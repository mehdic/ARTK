# ARTK Copilot Instructions

This file provides guidance to GitHub Copilot and other AI coding assistants for working with ARTK-based Playwright tests.

## Installed Variant: {{VARIANT_ID}}

- **Node.js Range**: {{NODE_RANGE}}
- **Playwright Version**: {{PLAYWRIGHT_VERSION}}
- **Module System**: {{MODULE_SYSTEM}}

## Critical: Vendor Directory Rules

**DO NOT modify files in `vendor/artk-core/` or `vendor/artk-core-autogen/`.**

These directories contain vendored ARTK code that:
1. Is automatically managed by ARTK CLI
2. Will be overwritten on upgrades
3. Is built for a specific Node.js version and module system

If you encounter issues with vendor code:
1. Check `variant-features.json` for feature availability
2. Suggest running `artk init --force` to reinstall
3. Use documented alternatives from `variant-features.json`

## Feature Availability

Before using Playwright features, check `vendor/artk-core/variant-features.json`:

```typescript
// Read feature availability
const features = require('./vendor/artk-core/variant-features.json');

if (!features.features.clock_api.available) {
  // Use alternative approach
  console.log(features.features.clock_api.alternative);
}
```

{{#if LEGACY_MODE}}
### Legacy Variant Limitations

This project uses a legacy ARTK variant ({{VARIANT_ID}}) with Playwright {{PLAYWRIGHT_VERSION}}.
Some modern features are NOT available:

{{#each UNAVAILABLE_FEATURES}}
- **{{name}}**: {{alternative}}
{{/each}}

When generating tests, always check feature availability first.
{{/if}}

## Import Patterns

{{#if ESM_MODE}}
### ESM Imports (Modern)

```typescript
// Correct ESM imports
import { test, expect } from '@playwright/test';
import { loadConfig } from '@artk/core/config';
import { AuthFixture } from '@artk/core/auth';
```
{{else}}
### CommonJS Imports

```typescript
// Correct CommonJS requires
const { test, expect } = require('@playwright/test');
const { loadConfig } = require('@artk/core/config');
const { AuthFixture } = require('@artk/core/auth');
```

**DO NOT use ESM import syntax in this project.**
{{/if}}

## Test Structure Guidelines

Follow ARTK patterns when generating tests:

```typescript
import { test, expect } from '@playwright/test';

test.describe('Feature Name', () => {
  test('should do something @smoke', async ({ page }) => {
    // Use data-testid selectors when available
    await page.getByTestId('submit-button').click();

    // Prefer web-first assertions
    await expect(page.getByRole('heading')).toHaveText('Success');
  });
});
```

## Tier Tags

Use tier tags in test names:
- `@smoke` - Critical path tests (run on every commit)
- `@release` - Feature tests (run before releases)
- `@regression` - Comprehensive tests (run nightly)

## Configuration

ARTK configuration is in `artk.config.yml`:
- Environment URLs
- Auth configuration
- Browser settings

**DO NOT hardcode URLs** - use config loader:

```typescript
import { getBaseUrl } from './config/env';

const baseUrl = getBaseUrl(process.env.ARTK_ENV || 'local');
```

## When You Encounter Errors

### Module/Import Errors

If you see `ERR_REQUIRE_ESM`, `Cannot use import statement`, or similar:

1. Check the variant's module system in this file
2. Suggest reinstalling: `artk init . --force`
3. Do NOT try to fix by modifying vendor code

### Feature Not Found

If a Playwright feature doesn't exist:

1. Check `variant-features.json` for availability
2. This variant uses Playwright {{PLAYWRIGHT_VERSION}}
3. Use the documented alternative approach

### Type Errors

If TypeScript complains about @artk/core:

1. Check `tsconfig.json` paths configuration
2. Ensure `node_modules` is populated (`npm install`)
3. The vendor code has its own type definitions

---

*Generated by ARTK CLI for variant {{VARIANT_ID}}*
