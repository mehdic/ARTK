{"version":3,"sources":["../src/lib/logger.ts","../src/lib/workflows/types.ts","../src/lib/workflows/journey-validate.ts","../src/lib/workflows/journey-implement.ts","../src/lib/workflows/index.ts","../src/commands/journey/check-llkb.ts","../src/lib/bootstrap.ts","../src/lib/environment.ts","../src/lib/browser-resolver.ts","../src/lib/config-validator.ts","../src/lib/variants/variant-definitions.ts","../src/lib/variants/variant-detector.ts","../src/lib/variants/variant-files.ts","../src/commands/init.ts","../src/lib/variants/variant-types.ts","../src/lib/variants/variant-schemas.ts","../src/lib/prerequisites.ts","../src/commands/check.ts","../src/lib/version.ts","../src/commands/upgrade.ts","../src/commands/doctor.ts","../src/commands/uninstall.ts","../src/commands/llkb/init.ts","../src/commands/llkb/export.ts","../src/commands/llkb/health.ts","../src/commands/llkb/stats.ts","../src/commands/llkb/prune.ts","../src/commands/llkb/learn.ts","../src/commands/llkb/check-updates.ts","../src/commands/llkb/update-test.ts","../src/commands/llkb/update-tests.ts","../src/commands/llkb/index.ts","../src/commands/journey/validate.ts","../src/commands/journey/implement.ts","../src/commands/journey/index.ts","../src/cli.ts"],"names":["z","path10","fs12","detectEnvironment","fs13","path12","resolve","spawn","path14","logger","path","fs","execSync","version","path2","fs3","yaml","path3","fs4","detectModuleSystem","__filename","__dirname","path4","fs5","fileURLToPath","configPath","variantDef","MIN_NODE_VERSION","fs7","getBrowserPaths","path6","fs8","path7","getAssetsDir","path8","path9","initCommand","program","existsSync","join","path11","path13","state","checkLlkbCommand"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,IAOa,MAAA;AAPb,IAAA,WAAA,GAAA,KAAA,CAAA;AAAA,EAAA,mBAAA,GAAA;AAOO,IAAM,SAAN,MAAa;AAAA,MACV,OAAA,GAAsB,IAAA;AAAA,MACtB,OAAA;AAAA,MAER,WAAA,CAAY,OAAA,GAAiC,EAAC,EAAG;AAC/C,QAAA,IAAA,CAAK,OAAA,GAAU,QAAQ,OAAA,IAAW,KAAA;AAAA,MACpC;AAAA,MAEA,OAAO,IAAA,EAAoB;AACzB,QAAA,OAAA,CAAQ,IAAI,EAAE,CAAA;AACd,QAAA,OAAA,CAAQ,GAAA,CAAI,KAAA,CAAM,KAAA,CAAM,QAAA,GAAM,QAAA,CAAI,MAAA,CAAO,IAAA,CAAK,MAAA,GAAS,CAAC,CAAA,GAAI,QAAG,CAAC,CAAA;AAChE,QAAA,OAAA,CAAQ,GAAA,CAAI,KAAA,CAAM,KAAA,CAAM,WAAM,CAAA,GAAI,KAAA,CAAM,IAAA,CAAK,KAAA,CAAM,IAAI,CAAA,GAAI,KAAA,CAAM,KAAA,CAAM,WAAM,CAAC,CAAA;AAC9E,QAAA,OAAA,CAAQ,GAAA,CAAI,KAAA,CAAM,KAAA,CAAM,QAAA,GAAM,QAAA,CAAI,MAAA,CAAO,IAAA,CAAK,MAAA,GAAS,CAAC,CAAA,GAAI,QAAG,CAAC,CAAA;AAChE,QAAA,OAAA,CAAQ,IAAI,EAAE,CAAA;AAAA,MAChB;AAAA,MAEA,IAAA,CAAK,OAAA,EAAiB,KAAA,EAAe,OAAA,EAAuB;AAC1D,QAAA,IAAA,CAAK,WAAA,EAAY;AACjB,QAAA,OAAA,CAAQ,GAAA,CAAI,KAAA,CAAM,MAAA,CAAO,CAAA,CAAA,EAAI,OAAO,IAAI,KAAK,CAAA,CAAA,CAAG,CAAA,GAAI,GAAA,GAAM,OAAO,CAAA;AAAA,MACnE;AAAA,MAEA,aAAa,OAAA,EAAuB;AAClC,QAAA,IAAA,CAAK,WAAA,EAAY;AACjB,QAAA,IAAA,CAAK,OAAA,GAAU,GAAA,CAAI,OAAO,CAAA,CAAE,KAAA,EAAM;AAAA,MACpC;AAAA,MAEA,cAAc,OAAA,EAAuB;AACnC,QAAA,IAAI,KAAK,OAAA,EAAS;AAChB,UAAA,IAAA,CAAK,QAAQ,IAAA,GAAO,OAAA;AAAA,QACtB;AAAA,MACF;AAAA,MAEA,eAAe,OAAA,EAAwB;AACrC,QAAA,IAAI,KAAK,OAAA,EAAS;AAChB,UAAA,IAAA,CAAK,OAAA,CAAQ,QAAQ,OAAO,CAAA;AAC5B,UAAA,IAAA,CAAK,OAAA,GAAU,IAAA;AAAA,QACjB;AAAA,MACF;AAAA,MAEA,YAAY,OAAA,EAAwB;AAClC,QAAA,IAAI,KAAK,OAAA,EAAS;AAChB,UAAA,IAAA,CAAK,OAAA,CAAQ,KAAK,OAAO,CAAA;AACzB,UAAA,IAAA,CAAK,OAAA,GAAU,IAAA;AAAA,QACjB;AAAA,MACF;AAAA,MAEA,WAAA,GAAoB;AAClB,QAAA,IAAI,KAAK,OAAA,EAAS;AAChB,UAAA,IAAA,CAAK,QAAQ,IAAA,EAAK;AAClB,UAAA,IAAA,CAAK,OAAA,GAAU,IAAA;AAAA,QACjB;AAAA,MACF;AAAA,MAEA,KAAK,OAAA,EAAuB;AAC1B,QAAA,OAAA,CAAQ,IAAI,KAAA,CAAM,IAAA,CAAK,QAAG,CAAA,GAAI,MAAM,OAAO,CAAA;AAAA,MAC7C;AAAA,MAEA,QAAQ,OAAA,EAAuB;AAC7B,QAAA,OAAA,CAAQ,IAAI,KAAA,CAAM,KAAA,CAAM,QAAG,CAAA,GAAI,MAAM,OAAO,CAAA;AAAA,MAC9C;AAAA,MAEA,QAAQ,OAAA,EAAuB;AAC7B,QAAA,OAAA,CAAQ,GAAA,CAAI,MAAM,MAAA,CAAO,QAAG,IAAI,GAAA,GAAM,KAAA,CAAM,MAAA,CAAO,OAAO,CAAC,CAAA;AAAA,MAC7D;AAAA,MAEA,MAAM,OAAA,EAAuB;AAC3B,QAAA,OAAA,CAAQ,GAAA,CAAI,MAAM,GAAA,CAAI,QAAG,IAAI,GAAA,GAAM,KAAA,CAAM,GAAA,CAAI,OAAO,CAAC,CAAA;AAAA,MACvD;AAAA,MAEA,MAAM,OAAA,EAAuB;AAC3B,QAAA,IAAI,KAAK,OAAA,EAAS;AAChB,UAAA,OAAA,CAAQ,GAAA,CAAI,KAAA,CAAM,IAAA,CAAK,IAAA,GAAO,OAAO,CAAC,CAAA;AAAA,QACxC;AAAA,MACF;AAAA,MAEA,IAAA,CAAK,KAAA,EAAiB,MAAA,GAAiB,CAAA,EAAS;AAC9C,QAAA,MAAM,MAAA,GAAS,GAAA,CAAI,MAAA,CAAO,MAAM,CAAA;AAChC,QAAA,KAAA,MAAW,QAAQ,KAAA,EAAO;AACxB,UAAA,OAAA,CAAQ,IAAI,MAAA,GAAS,KAAA,CAAM,IAAI,QAAG,CAAA,GAAI,MAAM,IAAI,CAAA;AAAA,QAClD;AAAA,MACF;AAAA,MAEA,MAAM,IAAA,EAAqD;AACzD,QAAA,MAAM,cAAA,GAAiB,IAAA,CAAK,GAAA,CAAI,GAAG,IAAA,CAAK,GAAA,CAAI,CAAC,CAAA,KAAM,CAAA,CAAE,KAAA,CAAM,MAAM,CAAC,CAAA;AAClE,QAAA,KAAA,MAAW,OAAO,IAAA,EAAM;AACtB,UAAA,MAAM,WAAA,GAAc,GAAA,CAAI,KAAA,CAAM,MAAA,CAAO,cAAc,CAAA;AACnD,UAAA,OAAA,CAAQ,GAAA,CAAI,OAAO,KAAA,CAAM,GAAA,CAAI,WAAW,CAAA,GAAI,IAAA,GAAO,IAAI,KAAK,CAAA;AAAA,QAC9D;AAAA,MACF;AAAA,MAEA,UAAU,KAAA,EAAuB;AAC/B,QAAA,OAAA,CAAQ,IAAI,EAAE,CAAA;AACd,QAAA,OAAA,CAAQ,GAAA,CAAI,KAAA,CAAM,IAAA,CAAK,aAAa,CAAC,CAAA;AACrC,QAAA,KAAA,CAAM,OAAA,CAAQ,CAAC,IAAA,EAAM,CAAA,KAAM;AACzB,UAAA,OAAA,CAAQ,GAAA,CAAI,MAAM,GAAA,CAAI,CAAA,EAAA,EAAK,IAAI,CAAC,CAAA,CAAA,CAAG,CAAA,GAAI,GAAA,GAAM,IAAI,CAAA;AAAA,QACnD,CAAC,CAAA;AACD,QAAA,OAAA,CAAQ,IAAI,EAAE,CAAA;AAAA,MAChB;AAAA,MAEA,KAAA,GAAc;AACZ,QAAA,OAAA,CAAQ,IAAI,EAAE,CAAA;AAAA,MAChB;AAAA,MAEA,OAAA,GAAgB;AACd,QAAA,OAAA,CAAQ,IAAI,KAAA,CAAM,GAAA,CAAI,SAAI,MAAA,CAAO,EAAE,CAAC,CAAC,CAAA;AAAA,MACvC;AAAA,KACF;AAGO,IAAe,IAAI,MAAA,EAAO;AAAA,EAAA;AAAA,CAAA,CAAA;ACejC,SAAS,iBAAA,GAA4B;AACnC,EAAA,MAAM,SAAA,GAAY,IAAA,CAAK,GAAA,EAAI,CAAE,SAAS,EAAE,CAAA;AACxC,EAAA,MAAM,MAAA,GAAS,KAAK,MAAA,EAAO,CAAE,SAAS,EAAE,CAAA,CAAE,SAAA,CAAU,CAAA,EAAG,CAAC,CAAA;AACxD,EAAA,OAAO,CAAA,KAAA,EAAQ,SAAS,CAAA,CAAA,EAAI,MAAM,CAAA,CAAA;AACpC;AAGO,SAAS,kBAAA,CACd,UAAA,EACA,SAAA,EACA,YAAA,EACc;AACd,EAAA,OAAO;AAAA,IACL,WAAW,iBAAA,EAAkB;AAAA,IAC7B,aAAA,EAAe,sBAAA;AAAA,IACf,iBAAA,EAAmB,UAAA;AAAA,IACnB,mBAAmB,EAAC;AAAA,IACpB,gBAAgB,EAAC;AAAA,IACjB,mBAAA,EAAqB,CAAA;AAAA,IACrB,eAAe,UAAA,CAAW,MAAA;AAAA,IAC1B,SAAA;AAAA,IACA,YAAA;AAAA,IACA,eAAA,EAAiB,CAAA;AAAA,IACjB,kBAAA,EAAoB,CAAA;AAAA,IACpB,kBAAA,EAAoB,CAAA;AAAA,IACpB,SAAA,EAAW,KAAK,GAAA,EAAI;AAAA,IACpB,gBAAA,EAAkB,IAAA;AAAA,IAClB,kBAAA,EAAoB,KAAA;AAAA,IACpB,gBAAgB;AAAC,GACnB;AACF;AAjKA,IAmBa,mBAAA,EAYA,wBAAA,EA+EA,gBAAA,EASA,YAAA,EAMA,0BAAA,EAGA,sBAAA;AAhIb,IAAA,UAAA,GAAA,KAAA,CAAA;AAAA,EAAA,4BAAA,GAAA;AAmBO,IAAM,mBAAA,GAAsBA,EAAE,IAAA,CAAK;AAAA,MACxC,UAAA;AAAA,MACA,SAAA;AAAA,MACA,WAAA;AAAA,MACA,aAAA;AAAA,MACA,aAAA;AAAA,MACA;AAAA,KACD,CAAA;AAKM,IAAM,wBAAA,GAA2BA,EAAE,MAAA,CAAO;AAAA,MAC/C,IAAIA,CAAAA,CAAE,MAAA,EAAO,CAAE,KAAA,CAAM,eAAe,wCAAwC,CAAA;AAAA,MAC5E,OAAOA,CAAAA,CAAE,MAAA,EAAO,CAAE,GAAA,CAAI,GAAG,mBAAmB,CAAA;AAAA,MAC5C,MAAA,EAAQ,mBAAA;AAAA,MACR,KAAA,EAAOA,CAAAA,CAAE,KAAA,CAAMA,CAAAA,CAAE,MAAA,EAAQ,CAAA,CAAE,QAAA,EAAS,CAAE,OAAA,CAAQ,EAAE,CAAA;AAAA,MAChD,IAAA,EAAMA,EAAE,IAAA,CAAK,CAAC,SAAS,SAAA,EAAW,YAAY,CAAC,CAAA,CAAE,QAAA,EAAS;AAAA,MAC1D,KAAA,EAAOA,CAAAA,CAAE,MAAA,EAAO,CAAE,QAAA,EAAS;AAAA,MAC3B,KAAA,EAAOA,CAAAA,CAAE,MAAA,EAAO,CAAE,QAAA;AAAS,KAC5B,EAAE,WAAA,EAAY;AAuER,IAAM,gBAAA,GAAmBA,EAAE,MAAA,CAAO;AAAA,MACvC,OAAA,EAASA,EAAE,OAAA,EAAQ;AAAA,MACnB,OAAA,EAASA,CAAAA,CAAE,MAAA,EAAO,CAAE,QAAA,EAAS;AAAA,MAC7B,aAAA,EAAeA,CAAAA,CAAE,MAAA,EAAO,CAAE,GAAA,CAAI,CAAC,CAAA,CAAE,GAAA,CAAI,CAAC,CAAA,CAAE,QAAA;AAAS,KAClD,EAAE,WAAA,EAAY;AAKR,IAAM,YAAA,GAAe;AAAA,MAC1B,UAAA,EAAY,EAAA;AAAA,MACZ,UAAA,EAAY;AAAA,KACd;AAGO,IAAM,0BAAA,GAA6B,IAAI,EAAA,GAAK,GAAA;AAG5C,IAAM,sBAAA,GAAyB,OAAA;AAAA,EAAA;AAAA,CAAA,CAAA;ACjG/B,SAAS,UAAA,CAAW,YAAoB,QAAA,EAA2B;AAExE,EAAA,MAAM,gBAAA,GAAwBC,cAAQ,UAAU,CAAA;AAChD,EAAA,MAAM,cAAA,GAAsBA,cAAQ,QAAQ,CAAA;AAG5C,EAAA,MAAM,SAAA,GAAY,QAAQ,QAAA,KAAa,OAAA;AAEvC,EAAA,MAAM,aAAA,GAAgB,SAAA,GAAY,gBAAA,CAAiB,WAAA,EAAY,GAAI,gBAAA;AACnE,EAAA,MAAM,WAAA,GAAc,SAAA,GAAY,cAAA,CAAe,WAAA,EAAY,GAAI,cAAA;AAG/D,EAAA,MAAM,cAAc,WAAA,GAAmBA,KAAA,CAAA,GAAA;AAEvC,EAAA,OAAO,aAAA,KAAkB,WAAA,IAAe,aAAA,CAAc,UAAA,CAAW,WAAW,CAAA;AAC9E;AAKO,SAAS,iBAAiB,EAAA,EAAqB;AACpD,EAAA,OAAO,aAAA,CAAc,KAAK,EAAE,CAAA;AAC9B;AAkBO,SAAS,wBAAwB,OAAA,EAA8B;AACpE,EAAA,MAAM,KAAA,GAAQ,OAAA,CAAQ,KAAA,CAAM,uBAAuB,CAAA;AACnD,EAAA,IAAI,CAAC,KAAA,EAAO;AACV,IAAA,OAAO;AAAA,MACL,OAAA,EAAS,KAAA;AAAA,MACT,KAAA,EAAO;AAAA,KACT;AAAA,EACF;AAEA,EAAA,IAAI;AACF,IAAA,MAAM,MAAA,GAAc,KAAA,CAAA,KAAA,CAAM,KAAA,CAAM,CAAC,CAAC,CAAA;AAClC,IAAA,MAAM,MAAA,GAAS,wBAAA,CAAyB,SAAA,CAAU,MAAM,CAAA;AAExD,IAAA,IAAI,CAAC,OAAO,OAAA,EAAS;AACnB,MAAA,MAAM,OAAA,GAAU,MAAA,CAAO,KAAA,CAAM,MAAA,CAAO,GAAA;AAAA,QAAI,CAAA,KAAA,KACtC,GAAG,KAAA,CAAM,IAAA,CAAK,KAAK,GAAG,CAAC,CAAA,EAAA,EAAK,KAAA,CAAM,OAAO,CAAA;AAAA,OAC3C;AACA,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,KAAA;AAAA,QACT,KAAA,EAAO,4BAAA;AAAA,QACP;AAAA,OACF;AAAA,IACF;AAEA,IAAA,OAAO,EAAE,OAAA,EAAS,IAAA,EAAM,IAAA,EAAM,OAAO,IAAA,EAAK;AAAA,EAC5C,SAAS,CAAA,EAAG;AACV,IAAA,OAAO;AAAA,MACL,OAAA,EAAS,KAAA;AAAA,MACT,KAAA,EAAO,qBAAqB,CAAA,YAAa,KAAA,GAAQ,EAAE,OAAA,GAAU,MAAA,CAAO,CAAC,CAAC,CAAA;AAAA,KACxE;AAAA,EACF;AACF;AAeO,SAAS,WAAA,CAAY,aAAqB,WAAA,EAAyC;AAExF,EAAA,IAAI,WAAA,IAAe,CAAC,UAAA,CAAW,WAAA,EAAa,WAAW,CAAA,EAAG;AACxD,IAAA,OAAO,EAAE,OAAA,EAAS,IAAA,EAAM,KAAA,EAAO,0DAAA,EAA2D;AAAA,EAC5F;AAEA,EAAA,IAAI;AACF,IAAA,IAAI,CAAIC,GAAA,CAAA,UAAA,CAAW,WAAW,CAAA,EAAG;AAC/B,MAAA,OAAO,EAAE,OAAA,EAAS,IAAA,EAAM,KAAA,EAAO,gBAAA,EAAiB;AAAA,IAClD;AAEA,IAAA,MAAM,OAAA,GAAaA,GAAA,CAAA,YAAA,CAAa,WAAA,EAAa,OAAO,CAAA;AACpD,IAAA,MAAM,WAAA,GAAc,wBAAwB,OAAO,CAAA;AAEnD,IAAA,IAAI,CAAC,YAAY,OAAA,EAAS;AACxB,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,IAAA;AAAA,QACT,OAAO,WAAA,CAAY,KAAA;AAAA,QACnB,SAAS,WAAA,CAAY;AAAA,OACvB;AAAA,IACF;AAEA,IAAA,OAAO;AAAA,MACL,OAAA,EAAS;AAAA,QACP,EAAA,EAAI,YAAY,IAAA,CAAK,EAAA;AAAA,QACrB,IAAA,EAAM,WAAA;AAAA,QACN,MAAA,EAAQ,YAAY,IAAA,CAAK,MAAA;AAAA,QACzB,KAAA,EAAO,YAAY,IAAA,CAAK,KAAA;AAAA,QACxB,KAAA,EAAO,YAAY,IAAA,CAAK;AAAA;AAC1B,KACF;AAAA,EACF,SAAS,CAAA,EAAG;AACV,IAAA,OAAO;AAAA,MACL,OAAA,EAAS,IAAA;AAAA,MACT,KAAA,EAAO,oBAAoB,CAAA,YAAa,KAAA,GAAQ,EAAE,OAAA,GAAU,MAAA,CAAO,CAAC,CAAC,CAAA;AAAA,KACvE;AAAA,EACF;AACF;AAKO,SAAS,iCAAiC,OAAA,EAAwC;AACvF,EAAA,MAAM,SAAmB,EAAC;AAC1B,EAAA,MAAM,WAAqB,EAAC;AAG5B,EAAA,IAAI,CAAC,QAAQ,EAAA,EAAI;AACf,IAAA,MAAA,CAAO,KAAK,uCAAuC,CAAA;AAAA,EACrD,CAAA,MAAA,IAAW,CAAC,gBAAA,CAAiB,OAAA,CAAQ,EAAE,CAAA,EAAG;AACxC,IAAA,MAAA,CAAO,IAAA,CAAK,CAAA,YAAA,EAAe,OAAA,CAAQ,EAAE,CAAA,iCAAA,CAAmC,CAAA;AAAA,EAC1E;AAGA,EAAA,MAAM,aAAA,GAAyC,CAAC,WAAA,EAAa,SAAS,CAAA;AACtE,EAAA,IAAI,CAAC,aAAA,CAAc,QAAA,CAAS,OAAA,CAAQ,MAAM,CAAA,EAAG;AAC3C,IAAA,IAAI,OAAA,CAAQ,WAAW,UAAA,EAAY;AACjC,MAAA,MAAA,CAAO,KAAK,CAAA,wGAAA,CAA0G,CAAA;AAAA,IACxH,CAAA,MAAA,IAAW,OAAA,CAAQ,MAAA,KAAW,aAAA,EAAe;AAC3C,MAAA,QAAA,CAAS,KAAK,mEAAmE,CAAA;AAAA,IACnF,CAAA,MAAA,IAAW,OAAA,CAAQ,MAAA,KAAW,aAAA,EAAe;AAC3C,MAAA,MAAA,CAAO,KAAK,gEAAgE,CAAA;AAAA,IAC9E,CAAA,MAAA,IAAW,OAAA,CAAQ,MAAA,KAAW,YAAA,EAAc;AAC1C,MAAA,MAAA,CAAO,KAAK,sDAAsD,CAAA;AAAA,IACpE;AAAA,EACF;AAGA,EAAA,IAAI,OAAA,CAAQ,WAAW,SAAA,EAAW;AAChC,IAAA,QAAA,CAAS,KAAK,oHAAoH,CAAA;AAAA,EACpI;AAEA,EAAA,OAAO;AAAA,IACL,KAAA,EAAO,OAAO,MAAA,KAAW,CAAA;AAAA,IACzB,MAAA;AAAA,IACA;AAAA,GACF;AACF;AAKO,SAAS,aAAa,QAAA,EAAoC;AAC/D,EAAA,MAAM,SAAmB,EAAC;AAC1B,EAAA,MAAM,WAAqB,EAAC;AAE5B,EAAA,IAAI;AAEF,IAAA,IAAI,CAAIA,GAAA,CAAA,UAAA,CAAW,QAAQ,CAAA,EAAG;AAC5B,MAAA,MAAA,CAAO,IAAA,CAAK,CAAA,0BAAA,EAA6B,QAAQ,CAAA,CAAE,CAAA;AACnD,MAAA,MAAA,CAAO,KAAK,+CAA+C,CAAA;AAC3D,MAAA,OAAO,EAAE,KAAA,EAAO,KAAA,EAAO,MAAA,EAAQ,QAAA,EAAS;AAAA,IAC1C;AAGA,IAAA,MAAM,UAAA,GAAkBD,KAAA,CAAA,IAAA,CAAK,QAAA,EAAU,YAAY,CAAA;AACnD,IAAA,IAAI,CAAIC,GAAA,CAAA,UAAA,CAAW,UAAU,CAAA,EAAG;AAC9B,MAAA,MAAA,CAAO,IAAA,CAAK,CAAA,uBAAA,EAA0B,UAAU,CAAA,CAAE,CAAA;AAClD,MAAA,OAAO,EAAE,KAAA,EAAO,KAAA,EAAO,MAAA,EAAQ,QAAA,EAAS;AAAA,IAC1C;AAGA,IAAA,MAAM,aAAA,GAAmBA,GAAA,CAAA,YAAA,CAAa,UAAA,EAAY,OAAO,CAAA;AACzD,IAAA,MAAM,YAAA,GAAoB,YAAM,aAAa,CAAA;AAC7C,IAAA,MAAM,YAAA,GAAe,gBAAA,CAAiB,SAAA,CAAU,YAAY,CAAA;AAE5D,IAAA,IAAI,CAAC,aAAa,OAAA,EAAS;AACzB,MAAA,MAAM,OAAA,GAAU,YAAA,CAAa,KAAA,CAAM,MAAA,CAAO,GAAA;AAAA,QAAI,CAAA,KAAA,KAC5C,GAAG,KAAA,CAAM,IAAA,CAAK,KAAK,GAAG,CAAC,CAAA,EAAA,EAAK,KAAA,CAAM,OAAO,CAAA;AAAA,OAC3C,CAAE,KAAK,IAAI,CAAA;AACX,MAAA,MAAA,CAAO,IAAA,CAAK,CAAA,qBAAA,EAAwB,OAAO,CAAA,CAAE,CAAA;AAC7C,MAAA,OAAO,EAAE,KAAA,EAAO,KAAA,EAAO,MAAA,EAAQ,QAAA,EAAS;AAAA,IAC1C;AAEA,IAAA,IAAI,YAAA,CAAa,IAAA,CAAK,OAAA,KAAY,KAAA,EAAO;AACvC,MAAA,MAAA,CAAO,KAAK,gEAAgE,CAAA;AAAA,IAC9E;AAGA,IAAA,IAAI,YAAA,CAAa,IAAA,CAAK,aAAA,KAAkB,KAAA,CAAA,EAAW;AACjD,MAAA,IAAI,YAAA,CAAa,IAAA,CAAK,aAAA,GAAgB,GAAA,EAAK;AACzC,QAAA,QAAA,CAAS,IAAA,CAAK,CAAA,sBAAA,EAAyB,YAAA,CAAa,IAAA,CAAK,aAAa,CAAA,yCAAA,CAA2C,CAAA;AAAA,MACnH;AAAA,IACF;AAGA,IAAA,MAAM,aAAA,GAAgB,CAAC,iBAAA,EAAmB,cAAc,CAAA;AACxD,IAAA,KAAA,MAAW,QAAQ,aAAA,EAAe;AAChC,MAAA,MAAM,QAAA,GAAgBD,KAAA,CAAA,IAAA,CAAK,QAAA,EAAU,IAAI,CAAA;AACzC,MAAA,IAAI,CAAIC,GAAA,CAAA,UAAA,CAAW,QAAQ,CAAA,EAAG;AAC5B,QAAA,QAAA,CAAS,IAAA,CAAK,CAAA,mBAAA,EAAsB,IAAI,CAAA,gCAAA,CAAkC,CAAA;AAAA,MAC5E;AAAA,IACF;AAEA,IAAA,OAAO;AAAA,MACL,KAAA,EAAO,OAAO,MAAA,KAAW,CAAA;AAAA,MACzB,MAAA;AAAA,MACA;AAAA,KACF;AAAA,EACF,SAAS,CAAA,EAAG;AACV,IAAA,MAAM,UAAU,CAAA,YAAa,KAAA,GAAQ,CAAA,CAAE,OAAA,GAAU,OAAO,CAAC,CAAA;AACzD,IAAA,OAAO;AAAA,MACL,KAAA,EAAO,KAAA;AAAA,MACP,MAAA,EAAQ,CAAC,CAAA,yBAAA,EAA4B,OAAO,CAAA,CAAE,CAAA;AAAA,MAC9C;AAAA,KACF;AAAA,EACF;AACF;AAMO,SAAS,kBAAkB,SAAA,EAKhC;AACA,EAAA,MAAM,KAAA,GAAQ,SAAA,CAAU,WAAA,EAAY,CAAE,IAAA,EAAK;AAG3C,EAAA,IAAI,UAAU,UAAA,EAAY;AACxB,IAAA,OAAO;AAAA,MACL,KAAA,EAAO,IAAA;AAAA,MACP,UAAA,EAAY,QAAA;AAAA,MACZ,OAAA,EAAS;AAAA,KACX;AAAA,EACF;AAGA,EAAA,IAAI,UAAU,UAAA,EAAY;AACxB,IAAA,OAAO;AAAA,MACL,KAAA,EAAO,KAAA;AAAA,MACP,UAAA,EAAY,QAAA;AAAA,MACZ,KAAA,EAAO;AAAA,KACT;AAAA,EACF;AAGA,EAAA,IAAI,KAAA,KAAU,QAAA,IAAY,KAAA,KAAU,EAAA,EAAI;AACtC,IAAA,OAAO,EAAE,KAAA,EAAO,IAAA,EAAM,UAAA,EAAY,QAAA,EAAS;AAAA,EAC7C;AAGA,EAAA,OAAO;AAAA,IACL,KAAA,EAAO,KAAA;AAAA,IACP,UAAA,EAAY,QAAA;AAAA,IACZ,KAAA,EAAO,wBAAwB,SAAS,CAAA,uBAAA;AAAA,GAC1C;AACF;AAKO,SAAS,qBAAqB,YAAA,EAInC;AACA,EAAA,MAAM,UAAA,GAAa,YAAA,CAAa,WAAA,EAAY,CAAE,IAAA,EAAK;AAEnD,EAAA,IAAI,UAAA,KAAe,QAAA,IAAY,UAAA,KAAe,OAAA,IAAW,eAAe,MAAA,EAAQ;AAC9E,IAAA,OAAO,EAAE,KAAA,EAAO,IAAA,EAAM,UAAA,EAAW;AAAA,EACnC;AAGA,EAAA,OAAO;AAAA,IACL,KAAA,EAAO,KAAA;AAAA,IACP,UAAA,EAAY,QAAA;AAAA,IACZ,KAAA,EAAO,2BAA2B,YAAY,CAAA,qCAAA;AAAA,GAChD;AACF;AAeO,SAAS,gBAAA,CAAiB,aAAqB,UAAA,EAA8C;AAClG,EAAA,MAAM,KAAA,uBAAY,GAAA,EAA2B;AAC7C,EAAA,MAAM,UAAA,uBAAiB,GAAA,EAAsB;AAC7C,EAAA,MAAM,WAAA,GAAmBD,KAAA,CAAA,IAAA,CAAK,WAAA,EAAa,UAAU,CAAA;AAGrD,EAAA,MAAM,QAAA,GAAW,UAAA,CAAW,MAAA,CAAO,gBAAgB,CAAA;AAEnD,EAAA,KAAA,MAAW,MAAM,QAAA,EAAU;AACzB,IAAA,MAAM,YAAsB,EAAC;AAE7B,IAAA,MAAM,WAAW,CAAC,WAAA,EAAa,WAAW,UAAA,EAAY,aAAA,EAAe,eAAe,YAAY,CAAA;AAEhG,IAAA,KAAA,MAAW,UAAU,QAAA,EAAU;AAC7B,MAAA,MAAM,SAAA,GAAiBA,KAAA,CAAA,IAAA,CAAK,WAAA,EAAa,MAAM,CAAA;AAG/C,MAAA,IAAI,CAAC,UAAA,CAAW,SAAA,EAAW,WAAW,CAAA,EAAG;AACvC,QAAA;AAAA,MACF;AAEA,MAAA,IAAI;AACF,QAAA,IAAI,CAAIC,GAAA,CAAA,UAAA,CAAW,SAAS,CAAA,EAAG;AAE/B,QAAA,MAAM,KAAA,GAAWA,gBAAY,SAAS,CAAA;AACtC,QAAA,MAAM,KAAA,GAAQ,KAAA,CAAM,IAAA,CAAK,CAAA,CAAA,KAAK,CAAA,CAAE,UAAA,CAAW,CAAA,EAAG,EAAE,CAAA,EAAA,CAAI,CAAA,IAAK,CAAA,CAAE,QAAA,CAAS,KAAK,CAAC,CAAA;AAE1E,QAAA,IAAI,KAAA,EAAO;AACT,UAAA,MAAM,QAAA,GAAgBD,KAAA,CAAA,IAAA,CAAK,SAAA,EAAW,KAAK,CAAA;AAG3C,UAAA,IAAI,UAAA,CAAW,QAAA,EAAU,WAAW,CAAA,EAAG;AACrC,YAAA,SAAA,CAAU,KAAK,QAAQ,CAAA;AAAA,UACzB;AAAA,QACF;AAAA,MACF,CAAA,CAAA,MAAQ;AAEN,QAAA;AAAA,MACF;AAAA,IACF;AAEA,IAAA,IAAI,SAAA,CAAU,SAAS,CAAA,EAAG;AAExB,MAAA,UAAA,CAAW,GAAA,CAAI,IAAI,SAAS,CAAA;AAE5B,MAAA,KAAA,CAAM,GAAA,CAAI,EAAA,EAAI,SAAA,CAAU,CAAC,CAAC,CAAA;AAAA,IAC5B,CAAA,MAAA,IAAW,SAAA,CAAU,MAAA,KAAW,CAAA,EAAG;AACjC,MAAA,KAAA,CAAM,GAAA,CAAI,EAAA,EAAI,SAAA,CAAU,CAAC,CAAC,CAAA;AAAA,IAC5B,CAAA,MAAO;AACL,MAAA,KAAA,CAAM,GAAA,CAAI,IAAI,IAAI,CAAA;AAAA,IACpB;AAAA,EACF;AAGA,EAAA,KAAA,MAAW,MAAM,UAAA,EAAY;AAC3B,IAAA,IAAI,CAAC,SAAS,QAAA,CAAS,EAAE,KAAK,CAAC,KAAA,CAAM,GAAA,CAAI,EAAE,CAAA,EAAG;AAC5C,MAAA,KAAA,CAAM,GAAA,CAAI,IAAI,IAAI,CAAA;AAAA,IACpB;AAAA,EACF;AAEA,EAAA,OAAO,EAAE,OAAO,UAAA,EAAW;AAC7B;AAYO,SAAS,iBAAiB,KAAA,EAAyB;AACxD,EAAA,MAAM,GAAA,uBAAU,GAAA,EAAY;AAG5B,EAAA,MAAM,KAAA,GAAQ,KAAA,CAAM,KAAA,CAAM,GAAG,CAAA,CAAE,GAAA,CAAI,CAAA,CAAA,KAAK,CAAA,CAAE,IAAA,EAAM,CAAA,CAAE,MAAA,CAAO,OAAO,CAAA;AAEhE,EAAA,KAAA,MAAW,QAAQ,KAAA,EAAO;AAExB,IAAA,MAAM,UAAA,GAAa,IAAA,CAAK,KAAA,CAAM,gCAAgC,CAAA;AAC9D,IAAA,IAAI,UAAA,EAAY;AACd,MAAA,MAAM,KAAA,GAAQ,QAAA,CAAS,UAAA,CAAW,CAAC,GAAG,EAAE,CAAA;AACxC,MAAA,MAAM,GAAA,GAAM,QAAA,CAAS,UAAA,CAAW,CAAC,GAAG,EAAE,CAAA;AAGtC,MAAA,MAAM,GAAA,GAAM,IAAA,CAAK,GAAA,CAAI,KAAA,EAAO,GAAG,CAAA;AAC/B,MAAA,MAAM,GAAA,GAAM,IAAA,CAAK,GAAA,CAAI,KAAA,EAAO,GAAG,CAAA;AAE/B,MAAA,KAAA,IAAS,CAAA,GAAI,GAAA,EAAK,CAAA,IAAK,GAAA,EAAK,CAAA,EAAA,EAAK;AAC/B,QAAA,GAAA,CAAI,GAAA,CAAI,OAAO,CAAA,CAAE,QAAA,GAAW,QAAA,CAAS,CAAA,EAAG,GAAG,CAAC,CAAA,CAAE,CAAA;AAAA,MAChD;AAAA,IACF,CAAA,MAAA,IAAW,gBAAA,CAAiB,IAAI,CAAA,EAAG;AACjC,MAAA,GAAA,CAAI,IAAI,IAAI,CAAA;AAAA,IACd;AAAA,EAEF;AAGA,EAAA,OAAO,MAAM,IAAA,CAAK,GAAG,EAAE,IAAA,CAAK,CAAC,GAAG,CAAA,KAAM;AACpC,IAAA,MAAM,OAAO,QAAA,CAAS,CAAA,CAAE,QAAQ,MAAA,EAAQ,EAAE,GAAG,EAAE,CAAA;AAC/C,IAAA,MAAM,OAAO,QAAA,CAAS,CAAA,CAAE,QAAQ,MAAA,EAAQ,EAAE,GAAG,EAAE,CAAA;AAC/C,IAAA,OAAO,IAAA,GAAO,IAAA;AAAA,EAChB,CAAC,CAAA;AACH;AAKO,SAAS,kBAAkB,KAAA,EAIhC;AACA,EAAA,IAAI,SAAS,CAAA,EAAG;AACd,IAAA,OAAO,EAAE,KAAA,EAAO,KAAA,EAAO,KAAA,EAAO,kCAAA,EAAmC;AAAA,EACnE;AAEA,EAAA,IAAI,KAAA,GAAQ,aAAa,UAAA,EAAY;AACnC,IAAA,OAAO;AAAA,MACL,KAAA,EAAO,KAAA;AAAA,MACP,KAAA,EAAO,CAAA,mBAAA,EAAsB,KAAK,CAAA,aAAA,EAAgB,aAAa,UAAU,CAAA,sBAAA;AAAA,KAC3E;AAAA,EACF;AAEA,EAAA,IAAI,KAAA,GAAQ,aAAa,UAAA,EAAY;AACnC,IAAA,OAAO;AAAA,MACL,KAAA,EAAO,IAAA;AAAA,MACP,OAAA,EAAS,CAAA,WAAA,EAAc,KAAK,CAAA,2CAAA,EAA8C,aAAa,UAAU,CAAA,8BAAA;AAAA,KACnG;AAAA,EACF;AAEA,EAAA,OAAO,EAAE,OAAO,IAAA,EAAK;AACvB;AA9dA,IAAA,qBAAA,GAAA,KAAA,CAAA;AAAA,EAAA,uCAAA,GAAA;AAgBA,IAAA,UAAA,EAAA;AAAA,EAAA;AAAA,CAAA,CAAA;AC+DO,SAASE,kBAAAA,GAA0C;AAExD,EAAA,IAAI,OAAA,CAAQ,IAAI,UAAA,IAAc,OAAA,CAAQ,IAAI,UAAA,IAAc,OAAA,CAAQ,GAAA,CAAI,YAAA,KAAiB,QAAA,EAAU;AAC7F,IAAA,OAAO,cAAA;AAAA,EACT;AAGA,EAAA,IAAI,QAAQ,GAAA,CAAI,eAAA,IAAmB,OAAA,CAAQ,GAAA,CAAI,iBAAiB,QAAA,EAAU;AACxE,IAAA,OAAO,cAAA;AAAA,EACT;AAGA,EAAA,IAAI,OAAA,CAAQ,IAAI,aAAA,IAAiB,OAAA,CAAQ,IAAI,iBAAA,EAAmB,QAAA,CAAS,WAAW,CAAA,EAAG;AACrF,IAAA,OAAO,cAAA;AAAA,EACT;AAGA,EAAA,IACE,OAAA,CAAQ,IAAI,cAAA,KAAmB,MAAA,IAC/B,QAAQ,GAAA,CAAI,SAAA,KAAc,MAAA,IAC1B,OAAA,CAAQ,GAAA,CAAI,WAAA,IACZ,QAAQ,GAAA,CAAI,QAAA,KAAa,UACzB,OAAA,CAAQ,GAAA,CAAI,WAAW,MAAA,IACvB,OAAA,CAAQ,GAAA,CAAI,EAAA,KAAO,MAAA,EACnB;AACA,IAAA,OAAO,aAAA;AAAA,EACT;AAGA,EAAA,IAAI,QAAQ,GAAA,CAAI,UAAA,KAAe,MAAA,IAAU,OAAA,CAAQ,IAAI,sBAAA,EAAwB;AAC3E,IAAA,OAAO,YAAA;AAAA,EACT;AAGA,EAAA,IAAI,OAAA,CAAQ,GAAA,CAAI,eAAA,IAAmB,OAAA,CAAQ,IAAI,MAAA,EAAQ;AACrD,IAAA,OAAO,cAAA;AAAA,EACT;AAGA,EAAA,IAAOC,eAAW,aAAa,CAAA,IAAK,OAAA,CAAQ,GAAA,CAAI,cAAc,QAAA,EAAU;AACtE,IAAA,OAAO,cAAA;AAAA,EACT;AAGA,EAAA,IAAI,OAAA,CAAQ,OAAO,KAAA,EAAO;AACxB,IAAA,OAAO,cAAA;AAAA,EACT;AAEA,EAAA,OAAO,SAAA;AACT;AAKO,SAAS,kBAAkB,WAAA,EAA4E;AAC5G,EAAA,QAAQ,WAAA;AAAa,IACnB,KAAK,cAAA;AACH,MAAA,OAAO,EAAE,WAAW,IAAA,EAAK;AAAA,IAC3B,KAAK,cAAA;AACH,MAAA,OAAO,EAAE,WAAW,IAAA,EAAK;AAAA,IAC3B,KAAK,aAAA;AACH,MAAA,OAAO,EAAE,WAAW,IAAA,EAAK;AAAA,IAC3B,KAAK,YAAA;AACH,MAAA,OAAO;AAAA,QACL,SAAA,EAAW,KAAA;AAAA,QACX,MAAA,EAAQ;AAAA,OACV;AAAA,IACF,KAAK,SAAA;AACH,MAAA,OAAO;AAAA,QACL,SAAA,EAAW,KAAA;AAAA,QACX,MAAA,EAAQ;AAAA,OACV;AAAA;AAEN;AAKO,SAAS,kBAAA,CACd,KACA,OAAA,EAC+B;AAC/B,EAAA,MAAM,SAAmB,EAAC;AAC1B,EAAA,MAAM,WAAqB,EAAC;AAG5B,EAAA,MAAM,cAAcD,kBAAAA,EAAkB;AAGtC,EAAA,MAAM,aAAA,GAAgB,kBAAkB,WAAW,CAAA;AACnD,EAAA,IAAI,CAAC,aAAA,CAAc,SAAA,IAAa,CAAC,QAAQ,MAAA,EAAQ;AAC/C,IAAA,OAAO;AAAA,MACL,OAAA,EAAS,KAAA;AAAA,MACT,KAAA,EAAO,cAAc,MAAA,IAAU;AAAA,KACjC;AAAA,EACF;AAEA,EAAA,IAAI,CAAC,aAAA,CAAc,SAAA,IAAa,OAAA,CAAQ,MAAA,EAAQ;AAC9C,IAAA,QAAA,CAAS,IAAA,CAAK,CAAA,EAAG,aAAA,CAAc,MAAM,CAAA,mBAAA,CAAqB,CAAA;AAAA,EAC5D;AAGA,EAAA,MAAM,UAAA,GAAa,gBAAA,CAAiB,OAAA,CAAQ,UAAU,CAAA;AACtD,EAAA,IAAI,UAAA,CAAW,WAAW,CAAA,EAAG;AAC3B,IAAA,OAAO;AAAA,MACL,OAAA,EAAS,KAAA;AAAA,MACT,KAAA,EAAO;AAAA,KACT;AAAA,EACF;AAGA,EAAA,MAAM,eAAA,GAAkB,iBAAA,CAAkB,UAAA,CAAW,MAAM,CAAA;AAC3D,EAAA,IAAI,CAAC,gBAAgB,KAAA,EAAO;AAC1B,IAAA,OAAO,EAAE,OAAA,EAAS,KAAA,EAAO,KAAA,EAAO,gBAAgB,KAAA,EAAM;AAAA,EACxD;AACA,EAAA,IAAI,gBAAgB,OAAA,EAAS;AAC3B,IAAA,QAAA,CAAS,IAAA,CAAK,gBAAgB,OAAO,CAAA;AAAA,EACvC;AAGA,EAAA,MAAM,eAAA,GAAkB,iBAAA,CAAkB,OAAA,CAAQ,SAAA,IAAa,QAAQ,CAAA;AACvE,EAAA,IAAI,CAAC,gBAAgB,KAAA,EAAO;AAC1B,IAAA,OAAO;AAAA,MACL,OAAA,EAAS,KAAA;AAAA,MACT,KAAA,EAAO,eAAA,CAAgB,KAAA,IAAS,CAAA,oBAAA,EAAuB,QAAQ,SAAS,CAAA,sBAAA;AAAA,KAC1E;AAAA,EACF;AACA,EAAA,IAAI,gBAAgB,OAAA,EAAS;AAC3B,IAAA,QAAA,CAAS,IAAA,CAAK,gBAAgB,OAAO,CAAA;AAAA,EACvC;AAGA,EAAA,MAAM,kBAAA,GAAqB,oBAAA,CAAqB,OAAA,CAAQ,YAAA,IAAgB,QAAQ,CAAA;AAChF,EAAA,IAAI,CAAC,mBAAmB,KAAA,EAAO;AAC7B,IAAA,OAAO;AAAA,MACL,OAAA,EAAS,KAAA;AAAA,MACT,KAAA,EAAO,CAAA,uBAAA,EAA0B,OAAA,CAAQ,YAAY,CAAA,mCAAA;AAAA,KACvD;AAAA,EACF;AAGA,EAAA,IAAI,eAAA,CAAgB,UAAA,KAAe,QAAA,IAAY,kBAAA,CAAmB,eAAe,OAAA,EAAS;AACxF,IAAA,QAAA,CAAS,KAAK,0GAA0G,CAAA;AAAA,EAC1H;AAGA,EAAA,MAAM,UAAA,GAAa,YAAA,CAAa,GAAA,CAAI,QAAQ,CAAA;AAC5C,EAAA,IAAI,CAAC,WAAW,KAAA,EAAO;AACrB,IAAA,OAAO;AAAA,MACL,OAAA,EAAS,KAAA;AAAA,MACT,KAAA,EAAO,UAAA,CAAW,MAAA,CAAO,IAAA,CAAK,IAAI;AAAA,KACpC;AAAA,EACF;AACA,EAAA,QAAA,CAAS,IAAA,CAAK,GAAG,UAAA,CAAW,QAAQ,CAAA;AAGpC,EAAA,MAAM,UAAA,GAAa,gBAAA,CAAiB,GAAA,CAAI,WAAA,EAAa,UAAU,CAAA;AAC/D,EAAA,MAAM,WAA0B,EAAC;AAGjC,EAAA,KAAA,MAAW,CAAC,EAAA,EAAI,KAAK,CAAA,IAAK,WAAW,UAAA,EAAY;AAC/C,IAAA,QAAA,CAAS,IAAA;AAAA,MACP,CAAA,QAAA,EAAW,EAAE,CAAA,8BAAA,EAAiC,KAAA,CAAM,IAAI,CAAA,CAAA,KAAUE,KAAA,CAAA,QAAA,CAAcA,KAAA,CAAA,OAAA,CAAQ,CAAC,CAAC,CAAC,CAAA,CAAE,IAAA,CAAK,IAAI,CAAC,CAAA,yBAAA;AAAA,KACzG;AAAA,EACF;AAEA,EAAA,KAAA,MAAW,MAAM,UAAA,EAAY;AAC3B,IAAA,MAAM,WAAA,GAAc,UAAA,CAAW,KAAA,CAAM,GAAA,CAAI,EAAE,CAAA;AAC3C,IAAA,IAAI,CAAC,WAAA,EAAa;AAChB,MAAA,MAAA,CAAO,IAAA,CAAK,CAAA,mBAAA,EAAsB,EAAE,CAAA,CAAE,CAAA;AACtC,MAAA;AAAA,IACF;AAGA,IAAA,IAAI,CAAC,UAAA,CAAW,WAAA,EAAa,GAAA,CAAI,WAAW,CAAA,EAAG;AAC7C,MAAA,MAAA,CAAO,IAAA,CAAK,CAAA,iCAAA,EAAoC,EAAE,CAAA,CAAE,CAAA;AACpD,MAAA;AAAA,IACF;AAEA,IAAA,MAAM,UAAA,GAAa,WAAA,CAAY,WAAA,EAAa,GAAA,CAAI,WAAW,CAAA;AAC3D,IAAA,IAAI,CAAC,WAAW,OAAA,EAAS;AAEvB,MAAA,MAAM,QAAA,GAAW,WAAW,KAAA,IAAS,eAAA;AACrC,MAAA,MAAM,OAAA,GAAU,WAAW,OAAA,GAAU,CAAA,EAAA,EAAK,WAAW,OAAA,CAAQ,IAAA,CAAK,IAAI,CAAC,CAAA,CAAA,GAAK,EAAA;AAC5E,MAAA,MAAA,CAAO,KAAK,CAAA,wBAAA,EAA2B,EAAE,KAAK,QAAQ,CAAA,EAAG,OAAO,CAAA,CAAE,CAAA;AAClE,MAAA;AAAA,IACF;AAEA,IAAA,MAAM,UAAA,GAAa,gCAAA,CAAiC,UAAA,CAAW,OAAO,CAAA;AACtE,IAAA,IAAI,CAAC,WAAW,KAAA,EAAO;AACrB,MAAA,MAAA,CAAO,IAAA,CAAK,WAAW,EAAE,CAAA,EAAA,EAAK,WAAW,MAAA,CAAO,IAAA,CAAK,IAAI,CAAC,CAAA,CAAE,CAAA;AAAA,IAC9D;AACA,IAAA,QAAA,CAAS,IAAA,CAAK,GAAG,UAAA,CAAW,QAAA,CAAS,GAAA,CAAI,CAAA,CAAA,KAAK,CAAA,QAAA,EAAW,EAAE,CAAA,EAAA,EAAK,CAAC,CAAA,CAAE,CAAC,CAAA;AAEpE,IAAA,QAAA,CAAS,IAAA,CAAK,WAAW,OAAO,CAAA;AAAA,EAClC;AAEA,EAAA,IAAI,MAAA,CAAO,SAAS,CAAA,EAAG;AACrB,IAAA,OAAO;AAAA,MACL,OAAA,EAAS,KAAA;AAAA,MACT,KAAA,EAAO,MAAA,CAAO,IAAA,CAAK,IAAI;AAAA,KACzB;AAAA,EACF;AAGA,EAAA,MAAM,iBAAA,GAAiC;AAAA,IACrC,UAAA,EAAY,KAAA;AAAA,IACZ,IAAA,EAAM;AAAA,MACJ,MAAA;AAAA,MACA,MAAA;AAAA,MACA,QAAA;AAAA,MACA,eAAA;AAAA,MACA,aAAA;AAAA,MACA,GAAA,CAAI,QAAA;AAAA,MACJ,UAAA;AAAA,MACA,GAAA,CAAI,WAAA;AAAA,MACJ,kBAAA;AAAA,MACA;AAAA,KACF;AAAA,IACA,KAAK,GAAA,CAAI,WAAA;AAAA,IACT,WAAA,EAAa;AAAA,GACf;AAEA,EAAA,MAAM,eAAA,GAAiC,QAAA,CAAS,GAAA,CAAI,CAAA,CAAA,KAAK;AACvD,IAAA,MAAM,QAAA,GAAgBA,KAAA,CAAA,IAAA,CAAK,GAAA,CAAI,WAAA,EAAa,OAAO,CAAA;AACnD,IAAA,MAAM,UAAA,GAAkBA,KAAA,CAAA,IAAA,CAAK,GAAA,CAAI,WAAA,EAAa,yBAAyB,CAAA;AACvE,IAAA,MAAM,YAAA,GAAoBA,KAAA,CAAA,IAAA,CAAK,GAAA,CAAI,WAAA,EAAa,kBAAkB,CAAA;AAElE,IAAA,OAAO;AAAA,MACL,UAAA,EAAY,KAAA;AAAA,MACZ,IAAA,EAAM;AAAA,QACJ,cAAA;AAAA,QACA,UAAA;AAAA,QACA,CAAA,CAAE,IAAA;AAAA,QACF,IAAA;AAAA,QACA,QAAA;AAAA,QACA,IAAA;AAAA,QACA,eAAA;AAAA,QACA,UAAA;AAAA,QACA,iBAAA;AAAA,QACA;AAAA,OACF;AAAA,MACA,KAAK,GAAA,CAAI,WAAA;AAAA,MACT,WAAA,EAAa,CAAA,mBAAA,EAAsB,CAAA,CAAE,EAAE,CAAA;AAAA,KACzC;AAAA,EACF,CAAC,CAAA;AAED,EAAA,OAAO;AAAA,IACL,OAAA,EAAS,IAAA;AAAA,IACT,IAAA,EAAM;AAAA,MACJ,QAAA;AAAA,MACA,WAAW,eAAA,CAAgB,UAAA;AAAA,MAC3B,cAAc,kBAAA,CAAmB,UAAA;AAAA,MACjC,iBAAA;AAAA,MACA,eAAA;AAAA,MACA,QAAA;AAAA,MACA;AAAA;AACF,GACF;AACF;AAMA,SAAS,cAAc,GAAA,EAA0B;AAE/C,EAAA,MAAM,UAAA,GAAa,GAAA,CAAI,IAAA,CAAK,GAAA,CAAI,CAAA,GAAA,KAAO;AACrC,IAAA,IAAI,GAAA,CAAI,QAAA,CAAS,GAAG,CAAA,IAAK,IAAI,QAAA,CAAS,GAAG,CAAA,IAAK,GAAA,CAAI,SAAS,GAAG,CAAA,IAAK,GAAA,CAAI,QAAA,CAAS,GAAG,CAAA,EAAG;AAEpF,MAAA,OAAO,CAAA,CAAA,EAAI,GAAA,CAAI,OAAA,CAAQ,IAAA,EAAM,KAAK,CAAC,CAAA,CAAA,CAAA;AAAA,IACrC;AACA,IAAA,OAAO,GAAA;AAAA,EACT,CAAC,CAAA;AACD,EAAA,OAAO,GAAG,GAAA,CAAI,UAAU,IAAI,UAAA,CAAW,IAAA,CAAK,GAAG,CAAC,CAAA,CAAA;AAClD;AAKO,SAAS,mBAAmB,WAAA,EAA6B;AAC9D,EAAA,OAAYA,KAAA,CAAA,IAAA,CAAK,WAAA,EAAa,OAAA,EAAS,cAAc,CAAA;AACvD;AAMA,eAAsB,gBAAA,CAAiB,aAAqB,KAAA,EAAuC;AACjG,EAAA,IAAI;AACF,IAAA,MAAM,WAAA,GAAc,mBAAmB,WAAW,CAAA;AAClD,IAAA,MAAM,UAAA,GAAkBA,cAAQ,WAAW,CAAA;AAG3C,IAAA,IAAI,CAAID,GAAA,CAAA,UAAA,CAAW,UAAU,CAAA,EAAG;AAC9B,MAAGA,GAAA,CAAA,SAAA,CAAU,UAAA,EAAY,EAAE,SAAA,EAAW,MAAM,CAAA;AAAA,IAC9C;AAGA,IAAA,MAAM,WAAA,GAA4B;AAAA,MAChC,GAAG,KAAA;AAAA,MACH,OAAA,EAAA,iBAAS,IAAI,IAAA,EAAK,EAAE,WAAA;AAAY,KAClC;AAEA,IAAGA,GAAA,CAAA,aAAA,CAAc,aAAa,IAAA,CAAK,SAAA,CAAU,aAAa,IAAA,EAAM,CAAC,GAAG,OAAO,CAAA;AAC3E,IAAA,OAAO,IAAA;AAAA,EACT,CAAA,CAAA,MAAQ;AAEN,IAAA,OAAO,KAAA;AAAA,EACT;AACF;AA8BO,SAAS,sBAAA,CAAuB,QAAgB,SAAA,EAAkC;AAEvF,EAAA,MAAM,cAAA,GAAiB,MAAA,CAAO,KAAA,CAAM,8BAA8B,CAAA;AAClE,EAAA,IAAI,cAAA,EAAgB;AAClB,IAAA,OAAO,cAAA,CAAe,CAAC,CAAA,CAAE,IAAA,EAAK;AAAA,EAChC;AAGA,EAAA,MAAM,YAAA,GAAe,MAAA,CAAO,KAAA,CAAM,sCAAsC,CAAA;AACxE,EAAA,IAAI,YAAA,EAAc;AAChB,IAAA,OAAO,YAAA,CAAa,CAAC,CAAA,CAAE,IAAA,EAAK;AAAA,EAC9B;AAGA,EAAA,MAAM,WAAA,GAAc,MAAA,CAAO,KAAA,CAAM,2BAA2B,CAAA;AAC5D,EAAA,IAAI,WAAA,EAAa;AACf,IAAA,OAAO,WAAA,CAAY,CAAC,CAAA,CAAE,IAAA,EAAK;AAAA,EAC7B;AAGA,EAAA,MAAM,gBAAA,GAAmB,OAAO,KAAA,CAAM,IAAI,OAAO,CAAA,KAAA,EAAQ,SAAS,CAAA,iBAAA,CAAA,EAAqB,GAAG,CAAC,CAAA;AAC3F,EAAA,IAAI,gBAAA,EAAkB;AACpB,IAAA,OAAO,gBAAA,CAAiB,CAAC,CAAA,CAAE,IAAA,EAAK;AAAA,EAClC;AAGA,EAAA,OAAO,IAAA;AACT;AAKA,SAAS,eAAA,CAAgB,QAAgB,OAAA,EAA8B;AACrE,EAAA,MAAM,MAAA,GAAS,sBAAA,CAAuB,MAAA,EAAQ,OAAA,CAAQ,EAAE,CAAA;AACxD,EAAA,IAAI,MAAA,EAAQ;AACV,IAAA,OAAYC,eAAS,MAAM,CAAA;AAAA,EAC7B;AAEA,EAAA,OAAO,CAAA,EAAG,QAAQ,EAAE,CAAA,QAAA,CAAA;AACtB;AAKO,SAAS,oBAAoB,IAAA,EAA6B;AAC/D,EAAA,MAAM,QAAkB,EAAC;AAEzB,EAAA,KAAA,CAAM,KAAK,8YAAoE,CAAA;AAC/E,EAAA,KAAA,CAAM,KAAK,8EAAoE,CAAA;AAC/E,EAAA,KAAA,CAAM,KAAK,8YAAoE,CAAA;AAC/E,EAAA,KAAA,CAAM,KAAK,EAAE,CAAA;AAEb,EAAA,KAAA,CAAM,IAAA,CAAK,CAAA,aAAA,EAAgB,IAAA,CAAK,WAAW,CAAA,CAAE,CAAA;AAC7C,EAAA,KAAA,CAAM,IAAA,CAAK,CAAA,YAAA,EAAe,IAAA,CAAK,SAAS,CAAA,CAAE,CAAA;AAC1C,EAAA,KAAA,CAAM,IAAA,CAAK,CAAA,eAAA,EAAkB,IAAA,CAAK,YAAY,CAAA,CAAE,CAAA;AAChD,EAAA,KAAA,CAAM,IAAA,CAAK,CAAA,UAAA,EAAa,IAAA,CAAK,QAAA,CAAS,MAAM,CAAA,CAAE,CAAA;AAC9C,EAAA,KAAA,CAAM,KAAK,EAAE,CAAA;AAEb,EAAA,KAAA,CAAM,KAAK,wBAAwB,CAAA;AACnC,EAAA,KAAA,MAAW,CAAA,IAAK,KAAK,QAAA,EAAU;AAC7B,IAAA,KAAA,CAAM,IAAA,CAAK,CAAA,IAAA,EAAO,CAAA,CAAE,EAAE,CAAA,EAAA,EAAK,EAAE,KAAK,CAAA,UAAA,EAAa,CAAA,CAAE,MAAM,CAAA,CAAA,CAAG,CAAA;AAAA,EAC5D;AACA,EAAA,KAAA,CAAM,KAAK,EAAE,CAAA;AAEb,EAAA,KAAA,CAAM,KAAK,iCAAiC,CAAA;AAC5C,EAAA,KAAA,CAAM,KAAK,EAAE,CAAA;AACb,EAAA,KAAA,CAAM,KAAK,6BAA6B,CAAA;AACxC,EAAA,KAAA,CAAM,KAAK,CAAA,GAAA,EAAM,aAAA,CAAc,IAAA,CAAK,iBAAiB,CAAC,CAAA,CAAE,CAAA;AACxD,EAAA,KAAA,CAAM,KAAK,EAAE,CAAA;AAEb,EAAA,KAAA,CAAM,KAAK,kCAAkC,CAAA;AAC7C,EAAA,KAAA,IAAS,IAAI,CAAA,EAAG,CAAA,GAAI,IAAA,CAAK,eAAA,CAAgB,QAAQ,CAAA,EAAA,EAAK;AACpD,IAAA,KAAA,CAAM,IAAA,CAAK,CAAA,IAAA,EAAO,CAAA,GAAI,CAAC,CAAA,EAAA,EAAK,aAAA,CAAc,IAAA,CAAK,eAAA,CAAgB,CAAC,CAAC,CAAC,CAAA,CAAE,CAAA;AAAA,EACtE;AACA,EAAA,KAAA,CAAM,KAAK,EAAE,CAAA;AAEb,EAAA,IAAI,IAAA,CAAK,QAAA,CAAS,MAAA,GAAS,CAAA,EAAG;AAC5B,IAAA,KAAA,CAAM,KAAK,WAAW,CAAA;AACtB,IAAA,KAAA,MAAW,CAAA,IAAK,KAAK,QAAA,EAAU;AAC7B,MAAA,KAAA,CAAM,IAAA,CAAK,CAAA,gBAAA,EAAS,CAAC,CAAA,CAAE,CAAA;AAAA,IACzB;AACA,IAAA,KAAA,CAAM,KAAK,EAAE,CAAA;AAAA,EACf;AAEA,EAAA,KAAA,CAAM,KAAK,8YAAoE,CAAA;AAE/E,EAAA,OAAO,KAAA,CAAM,KAAK,IAAI,CAAA;AACxB;AAmBA,eAAe,WAAA,CACb,GAAA,EACA,SAAA,GAAoB,0BAAA,EACI;AACxB,EAAA,OAAO,IAAI,OAAA,CAAQ,CAACC,SAAAA,KAAY;AAC9B,IAAA,MAAM,IAAA,GAAOC,KAAAA,CAAM,GAAA,CAAI,UAAA,EAAY,IAAI,IAAA,EAAM;AAAA,MAC3C,KAAK,GAAA,CAAI,GAAA;AAAA,MACT,KAAA,EAAO,KAAA;AAAA;AAAA,MACP,KAAA,EAAO,CAAC,MAAA,EAAQ,MAAA,EAAQ,MAAM;AAAA,KAC/B,CAAA;AAED,IAAA,IAAI,MAAA,GAAS,EAAA;AACb,IAAA,IAAI,MAAA,GAAS,EAAA;AACb,IAAA,IAAI,MAAA,GAAS,KAAA;AAGb,IAAA,MAAM,KAAA,GAAQ,WAAW,MAAM;AAC7B,MAAA,MAAA,GAAS,IAAA;AACT,MAAA,IAAA,CAAK,KAAK,SAAS,CAAA;AAEnB,MAAA,UAAA,CAAW,MAAM;AACf,QAAA,IAAI,CAAC,KAAK,MAAA,EAAQ;AAChB,UAAA,IAAA,CAAK,KAAK,SAAS,CAAA;AAAA,QACrB;AAAA,MACF,GAAG,GAAI,CAAA;AAAA,IACT,GAAG,SAAS,CAAA;AAEZ,IAAA,IAAA,CAAK,MAAA,CAAO,EAAA,CAAG,MAAA,EAAQ,CAAC,IAAA,KAAS;AAAE,MAAA,MAAA,IAAU,KAAK,QAAA,EAAS;AAAA,IAAG,CAAC,CAAA;AAC/D,IAAA,IAAA,CAAK,MAAA,CAAO,EAAA,CAAG,MAAA,EAAQ,CAAC,IAAA,KAAS;AAAE,MAAA,MAAA,IAAU,KAAK,QAAA,EAAS;AAAA,IAAG,CAAC,CAAA;AAE/D,IAAA,IAAA,CAAK,EAAA,CAAG,OAAA,EAAS,CAAC,IAAA,KAAS;AACzB,MAAA,YAAA,CAAa,KAAK,CAAA;AAClB,MAAA,IAAI,MAAA,EAAQ;AACV,QAAAD,SAAAA,CAAQ;AAAA,UACN,OAAA,EAAS,KAAA;AAAA,UACT,MAAA;AAAA,UACA,QAAQ,CAAA,wBAAA,EAA2B,IAAA,CAAK,KAAA,CAAM,SAAA,GAAY,GAAI,CAAC,CAAA,QAAA,CAAA;AAAA,UAC/D,QAAA,EAAU;AAAA,SACX,CAAA;AAAA,MACH,CAAA,MAAO;AACL,QAAAA,UAAQ,EAAE,OAAA,EAAS,SAAS,CAAA,EAAG,MAAA,EAAQ,QAAQ,CAAA;AAAA,MACjD;AAAA,IACF,CAAC,CAAA;AAED,IAAA,IAAA,CAAK,EAAA,CAAG,OAAA,EAAS,CAAC,GAAA,KAAQ;AACxB,MAAA,YAAA,CAAa,KAAK,CAAA;AAClB,MAAAA,SAAAA,CAAQ,EAAE,OAAA,EAAS,KAAA,EAAO,QAAQ,MAAA,EAAQ,GAAA,CAAI,SAAS,CAAA;AAAA,IACzD,CAAC,CAAA;AAAA,EACH,CAAC,CAAA;AACH;AAKA,eAAsB,qBAAA,CACpB,GAAA,EACA,IAAA,EACA,OAAA,EACuG;AACvG,EAAA,MAAM,SAAA,GAAY,QAAQ,SAAA,IAAa,0BAAA;AACvC,EAAA,MAAM,WAAqB,EAAC;AAG5B,EAAA,MAAM,YAAA,GAAe,kBAAA;AAAA,IACnB,IAAA,CAAK,QAAA,CAAS,GAAA,CAAI,CAAA,CAAA,KAAK,EAAE,EAAE,CAAA;AAAA,IAC3B,IAAA,CAAK,SAAA;AAAA,IACL,IAAA,CAAK;AAAA,GACP;AAGA,EAAA,MAAM,gBAAA,CAAiB,GAAA,CAAI,WAAA,EAAa,YAAY,CAAA;AAEpD,EAAA,MAAM,iBAA2B,EAAC;AAGlC,EAAA,IAAI,QAAQ,OAAA,EAAS;AACnB,IAAA,OAAA,CAAQ,IAAI,2CAAoC,CAAA;AAChD,IAAA,OAAA,CAAQ,IAAI,CAAA,GAAA,EAAM,aAAA,CAAc,IAAA,CAAK,iBAAiB,CAAC,CAAA,CAAE,CAAA;AAAA,EAC3D;AAEA,EAAA,MAAM,UAAA,GAAa,MAAM,WAAA,CAAY,IAAA,CAAK,mBAAmB,SAAS,CAAA;AACtE,EAAA,IAAI,CAAC,WAAW,OAAA,EAAS;AACvB,IAAA,YAAA,CAAa,OAAA,GAAU,KAAK,GAAA,EAAI;AAChC,IAAA,MAAM,gBAAA,CAAiB,GAAA,CAAI,WAAA,EAAa,YAAY,CAAA;AAEpD,IAAA,IAAI,WAAW,QAAA,EAAU;AACvB,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,KAAA;AAAA,QACT,OAAO,CAAA,4BAAA,EAA+B,IAAA,CAAK,KAAA,CAAM,SAAA,GAAY,GAAI,CAAC,CAAA,QAAA;AAAA,OACpE;AAAA,IACF;AACA,IAAA,OAAO;AAAA,MACL,OAAA,EAAS,KAAA;AAAA,MACT,KAAA,EAAO,CAAA,oBAAA,EAAuB,UAAA,CAAW,MAAM,CAAA;AAAA,KACjD;AAAA,EACF;AACA,EAAA,YAAA,CAAa,eAAA,EAAA;AACb,EAAA,YAAA,CAAa,kBAAA,GAAqB,KAAK,GAAA,EAAI;AAC3C,EAAA,MAAM,gBAAA,CAAiB,GAAA,CAAI,WAAA,EAAa,YAAY,CAAA;AAGpD,EAAA,KAAA,IAAS,IAAI,CAAA,EAAG,CAAA,GAAI,IAAA,CAAK,QAAA,CAAS,QAAQ,CAAA,EAAA,EAAK;AAC7C,IAAA,MAAM,OAAA,GAAU,IAAA,CAAK,QAAA,CAAS,CAAC,CAAA;AAC/B,IAAA,MAAM,OAAA,GAAU,IAAA,CAAK,eAAA,CAAgB,CAAC,CAAA;AAGtC,IAAA,YAAA,CAAa,mBAAA,GAAsB,CAAA;AACnC,IAAA,YAAA,CAAa,mBAAmB,OAAA,CAAQ,EAAA;AACxC,IAAA,MAAM,gBAAA,CAAiB,GAAA,CAAI,WAAA,EAAa,YAAY,CAAA;AAEpD,IAAA,IAAI,QAAQ,OAAA,EAAS;AACnB,MAAA,OAAA,CAAQ,GAAA,CAAI;AAAA,WAAA,EAAS,CAAA,GAAI,CAAC,CAAA,CAAA,EAAI,IAAA,CAAK,SAAS,MAAM,CAAA,uBAAA,EAA0B,OAAA,CAAQ,EAAE,CAAA,GAAA,CAAK,CAAA;AAC3F,MAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,GAAA,EAAM,aAAA,CAAc,OAAO,CAAC,CAAA,CAAE,CAAA;AAAA,IAC5C;AAEA,IAAA,MAAM,MAAA,GAAS,MAAM,WAAA,CAAY,OAAA,EAAS,SAAS,CAAA;AAEnD,IAAA,IAAI,CAAC,OAAO,OAAA,EAAS;AACnB,MAAA,YAAA,CAAa,cAAA,CAAe,IAAA,CAAK,OAAA,CAAQ,EAAE,CAAA;AAC3C,MAAA,YAAA,CAAa,OAAA,GAAU,KAAK,GAAA,EAAI;AAChC,MAAA,MAAM,gBAAA,CAAiB,GAAA,CAAI,WAAA,EAAa,YAAY,CAAA;AAEpD,MAAA,MAAM,WAAW,MAAA,CAAO,QAAA,GACpB,yBAAyB,OAAA,CAAQ,EAAE,UAAU,IAAA,CAAK,KAAA,CAAM,SAAA,GAAY,GAAI,CAAC,CAAA,QAAA,CAAA,GACzE,CAAA,mBAAA,EAAsB,QAAQ,EAAE,CAAA,EAAA,EAAK,OAAO,MAAM,CAAA,CAAA;AAEtD,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,KAAA;AAAA,QACT,KAAA,EAAO,QAAA;AAAA,QACP,IAAA,EAAM,EAAE,cAAA,EAAgB,YAAA,EAAc,QAAA;AAAS,OACjD;AAAA,IACF;AAGA,IAAA,MAAM,QAAA,GAAW,eAAA,CAAgB,MAAA,CAAO,MAAA,EAAQ,OAAO,CAAA;AACvD,IAAA,cAAA,CAAe,KAAK,QAAQ,CAAA;AAC5B,IAAA,YAAA,CAAa,cAAA,CAAe,KAAK,QAAQ,CAAA;AACzC,IAAA,YAAA,CAAa,iBAAA,CAAkB,IAAA,CAAK,OAAA,CAAQ,EAAE,CAAA;AAC9C,IAAA,MAAM,gBAAA,CAAiB,GAAA,CAAI,WAAA,EAAa,YAAY,CAAA;AAEpD,IAAA,IAAI,QAAQ,OAAA,EAAS;AACnB,MAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,qBAAA,EAAmB,QAAQ,CAAA,CAAE,CAAA;AAAA,IAC3C;AAGA,IAAA,IAAI,KAAK,YAAA,KAAiB,QAAA,IAAY,IAAI,IAAA,CAAK,QAAA,CAAS,SAAS,CAAA,EAAG;AAClE,MAAA,IAAI,QAAQ,OAAA,EAAS;AACnB,QAAA,OAAA,CAAQ,IAAI,wDAAiD,CAAA;AAAA,MAC/D;AACA,MAAA,MAAM,cAAA,GAAiB,MAAM,WAAA,CAAY,IAAA,CAAK,mBAAmB,SAAS,CAAA;AAC1E,MAAA,IAAI,eAAe,OAAA,EAAS;AAC1B,QAAA,YAAA,CAAa,eAAA,EAAA;AACb,QAAA,YAAA,CAAa,kBAAA,GAAqB,KAAK,GAAA,EAAI;AAAA,MAC7C,CAAA,MAAO;AACL,QAAA,YAAA,CAAa,kBAAA,EAAA;AAEb,QAAA,MAAM,OAAA,GAAU,cAAA,CAAe,QAAA,GAC3B,CAAA,uCAAA,EAA0C,OAAA,CAAQ,EAAE,CAAA,sCAAA,CAAA,GACpD,CAAA,oCAAA,EAAuC,OAAA,CAAQ,EAAE,CAAA,EAAA,EAAK,cAAA,CAAe,MAAM,CAAA,sCAAA,CAAA;AAC/E,QAAA,QAAA,CAAS,KAAK,OAAO,CAAA;AACrB,QAAA,IAAI,QAAQ,OAAA,EAAS;AACnB,UAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,iBAAA,EAAU,OAAO,CAAA,CAAE,CAAA;AAAA,QACjC;AAAA,MACF;AACA,MAAA,MAAM,gBAAA,CAAiB,GAAA,CAAI,WAAA,EAAa,YAAY,CAAA;AAAA,IACtD;AAAA,EACF;AAGA,EAAA,YAAA,CAAa,OAAA,GAAU,KAAK,GAAA,EAAI;AAChC,EAAA,YAAA,CAAa,gBAAA,GAAmB,IAAA;AAChC,EAAA,YAAA,CAAa,kBAAA,GAAqB,IAAA;AAClC,EAAA,MAAM,gBAAA,CAAiB,GAAA,CAAI,WAAA,EAAa,YAAY,CAAA;AAEpD,EAAA,OAAO;AAAA,IACL,OAAA,EAAS,IAAA;AAAA,IACT,IAAA,EAAM,EAAE,cAAA,EAAgB,YAAA,EAAc,QAAA,EAAS;AAAA,IAC/C,QAAA,EAAU,QAAA,CAAS,MAAA,GAAS,CAAA,GAAI,QAAA,GAAW;AAAA,GAC7C;AACF;AAhsBA,IAAA,sBAAA,GAAA,KAAA,CAAA;AAAA,EAAA,wCAAA,GAAA;AAiBA,IAAA,UAAA,EAAA;AAaA,IAAA,qBAAA,EAAA;AAAA,EAAA;AAAA,CAAA,CAAA;;;AC9BA,IAAA,cAAA,GAAA,KAAA,CAAA;AAAA,EAAA,4BAAA,GAAA;AAIA,IAAA,UAAA,EAAA;AACA,IAAA,qBAAA,EAAA;AACA,IAAA,sBAAA,EAAA;AAAA,EAAA;AAAA,CAAA,CAAA;;;ACNA,IAAA,kBAAA,GAAA,EAAA;AAAA,QAAA,CAAA,kBAAA,EAAA;AAAA,EAAA,gBAAA,EAAA,MAAA,gBAAA;AAAA,EAAA,YAAA,EAAA,MAAA;AAAA,CAAA,CAAA;AA2BO,SAAS,aAAa,OAAA,EAA4C;AACvE,EAAA,MAAM,WAAA,GAAmBE,KAAA,CAAA,OAAA,CAAQ,OAAA,CAAQ,WAAW,CAAA;AACpD,EAAA,MAAM,QAAA,GAAgBA,KAAA,CAAA,IAAA,CAAK,WAAA,EAAa,OAAA,EAAS,MAAM,CAAA;AAEvD,EAAA,MAAM,MAAA,GAAS,aAAa,QAAQ,CAAA;AAEpC,EAAA,OAAO;AAAA,IACL,OAAO,MAAA,CAAO,KAAA;AAAA,IACd,QAAA;AAAA,IACA,QAAQ,MAAA,CAAO,MAAA;AAAA,IACf,UAAU,MAAA,CAAO;AAAA,GACnB;AACF;AAKA,eAAsB,iBAAiB,OAAA,EAA4C;AACjF,EAAA,MAAMC,OAAAA,GAAS,IAAI,MAAA,EAAO;AAC1B,EAAA,MAAM,MAAA,GAAS,aAAa,OAAO,CAAA;AAEnC,EAAA,IAAI,QAAQ,IAAA,EAAM;AAChB,IAAA,OAAA,CAAQ,IAAI,IAAA,CAAK,SAAA,CAAU,MAAA,EAAQ,IAAA,EAAM,CAAC,CAAC,CAAA;AAAA,EAC7C,CAAA,MAAO;AACL,IAAAA,OAAAA,CAAO,OAAO,YAAY,CAAA;AAC1B,IAAAA,OAAAA,CAAO,IAAA,CAAK,CAAA,WAAA,EAAc,MAAA,CAAO,QAAQ,CAAA,CAAE,CAAA;AAC3C,IAAAA,QAAO,KAAA,EAAM;AAEb,IAAA,IAAI,OAAO,KAAA,EAAO;AAChB,MAAAA,OAAAA,CAAO,QAAQ,8BAA8B,CAAA;AAAA,IAC/C,CAAA,MAAO;AACL,MAAAA,OAAAA,CAAO,MAAM,mBAAmB,CAAA;AAChC,MAAA,KAAA,MAAW,GAAA,IAAO,OAAO,MAAA,EAAQ;AAC/B,QAAAA,OAAAA,CAAO,IAAA,CAAK,CAAA,IAAA,EAAO,GAAG,CAAA,CAAE,CAAA;AAAA,MAC1B;AAAA,IACF;AAEA,IAAA,KAAA,MAAW,IAAA,IAAQ,OAAO,QAAA,EAAU;AAClC,MAAAA,OAAAA,CAAO,OAAA,CAAQ,CAAA,IAAA,EAAO,IAAI,CAAA,CAAE,CAAA;AAAA,IAC9B;AAAA,EACF;AAEA,EAAA,OAAO,MAAA,CAAO,QAAQ,CAAA,GAAI,CAAA;AAC5B;AAtEA,IAAA,eAAA,GAAA,KAAA,CAAA;AAAA,EAAA,oCAAA,GAAA;AAQA,IAAA,WAAA,EAAA;AACA,IAAA,cAAA,EAAA;AAAA,EAAA;AAAA,CAAA,CAAA;;;ACGA,WAAA,EAAA;ACaA,eAAsB,kBAAkB,WAAA,EAA+C;AACrF,EAAA,MAAM,YAAA,GAAoBC,cAAQ,WAAW,CAAA;AAE7C,EAAA,OAAO;AAAA,IACL,YAAA,EAAc,mBAAmB,YAAY,CAAA;AAAA,IAC7C,aAAa,OAAA,CAAQ,OAAA;AAAA,IACrB,UAAA,EAAY,MAAM,gBAAA,EAAiB;AAAA,IACnC,MAAA,EAAQ,MAAM,SAAA,CAAU,YAAY,CAAA;AAAA,IACpC,aAAA,EAAe,iBAAiB,YAAY,CAAA;AAAA,IAC5C,WAAA,EAAa,eAAe,YAAY,CAAA;AAAA,IACxC,UAAU,OAAA,CAAQ,QAAA;AAAA,IAClB,MAAM,OAAA,CAAQ,IAAA;AAAA,IACd,MAAM,QAAA;AAAS,GACjB;AACF;AAKA,SAAS,mBAAmB,WAAA,EAAqD;AAC/E,EAAA,MAAM,eAAA,GAAuBA,KAAA,CAAA,IAAA,CAAK,WAAA,EAAa,cAAc,CAAA;AAG7D,EAAA,IAAOC,GAAA,CAAA,UAAA,CAAW,eAAe,CAAA,EAAG;AAClC,IAAA,IAAI;AACF,MAAA,MAAM,MAAM,IAAA,CAAK,KAAA,CAASA,GAAA,CAAA,YAAA,CAAa,eAAA,EAAiB,MAAM,CAAC,CAAA;AAC/D,MAAA,IAAI,GAAA,CAAI,SAAS,QAAA,EAAU;AACzB,QAAA,OAAO,KAAA;AAAA,MACT;AACA,MAAA,IAAI,GAAA,CAAI,IAAA,KAAS,UAAA,IAAc,CAAC,IAAI,IAAA,EAAM;AAExC,QAAA,MAAM,YAAA,GAAkBA,GAAA,CAAA,UAAA,CAAgBD,KAAA,CAAA,IAAA,CAAK,WAAA,EAAa,eAAe,CAAC,CAAA;AAC1E,QAAA,IAAI,YAAA,EAAc;AAChB,UAAA,IAAI;AACF,YAAA,MAAM,QAAA,GAAW,KAAK,KAAA,CAASC,GAAA,CAAA,YAAA,CAAkBD,WAAK,WAAA,EAAa,eAAe,CAAA,EAAG,MAAM,CAAC,CAAA;AAC5F,YAAA,MAAM,MAAA,GAAS,QAAA,CAAS,eAAA,EAAiB,MAAA,EAAQ,WAAA,EAAY;AAC7D,YAAA,IAAI,MAAA,KAAW,MAAA,CAAO,QAAA,CAAS,QAAQ,CAAA,IAAK,OAAO,QAAA,CAAS,MAAM,CAAA,IAAK,MAAA,KAAW,UAAA,CAAA,EAAa;AAC7F,cAAA,OAAO,KAAA;AAAA,YACT;AAAA,UACF,CAAA,CAAA,MAAQ;AAAA,UAER;AAAA,QACF;AACA,QAAA,OAAO,UAAA;AAAA,MACT;AAAA,IACF,CAAA,CAAA,MAAQ;AAAA,IAER;AAAA,EACF;AAGA,EAAA,MAAM,MAAA,GAAcA,KAAA,CAAA,IAAA,CAAK,WAAA,EAAa,KAAK,CAAA;AAC3C,EAAA,IAAOC,GAAA,CAAA,UAAA,CAAW,MAAM,CAAA,EAAG;AACzB,IAAA,IAAI;AACF,MAAA,MAAM,QAAWA,GAAA,CAAA,WAAA,CAAY,MAAA,EAAQ,EAAE,SAAA,EAAW,MAAM,CAAA;AACxD,MAAA,MAAM,MAAA,GAAS,MAAM,IAAA,CAAK,CAAC,MAAM,CAAA,CAAE,QAAA,CAAS,MAAM,CAAC,CAAA;AACnD,MAAA,MAAM,MAAA,GAAS,MAAM,IAAA,CAAK,CAAC,MAAM,CAAA,CAAE,QAAA,CAAS,MAAM,CAAC,CAAA;AACnD,MAAA,IAAI,MAAA,IAAU,CAAC,MAAA,EAAQ,OAAO,KAAA;AAC9B,MAAA,IAAI,MAAA,IAAU,CAAC,MAAA,EAAQ,OAAO,UAAA;AAAA,IAChC,CAAA,CAAA,MAAQ;AAAA,IAER;AAAA,EACF;AAEA,EAAA,OAAO,SAAA;AACT;AAKA,eAAe,gBAAA,GAA2C;AACxD,EAAA,IAAI;AACF,IAAA,MAAM,EAAE,QAAA,EAAAC,SAAAA,EAAS,GAAI,MAAM,OAAO,eAAe,CAAA;AACjD,IAAA,MAAMC,QAAAA,GAAUD,UAAS,eAAA,EAAiB,EAAE,UAAU,MAAA,EAAQ,EAAE,IAAA,EAAK;AACrE,IAAA,OAAOC,QAAAA;AAAA,EACT,CAAA,CAAA,MAAQ;AACN,IAAA,OAAO,IAAA;AAAA,EACT;AACF;AAKA,eAAe,UAAU,WAAA,EAAuC;AAE9D,EAAA,IAAOF,GAAA,CAAA,UAAA,CAAgBD,KAAA,CAAA,IAAA,CAAK,WAAA,EAAa,MAAM,CAAC,CAAA,EAAG;AACjD,IAAA,OAAO,IAAA;AAAA,EACT;AAGA,EAAA,IAAI;AACF,IAAA,MAAM,EAAE,QAAA,EAAAE,SAAAA,EAAS,GAAI,MAAM,OAAO,eAAe,CAAA;AACjD,IAAAA,SAAAA,CAAS,2BAA2B,EAAE,GAAA,EAAK,aAAa,QAAA,EAAU,MAAA,EAAQ,KAAA,EAAO,MAAA,EAAQ,CAAA;AACzF,IAAA,OAAO,IAAA;AAAA,EACT,CAAA,CAAA,MAAQ;AACN,IAAA,OAAO,KAAA;AAAA,EACT;AACF;AAKA,SAAS,iBAAiB,WAAA,EAA8B;AACtD,EAAA,MAAM,cAAA,GAAsBF,KAAA,CAAA,IAAA,CAAK,WAAA,EAAa,cAAA,EAAgB,eAAe,MAAM,CAAA;AACnF,EAAA,OAAUC,eAAW,cAAc,CAAA;AACrC;AAKA,SAAS,eAAe,WAAA,EAA8B;AAEpD,EAAA,MAAM,UAAA,GAAkBD,KAAA,CAAA,IAAA,CAAK,WAAA,EAAa,UAAA,EAAY,UAAU,WAAW,CAAA;AAC3E,EAAA,IAAOC,GAAA,CAAA,UAAA,CAAW,UAAU,CAAA,EAAG,OAAO,IAAA;AAGtC,EAAA,MAAM,eAAA,GAAuBD,KAAA,CAAA,IAAA,CAAK,WAAA,EAAa,cAAA,EAAgB,SAAS,MAAM,CAAA;AAC9E,EAAA,OAAUC,eAAW,eAAe,CAAA;AACtC;AAKO,SAAS,IAAA,GAAgB;AAC9B,EAAA,OAAO,CAAC,EACN,OAAA,CAAQ,GAAA,CAAI,MACZ,OAAA,CAAQ,GAAA,CAAI,cAAA,IACZ,OAAA,CAAQ,GAAA,CAAI,SAAA,IACZ,OAAA,CAAQ,GAAA,CAAI,gBACZ,OAAA,CAAQ,GAAA,CAAI,QAAA,IACZ,OAAA,CAAQ,GAAA,CAAI,MAAA,IACZ,OAAA,CAAQ,GAAA,CAAI,YACZ,OAAA,CAAQ,GAAA,CAAI,IAAA,KAAS,SAAA,IACrB,QAAQ,GAAA,CAAI,IAAA,KAAS,eAAA,IACrB,OAAA,CAAQ,IAAI,IAAA,KAAS,UAAA,CAAA;AAEzB;AAGA,SAAS,QAAA,GAAoB;AAC3B,EAAA,OAAO,IAAA,EAAK;AACd;AAKO,SAAS,SAAA,GAA0C;AACxD,EAAA,IAAI,EAAA;AACJ,EAAA,QAAQ,QAAQ,QAAA;AAAU,IACxB,KAAK,QAAA;AACH,MAAA,EAAA,GAAK,OAAA;AACL,MAAA;AAAA,IACF,KAAK,OAAA;AACH,MAAA,EAAA,GAAK,SAAA;AACL,MAAA;AAAA,IACF,KAAK,OAAA;AACH,MAAA,EAAA,GAAK,OAAA;AACL,MAAA;AAAA,IACF;AACE,MAAA,EAAA,GAAK,SAAA;AAAA;AAGT,EAAA,IAAI,IAAA;AACJ,EAAA,QAAQ,QAAQ,IAAA;AAAM,IACpB,KAAK,KAAA;AACH,MAAA,IAAA,GAAO,KAAA;AACP,MAAA;AAAA,IACF,KAAK,OAAA;AACH,MAAA,IAAA,GAAO,OAAA;AACP,MAAA;AAAA,IACF,KAAK,MAAA;AACH,MAAA,IAAA,GAAO,KAAA;AACP,MAAA;AAAA,IACF;AACE,MAAA,IAAA,GAAO,SAAA;AAAA;AAGX,EAAA,OAAO,EAAE,IAAI,IAAA,EAAK;AACpB;AC9LA,WAAA,EAAA;AAwBA,eAAsB,cAAA,CACpB,UAAA,EACAF,OAAAA,EACA,OAAA,GAAmF,EAAC,EAC9D;AACtB,EAAA,MAAM,GAAA,GAAMA,OAAAA,IAAU,IAAI,MAAA,EAAO;AACjC,EAAA,MAAM,WAAA,GAAmBK,KAAA,CAAA,IAAA,CAAK,UAAA,EAAY,UAAU,CAAA;AACpD,EAAA,MAAM,iBAAA,GAAyBA,KAAA,CAAA,IAAA,CAAK,UAAA,EAAY,OAAA,EAAS,UAAU,CAAA;AACnE,EAAA,MAAM,UAAU,OAAA,CAAQ,OAAA,IAAgBA,KAAA,CAAA,IAAA,CAAK,UAAA,EAAY,SAAS,MAAM,CAAA;AAGxE,EAAG,GAAA,CAAA,SAAA,CAAU,iBAAA,EAAmB,EAAE,SAAA,EAAW,MAAM,CAAA;AACnD,EAAG,GAAA,CAAA,SAAA,CAAU,OAAA,EAAS,EAAE,SAAA,EAAW,MAAM,CAAA;AAGzC,EAAA,OAAA,CAAQ,IAAI,wBAAA,GAA2B,iBAAA;AAGvC,EAAA,IAAI,QAAA,GAAW,QAAQ,QAAA,IAAY,MAAA;AAGnC,EAAA,IAAI,QAAQ,WAAA,EAAa;AACvB,IAAA,GAAA,CAAI,MAAM,qDAAqD,CAAA;AAC/D,IAAA,QAAA,GAAW,aAAA;AAAA,EACb;AAGA,EAAA,IAAI,IAAA,EAAK,IAAK,QAAA,KAAa,aAAA,EAAe;AACxC,IAAA,GAAA,CAAI,KAAK,sEAAsE,CAAA;AAC/E,IAAA,QAAA,GAAW,cAAA;AAAA,EACb;AAGA,EAAA,QAAQ,QAAA;AAAU,IAChB,KAAK,cAAA;AACH,MAAA,OAAO,MAAM,kBAAA,CAAmB,WAAA,EAAa,iBAAA,EAAmB,SAAS,GAAG,CAAA;AAAA,IAE9E,KAAK,aAAA;AACH,MAAA,OAAO,MAAM,iBAAA,CAAkB,OAAA,EAAS,GAAG,CAAA;AAAA,IAE7C,KAAK,eAAA;AACH,MAAA,OAAO,MAAM,mBAAA,CAAoB,WAAA,EAAa,iBAAA,EAAmB,SAAS,GAAG,CAAA;AAAA,IAE/E,KAAK,gBAAA;AAAA,IACL,KAAK,MAAA;AAAA,IACL;AACE,MAAA,OAAO,MAAM,WAAA,CAAY,WAAA,EAAa,iBAAA,EAAmB,SAAS,GAAG,CAAA;AAAA;AAE3E;AAKA,eAAe,kBAAA,CACb,WAAA,EACA,iBAAA,EACA,OAAA,EACAL,OAAAA,EACsB;AAEtB,EAAAA,OAAAA,CAAO,MAAM,kDAAkD,CAAA;AAC/D,EAAA,MAAM,qBAAqB,MAAM,uBAAA,CAAwB,WAAA,EAAa,iBAAA,EAAmB,SAASA,OAAM,CAAA;AACxG,EAAA,IAAI,kBAAA,EAAoB;AACtB,IAAA,OAAO,kBAAA;AAAA,EACT;AAGA,EAAAA,OAAAA,CAAO,MAAM,sDAAsD,CAAA;AACnE,EAAA,MAAM,gBAAgB,MAAM,iBAAA,CAAkB,WAAA,EAAa,iBAAA,EAAmB,SAASA,OAAM,CAAA;AAC7F,EAAA,IAAI,aAAA,EAAe;AACjB,IAAA,OAAO,aAAA;AAAA,EACT;AAGA,EAAA,MAAM,IAAI,KAAA;AAAA,IACR,CAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAAA,EAKuB,OAAO,CAAA;AAAA,GAChC;AACF;AAKA,eAAe,iBAAA,CAAkB,SAAiBA,OAAAA,EAAsC;AACtF,EAAAA,OAAAA,CAAO,MAAM,sDAAsD,CAAA;AACnE,EAAA,MAAM,YAAA,GAAe,MAAM,mBAAA,CAAoB,OAAA,EAASA,OAAM,CAAA;AAE9D,EAAA,IAAI,YAAA,CAAa,YAAY,SAAA,EAAW;AACtC,IAAA,OAAO,YAAA;AAAA,EACT;AAGA,EAAA,MAAM,IAAI,KAAA;AAAA,IACR,CAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAAA,EAKuB,OAAO,CAAA;AAAA,GAChC;AACF;AAKA,eAAe,mBAAA,CACb,WAAA,EACA,iBAAA,EACA,OAAA,EACAA,OAAAA,EACsB;AACtB,EAAAA,OAAAA,CAAO,MAAM,6DAA6D,CAAA;AAG1E,EAAA,MAAM,YAAA,GAAe,MAAM,mBAAA,CAAoB,OAAA,EAASA,OAAM,CAAA;AAC9D,EAAA,IAAI,YAAA,CAAa,YAAY,SAAA,EAAW;AACtC,IAAAA,OAAAA,CAAO,OAAA,CAAQ,CAAA,sBAAA,EAAyB,YAAA,CAAa,OAAO,CAAA,CAAE,CAAA;AAC9D,IAAA,OAAO,YAAA;AAAA,EACT;AAGA,EAAAA,OAAAA,CAAO,MAAM,sDAAsD,CAAA;AAEnE,EAAA,MAAM,qBAAqB,MAAM,uBAAA,CAAwB,WAAA,EAAa,iBAAA,EAAmB,SAASA,OAAM,CAAA;AACxG,EAAA,IAAI,kBAAA,EAAoB;AACtB,IAAA,OAAO,kBAAA;AAAA,EACT;AAEA,EAAA,MAAM,gBAAgB,MAAM,iBAAA,CAAkB,WAAA,EAAa,iBAAA,EAAmB,SAASA,OAAM,CAAA;AAC7F,EAAA,IAAI,aAAA,EAAe;AACjB,IAAA,OAAO,aAAA;AAAA,EACT;AAEA,EAAA,OAAO,mBAAA,CAAoB,SAASA,OAAM,CAAA;AAC5C;AAKA,eAAe,WAAA,CACb,WAAA,EACA,iBAAA,EACA,OAAA,EACAA,OAAAA,EACsB;AAEtB,EAAAA,OAAAA,CAAO,MAAM,iEAAiE,CAAA;AAC9E,EAAA,MAAM,qBAAqB,MAAM,uBAAA,CAAwB,WAAA,EAAa,iBAAA,EAAmB,SAASA,OAAM,CAAA;AACxG,EAAA,IAAI,kBAAA,EAAoB;AACtB,IAAA,OAAO,kBAAA;AAAA,EACT;AAGA,EAAAA,OAAAA,CAAO,MAAM,kDAAkD,CAAA;AAC/D,EAAA,MAAM,gBAAgB,MAAM,iBAAA,CAAkB,WAAA,EAAa,iBAAA,EAAmB,SAASA,OAAM,CAAA;AAC7F,EAAA,IAAI,aAAA,EAAe;AACjB,IAAA,OAAO,aAAA;AAAA,EACT;AAGA,EAAAA,OAAAA,CAAO,MAAM,8BAA8B,CAAA;AAC3C,EAAA,MAAM,YAAA,GAAe,MAAM,mBAAA,CAAoB,OAAA,EAASA,OAAM,CAAA;AAC9D,EAAA,IAAI,YAAA,CAAa,YAAY,SAAA,EAAW;AACtC,IAAA,OAAO,YAAA;AAAA,EACT;AAEA,EAAA,OAAO,mBAAA,CAAoB,SAASA,OAAM,CAAA;AAC5C;AAKA,SAAS,mBAAA,CAAoB,SAAiBA,OAAAA,EAAuB;AACnE,EAAAA,OAAAA,CAAO,MAAM,8BAA8B,CAAA;AAC3C,EAAAA,OAAAA,CAAO,MAAM,aAAa,CAAA;AAC1B,EAAAA,OAAAA,CAAO,MAAM,2CAA2C,CAAA;AACxD,EAAAA,OAAAA,CAAO,MAAM,uCAAuC,CAAA;AACpD,EAAAA,OAAAA,CAAO,MAAM,uCAAuC,CAAA;AACpD,EAAAA,OAAAA,CAAO,MAAM,sCAAsC,CAAA;AACnD,EAAAA,OAAAA,CAAO,MAAM,EAAE,CAAA;AACf,EAAAA,OAAAA,CAAO,MAAM,YAAY,CAAA;AACzB,EAAAA,OAAAA,CAAO,MAAM,yDAAyD,CAAA;AACtE,EAAAA,OAAAA,CAAO,MAAM,uDAAuD,CAAA;AACpE,EAAAA,OAAAA,CAAO,MAAM,0DAA0D,CAAA;AACvE,EAAAA,OAAAA,CAAO,MAAM,4DAA4D,CAAA;AACzE,EAAAA,OAAAA,CAAO,KAAA,CAAM,CAAA,oBAAA,EAAuB,OAAO,CAAA,CAAE,CAAA;AAE7C,EAAA,MAAM,IAAI,MAAM,gEAAgE,CAAA;AAClF;AAKA,eAAe,uBAAA,CACb,WAAA,EACA,iBAAA,EACA,OAAA,EACAA,OAAAA,EAC6B;AAC7B,EAAA,MAAM,OAAA,GAAeK,KAAA,CAAA,IAAA,CAAK,OAAA,EAAS,4BAA4B,CAAA;AAC/D,EAAA,MAAM,QAAA,GAAqB,CAAC,CAAA,iCAAA,EAAA,iBAAoC,IAAI,MAAK,EAAE,WAAA,EAAa,CAAA,CAAE,CAAA;AAG1F,EAAA,MAAM,gBAAA,GAAwBA,KAAA,CAAA,IAAA,CAAK,WAAA,EAAa,cAAA,EAAgB,mBAAmB,eAAe,CAAA;AAClG,EAAA,IAAI,CAAI,GAAA,CAAA,UAAA,CAAW,gBAAgB,CAAA,EAAG;AACpC,IAAA,QAAA,CAAS,KAAK,iDAAiD,CAAA;AAC/D,IAAA,YAAA,CAAa,SAAS,QAAQ,CAAA;AAC9B,IAAAL,OAAAA,CAAO,MAAM,iDAAiD,CAAA;AAC9D,IAAA,OAAO,IAAA;AAAA,EACT;AAEA,EAAA,IAAI;AACF,IAAA,MAAM,eAAe,IAAA,CAAK,KAAA,CAAS,GAAA,CAAA,YAAA,CAAa,gBAAA,EAAkB,MAAM,CAAC,CAAA;AACzE,IAAA,MAAM,QAAA,GAAW,aAAa,QAAA,EAAU,IAAA,CAAK,CAAC,CAAA,KAAW,CAAA,CAAE,SAAS,UAAU,CAAA;AAC9E,IAAA,IAAI,CAAC,UAAU,QAAA,EAAU;AACvB,MAAA,QAAA,CAAS,KAAK,8CAA8C,CAAA;AAC5D,MAAA,YAAA,CAAa,SAAS,QAAQ,CAAA;AAC9B,MAAAA,OAAAA,CAAO,MAAM,8CAA8C,CAAA;AAC3D,MAAA,OAAO,IAAA;AAAA,IACT;AAEA,IAAA,QAAA,CAAS,IAAA,CAAK,CAAA,mBAAA,EAAsB,QAAA,CAAS,QAAQ,CAAA,CAAE,CAAA;AAEvD,IAAA,MAAM,EAAE,EAAA,EAAI,IAAA,EAAK,GAAI,SAAA,EAAU;AAC/B,IAAA,IAAI,EAAA,KAAO,SAAA,IAAa,IAAA,KAAS,SAAA,EAAW;AAC1C,MAAA,QAAA,CAAS,IAAA,CAAK,CAAA,qBAAA,EAAwB,EAAE,CAAA,CAAA,EAAI,IAAI,CAAA,CAAE,CAAA;AAClD,MAAA,YAAA,CAAa,SAAS,QAAQ,CAAA;AAC9B,MAAAA,QAAO,KAAA,CAAM,CAAA,qBAAA,EAAwB,EAAE,CAAA,CAAA,EAAI,IAAI,CAAA,CAAE,CAAA;AACjD,MAAA,OAAO,IAAA;AAAA,IACT;AAEA,IAAA,QAAA,CAAS,IAAA,CAAK,CAAA,SAAA,EAAY,EAAE,CAAA,CAAA,EAAI,IAAI,CAAA,CAAE,CAAA;AAGtC,IAAA,MAAM,aAAkBK,KAAA,CAAA,IAAA,CAAK,iBAAA,EAAmB,CAAA,SAAA,EAAY,QAAA,CAAS,QAAQ,CAAA,CAAE,CAAA;AAC/E,IAAA,IAAO,GAAA,CAAA,UAAA,CAAW,UAAU,CAAA,EAAG;AAC7B,MAAA,QAAA,CAAS,IAAA,CAAK,CAAA,yBAAA,EAA4B,UAAU,CAAA,CAAE,CAAA;AACtD,MAAA,YAAA,CAAa,SAAS,QAAQ,CAAA;AAC9B,MAAAL,OAAAA,CAAO,KAAA,CAAM,CAAA,yBAAA,EAA4B,UAAU,CAAA,CAAE,CAAA;AACrD,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,SAAA;AAAA,QACT,SAAS,QAAA,CAAS,QAAA;AAAA,QAClB,IAAA,EAAM,UAAA;AAAA,QACN,QAAA,EAAU;AAAA,OACZ;AAAA,IACF;AAGA,IAAA,MAAM,oBAAyBK,KAAA,CAAA,IAAA,CAAK,WAAA,EAAa,cAAA,EAAgB,aAAA,EAAe,QAAQ,cAAc,CAAA;AACtG,IAAA,IAAI,iBAAA,GAAoB,QAAA;AACxB,IAAA,IAAO,GAAA,CAAA,UAAA,CAAW,iBAAiB,CAAA,EAAG;AACpC,MAAA,MAAM,MAAM,IAAA,CAAK,KAAA,CAAS,GAAA,CAAA,YAAA,CAAa,iBAAA,EAAmB,MAAM,CAAC,CAAA;AACjE,MAAA,iBAAA,GAAoB,GAAA,CAAI,OAAA;AAAA,IAC1B;AAEA,IAAA,QAAA,CAAS,IAAA,CAAK,CAAA,oBAAA,EAAuB,iBAAiB,CAAA,CAAE,CAAA;AAGxD,IAAA,MAAM,IAAA,GAAO,QAAQ,GAAA,CAAI,6BAAA;AACzB,IAAA,IAAI,CAAC,IAAA,EAAM;AACT,MAAA,QAAA,CAAS,KAAK,+DAA+D,CAAA;AAC7E,MAAA,YAAA,CAAa,SAAS,QAAQ,CAAA;AAC9B,MAAAL,OAAAA,CAAO,MAAM,+DAA+D,CAAA;AAC5E,MAAA,OAAO,IAAA;AAAA,IACT;AAEA,IAAA,MAAM,GAAA,GAAM,OAAA,CAAQ,GAAA,CAAI,4BAAA,IAAgC,uBAAuB,iBAAiB,CAAA,CAAA;AAChG,IAAA,MAAM,QAAQ,CAAA,SAAA,EAAY,QAAA,CAAS,QAAQ,CAAA,CAAA,EAAI,EAAE,IAAI,IAAI,CAAA,IAAA,CAAA;AACzD,IAAA,MAAM,OAAA,GAAU,CAAA,mBAAA,EAAsB,IAAI,CAAA,mBAAA,EAAsB,GAAG,CAAA,CAAA;AACnE,IAAA,MAAM,MAAA,GAAS,CAAA,EAAG,OAAO,CAAA,CAAA,EAAI,KAAK,CAAA,CAAA;AAClC,IAAA,MAAM,MAAA,GAAS,CAAA,EAAG,OAAO,CAAA,CAAA,EAAI,KAAK,CAAA,OAAA,CAAA;AAElC,IAAA,QAAA,CAAS,IAAA,CAAK,CAAA,MAAA,EAAS,IAAI,CAAA,CAAE,CAAA;AAC7B,IAAA,QAAA,CAAS,IAAA,CAAK,CAAA,KAAA,EAAQ,GAAG,CAAA,CAAE,CAAA;AAC3B,IAAA,QAAA,CAAS,IAAA,CAAK,CAAA,OAAA,EAAU,KAAK,CAAA,CAAE,CAAA;AAC/B,IAAA,QAAA,CAAS,IAAA,CAAK,CAAA,KAAA,EAAQ,MAAM,CAAA,CAAE,CAAA;AAE9B,IAAAA,OAAAA,CAAO,aAAa,sDAAsD,CAAA;AAE1E,IAAA,MAAM,OAAA,GAAeK,KAAA,CAAA,IAAA,CAAK,iBAAA,EAAmB,KAAK,CAAA;AAClD,IAAA,MAAM,OAAA,GAAU,GAAG,OAAO,CAAA,OAAA,CAAA;AAE1B,IAAA,IAAI;AAEF,MAAA,QAAA,CAAS,KAAK,oBAAoB,CAAA;AAClC,MAAA,MAAM,YAAA,CAAa,MAAA,EAAQ,OAAA,EAAS,GAAK,CAAA;AACzC,MAAA,QAAA,CAAS,KAAK,CAAA,gBAAA,EAAsB,GAAA,CAAA,QAAA,CAAS,OAAO,CAAA,CAAE,IAAI,CAAA,MAAA,CAAQ,CAAA;AAGlE,MAAA,QAAA,CAAS,KAAK,uBAAuB,CAAA;AACrC,MAAA,MAAM,YAAA,CAAa,MAAA,EAAQ,OAAA,EAAS,GAAK,CAAA;AAGzC,MAAA,MAAM,YAAA,GAAkB,GAAA,CAAA,YAAA,CAAa,OAAA,EAAS,MAAM,CAAA,CAAE,KAAA,CAAM,KAAK,CAAA,CAAE,CAAC,CAAA,CAAE,IAAA,EAAK,CAAE,WAAA,EAAY;AACzF,MAAA,MAAM,UAAA,GAAa,MAAM,aAAA,CAAc,OAAO,CAAA;AAE9C,MAAA,QAAA,CAAS,IAAA,CAAK,CAAA,iBAAA,EAAoB,YAAY,CAAA,CAAE,CAAA;AAChD,MAAA,QAAA,CAAS,IAAA,CAAK,CAAA,eAAA,EAAkB,UAAU,CAAA,CAAE,CAAA;AAE5C,MAAA,IAAI,iBAAiB,UAAA,EAAY;AAC/B,QAAA,QAAA,CAAS,KAAK,kCAAkC,CAAA;AAChD,QAAA,YAAA,CAAa,SAAS,QAAQ,CAAA;AAC9B,QAAAL,OAAAA,CAAO,YAAY,iCAAiC,CAAA;AACpD,QAAG,eAAW,OAAO,CAAA;AACrB,QAAG,eAAW,OAAO,CAAA;AACrB,QAAA,OAAO,IAAA;AAAA,MACT;AAEA,MAAA,QAAA,CAAS,KAAK,mBAAmB,CAAA;AAGjC,MAAA,QAAA,CAAS,KAAK,mBAAmB,CAAA;AACjC,MAAA,MAAM,UAAA,CAAW,SAAS,iBAAiB,CAAA;AAC3C,MAAA,QAAA,CAAS,IAAA,CAAK,CAAA,cAAA,EAAiB,iBAAiB,CAAA,CAAE,CAAA;AAGlD,MAAG,eAAW,OAAO,CAAA;AACrB,MAAG,eAAW,OAAO,CAAA;AAErB,MAAA,QAAA,CAAS,KAAK,gDAAgD,CAAA;AAC9D,MAAA,YAAA,CAAa,SAAS,QAAQ,CAAA;AAE9B,MAAAA,OAAAA,CAAO,eAAe,kDAAkD,CAAA;AAExE,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,SAAA;AAAA,QACT,SAAS,QAAA,CAAS,QAAA;AAAA,QAClB,MAAWK,KAAA,CAAA,IAAA,CAAK,iBAAA,EAAmB,CAAA,SAAA,EAAY,QAAA,CAAS,QAAQ,CAAA,CAAE,CAAA;AAAA,QAClE,QAAA,EAAU;AAAA,OACZ;AAAA,IACF,SAAS,aAAA,EAAe;AACtB,MAAA,QAAA,CAAS,IAAA,CAAK,CAAA,iBAAA,EAAoB,aAAa,CAAA,CAAE,CAAA;AACjD,MAAA,YAAA,CAAa,SAAS,QAAQ,CAAA;AAC9B,MAAAL,OAAAA,CAAO,YAAY,+BAA+B,CAAA;AAGlD,MAAA,IAAO,GAAA,CAAA,UAAA,CAAW,OAAO,CAAA,EAAM,eAAW,OAAO,CAAA;AACjD,MAAA,IAAO,GAAA,CAAA,UAAA,CAAW,OAAO,CAAA,EAAM,eAAW,OAAO,CAAA;AAEjD,MAAA,OAAO,IAAA;AAAA,IACT;AAAA,EACF,SAAS,KAAA,EAAO;AACd,IAAA,QAAA,CAAS,IAAA,CAAK,CAAA,4BAAA,EAA+B,KAAK,CAAA,CAAE,CAAA;AACpD,IAAA,YAAA,CAAa,SAAS,QAAQ,CAAA;AAC9B,IAAAA,OAAAA,CAAO,KAAA,CAAM,CAAA,4BAAA,EAA+B,KAAK,CAAA,CAAE,CAAA;AACnD,IAAA,OAAO,IAAA;AAAA,EACT;AACF;AAKA,SAAS,YAAA,CAAa,GAAA,EAAa,QAAA,EAAkB,SAAA,EAAkC;AACrF,EAAA,OAAO,IAAI,OAAA,CAAQ,CAACH,SAAAA,EAAS,MAAA,KAAW;AACtC,IAAA,MAAM,IAAA,GAAU,sBAAkB,QAAQ,CAAA;AAE1C,IAAA,MAAM,OAAA,GAAgB,UAAI,GAAA,EAAK,EAAE,SAAS,SAAA,EAAU,EAAG,CAAC,QAAA,KAAa;AAEnE,MAAA,IAAI,QAAA,CAAS,UAAA,KAAe,GAAA,IAAO,QAAA,CAAS,eAAe,GAAA,EAAK;AAC9D,QAAA,MAAM,WAAA,GAAc,SAAS,OAAA,CAAQ,QAAA;AACrC,QAAA,IAAI,WAAA,EAAa;AACf,UAAA,IAAA,CAAK,KAAA,EAAM;AACX,UAAG,eAAW,QAAQ,CAAA;AACtB,UAAA,YAAA,CAAa,WAAA,EAAa,UAAU,SAAS,CAAA,CAAE,KAAKA,SAAO,CAAA,CAAE,MAAM,MAAM,CAAA;AACzE,UAAA;AAAA,QACF;AAAA,MACF;AAEA,MAAA,IAAI,QAAA,CAAS,eAAe,GAAA,EAAK;AAC/B,QAAA,IAAA,CAAK,KAAA,EAAM;AACX,QAAG,eAAW,QAAQ,CAAA;AACtB,QAAA,MAAA,CAAO,IAAI,MAAM,CAAA,KAAA,EAAQ,QAAA,CAAS,UAAU,CAAA,EAAA,EAAK,GAAG,EAAE,CAAC,CAAA;AACvD,QAAA;AAAA,MACF;AAEA,MAAA,QAAA,CAAS,KAAK,IAAI,CAAA;AAClB,MAAA,IAAA,CAAK,EAAA,CAAG,UAAU,MAAM;AACtB,QAAA,IAAA,CAAK,KAAA,EAAM;AACX,QAAAA,SAAAA,EAAQ;AAAA,MACV,CAAC,CAAA;AAAA,IACH,CAAC,CAAA;AAED,IAAA,OAAA,CAAQ,EAAA,CAAG,OAAA,EAAS,CAAC,GAAA,KAAQ;AAC3B,MAAA,IAAA,CAAK,KAAA,EAAM;AACX,MAAA,IAAO,GAAA,CAAA,UAAA,CAAW,QAAQ,CAAA,EAAM,eAAW,QAAQ,CAAA;AACnD,MAAA,MAAA,CAAO,GAAG,CAAA;AAAA,IACZ,CAAC,CAAA;AAED,IAAA,OAAA,CAAQ,EAAA,CAAG,WAAW,MAAM;AAC1B,MAAA,OAAA,CAAQ,OAAA,EAAQ;AAChB,MAAA,IAAA,CAAK,KAAA,EAAM;AACX,MAAA,IAAO,GAAA,CAAA,UAAA,CAAW,QAAQ,CAAA,EAAM,eAAW,QAAQ,CAAA;AACnD,MAAA,MAAA,CAAO,IAAI,KAAA,CAAM,CAAA,kBAAA,EAAqB,GAAG,EAAE,CAAC,CAAA;AAAA,IAC9C,CAAC,CAAA;AAAA,EACH,CAAC,CAAA;AACH;AAKA,SAAS,cAAc,QAAA,EAAmC;AACxD,EAAA,OAAO,IAAI,OAAA,CAAQ,CAACA,SAAAA,EAAS,MAAA,KAAW;AACtC,IAAA,MAAM,IAAA,GAAc,kBAAW,QAAQ,CAAA;AACvC,IAAA,MAAM,MAAA,GAAY,qBAAiB,QAAQ,CAAA;AAE3C,IAAA,MAAA,CAAO,GAAG,MAAA,EAAQ,CAAC,SAAS,IAAA,CAAK,MAAA,CAAO,IAAI,CAAC,CAAA;AAC7C,IAAA,MAAA,CAAO,EAAA,CAAG,KAAA,EAAO,MAAMA,SAAAA,CAAQ,IAAA,CAAK,OAAO,KAAK,CAAA,CAAE,WAAA,EAAa,CAAC,CAAA;AAChE,IAAA,MAAA,CAAO,EAAA,CAAG,SAAS,MAAM,CAAA;AAAA,EAC3B,CAAC,CAAA;AACH;AAKA,eAAe,UAAA,CAAW,SAAiB,OAAA,EAAgC;AACzE,EAAA,OAAO,IAAI,OAAA,CAAQ,CAACA,SAAAA,EAAS,MAAA,KAAW;AAEtC,IAAA,MAAM,QAAA,GAAW;AAAA,MACf,EAAE,KAAK,OAAA,EAAS,IAAA,EAAM,CAAC,IAAA,EAAM,OAAA,EAAS,IAAA,EAAM,OAAO,CAAA,EAAE;AAAA,MACrD,EAAE,KAAK,QAAA,EAAU,IAAA,EAAM,CAAC,KAAA,EAAO,OAAA,EAAS,IAAA,EAAM,OAAO,CAAA,EAAE;AAAA,MACvD,EAAE,KAAK,KAAA,EAAO,IAAA,EAAM,CAAC,MAAA,EAAQ,OAAA,EAAS,IAAA,EAAM,OAAO,CAAA;AAAE,KACvD;AAEA,IAAA,MAAM,UAAA,GAAa,CAAC,KAAA,KAAkB;AACpC,MAAA,IAAI,KAAA,IAAS,SAAS,MAAA,EAAQ;AAC5B,QAAA,MAAA,CAAO,IAAI,KAAA,CAAM,6DAA6D,CAAC,CAAA;AAC/E,QAAA;AAAA,MACF;AAEA,MAAA,MAAM,EAAE,GAAA,EAAK,IAAA,EAAK,GAAI,SAAS,KAAK,CAAA;AACpC,MAAA,MAAM,QAAQ,KAAA,CAAM,GAAA,EAAK,MAAM,EAAE,KAAA,EAAO,QAAQ,CAAA;AAEhD,MAAA,KAAA,CAAM,EAAA,CAAG,SAAS,MAAM;AAEtB,QAAA,UAAA,CAAW,QAAQ,CAAC,CAAA;AAAA,MACtB,CAAC,CAAA;AAED,MAAA,KAAA,CAAM,EAAA,CAAG,OAAA,EAAS,CAAC,IAAA,KAAS;AAC1B,QAAA,IAAI,SAAS,CAAA,EAAG;AACd,UAAAA,SAAAA,EAAQ;AAAA,QACV,CAAA,MAAO;AAEL,UAAA,UAAA,CAAW,QAAQ,CAAC,CAAA;AAAA,QACtB;AAAA,MACF,CAAC,CAAA;AAAA,IACH,CAAA;AAEA,IAAA,UAAA,CAAW,CAAC,CAAA;AAAA,EACd,CAAC,CAAA;AACH;AAKA,SAAS,YAAA,CAAa,SAAiB,KAAA,EAAuB;AAC5D,EAAA,IAAI;AACF,IAAG,kBAAc,OAAA,EAAS,KAAA,CAAM,IAAA,CAAK,IAAI,IAAI,IAAI,CAAA;AAAA,EACnD,CAAA,CAAA,MAAQ;AAAA,EAER;AACF;AAKA,eAAe,iBAAA,CACb,WAAA,EACA,iBAAA,EACA,OAAA,EACAG,OAAAA,EAC6B;AAC7B,EAAA,MAAM,OAAA,GAAeK,KAAA,CAAA,IAAA,CAAK,OAAA,EAAS,gCAAgC,CAAA;AAEnE,EAAA,OAAO,IAAI,OAAA,CAAQ,CAACR,SAAAA,KAAY;AAC9B,IAAAG,OAAAA,CAAO,aAAa,mCAAmC,CAAA;AAEvD,IAAA,MAAM,QAAA,GAAqB,CAAC,CAAA,qCAAA,EAAA,iBAAwC,IAAI,MAAK,EAAE,WAAA,EAAa,CAAA,CAAE,CAAA;AAC9F,IAAA,QAAA,CAAS,IAAA,CAAK,CAAA,mBAAA,EAAsB,WAAW,CAAA,CAAE,CAAA;AACjD,IAAA,QAAA,CAAS,IAAA,CAAK,CAAA,gBAAA,EAAmB,iBAAiB,CAAA,CAAE,CAAA;AAEpD,IAAA,MAAM,QAAQ,KAAA,CAAM,KAAA,EAAO,CAAC,YAAA,EAAc,SAAA,EAAW,UAAU,CAAA,EAAG;AAAA,MAChE,GAAA,EAAK,WAAA;AAAA,MACL,GAAA,EAAK;AAAA,QACH,GAAG,OAAA,CAAQ,GAAA;AAAA,QACX,wBAAA,EAA0B;AAAA,OAC5B;AAAA,MACA,KAAA,EAAO,IAAA;AAAA,MACP,KAAA,EAAO;AAAA,KACR,CAAA;AAED,IAAA,IAAI,MAAA,GAAS,EAAA;AACb,IAAA,IAAI,MAAA,GAAS,EAAA;AAEb,IAAA,KAAA,CAAM,MAAA,EAAQ,EAAA,CAAG,MAAA,EAAQ,CAAC,IAAA,KAAS;AACjC,MAAA,MAAA,IAAU,KAAK,QAAA,EAAS;AAAA,IAC1B,CAAC,CAAA;AAED,IAAA,KAAA,CAAM,MAAA,EAAQ,EAAA,CAAG,MAAA,EAAQ,CAAC,IAAA,KAAS;AACjC,MAAA,MAAA,IAAU,KAAK,QAAA,EAAS;AAAA,IAC1B,CAAC,CAAA;AAED,IAAA,KAAA,CAAM,EAAA,CAAG,OAAA,EAAS,CAAC,IAAA,KAAS;AAC1B,MAAA,QAAA,CAAS,IAAA,CAAK,CAAA,WAAA,EAAc,IAAI,CAAA,CAAE,CAAA;AAClC,MAAA,QAAA,CAAS,KAAK,gBAAgB,CAAA;AAC9B,MAAA,QAAA,CAAS,IAAA,CAAK,UAAU,SAAS,CAAA;AACjC,MAAA,QAAA,CAAS,KAAK,gBAAgB,CAAA;AAC9B,MAAA,QAAA,CAAS,IAAA,CAAK,UAAU,SAAS,CAAA;AACjC,MAAA,YAAA,CAAa,SAAS,QAAQ,CAAA;AAE9B,MAAA,IAAI,SAAS,CAAA,EAAG;AACd,QAAAA,OAAAA,CAAO,eAAe,+BAA+B,CAAA;AACrD,QAAAH,SAAAA,CAAQ;AAAA,UACN,OAAA,EAAS,SAAA;AAAA,UACT,OAAA,EAAS,IAAA;AAAA,UACT,IAAA,EAAM,iBAAA;AAAA,UACN,QAAA,EAAU;AAAA,SACX,CAAA;AAAA,MACH,CAAA,MAAO;AACL,QAAAG,OAAAA,CAAO,YAAY,uCAAuC,CAAA;AAC1D,QAAAA,OAAAA,CAAO,KAAA,CAAM,CAAA,WAAA,EAAc,IAAI,CAAA,CAAE,CAAA;AACjC,QAAAA,OAAAA,CAAO,KAAA,CAAM,CAAA,kBAAA,EAAqB,OAAO,CAAA,CAAE,CAAA;AAC3C,QAAAH,UAAQ,IAAI,CAAA;AAAA,MACd;AAAA,IACF,CAAC,CAAA;AAED,IAAA,KAAA,CAAM,EAAA,CAAG,OAAA,EAAS,CAAC,KAAA,KAAU;AAC3B,MAAA,QAAA,CAAS,IAAA,CAAK,CAAA,eAAA,EAAkB,KAAA,CAAM,OAAO,CAAA,CAAE,CAAA;AAC/C,MAAA,YAAA,CAAa,SAAS,QAAQ,CAAA;AAC9B,MAAAG,OAAAA,CAAO,YAAY,uCAAuC,CAAA;AAC1D,MAAAA,OAAAA,CAAO,KAAA,CAAM,CAAA,OAAA,EAAU,KAAA,CAAM,OAAO,CAAA,CAAE,CAAA;AACtC,MAAAH,UAAQ,IAAI,CAAA;AAAA,IACd,CAAC,CAAA;AAGD,IAAA,UAAA,CAAW,MAAM;AACf,MAAA,QAAA,CAAS,KAAK,kDAAkD,CAAA;AAChE,MAAA,YAAA,CAAa,SAAS,QAAQ,CAAA;AAC9B,MAAA,KAAA,CAAM,IAAA,EAAK;AACX,MAAAG,OAAAA,CAAO,YAAY,gCAAgC,CAAA;AACnD,MAAAH,UAAQ,IAAI,CAAA;AAAA,IACd,GAAG,GAAM,CAAA;AAAA,EACX,CAAC,CAAA;AACH;AAKA,eAAe,mBAAA,CAAoB,SAAiBG,OAAAA,EAAsC;AACxF,EAAA,MAAM,OAAA,GAAeK,KAAA,CAAA,IAAA,CAAK,OAAA,EAAS,2BAA2B,CAAA;AAC9D,EAAA,MAAM,QAAA,GAAqB,CAAC,CAAA,2BAAA,EAAA,iBAA8B,IAAI,MAAK,EAAE,WAAA,EAAa,CAAA,CAAE,CAAA;AACpF,EAAA,QAAA,CAAS,IAAA,CAAK,CAAA,UAAA,EAAa,OAAA,CAAQ,QAAQ,CAAA,CAAE,CAAA;AAG7C,EAAA,QAAA,CAAS,KAAK,4BAA4B,CAAA;AAC1C,EAAA,MAAM,QAAA,GAAW,MAAM,gBAAA,CAAiB,QAAA,EAAU,QAAgB,CAAA;AAClE,EAAA,IAAI,QAAA,EAAU;AACZ,IAAA,QAAA,CAAS,KAAK,CAAA,uBAAA,EAA0B,QAAA,CAAS,IAAI,CAAA,EAAA,EAAK,QAAA,CAAS,OAAO,CAAA,CAAA,CAAG,CAAA;AAC7E,IAAA,YAAA,CAAa,SAAS,QAAQ,CAAA;AAC9B,IAAAL,QAAO,OAAA,CAAQ,CAAA,yBAAA,EAA4B,QAAA,CAAS,OAAA,IAAW,iBAAiB,CAAA,CAAE,CAAA;AAClF,IAAA,OAAO,QAAA;AAAA,EACT;AAGA,EAAA,QAAA,CAAS,KAAK,2BAA2B,CAAA;AACzC,EAAA,MAAM,UAAA,GAAa,MAAM,gBAAA,CAAiB,QAAA,EAAU,QAAgB,CAAA;AACpE,EAAA,IAAI,UAAA,EAAY;AACd,IAAA,QAAA,CAAS,KAAK,CAAA,yBAAA,EAA4B,UAAA,CAAW,IAAI,CAAA,EAAA,EAAK,UAAA,CAAW,OAAO,CAAA,CAAA,CAAG,CAAA;AACnF,IAAA,YAAA,CAAa,SAAS,QAAQ,CAAA;AAC9B,IAAAA,QAAO,OAAA,CAAQ,CAAA,wBAAA,EAA2B,UAAA,CAAW,OAAA,IAAW,iBAAiB,CAAA,CAAE,CAAA;AACnF,IAAA,OAAO,UAAA;AAAA,EACT;AAEA,EAAA,QAAA,CAAS,KAAK,0BAA0B,CAAA;AACxC,EAAA,YAAA,CAAa,SAAS,QAAQ,CAAA;AAE9B,EAAA,OAAO;AAAA,IACL,OAAA,EAAS,SAAA;AAAA,IACT,OAAA,EAAS,IAAA;AAAA,IACT,IAAA,EAAM,IAAA;AAAA,IACN,QAAA,EAAU;AAAA,GACZ;AACF;AAKA,eAAe,gBAAA,CACb,OAAA,EACA,QAAA,EACAA,OAAAA,EAC6B;AAC7B,EAAA,MAAM,KAAA,GAAQ,gBAAgB,OAAO,CAAA;AAErC,EAAA,KAAA,MAAW,eAAe,KAAA,EAAO;AAC/B,IAAA,QAAA,CAAS,IAAA,CAAK,CAAA,iBAAA,EAAoB,WAAW,CAAA,CAAE,CAAA;AAC/C,IAAA,IAAO,GAAA,CAAA,UAAA,CAAW,WAAW,CAAA,EAAG;AAC9B,MAAA,MAAMI,QAAAA,GAAU,MAAM,iBAAA,CAAkB,WAAW,CAAA;AACnD,MAAA,QAAA,CAAS,IAAA,CAAK,CAAA,oBAAA,EAAuBA,QAAAA,IAAW,SAAS,CAAA,CAAE,CAAA;AAC3D,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,OAAA;AAAA,QACT,OAAA,EAAAA,QAAAA;AAAA,QACA,IAAA,EAAM,WAAA;AAAA,QACN,QAAA,EAAU;AAAA,OACZ;AAAA,IACF,CAAA,MAAO;AACL,MAAA,QAAA,CAAS,KAAK,eAAe,CAAA;AAAA,IAC/B;AAAA,EACF;AAGA,EAAA,MAAM,QAAA,GACJ,YAAY,QAAA,GACR,CAAC,kBAAkB,uBAAuB,CAAA,GAC1C,CAAC,eAAA,EAAiB,sBAAsB,CAAA;AAE9C,EAAA,KAAA,MAAW,OAAO,QAAA,EAAU;AAC1B,IAAA,QAAA,CAAS,IAAA,CAAK,CAAA,oBAAA,EAAuB,GAAG,CAAA,CAAE,CAAA;AAC1C,IAAA,IAAI;AACF,MAAA,MAAM,MAAA,GAAS,QAAA,CAAS,CAAA,EAAG,GAAG,CAAA,UAAA,CAAA,EAAc,EAAE,QAAA,EAAU,MAAA,EAAQ,KAAA,EAAO,MAAA,EAAQ,OAAA,EAAS,GAAA,EAAM,CAAA;AAC9F,MAAA,MAAM,YAAA,GAAe,MAAA,CAAO,KAAA,CAAM,sBAAsB,CAAA;AACxD,MAAA,QAAA,CAAS,KAAK,CAAA,oBAAA,EAAuB,YAAA,GAAe,aAAa,CAAC,CAAA,GAAI,SAAS,CAAA,CAAE,CAAA;AACjF,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,OAAA;AAAA,QACT,OAAA,EAAS,YAAA,GAAe,YAAA,CAAa,CAAC,CAAA,GAAI,IAAA;AAAA,QAC1C,IAAA,EAAM,GAAA;AAAA,QACN,QAAA,EAAU;AAAA,OACZ;AAAA,IACF,SAAS,GAAA,EAAK;AACZ,MAAA,QAAA,CAAS,KAAK,CAAA,eAAA,EAAkB,GAAA,YAAe,QAAQ,GAAA,CAAI,OAAA,GAAU,eAAe,CAAA,CAAE,CAAA;AAAA,IACxF;AAAA,EACF;AAEA,EAAA,OAAO,IAAA;AACT;AAKA,eAAe,kBAAkB,WAAA,EAA6C;AAC5E,EAAA,IAAI;AACF,IAAA,MAAM,MAAA,GAAS,QAAA,CAAS,CAAA,CAAA,EAAI,WAAW,CAAA,WAAA,CAAA,EAAe,EAAE,QAAA,EAAU,MAAA,EAAQ,KAAA,EAAO,MAAA,EAAQ,OAAA,EAAS,GAAA,EAAM,CAAA;AACxG,IAAA,MAAM,YAAA,GAAe,MAAA,CAAO,KAAA,CAAM,sBAAsB,CAAA;AACxD,IAAA,OAAO,YAAA,GAAe,YAAA,CAAa,CAAC,CAAA,GAAI,IAAA;AAAA,EAC1C,CAAA,CAAA,MAAQ;AACN,IAAA,OAAO,IAAA;AAAA,EACT;AACF;AAKA,SAAS,gBAAgB,OAAA,EAAwC;AAC/D,EAAA,MAAM,QAAkB,EAAC;AAEzB,EAAA,IAAI,OAAA,CAAQ,aAAa,OAAA,EAAS;AAChC,IAAA,MAAM,YAAA,GAAe,OAAA,CAAQ,GAAA,CAAI,cAAc,CAAA,IAAK,mBAAA;AACpD,IAAA,MAAM,eAAA,GAAkB,OAAA,CAAQ,GAAA,CAAI,mBAAmB,CAAA,IAAK,yBAAA;AAC5D,IAAA,MAAM,YAAA,GAAe,OAAA,CAAQ,GAAA,CAAI,cAAc,CAAA,IAAK,EAAA;AAEpD,IAAA,IAAI,YAAY,QAAA,EAAU;AACxB,MAAA,KAAA,CAAM,IAAA;AAAA,QACJ,GAAG,eAAe,CAAA,0CAAA,CAAA;AAAA,QAClB,GAAG,YAAY,CAAA,0CAAA,CAAA;AAAA,QACf,GAAG,YAAY,CAAA,0CAAA;AAAA,OACjB;AAAA,IACF,CAAA,MAAO;AACL,MAAA,KAAA,CAAM,IAAA;AAAA,QACJ,GAAG,YAAY,CAAA,yCAAA,CAAA;AAAA,QACf,GAAG,eAAe,CAAA,yCAAA,CAAA;AAAA,QAClB,GAAG,YAAY,CAAA,yCAAA;AAAA,OACjB;AAAA,IACF;AAAA,EACF,CAAA,MAAA,IAAW,OAAA,CAAQ,QAAA,KAAa,QAAA,EAAU;AACxC,IAAA,IAAI,YAAY,QAAA,EAAU;AACxB,MAAA,KAAA,CAAM,KAAK,gEAAgE,CAAA;AAAA,IAC7E,CAAA,MAAO;AACL,MAAA,KAAA,CAAM,KAAK,8DAA8D,CAAA;AAAA,IAC3E;AAAA,EACF,CAAA,MAAO;AAEL,IAAA,IAAI,YAAY,QAAA,EAAU;AACxB,MAAA,KAAA,CAAM,IAAA,CAAK,yBAAA,EAA2B,gCAAA,EAAkC,0BAA0B,CAAA;AAAA,IACpG,CAAA,MAAO;AACL,MAAA,KAAA,CAAM,IAAA;AAAA,QACJ,wBAAA;AAAA,QACA,+BAAA;AAAA,QACA,oBAAA;AAAA,QACA;AAAA,OACF;AAAA,IACF;AAAA,EACF;AAEA,EAAA,OAAO,KAAA;AACT;AAKO,SAAS,uBAAA,CAAwB,YAAoB,WAAA,EAAgC;AAC1F,EAAA,IAAI,CAAI,GAAA,CAAA,UAAA,CAAW,UAAU,CAAA,EAAG;AAC9B,IAAA;AAAA,EACF;AAEA,EAAA,IAAI,OAAA,GAAa,GAAA,CAAA,YAAA,CAAa,UAAA,EAAY,MAAM,CAAA;AAGhD,EAAA,IAAI,CAAC,mBAAA,CAAoB,IAAA,CAAK,OAAO,CAAA,EAAG;AAEtC,IAAA,OAAA,IAAW;AAAA;AAAA;AAAA;AAAA,WAAA,EAIF,YAAY,OAAO;AAAA,YAAA,EAClB,YAAY,QAAQ;AAAA;AAAA;AAAA;AAAA;AAAA,CAAA;AAAA,EAMhC,CAAA,MAAO;AAEL,IAAA,OAAA,GAAU,OAAA,CAAQ,OAAA;AAAA,MAChB,0BAAA;AAAA,MACA,CAAA,EAAA,EAAK,YAAY,OAAO,CAAA;AAAA,KAC1B;AACA,IAAA,OAAA,GAAU,OAAA,CAAQ,OAAA;AAAA,MAChB,2BAAA;AAAA,MACA,CAAA,EAAA,EAAK,YAAY,QAAQ,CAAA;AAAA,KAC3B;AAAA,EACF;AAEA,EAAG,GAAA,CAAA,aAAA,CAAc,YAAY,OAAO,CAAA;AACtC;;;AC3vBA,WAAA,EAAA;AAKA,IAAM,iBAAA,GAAoB,EAAE,MAAA,CAAO;AAAA,EACjC,OAAA,EAAS,CAAA,CAAE,MAAA,EAAO,CAAE,GAAA,EAAI,CAAE,EAAA,CAAG,CAAA,CAAE,MAAA,EAAO,CAAE,KAAA,CAAM,eAAe,CAAC;AAAA;AAChE,CAAC,EAAE,WAAA,EAAY;AAKf,IAAM,UAAA,GAAa,EAAE,MAAA,CAAO;AAAA,EAC1B,QAAA,EAAU,CAAA,CAAE,IAAA,CAAK,CAAC,MAAA,EAAQ,MAAA,EAAQ,OAAA,EAAS,QAAA,EAAU,MAAM,CAAC,CAAA,CAAE,OAAA,CAAQ,MAAM,CAAA;AAAA,EAC5E,eAAA,EAAiB,CAAA,CAAE,MAAA,EAAO,CAAE,QAAQ,gBAAgB,CAAA;AAAA,EACpD,KAAA,EAAO,CAAA,CAAE,MAAA,CAAO,CAAA,CAAE,MAAA,CAAO;AAAA,IACvB,QAAA,EAAU,CAAA,CAAE,MAAA,EAAO,CAAE,QAAA,EAAS;AAAA,IAC9B,QAAA,EAAU,CAAA,CAAE,MAAA,EAAO,CAAE,QAAA;AAAS,GAC/B,CAAC,CAAA,CAAE,QAAA;AACN,CAAC,EAAE,WAAA,EAAY;AAKf,IAAM,aAAA,GAAgB,EAAE,MAAA,CAAO;AAAA,EAC7B,OAAA,EAAS,CAAA,CAAE,KAAA,CAAM,CAAA,CAAE,KAAK,CAAC,UAAA,EAAY,SAAA,EAAW,QAAQ,CAAC,CAAC,CAAA,CAAE,OAAA,CAAQ,CAAC,UAAU,CAAC,CAAA;AAAA,EAChF,OAAA,EAAS,CAAA,CAAE,IAAA,CAAK,CAAC,SAAA,EAAW,QAAA,EAAU,QAAA,EAAU,aAAA,EAAe,YAAY,CAAC,CAAA,CAAE,OAAA,CAAQ,SAAS,CAAA;AAAA,EAC/F,QAAA,EAAU,CAAA,CAAE,IAAA,CAAK,CAAC,MAAA,EAAQ,cAAA,EAAgB,aAAA,EAAe,eAAA,EAAiB,gBAAgB,CAAC,CAAA,CAAE,OAAA,CAAQ,MAAM,CAAA;AAAA,EAC3G,QAAA,EAAU,EAAE,MAAA,CAAO;AAAA,IACjB,KAAA,EAAO,CAAA,CAAE,MAAA,EAAO,CAAE,GAAA,CAAI,GAAG,CAAA,CAAE,GAAA,CAAI,IAAI,CAAA,CAAE,OAAA,CAAQ,IAAI,CAAA;AAAA,IACjD,MAAA,EAAQ,CAAA,CAAE,MAAA,EAAO,CAAE,GAAA,CAAI,GAAG,CAAA,CAAE,GAAA,CAAI,IAAI,CAAA,CAAE,OAAA,CAAQ,GAAG;AAAA,GAClD,EAAE,QAAA,EAAS;AAAA,EACZ,QAAA,EAAU,CAAA,CAAE,OAAA,EAAQ,CAAE,QAAQ,IAAI;AACpC,CAAC,EAAE,WAAA,EAAY;AAKf,IAAM,cAAA,GAAiB,EAAE,MAAA,CAAO;AAAA,EAC9B,QAAA,EAAU,CAAA,CAAE,OAAA,EAAQ,CAAE,QAAQ,IAAI,CAAA;AAAA,EAClC,OAAA,EAAS,CAAA,CAAE,MAAA,EAAO,CAAE,GAAA,CAAI,CAAC,CAAA,CAAE,GAAA,CAAI,EAAE,CAAA,CAAE,OAAA,CAAQ,CAAC,CAAA;AAAA,EAC5C,OAAA,EAAS,CAAA,CAAE,MAAA,EAAO,CAAE,GAAA,CAAI,GAAI,CAAA,CAAE,GAAA,CAAI,GAAM,CAAA,CAAE,OAAA,CAAQ,GAAK,CAAA;AAAA,EACvD,cAAA,EAAgB,CAAA,CAAE,OAAA,EAAQ,CAAE,QAAQ,IAAI;AAC1C,CAAC,EAAE,WAAA,EAAY;AAKf,IAAM,gBAAA,GAAmB,EAAE,MAAA,CAAO;AAAA,EAChC,OAAA,EAAS,CAAA,CAAE,MAAA,EAAO,CAAE,QAAQ,KAAK,CAAA;AAAA,EACjC,GAAA,EAAK,EAAE,MAAA,CAAO;AAAA,IACZ,IAAA,EAAM,EAAE,MAAA,EAAO;AAAA,IACf,IAAA,EAAM,CAAA,CAAE,IAAA,CAAK,CAAC,KAAA,EAAO,UAAU,KAAK,CAAC,CAAA,CAAE,OAAA,CAAQ,KAAK,CAAA;AAAA,IACpD,WAAA,EAAa,CAAA,CAAE,MAAA,EAAO,CAAE,QAAA;AAAS,GAClC,CAAA;AAAA,EACD,YAAA,EAAc,CAAA,CAAE,MAAA,CAAO,iBAAiB,CAAA;AAAA,EACxC,IAAA,EAAM,WAAW,QAAA,EAAS;AAAA,EAC1B,QAAA,EAAU,eAAe,QAAA,EAAS;AAAA,EAClC,QAAA,EAAU,cAAc,QAAA;AAC1B,CAAC,EAAE,WAAA,EAAY;AAcR,SAAS,kBAAA,CAAmB,YAAoBJ,OAAAA,EAAmC;AACxF,EAAA,MAAM,GAAA,GAAMA,OAAAA,IAAU,IAAI,MAAA,EAAO;AACjC,EAAA,MAAM,MAAA,GAA2B;AAAA,IAC/B,KAAA,EAAO,IAAA;AAAA,IACP,QAAQ,EAAC;AAAA,IACT,UAAU;AAAC,GACb;AAGA,EAAA,IAAI,CAAIM,GAAA,CAAA,UAAA,CAAW,UAAU,CAAA,EAAG;AAC9B,IAAA,MAAA,CAAO,KAAA,GAAQ,KAAA;AACf,IAAA,MAAA,CAAO,MAAA,CAAO,IAAA,CAAK,CAAA,uBAAA,EAA0B,UAAU,CAAA,CAAE,CAAA;AACzD,IAAA,OAAO,MAAA;AAAA,EACT;AAEA,EAAA,IAAI;AAEF,IAAA,MAAM,OAAA,GAAaA,GAAA,CAAA,YAAA,CAAa,UAAA,EAAY,MAAM,CAAA;AAClD,IAAA,MAAM,SAAA,GAAYC,cAAA,CAAK,KAAA,CAAM,OAAO,CAAA;AAEpC,IAAA,IAAI,CAAC,SAAA,IAAa,OAAO,SAAA,KAAc,QAAA,EAAU;AAC/C,MAAA,MAAA,CAAO,KAAA,GAAQ,KAAA;AACf,MAAA,MAAA,CAAO,MAAA,CAAO,KAAK,sCAAsC,CAAA;AACzD,MAAA,OAAO,MAAA;AAAA,IACT;AAGA,IAAA,MAAM,WAAA,GAAc,gBAAA,CAAiB,SAAA,CAAU,SAAS,CAAA;AAExD,IAAA,IAAI,CAAC,YAAY,OAAA,EAAS;AACxB,MAAA,MAAA,CAAO,KAAA,GAAQ,KAAA;AAEf,MAAA,KAAA,MAAW,KAAA,IAAS,WAAA,CAAY,KAAA,CAAM,MAAA,EAAQ;AAC5C,QAAA,MAAMN,MAAAA,GAAO,KAAA,CAAM,IAAA,CAAK,IAAA,CAAK,GAAG,CAAA;AAChC,QAAA,MAAA,CAAO,OAAO,IAAA,CAAK,CAAA,EAAGA,MAAI,CAAA,EAAA,EAAK,KAAA,CAAM,OAAO,CAAA,CAAE,CAAA;AAAA,MAChD;AAEA,MAAA,OAAO,MAAA;AAAA,IACT;AAEA,IAAA,MAAA,CAAO,SAAS,WAAA,CAAY,IAAA;AAG5B,IAAA,MAAM,kBAAA,GAAqB,yBAAA,CAA0B,WAAA,CAAY,IAAI,CAAA;AACrE,IAAA,MAAA,CAAO,QAAA,CAAS,IAAA,CAAK,GAAG,kBAAkB,CAAA;AAE1C,IAAA,GAAA,CAAI,KAAA,CAAM,CAAA,6BAAA,EAAgC,UAAU,CAAA,CAAE,CAAA;AACtD,IAAA,OAAO,MAAA;AAAA,EAET,SAAS,KAAA,EAAO;AACd,IAAA,MAAA,CAAO,KAAA,GAAQ,KAAA;AACf,IAAA,MAAM,eAAe,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,OAAA,GAAU,OAAO,KAAK,CAAA;AAC1E,IAAA,MAAA,CAAO,MAAA,CAAO,IAAA,CAAK,CAAA,wBAAA,EAA2B,YAAY,CAAA,CAAE,CAAA;AAC5D,IAAA,OAAO,MAAA;AAAA,EACT;AACF;AAKA,SAAS,0BAA0B,MAAA,EAA8B;AAC/D,EAAA,MAAM,WAAqB,EAAC;AAG5B,EAAA,IAAI,OAAO,IAAA,CAAK,MAAA,CAAO,YAAY,CAAA,CAAE,WAAW,CAAA,EAAG;AACjD,IAAA,QAAA,CAAS,KAAK,uDAAuD,CAAA;AAAA,EACvE;AAGA,EAAA,MAAM,aAAa,CAAC,OAAA,EAAS,KAAA,EAAO,MAAA,EAAQ,WAAW,MAAM,CAAA;AAC7D,EAAA,MAAM,eAAe,UAAA,CAAW,IAAA,CAAK,CAAA,GAAA,KAAO,GAAA,IAAO,OAAO,YAAY,CAAA;AACtE,EAAA,IAAI,CAAC,YAAA,EAAc;AACjB,IAAA,QAAA,CAAS,KAAK,CAAA,2CAAA,EAA8C,UAAA,CAAW,IAAA,CAAK,IAAI,CAAC,CAAA,CAAE,CAAA;AAAA,EACrF;AAGA,EAAA,IAAI,MAAA,CAAO,QAAA,EAAU,QAAA,KAAa,aAAA,EAAe;AAC/C,IAAA,QAAA,CAAS,KAAK,0DAA0D,CAAA;AAAA,EAC1E;AAGA,EAAA,IAAI,OAAO,IAAA,EAAM,QAAA,KAAa,MAAA,IAAU,MAAA,CAAO,MAAM,KAAA,EAAO;AAC1D,IAAA,QAAA,CAAS,KAAK,2CAA2C,CAAA;AAAA,EAC3D;AAGA,EAAA,IAAI,OAAO,QAAA,EAAU,OAAA,IAAW,MAAA,CAAO,QAAA,CAAS,UAAU,GAAA,EAAM;AAC9D,IAAA,QAAA,CAAS,KAAK,iDAAiD,CAAA;AAAA,EACjE;AAEA,EAAA,OAAO,QAAA;AACT;;;AC/JO,IAAM,mBAAA,GAAkD;AAAA,EAC7D,YAAA,EAAc;AAAA,IACZ,EAAA,EAAI,YAAA;AAAA,IACJ,WAAA,EAAa,YAAA;AAAA,IACb,SAAA,EAAW,CAAC,IAAA,EAAM,IAAA,EAAM,IAAI,CAAA;AAAA;AAAA,IAC5B,iBAAA,EAAmB,QAAA;AAAA,IACnB,YAAA,EAAc,KAAA;AAAA,IACd,QAAA,EAAU,QAAA;AAAA,IACV,aAAA,EAAe;AAAA,GACjB;AAAA,EAEA,YAAA,EAAc;AAAA,IACZ,EAAA,EAAI,YAAA;AAAA,IACJ,WAAA,EAAa,YAAA;AAAA,IACb,SAAA,EAAW,CAAC,IAAA,EAAM,IAAA,EAAM,IAAI,CAAA;AAAA;AAAA,IAC5B,iBAAA,EAAmB,QAAA;AAAA,IACnB,YAAA,EAAc,KAAA;AAAA,IACd,QAAA,EAAU,QAAA;AAAA,IACV,aAAA,EAAe;AAAA,GACjB;AAAA,EAEA,WAAA,EAAa;AAAA,IACX,EAAA,EAAI,WAAA;AAAA,IACJ,WAAA,EAAa,gBAAA;AAAA,IACb,SAAA,EAAW,CAAC,IAAA,EAAM,IAAA,EAAM,IAAI,CAAA;AAAA;AAAA,IAC5B,iBAAA,EAAmB,QAAA;AAAA,IACnB,YAAA,EAAc,KAAA;AAAA,IACd,QAAA,EAAU,QAAA;AAAA,IACV,aAAA,EAAe;AAAA,GACjB;AAAA,EAEA,WAAA,EAAa;AAAA,IACX,EAAA,EAAI,WAAA;AAAA,IACJ,WAAA,EAAa,gBAAA;AAAA,IACb,SAAA,EAAW,CAAC,IAAA,EAAM,IAAA,EAAM,IAAI,CAAA;AAAA;AAAA,IAC5B,iBAAA,EAAmB,QAAA;AAAA,IACnB,YAAA,EAAc,KAAA;AAAA,IACd,QAAA,EAAU,QAAA;AAAA,IACV,aAAA,EAAe;AAAA;AAEnB,CAAA;AAKO,IAAM,eAAA,GAA+B;AAAA,EAC1C,YAAA;AAAA,EACA,YAAA;AAAA,EACA,WAAA;AAAA,EACA;AACF,CAAA;AAKO,SAAS,qBAAqB,EAAA,EAAwB;AAC3D,EAAA,OAAO,oBAAoB,EAAE,CAAA;AAC/B;AAKO,SAAS,cAAA,GAA4B;AAC1C,EAAA,OAAO,MAAA,CAAO,OAAO,mBAAmB,CAAA;AAC1C;AAoBO,SAAS,qBAAA,CACd,WACA,YAAA,EACW;AACX,EAAA,IAAI,aAAa,EAAA,EAAI;AACnB,IAAA,OAAO,YAAA,KAAiB,QAAQ,YAAA,GAAe,YAAA;AAAA,EACjD;AAEA,EAAA,IAAI,aAAa,EAAA,EAAI;AACnB,IAAA,OAAO,WAAA;AAAA,EACT;AAEA,EAAA,IAAI,aAAa,EAAA,EAAI;AACnB,IAAA,OAAO,WAAA;AAAA,EACT;AAEA,EAAA,MAAM,IAAI,KAAA;AAAA,IACR,WAAW,SAAS,CAAA,sDAAA;AAAA,GACtB;AACF;AAKO,SAAS,mBAAA,CACd,WACA,SAAA,EACS;AACT,EAAA,MAAM,OAAA,GAAU,oBAAoB,SAAS,CAAA;AAC7C,EAAA,OAAO,OAAA,CAAQ,SAAA,CAAU,QAAA,CAAS,MAAA,CAAO,SAAS,CAAC,CAAA;AACrD;AAKO,SAAS,kBAAA,GAA6B;AAC3C,EAAA,MAAM,KAAA,GAAQ,CAAC,qBAAqB,CAAA;AAEpC,EAAA,KAAA,MAAW,OAAA,IAAW,gBAAe,EAAG;AACtC,IAAA,MAAM,SAAA,GAAY,OAAA,CAAQ,SAAA,CAAU,IAAA,CAAK,IAAI,CAAA;AAC7C,IAAA,KAAA,CAAM,IAAA;AAAA,MACJ,CAAA,EAAA,EAAK,OAAA,CAAQ,EAAA,CAAG,MAAA,CAAO,EAAE,CAAC,CAAA,GAAA,EAAM,OAAA,CAAQ,WAAW,CAAA,OAAA,EAAU,SAAS,CAAA,aAAA,EAAgB,QAAQ,iBAAiB,CAAA,CAAA;AAAA,KACjH;AAAA,EACF;AAEA,EAAA,OAAO,KAAA,CAAM,KAAK,IAAI,CAAA;AACxB;ACzHO,SAAS,mBAAA,GAA8B;AAC5C,EAAA,MAAMG,WAAU,OAAA,CAAQ,OAAA;AACxB,EAAA,MAAM,KAAA,GAAQA,QAAAA,CAAQ,KAAA,CAAM,SAAS,CAAA;AACrC,EAAA,IAAI,CAAC,KAAA,EAAO;AACV,IAAA,MAAM,IAAI,KAAA,CAAM,CAAA,iCAAA,EAAoCA,QAAO,CAAA,CAAE,CAAA;AAAA,EAC/D;AACA,EAAA,OAAO,QAAA,CAAS,KAAA,CAAM,CAAC,CAAA,EAAG,EAAE,CAAA;AAC9B;AAgBA,SAAS,uBAAuB,SAAA,EAAkC;AAChE,EAAA,IAAI,WAAA,GAAmBI,cAAQ,SAAS,CAAA;AACxC,EAAA,MAAM,IAAA,GAAYA,KAAA,CAAA,KAAA,CAAM,WAAW,CAAA,CAAE,IAAA;AAErC,EAAA,OAAO,gBAAgB,IAAA,EAAM;AAC3B,IAAA,MAAM,eAAA,GAAuBA,KAAA,CAAA,IAAA,CAAK,WAAA,EAAa,cAAc,CAAA;AAC7D,IAAA,IAAOC,GAAA,CAAA,UAAA,CAAW,eAAe,CAAA,EAAG;AAClC,MAAA,OAAO,eAAA;AAAA,IACT;AACA,IAAA,WAAA,GAAmBD,cAAQ,WAAW,CAAA;AAAA,EACxC;AAEA,EAAA,OAAO,IAAA;AACT;AAaO,SAASE,oBAAmB,UAAA,EAAkC;AAEnE,EAAA,MAAM,iBAAA,GAAyBF,KAAA,CAAA,IAAA,CAAK,UAAA,EAAY,cAAc,CAAA;AAE9D,EAAA,IAAOC,GAAA,CAAA,UAAA,CAAW,iBAAiB,CAAA,EAAG;AACpC,IAAA,IAAI;AACF,MAAA,MAAM,OAAA,GAAaA,GAAA,CAAA,YAAA,CAAa,iBAAA,EAAmB,OAAO,CAAA;AAC1D,MAAA,MAAM,GAAA,GAAM,IAAA,CAAK,KAAA,CAAM,OAAO,CAAA;AAE9B,MAAA,IAAI,GAAA,CAAI,SAAS,QAAA,EAAU;AACzB,QAAA,OAAO,KAAA;AAAA,MACT;AAGA,MAAA,OAAO,KAAA;AAAA,IACT,CAAA,CAAA,MAAQ;AAAA,IAER;AAAA,EACF;AAGA,EAAA,MAAM,kBAAA,GAAqB,uBAAuB,UAAU,CAAA;AAE5D,EAAA,IAAI,kBAAA,EAAoB;AACtB,IAAA,IAAI;AACF,MAAA,MAAM,OAAA,GAAaA,GAAA,CAAA,YAAA,CAAa,kBAAA,EAAoB,OAAO,CAAA;AAC3D,MAAA,MAAM,GAAA,GAAM,IAAA,CAAK,KAAA,CAAM,OAAO,CAAA;AAE9B,MAAA,IAAI,GAAA,CAAI,SAAS,QAAA,EAAU;AACzB,QAAA,OAAO,KAAA;AAAA,MACT;AAGA,MAAA,OAAO,KAAA;AAAA,IACT,CAAA,CAAA,MAAQ;AAEN,MAAA,OAAO,KAAA;AAAA,IACT;AAAA,EACF;AAGA,EAAA,OAAO,KAAA;AACT;ACrGA,IAAME,YAAA,GAAa,aAAA,CAAc,MAAA,CAAA,IAAA,CAAY,GAAG,CAAA;AAChD,IAAMC,WAAA,GAAiBC,cAAQF,YAAU,CAAA;AAKlC,SAAS,cAAA,GAAyB;AAEvC,EAAA,MAAM,aAAA,GAAgB;AAAA,IACfE,KAAA,CAAA,IAAA,CAAKD,WAAA,EAAW,IAAA,EAAM,IAAA,EAAM,cAAc,CAAA;AAAA,IAC1CC,KAAA,CAAA,IAAA,CAAKD,WAAA,EAAW,IAAA,EAAM,IAAA,EAAM,MAAM,cAAc,CAAA;AAAA,IAChDC,KAAA,CAAA,IAAA,CAAK,OAAA,CAAQ,GAAA,EAAI,EAAG,OAAO,cAAc;AAAA,GAChD;AAEA,EAAA,KAAA,MAAW,WAAW,aAAA,EAAe;AACnC,IAAA,IAAI;AACF,MAAA,IAAOC,GAAA,CAAA,UAAA,CAAW,OAAO,CAAA,EAAG;AAC1B,QAAA,MAAM,MAAM,IAAA,CAAK,KAAA,CAASA,GAAA,CAAA,YAAA,CAAa,OAAA,EAAS,OAAO,CAAC,CAAA;AACxD,QAAA,IAAI,IAAI,IAAA,EAAM,QAAA,CAAS,MAAM,CAAA,IAAK,IAAI,OAAA,EAAS;AAC7C,UAAA,OAAO,GAAA,CAAI,OAAA;AAAA,QACb;AAAA,MACF;AAAA,IACF,CAAA,CAAA,MAAQ;AAAA,IAER;AAAA,EACF;AAEA,EAAA,OAAO,OAAA;AACT;AAsPO,SAAS,wBAAwB,OAAA,EAA6C;AACnF,EAAA,MAAM,UAAA,GAAa,oBAAoB,OAAO,CAAA;AAG9C,EAAA,MAAM,WAAyF,EAAC;AAGhG,EAAA,MAAM,cAAA,GAAiB;AAAA,IACrB,gBAAA;AAAA,IACA,gBAAA;AAAA,IACA,sBAAA;AAAA,IACA,cAAA;AAAA,IACA,aAAA;AAAA,IACA,eAAA;AAAA,IACA,iBAAA;AAAA,IACA,uBAAA;AAAA,IACA,sBAAA;AAAA,IACA,kBAAA;AAAA,IACA,eAAA;AAAA,IACA,oBAAA;AAAA,IACA;AAAA,GACF;AAEA,EAAA,KAAA,MAAW,WAAW,cAAA,EAAgB;AACpC,IAAA,QAAA,CAAS,OAAO,CAAA,GAAI,EAAE,SAAA,EAAW,IAAA,EAAK;AAAA,EACxC;AAGA,EAAA,IAAI,OAAA,KAAY,YAAA,IAAgB,OAAA,KAAY,YAAA,EAAc;AACxD,IAAA,QAAA,CAAS,gBAAgB,CAAA,GAAI,EAAE,SAAA,EAAW,IAAA,EAAK;AAC/C,IAAA,QAAA,CAAS,WAAW,CAAA,GAAI,EAAE,SAAA,EAAW,IAAA,EAAK;AAC1C,IAAA,QAAA,CAAS,YAAY,CAAA,GAAI,EAAE,SAAA,EAAW,IAAA,EAAK;AAC3C,IAAA,QAAA,CAAS,aAAa,CAAA,GAAI,EAAE,SAAA,EAAW,IAAA,EAAK;AAC5C,IAAA,QAAA,CAAS,mBAAmB,CAAA,GAAI,EAAE,SAAA,EAAW,IAAA,EAAK;AAClD,IAAA,QAAA,CAAS,aAAa,CAAA,GAAI,EAAE,SAAA,EAAW,IAAA,EAAK;AAC5C,IAAA,QAAA,CAAS,aAAa,CAAA,GAAI,EAAE,SAAA,EAAW,IAAA,EAAK;AAC5C,IAAA,QAAA,CAAS,kBAAkB,CAAA,GAAI,EAAE,SAAA,EAAW,IAAA,EAAK;AAAA,EACnD,CAAA,MAAA,IAAW,YAAY,WAAA,EAAa;AAElC,IAAA,QAAA,CAAS,gBAAgB,CAAA,GAAI,EAAE,SAAA,EAAW,IAAA,EAAK;AAC/C,IAAA,QAAA,CAAS,WAAW,CAAA,GAAI,EAAE,SAAA,EAAW,IAAA,EAAK;AAC1C,IAAA,QAAA,CAAS,YAAY,CAAA,GAAI,EAAE,SAAA,EAAW,IAAA,EAAK;AAC3C,IAAA,QAAA,CAAS,aAAa,CAAA,GAAI,EAAE,SAAA,EAAW,IAAA,EAAK;AAC5C,IAAA,QAAA,CAAS,mBAAmB,CAAA,GAAI,EAAE,SAAA,EAAW,IAAA,EAAK;AAClD,IAAA,QAAA,CAAS,aAAa,CAAA,GAAI,EAAE,SAAA,EAAW,IAAA,EAAK;AAC5C,IAAA,QAAA,CAAS,aAAa,CAAA,GAAI,EAAE,SAAA,EAAW,IAAA,EAAK;AAC5C,IAAA,QAAA,CAAS,kBAAkB,CAAA,GAAI,EAAE,SAAA,EAAW,IAAA,EAAK;AAAA,EACnD,CAAA,MAAA,IAAW,YAAY,WAAA,EAAa;AAElC,IAAA,QAAA,CAAS,gBAAgB,CAAA,GAAI;AAAA,MAC3B,SAAA,EAAW,KAAA;AAAA,MACX,WAAA,EAAa,uDAAA;AAAA,MACb,KAAA,EAAO;AAAA,KACT;AACA,IAAA,QAAA,CAAS,WAAW,CAAA,GAAI;AAAA,MACtB,SAAA,EAAW,KAAA;AAAA,MACX,WAAA,EAAa,4EAAA;AAAA,MACb,KAAA,EAAO;AAAA,KACT;AACA,IAAA,QAAA,CAAS,YAAY,CAAA,GAAI;AAAA,MACvB,SAAA,EAAW,KAAA;AAAA,MACX,WAAA,EAAa,qDAAA;AAAA,MACb,KAAA,EAAO;AAAA,KACT;AACA,IAAA,QAAA,CAAS,aAAa,CAAA,GAAI;AAAA,MACxB,SAAA,EAAW,KAAA;AAAA,MACX,WAAA,EAAa,oDAAA;AAAA,MACb,KAAA,EAAO;AAAA,KACT;AACA,IAAA,QAAA,CAAS,mBAAmB,CAAA,GAAI;AAAA,MAC9B,SAAA,EAAW,KAAA;AAAA,MACX,WAAA,EAAa,+CAAA;AAAA,MACb,KAAA,EAAO;AAAA,KACT;AACA,IAAA,QAAA,CAAS,aAAa,CAAA,GAAI;AAAA,MACxB,SAAA,EAAW,KAAA;AAAA,MACX,WAAA,EAAa,iDAAA;AAAA,MACb,KAAA,EAAO;AAAA,KACT;AACA,IAAA,QAAA,CAAS,aAAa,CAAA,GAAI;AAAA,MACxB,SAAA,EAAW,KAAA;AAAA,MACX,WAAA,EAAa,+CAAA;AAAA,MACb,KAAA,EAAO;AAAA,KACT;AACA,IAAA,QAAA,CAAS,kBAAkB,CAAA,GAAI,EAAE,SAAA,EAAW,IAAA,EAAK;AAAA,EACnD;AAGA,EAAA,IAAI,YAAY,YAAA,EAAc;AAC5B,IAAA,QAAA,CAAS,aAAa,CAAA,GAAI,EAAE,SAAA,EAAW,IAAA,EAAK;AAC5C,IAAA,QAAA,CAAS,iBAAiB,CAAA,GAAI,EAAE,SAAA,EAAW,IAAA,EAAK;AAChD,IAAA,QAAA,CAAS,aAAa,CAAA,GAAI,EAAE,SAAA,EAAW,IAAA,EAAK;AAAA,EAC9C,CAAA,MAAO;AACL,IAAA,QAAA,CAAS,aAAa,CAAA,GAAI;AAAA,MACxB,SAAA,EAAW,KAAA;AAAA,MACX,WAAA,EAAa;AAAA,KACf;AACA,IAAA,QAAA,CAAS,iBAAiB,CAAA,GAAI;AAAA,MAC5B,SAAA,EAAW,KAAA;AAAA,MACX,WAAA,EAAa;AAAA,KACf;AACA,IAAA,QAAA,CAAS,aAAa,CAAA,GAAI;AAAA,MACxB,SAAA,EAAW,KAAA;AAAA,MACX,WAAA,EAAa;AAAA,KACf;AAAA,EACF;AAEA,EAAA,OAAO;AAAA,IACL,OAAA;AAAA,IACA,mBAAmB,UAAA,CAAW,iBAAA;AAAA,IAC9B,WAAW,UAAA,CAAW,SAAA;AAAA,IACtB,cAAc,UAAA,CAAW,YAAA;AAAA,IACzB,UAAU,UAAA,CAAW,QAAA;AAAA,IACrB,QAAA;AAAA,IACA,WAAA,EAAA,iBAAa,IAAI,IAAA,EAAK,EAAE,WAAA,EAAY;AAAA,IACpC,WAAA,EAAa,CAAA,UAAA,EAAa,cAAA,EAAgB,CAAA;AAAA,GAC5C;AACF;AAiBO,SAAS,sBAAA,CACd,YACA,OAAA,EACQ;AACR,EAAA,OAAO,CAAA;;AAAA;;AAAA;;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA,gBAAA,EAaS,WAAW,EAAE,CAAA;AAAA,qBAAA,EACR,WAAW,WAAW,CAAA;AAAA,sBAAA,EACrB,UAAA,CAAW,SAAA,CAAU,IAAA,CAAK,IAAI,CAAC,CAAA;AAAA,2BAAA,EAC1B,WAAW,iBAAiB,CAAA;AAAA,sBAAA,EACjC,WAAW,YAAY,CAAA;AAAA,0BAAA,EACnB,WAAW,QAAQ,CAAA;AAAA,qBAAA,EACxB,QAAQ,kBAAkB,CAAA;AAAA,qBAAA,EAC1B,QAAQ,WAAW,CAAA;AAAA,EACxC,QAAQ,eAAA,GAAkB,CAAA,yBAAA,EAA4B,OAAA,CAAQ,eAAe,OAAO,EAAE;;AAAA;;AAAA;;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;;AAAA,sCAAA,EA+ChD,QAAQ,WAAW,CAAA;AAAA,CAAA;AAE3D;AAiBO,SAAS,iBAAiB,OAAA,EAA4B;AAC3D,EAAA,OAAO,CAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAAA,EAKI,OAAO;AAAA,aAAA,EAAA,iBACL,IAAI,IAAA,EAAK,EAAE,WAAA,EAAa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,CAAA;AAkBvC;;;ANpfA,IAAMH,WAAAA,GAAaI,aAAAA,CAAc,MAAA,CAAA,IAAA,CAAY,GAAG,CAAA;AAChD,IAAMH,UAAAA,GAAiB,cAAQD,WAAU,CAAA;AAGzC,IAAM,wBAAA,GAAgC,KAAA,CAAA,OAAA,CAAQC,UAAAA,EAAW,IAAA,EAAM,UAAU,qBAAqB,CAAA;AAM9F,SAAS,oBAAoB,YAAA,EAAqC;AAChE,EAAA,MAAM,YAAA,GAAoB,KAAA,CAAA,IAAA,CAAK,wBAAA,EAA0B,YAAY,CAAA;AACrE,EAAA,IAAIV,GAAAA,CAAG,UAAA,CAAW,YAAY,CAAA,EAAG;AAC/B,IAAA,MAAM,OAAA,GAAUA,GAAAA,CAAG,YAAA,CAAa,YAAA,EAAc,MAAM,CAAA;AAEpD,IAAA,MAAM,KAAA,GAAQ,OAAA,CAAQ,KAAA,CAAM,IAAI,CAAA;AAChC,IAAA,OAAO,KAAA,CAAM,KAAA,CAAM,EAAE,CAAA,CAAE,KAAK,IAAI,CAAA;AAAA,EAClC;AACA,EAAA,OAAO,IAAA;AACT;AA8BA,eAAsB,SAAA,CACpB,UAAA,EACA,OAAA,GAA4B,EAAC,EACH;AAC1B,EAAA,MAAMF,UAAS,IAAI,MAAA,CAAO,EAAE,OAAA,EAAS,OAAA,CAAQ,SAAS,CAAA;AACtD,EAAA,MAAM,SAAmB,EAAC;AAE1B,EAAA,MAAM,YAAA,GAAoB,cAAQ,UAAU,CAAA;AAC5C,EAAA,MAAM,WAAA,GAAmB,KAAA,CAAA,IAAA,CAAK,YAAA,EAAc,UAAU,CAAA;AACtD,EAAA,MAAM,OAAA,GAAe,KAAA,CAAA,IAAA,CAAK,YAAA,EAAc,OAAO,CAAA;AAC/C,EAAA,MAAM,OAAA,GAAe,KAAA,CAAA,IAAA,CAAK,OAAA,EAAS,MAAM,CAAA;AAEzC,EAAAA,OAAAA,CAAO,OAAO,6BAA6B,CAAA;AAC3C,EAAAA,QAAO,KAAA,CAAM;AAAA,IACX,EAAE,KAAA,EAAO,QAAA,EAAU,KAAA,EAAO,YAAA,EAAa;AAAA,IACvC,EAAE,KAAA,EAAO,UAAA,EAAY,KAAA,EAAO,WAAA;AAAY,GACzC,CAAA;AAGD,EAAA,IAAI,CAACE,GAAAA,CAAG,UAAA,CAAW,YAAY,CAAA,EAAG;AAChC,IAAAF,OAAAA,CAAO,KAAA,CAAM,CAAA,iCAAA,EAAoC,YAAY,CAAA,CAAE,CAAA;AAC/D,IAAA,OAAO,EAAE,SAAS,KAAA,EAAO,WAAA,EAAa,cAAc,WAAA,EAAa,MAAA,EAAQ,CAAC,iCAAiC,CAAA,EAAE;AAAA,EAC/G;AAGA,EAAA,IAAIE,IAAG,UAAA,CAAW,WAAW,CAAA,IAAK,CAAC,QAAQ,KAAA,EAAO;AAChD,IAAAF,OAAAA,CAAO,MAAM,sEAAsE,CAAA;AACnF,IAAA,OAAO,EAAE,SAAS,KAAA,EAAO,WAAA,EAAa,cAAc,WAAA,EAAa,MAAA,EAAQ,CAAC,mBAAmB,CAAA,EAAE;AAAA,EACjG;AAGA,EAAA,MAAM,MAAA,GAAsB;AAAA,IAC1B,UAAA,EAAY,IAAA;AAAA,IACZ,gBAAA,EAAkB,IAAA;AAAA,IAClB,WAAA,EAAa,IAAA;AAAA,IACb,iBAAA,EAAmB;AAAA,GACrB;AAGA,EAAA,MAAME,GAAAA,CAAG,UAAU,OAAO,CAAA;AAE1B,EAAA,IAAI;AAEF,IAAA,IAAI,QAAQ,KAAA,EAAO;AACjB,MAAA,MAAMc,WAAAA,GAAkB,KAAA,CAAA,IAAA,CAAK,WAAA,EAAa,iBAAiB,CAAA;AAC3D,MAAA,IAAId,GAAAA,CAAG,UAAA,CAAWc,WAAU,CAAA,EAAG;AAC7B,QAAA,MAAA,CAAO,UAAA,GAAaA,WAAAA;AACpB,QAAA,MAAA,CAAO,gBAAA,GAAmB,GAAGA,WAAU,CAAA,iBAAA,CAAA;AACvC,QAAA,MAAMd,GAAAA,CAAG,IAAA,CAAKc,WAAAA,EAAY,MAAA,CAAO,gBAAgB,CAAA;AACjD,QAAAhB,OAAAA,CAAO,MAAM,oCAAoC,CAAA;AAAA,MACnD;AAEA,MAAA,MAAM,WAAA,GAAmB,KAAA,CAAA,IAAA,CAAK,OAAA,EAAS,cAAc,CAAA;AACrD,MAAA,IAAIE,GAAAA,CAAG,UAAA,CAAW,WAAW,CAAA,EAAG;AAC9B,QAAA,MAAA,CAAO,WAAA,GAAc,WAAA;AACrB,QAAA,MAAA,CAAO,iBAAA,GAAoB,GAAG,WAAW,CAAA,iBAAA,CAAA;AACzC,QAAA,MAAMA,GAAAA,CAAG,IAAA,CAAK,WAAA,EAAa,MAAA,CAAO,iBAAiB,CAAA;AACnD,QAAAF,OAAAA,CAAO,MAAM,iCAAiC,CAAA;AAAA,MAChD;AAAA,IACF;AAGA,IAAAA,OAAAA,CAAO,IAAA,CAAK,CAAA,EAAG,CAAA,EAAG,gDAAgD,CAAA;AAClE,IAAA,MAAM,WAAA,GAAc,MAAM,iBAAA,CAAkB,YAAY,CAAA;AACxD,IAAA,MAAM,YAAY,mBAAA,EAAoB;AACtC,IAAA,MAAM,oBAAA,GAAuBU,oBAAmB,YAAY,CAAA;AAE5D,IAAA,IAAI,eAAA;AAEJ,IAAA,IAAI,OAAA,CAAQ,OAAA,IAAW,OAAA,CAAQ,OAAA,KAAY,MAAA,EAAQ;AAEjD,MAAA,eAAA,GAAkB,OAAA,CAAQ,OAAA;AAG1B,MAAA,IAAI,CAAC,mBAAA,CAAoB,eAAA,EAAiB,SAAS,CAAA,EAAG;AACpD,QAAA,MAAMO,WAAAA,GAAa,qBAAqB,eAAe,CAAA;AACvD,QAAAjB,OAAAA,CAAO,OAAA,CAAQ,CAAA,SAAA,EAAY,eAAe,CAAA,uBAAA,EAA0BiB,YAAW,SAAA,CAAU,IAAA,CAAK,GAAG,CAAC,CAAA,CAAE,CAAA;AACpG,QAAAjB,OAAAA,CAAO,OAAA,CAAQ,CAAA,qBAAA,EAAwB,SAAS,CAAA,sCAAA,CAAwC,CAAA;AAAA,MAC1F;AAAA,IACF,CAAA,MAAO;AAEL,MAAA,IAAI;AACF,QAAA,eAAA,GAAkB,qBAAA,CAAsB,WAAW,oBAAoB,CAAA;AACvE,QAAAA,OAAAA,CAAO,MAAM,CAAA,uBAAA,EAA0B,eAAe,UAAU,SAAS,CAAA,EAAA,EAAK,oBAAoB,CAAA,CAAA,CAAG,CAAA;AAAA,MACvG,SAAS,KAAA,EAAO;AAEd,QAAA,MAAM,UAAU,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,OAAA,GAAU,OAAO,KAAK,CAAA;AACrE,QAAAA,OAAAA,CAAO,MAAM,OAAO,CAAA;AACpB,QAAA,MAAM,KAAA;AAAA,MACR;AAAA,IACF;AAEA,IAAA,MAAM,UAAA,GAAa,qBAAqB,eAAe,CAAA;AACvD,IAAAA,QAAO,OAAA,CAAQ,CAAA,SAAA,EAAY,eAAe,CAAA,EAAA,EAAK,UAAA,CAAW,WAAW,CAAA,CAAA,CAAG,CAAA;AACxE,IAAAA,QAAO,KAAA,CAAM,CAAA,SAAA,EAAY,YAAY,WAAW,CAAA,SAAA,EAAY,SAAS,CAAA,CAAA,CAAG,CAAA;AACxE,IAAAA,OAAAA,CAAO,KAAA,CAAM,CAAA,eAAA,EAAkB,oBAAoB,CAAA,CAAE,CAAA;AACrD,IAAAA,OAAAA,CAAO,KAAA,CAAM,CAAA,YAAA,EAAe,UAAA,CAAW,iBAAiB,CAAA,CAAE,CAAA;AAC1D,IAAAA,OAAAA,CAAO,MAAM,CAAA,UAAA,EAAa,WAAA,CAAY,QAAQ,CAAA,CAAA,EAAI,WAAA,CAAY,IAAI,CAAA,CAAE,CAAA;AAGpE,IAAAA,OAAAA,CAAO,IAAA,CAAK,CAAA,EAAG,CAAA,EAAG,iCAAiC,CAAA;AACnD,IAAA,MAAM,yBAAyB,WAAW,CAAA;AAC1C,IAAAA,OAAAA,CAAO,QAAQ,6BAA6B,CAAA;AAG5C,IAAAA,QAAO,IAAA,CAAK,CAAA,EAAG,CAAA,EAAG,CAAA,uBAAA,EAA0B,eAAe,CAAA,eAAA,CAAiB,CAAA;AAC5E,IAAA,MAAM,qBAAA,CAAsB,WAAA,EAAa,eAAA,EAAiBA,OAAM,CAAA;AAChE,IAAAA,OAAAA,CAAO,OAAA,CAAQ,CAAA,iCAAA,EAAoC,UAAA,CAAW,WAAW,CAAA,CAAA,CAAG,CAAA;AAG5E,IAAA,IAAI,OAAA,CAAQ,YAAY,KAAA,EAAO;AAC7B,MAAAA,OAAAA,CAAO,IAAA,CAAK,CAAA,EAAG,CAAA,EAAG,2CAA2C,CAAA;AAC7D,MAAA,MAAM,cAAA,CAAe,cAAcA,OAAM,CAAA;AACzC,MAAAA,OAAAA,CAAO,QAAQ,mBAAmB,CAAA;AAAA,IACpC,CAAA,MAAO;AACL,MAAAA,OAAAA,CAAO,IAAA,CAAK,CAAA,EAAG,CAAA,EAAG,8CAA8C,CAAA;AAAA,IAClE;AAGA,IAAAA,OAAAA,CAAO,IAAA,CAAK,CAAA,EAAG,CAAA,EAAG,iCAAiC,CAAA;AACnD,IAAA,MAAM,WAAA,GAAmB,eAAS,YAAY,CAAA;AAC9C,IAAA,MAAM,wBAAA,CAAyB,WAAA,EAAa,OAAA,EAAS,YAAA,EAAc;AAAA,MACjE,WAAA;AAAA,MACA,OAAA,EAAS,eAAA;AAAA,MACT,UAAA;AAAA,MACA,SAAA;AAAA,MACA,YAAA,EAAc;AAAA,OACbA,OAAM,CAAA;AACT,IAAAA,OAAAA,CAAO,QAAQ,6BAA6B,CAAA;AAG5C,IAAA,MAAM,UAAA,GAAkB,KAAA,CAAA,IAAA,CAAK,WAAA,EAAa,iBAAiB,CAAA;AAC3D,IAAA,MAAM,gBAAA,GAAmB,kBAAA,CAAmB,UAAA,EAAYA,OAAM,CAAA;AAC9D,IAAA,IAAI,CAAC,iBAAiB,KAAA,EAAO;AAC3B,MAAAA,OAAAA,CAAO,MAAM,4CAA4C,CAAA;AACzD,MAAA,KAAA,MAAW,KAAA,IAAS,iBAAiB,MAAA,EAAQ;AAC3C,QAAAA,OAAAA,CAAO,KAAA,CAAM,CAAA,IAAA,EAAO,KAAK,CAAA,CAAE,CAAA;AAAA,MAC7B;AACA,MAAA,MAAM,IAAI,MAAM,iCAAiC,CAAA;AAAA,IACnD;AAEA,IAAA,IAAI,gBAAA,CAAiB,QAAA,CAAS,MAAA,GAAS,CAAA,EAAG;AACxC,MAAA,KAAA,MAAW,OAAA,IAAW,iBAAiB,QAAA,EAAU;AAC/C,QAAAA,OAAAA,CAAO,OAAA,CAAQ,CAAA,QAAA,EAAW,OAAO,CAAA,CAAE,CAAA;AAAA,MACrC;AAAA,IACF;AAGA,IAAA,IAAI,CAAC,QAAQ,OAAA,EAAS;AACpB,MAAAA,OAAAA,CAAO,IAAA,CAAK,CAAA,EAAG,CAAA,EAAG,wBAAwB,CAAA;AAC1C,MAAA,MAAM,aAAA,CAAc,WAAA,EAAa,OAAA,EAASA,OAAM,CAAA;AAChD,MAAAA,OAAAA,CAAO,QAAQ,uBAAuB,CAAA;AAAA,IACxC,CAAA,MAAO;AACL,MAAAA,OAAAA,CAAO,IAAA,CAAK,CAAA,EAAG,CAAA,EAAG,mCAAmC,CAAA;AAAA,IACvD;AAGA,IAAA,IAAI,WAAA;AACJ,IAAA,IAAI,CAAC,OAAA,CAAQ,YAAA,IAAgB,CAAC,QAAQ,OAAA,EAAS;AAC7C,MAAAA,OAAAA,CAAO,IAAA,CAAK,CAAA,EAAG,CAAA,EAAG,yBAAyB,CAAA;AAC3C,MAAA,WAAA,GAAc,MAAM,cAAA,CAAe,YAAA,EAAcA,OAAAA,EAAQ,EAAE,SAAS,CAAA;AAGpE,MAAA,IAAI,WAAA,CAAY,YAAY,SAAA,EAAW;AACrC,QAAAA,OAAAA,CAAO,MAAM,mCAAmC,CAAA;AAChD,QAAA,IAAI;AACF,UAAAG,SAAS,iCAAA,EAAmC;AAAA,YAC1C,GAAA,EAAK,WAAA;AAAA,YACL,KAAA,EAAO,MAAA;AAAA,YACP,GAAA,EAAK,EAAE,GAAG,OAAA,CAAQ,GAAA,EAAI;AAAA,YACtB,OAAA,EAAS;AAAA;AAAA,WACV,CAAA;AACD,UAAAH,OAAAA,CAAO,MAAM,+BAA+B,CAAA;AAAA,QAC9C,SAAS,KAAA,EAAO;AAEd,UAAAA,OAAAA,CAAO,QAAQ,uEAAuE,CAAA;AAEtF,UAAA,IAAI,WAAA,CAAY,YAAY,SAAA,EAAW;AACrC,YAAA,WAAA,GAAc,MAAM,cAAA,CAAe,YAAA,EAAcA,OAAAA,EAAQ;AAAA,cACvD,OAAA;AAAA,cACA,WAAA,EAAa;AAAA,aACd,CAAA;AAAA,UACH;AAAA,QACF;AAAA,MACF;AAGA,MAAA,MAAMgB,WAAAA,GAAkB,KAAA,CAAA,IAAA,CAAK,WAAA,EAAa,iBAAiB,CAAA;AAC3D,MAAA,uBAAA,CAAwBA,aAAY,WAAW,CAAA;AAG/C,MAAA,MAAM,iBAAA,CAAkB,OAAA,EAAS,EAAE,OAAA,EAAS,aAAa,CAAA;AACzD,MAAAhB,OAAAA,CAAO,QAAQ,CAAA,oBAAA,EAAuB,WAAA,CAAY,OAAO,CAAA,EAAA,EAAK,WAAA,CAAY,QAAQ,CAAA,CAAA,CAAG,CAAA;AAAA,IACvF,CAAA,MAAO;AACL,MAAAA,OAAAA,CAAO,IAAA,CAAK,CAAA,EAAG,CAAA,EAAG,gCAAgC,CAAA;AAAA,IACpD;AAGA,IAAA,MAAM,cAAc,MAAM,CAAA;AAG1B,IAAA,mBAAA,CAAoBA,OAAAA,EAAQ,YAAA,EAAc,WAAA,EAAa,WAAW,CAAA;AAElE,IAAA,OAAO;AAAA,MACL,OAAA,EAAS,IAAA;AAAA,MACT,WAAA,EAAa,YAAA;AAAA,MACb,WAAA;AAAA,MACA,WAAA;AAAA,MACA,WAAA;AAAA,MACA,QAAQ;AAAC,KACX;AAAA,EACF,SAAS,KAAA,EAAO;AACd,IAAA,MAAM,eAAe,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,OAAA,GAAU,OAAO,KAAK,CAAA;AAC1E,IAAAA,OAAAA,CAAO,KAAA,CAAM,CAAA,kBAAA,EAAqB,YAAY,CAAA,CAAE,CAAA;AAChD,IAAA,MAAA,CAAO,KAAK,YAAY,CAAA;AAGxB,IAAA,MAAM,iBAAA,CAAkB,QAAQA,OAAM,CAAA;AAEtC,IAAA,OAAO;AAAA,MACL,OAAA,EAAS,KAAA;AAAA,MACT,WAAA,EAAa,YAAA;AAAA,MACb,WAAA;AAAA,MACA;AAAA,KACF;AAAA,EACF;AACF;AAKA,eAAe,iBAAA,CAAkB,QAAqBA,OAAAA,EAA+B;AACnF,EAAAA,OAAAA,CAAO,QAAQ,oCAAoC,CAAA;AAEnD,EAAA,IAAI;AAEF,IAAA,IAAI,OAAO,gBAAA,IAAoBE,GAAAA,CAAG,UAAA,CAAW,MAAA,CAAO,gBAAgB,CAAA,EAAG;AACrE,MAAA,IAAI,OAAO,UAAA,EAAY;AACrB,QAAA,MAAMA,GAAAA,CAAG,IAAA,CAAK,MAAA,CAAO,gBAAA,EAAkB,OAAO,UAAU,CAAA;AACxD,QAAA,MAAMA,GAAAA,CAAG,MAAA,CAAO,MAAA,CAAO,gBAAgB,CAAA;AACvC,QAAAF,OAAAA,CAAO,MAAM,sCAAsC,CAAA;AAAA,MACrD;AAAA,IACF;AAGA,IAAA,IAAI,OAAO,iBAAA,IAAqBE,GAAAA,CAAG,UAAA,CAAW,MAAA,CAAO,iBAAiB,CAAA,EAAG;AACvE,MAAA,IAAI,OAAO,WAAA,EAAa;AACtB,QAAA,MAAMA,GAAAA,CAAG,IAAA,CAAK,MAAA,CAAO,iBAAA,EAAmB,OAAO,WAAW,CAAA;AAC1D,QAAA,MAAMA,GAAAA,CAAG,MAAA,CAAO,MAAA,CAAO,iBAAiB,CAAA;AACxC,QAAAF,OAAAA,CAAO,MAAM,mCAAmC,CAAA;AAAA,MAClD;AAAA,IACF;AAEA,IAAAA,OAAAA,CAAO,QAAQ,iEAAiE,CAAA;AAAA,EAClF,SAAS,aAAA,EAAe;AACtB,IAAAA,OAAAA,CAAO,KAAA,CAAM,CAAA,iBAAA,EAAoB,aAAa,CAAA,CAAE,CAAA;AAChD,IAAAA,OAAAA,CAAO,MAAM,iCAAiC,CAAA;AAAA,EAChD;AACF;AAKA,eAAe,cAAc,MAAA,EAAoC;AAC/D,EAAA,IAAI;AACF,IAAA,IAAI,OAAO,gBAAA,IAAoBE,GAAAA,CAAG,UAAA,CAAW,MAAA,CAAO,gBAAgB,CAAA,EAAG;AACrE,MAAA,MAAMA,GAAAA,CAAG,MAAA,CAAO,MAAA,CAAO,gBAAgB,CAAA;AAAA,IACzC;AACA,IAAA,IAAI,OAAO,iBAAA,IAAqBA,GAAAA,CAAG,UAAA,CAAW,MAAA,CAAO,iBAAiB,CAAA,EAAG;AACvE,MAAA,MAAMA,GAAAA,CAAG,MAAA,CAAO,MAAA,CAAO,iBAAiB,CAAA;AAAA,IAC1C;AAAA,EACF,CAAA,CAAA,MAAQ;AAAA,EAER;AACF;AAKA,eAAe,yBAAyB,WAAA,EAAoC;AAC1E,EAAA,MAAM,WAAA,GAAc;AAAA,IAClB,kBAAA;AAAA,IACA,0BAAA;AAAA,IACA,6BAAA;AAAA,IACA,mCAAA;AAAA,IACA,kCAAA;AAAA,IACA,6BAAA;AAAA,IACA,sBAAA;AAAA,IACA,QAAA;AAAA,IACA,aAAA;AAAA,IACA,kBAAA;AAAA,IACA,aAAA;AAAA,IACA,eAAA;AAAA,IACA,kBAAA;AAAA,IACA,gBAAA;AAAA,IACA,MAAA;AAAA,IACA,UAAA;AAAA,IACA;AAAA,GACF;AAEA,EAAA,KAAA,MAAW,OAAO,WAAA,EAAa;AAC7B,IAAA,MAAMA,GAAAA,CAAG,SAAA,CAAe,KAAA,CAAA,IAAA,CAAK,WAAA,EAAa,GAAG,CAAC,CAAA;AAAA,EAChD;AACF;AAKA,eAAe,qBAAA,CAAsB,WAAA,EAAqB,OAAA,EAAoBF,OAAAA,EAA+B;AAE3G,EAAA,MAAM,YAAY,YAAA,EAAa;AAC/B,EAAA,MAAM,UAAA,GAAa,qBAAqB,OAAO,CAAA;AAG/C,EAAA,MAAM,UAAA,GAAkB,KAAA,CAAA,IAAA,CAAK,SAAA,EAAW,MAAM,CAAA;AAC9C,EAAA,MAAM,UAAA,GAAkB,KAAA,CAAA,IAAA,CAAK,WAAA,EAAa,QAAA,EAAU,WAAW,CAAA;AAE/D,EAAA,IAAIE,GAAAA,CAAG,UAAA,CAAW,UAAU,CAAA,EAAG;AAE7B,IAAA,MAAMA,GAAAA,CAAG,IAAA,CAAK,UAAA,EAAY,UAAA,EAAY;AAAA,MACpC,SAAA,EAAW,IAAA;AAAA,MACX,MAAA,EAAQ,CAAC,GAAA,KAAQ;AAEf,QAAA,MAAM,YAAA,GAAoB,KAAA,CAAA,QAAA,CAAS,UAAA,EAAY,GAAG,CAAA;AAClD,QAAA,OAAO,CAAC,YAAA,CAAa,UAAA,CAAW,MAAM,CAAA;AAAA,MACxC;AAAA,KACD,CAAA;AAGD,IAAA,MAAM,UAAA,GAAkB,KAAA,CAAA,IAAA,CAAK,UAAA,EAAY,UAAA,CAAW,aAAa,CAAA;AACjE,IAAA,MAAM,UAAA,GAAkB,KAAA,CAAA,IAAA,CAAK,UAAA,EAAY,MAAM,CAAA;AAE/C,IAAA,IAAIA,GAAAA,CAAG,UAAA,CAAW,UAAU,CAAA,EAAG;AAC7B,MAAA,MAAMA,IAAG,IAAA,CAAK,UAAA,EAAY,YAAY,EAAE,SAAA,EAAW,MAAM,CAAA;AACzD,MAAAF,OAAAA,CAAO,KAAA,CAAM,CAAA,kBAAA,EAAqB,UAAA,CAAW,aAAa,CAAA,6BAAA,CAA0B,CAAA;AAAA,IACtF,CAAA,MAAO;AAEL,MAAA,MAAM,WAAA,GAAmB,KAAA,CAAA,IAAA,CAAK,UAAA,EAAY,MAAM,CAAA;AAChD,MAAA,IAAIE,GAAAA,CAAG,UAAA,CAAW,WAAW,CAAA,EAAG;AAC9B,QAAA,MAAMA,IAAG,IAAA,CAAK,WAAA,EAAa,YAAY,EAAE,SAAA,EAAW,MAAM,CAAA;AAC1D,QAAAF,OAAAA,CAAO,OAAA,CAAQ,CAAA,cAAA,EAAiB,UAAA,CAAW,aAAa,CAAA,+BAAA,CAAiC,CAAA;AAAA,MAC3F,CAAA,MAAO;AACL,QAAAA,OAAAA,CAAO,QAAQ,CAAA,mCAAA,CAAqC,CAAA;AAAA,MACtD;AAAA,IACF;AAGA,IAAA,MAAM,OAAA,GAAuB;AAAA,MAE3B,kBAAA,EAAA,iBAAoB,IAAI,IAAA,EAAK,EAAE,WAAA,EAAY;AAAA,MAC3C,aAAa,mBAAA,EAAoB;AAAA,MACjC,cAAc,UAAA,CAAW,YAAA;AAAA,MACzB,mBAAmB,UAAA,CAAW,iBAAA;AAAA,MAC9B,aAAa,cAAA,EAGf,CAAA;AAGA,IAAA,MAAM,QAAA,GAAW,wBAAwB,OAAO,CAAA;AAChD,IAAA,MAAME,GAAAA,CAAG,SAAA,CAAe,KAAA,CAAA,IAAA,CAAK,UAAA,EAAY,uBAAuB,GAAG,QAAA,EAAU,EAAE,MAAA,EAAQ,CAAA,EAAG,CAAA;AAG1F,IAAA,MAAM,eAAA,GAAkB,sBAAA,CAAuB,UAAA,EAAY,OAAO,CAAA;AAClE,IAAA,MAAMA,IAAG,SAAA,CAAe,KAAA,CAAA,IAAA,CAAK,UAAA,EAAY,aAAa,GAAG,eAAe,CAAA;AAGxE,IAAA,MAAM,eAAA,GAAkB,iBAAiB,OAAO,CAAA;AAChD,IAAA,MAAMA,IAAG,SAAA,CAAe,KAAA,CAAA,IAAA,CAAK,UAAA,EAAY,YAAY,GAAG,eAAe,CAAA;AAEvE,IAAAF,OAAAA,CAAO,KAAA,CAAM,CAAA,gDAAA,EAAmD,OAAO,CAAA,CAAA,CAAG,CAAA;AAAA,EAC5E,CAAA,MAAO;AACL,IAAAA,OAAAA,CAAO,OAAA,CAAQ,CAAA,+BAAA,EAAkC,UAAU,CAAA,CAAE,CAAA;AAE7D,IAAA,MAAME,GAAAA,CAAG,SAAA,CAAe,KAAA,CAAA,IAAA,CAAK,UAAA,EAAY,cAAc,CAAA,EAAG;AAAA,MACxD,IAAA,EAAM,YAAA;AAAA,MACN,OAAA,EAAS,OAAA;AAAA,MACT,IAAA,EAAM;AAAA,KACP,CAAA;AAAA,EACH;AAGA,EAAA,MAAM,aAAA,GAAqB,KAAA,CAAA,IAAA,CAAK,SAAA,EAAW,SAAS,CAAA;AACpD,EAAA,MAAM,aAAA,GAAqB,KAAA,CAAA,IAAA,CAAK,WAAA,EAAa,QAAA,EAAU,mBAAmB,CAAA;AAE1E,EAAA,IAAIA,GAAAA,CAAG,UAAA,CAAW,aAAa,CAAA,EAAG;AAChC,IAAA,MAAMA,IAAG,IAAA,CAAK,aAAA,EAAe,eAAe,EAAE,SAAA,EAAW,MAAM,CAAA;AAC/D,IAAAF,OAAAA,CAAO,MAAM,CAAA,6CAAA,CAA+C,CAAA;AAAA,EAC9D,CAAA,MAAO;AACL,IAAAA,OAAAA,CAAO,OAAA,CAAQ,CAAA,uCAAA,EAA0C,aAAa,CAAA,CAAE,CAAA;AACxE,IAAA,MAAME,GAAAA,CAAG,SAAA,CAAe,KAAA,CAAA,IAAA,CAAK,aAAA,EAAe,cAAc,CAAA,EAAG;AAAA,MAC3D,IAAA,EAAM,oBAAA;AAAA,MACN,OAAA,EAAS,OAAA;AAAA,MACT,IAAA,EAAM;AAAA,KACP,CAAA;AAAA,EACH;AACF;AAKA,eAAe,cAAA,CAAe,aAAqBF,OAAAA,EAA+B;AAChF,EAAA,MAAM,YAAY,YAAA,EAAa;AAC/B,EAAA,MAAM,aAAA,GAAqB,KAAA,CAAA,IAAA,CAAK,SAAA,EAAW,SAAS,CAAA;AACpD,EAAA,MAAM,aAAA,GAAqB,KAAA,CAAA,IAAA,CAAK,WAAA,EAAa,SAAA,EAAW,SAAS,CAAA;AAEjE,EAAA,MAAME,GAAAA,CAAG,UAAU,aAAa,CAAA;AAEhC,EAAA,IAAIA,GAAAA,CAAG,UAAA,CAAW,aAAa,CAAA,EAAG;AAChC,IAAA,MAAM,WAAA,GAAc,MAAMA,GAAAA,CAAG,OAAA,CAAQ,aAAa,CAAA;AAClD,IAAA,IAAI,SAAA,GAAY,CAAA;AAEhB,IAAA,KAAA,MAAW,QAAQ,WAAA,EAAa;AAC9B,MAAA,IAAI,KAAK,QAAA,CAAS,KAAK,KAAK,IAAA,CAAK,UAAA,CAAW,OAAO,CAAA,EAAG;AACpD,QAAA,MAAM,MAAA,GAAc,KAAA,CAAA,IAAA,CAAK,aAAA,EAAe,IAAI,CAAA;AAE5C,QAAA,MAAM,UAAA,GAAa,IAAA,CAAK,OAAA,CAAQ,OAAA,EAAS,YAAY,CAAA;AACrD,QAAA,MAAM,MAAA,GAAc,KAAA,CAAA,IAAA,CAAK,aAAA,EAAe,UAAU,CAAA;AAElD,QAAA,MAAMA,IAAG,IAAA,CAAK,MAAA,EAAQ,QAAQ,EAAE,SAAA,EAAW,MAAM,CAAA;AACjD,QAAA,SAAA,EAAA;AACA,QAAAF,OAAAA,CAAO,KAAA,CAAM,CAAA,kBAAA,EAAqB,UAAU,CAAA,CAAE,CAAA;AAAA,MAChD;AAAA,IACF;AAEA,IAAAA,OAAAA,CAAO,KAAA,CAAM,CAAA,UAAA,EAAa,SAAS,CAAA,aAAA,CAAe,CAAA;AAAA,EACpD,CAAA,MAAO;AACL,IAAAA,OAAAA,CAAO,OAAA,CAAQ,CAAA,4BAAA,EAA+B,aAAa,CAAA,CAAE,CAAA;AAAA,EAC/D;AACF;AAKA,eAAe,wBAAA,CACb,WAAA,EACA,OAAA,EACA,WAAA,EACA,SAOAA,OAAAA,EACe;AAEf,EAAA,MAAM,oBAAA,GAA+C;AAAA,IACnD,QAAA,EAAU,SAAA;AAAA,IACV,QAAA,EAAU,SAAA;AAAA,IACV,QAAA,EAAU;AAAA,GACZ;AACA,EAAA,MAAM,iBAAA,GAAoB,oBAAA,CAAqB,OAAA,CAAQ,UAAA,CAAW,iBAAiB,CAAA;AACnF,EAAA,IAAI,CAAC,iBAAA,EAAmB;AACtB,IAAA,MAAM,IAAI,MAAM,CAAA,uCAAA,EAA0C,OAAA,CAAQ,OAAO,CAAA,EAAA,EAAK,OAAA,CAAQ,UAAA,CAAW,iBAAiB,CAAA,sCAAA,CAAwC,CAAA;AAAA,EAC5J;AAGA,EAAA,MAAM,YAAA,GAA0C;AAAA,IAC9C,WAAA,EAAa,SAAA;AAAA,IACb,WAAA,EAAa,SAAA;AAAA,IACb,YAAA,EAAc,SAAA;AAAA,IACd,YAAA,EAAc;AAAA,GAChB;AACA,EAAA,MAAM,gBAAA,GAAmB,YAAA,CAAa,OAAA,CAAQ,OAAO,CAAA;AAGrD,EAAA,MAAME,GAAAA,CAAG,SAAA;AAAA,IACF,KAAA,CAAA,IAAA,CAAK,aAAa,cAAc,CAAA;AAAA,IACrC;AAAA,MACE,IAAA,EAAM,UAAA;AAAA,MACN,OAAA,EAAS,OAAA;AAAA,MACT,OAAA,EAAS,IAAA;AAAA,MACT,OAAA,EAAS;AAAA,QACP,IAAA,EAAM,iBAAA;AAAA,QACN,YAAA,EAAc,+BAAA;AAAA,QACd,cAAA,EAAgB,iCAAA;AAAA,QAChB,iBAAA,EAAmB,oCAAA;AAAA,QACnB,iBAAA,EAAmB,sCAAA;AAAA,QACnB,SAAA,EAAW,sBAAA;AAAA,QACX,MAAA,EAAQ,wBAAA;AAAA,QACR,SAAA,EAAW;AAAA,OACb;AAAA,MACA,YAAA,EAAc;AAAA,QACZ,IAAA,EAAM;AAAA,OACR;AAAA,MACA,eAAA,EAAiB;AAAA,QACf,YAAA,EAAc,yBAAA;AAAA,QACd,oBAAA,EAAsB,iCAAA;AAAA,QACtB,kBAAA,EAAoB,iBAAA;AAAA,QACpB,aAAA,EAAe,gBAAA;AAAA,QACf,UAAA,EAAY;AAAA;AACd,KACF;AAAA,IACA,EAAE,QAAQ,CAAA;AAAE,GACd;AACA,EAAAF,QAAO,KAAA,CAAM,CAAA,iBAAA,EAAoB,iBAAiB,CAAA,aAAA,EAAgB,OAAA,CAAQ,OAAO,CAAA,CAAE,CAAA;AAGnF,EAAA,MAAME,GAAAA,CAAG,SAAA;AAAA,IACF,KAAA,CAAA,IAAA,CAAK,aAAa,sBAAsB,CAAA;AAAA,IAC7C,2BAAA;AAA4B,GAC9B;AAGA,EAAA,MAAMA,GAAAA,CAAG,SAAA;AAAA,IACF,KAAA,CAAA,IAAA,CAAK,aAAa,eAAe,CAAA;AAAA,IACtC;AAAA,MACE,eAAA,EAAiB;AAAA,QACf,MAAA,EAAQ,QAAA;AAAA,QACR,MAAA,EAAQ,UAAA;AAAA,QACR,gBAAA,EAAkB,MAAA;AAAA,QAClB,GAAA,EAAK,CAAC,QAAA,EAAU,KAAK,CAAA;AAAA,QACrB,MAAA,EAAQ,IAAA;AAAA,QACR,eAAA,EAAiB,IAAA;AAAA,QACjB,4BAAA,EAA8B,IAAA;AAAA,QAC9B,YAAA,EAAc,IAAA;AAAA,QACd,gCAAA,EAAkC,IAAA;AAAA,QAClC,MAAA,EAAQ,QAAA;AAAA,QACR,OAAA,EAAS,GAAA;AAAA,QACT,WAAA,EAAa,IAAA;AAAA,QACb,iBAAA,EAAmB,IAAA;AAAA,QACnB,OAAA,EAAS,GAAA;AAAA,QACT,KAAA,EAAO;AAAA,UACL,YAAA,EAAc,CAAC,yBAAyB,CAAA;AAAA,UACxC,cAAA,EAAgB,CAAC,2BAA2B;AAAA;AAC9C,OACF;AAAA,MACA,OAAA,EAAS,CAAC,YAAA,EAAc,UAAA,EAAY,eAAe,MAAM,CAAA;AAAA,MACzD,OAAA,EAAS,CAAC,cAAA,EAAgB,MAAA,EAAQ,QAAQ;AAAA,KAC5C;AAAA,IACA,EAAE,QAAQ,CAAA;AAAE,GACd;AAGA,EAAA,MAAMA,GAAAA,CAAG,SAAA;AAAA,IACF,KAAA,CAAA,IAAA,CAAK,aAAa,iBAAiB,CAAA;AAAA,IACxC,qBAAA,CAAsB,QAAQ,WAAW;AAAA,GAC3C;AAGA,EAAA,MAAMA,GAAAA,CAAG,SAAA;AAAA,IACF,KAAA,CAAA,IAAA,CAAK,aAAa,YAAY,CAAA;AAAA,IACnC,CAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAOF;AAIA,EAAA,MAAM,oBAAyB,KAAA,CAAA,IAAA,CAAK,WAAA,EAAa,QAAA,EAAU,WAAA,EAAa,WAAW,wBAAwB,CAAA;AAC3G,EAAA,IAAIA,GAAAA,CAAG,UAAA,CAAW,iBAAiB,CAAA,EAAG;AACpC,IAAAF,OAAAA,CAAO,MAAM,iDAAiD,CAAA;AAC9D,IAAA,IAAI;AAEF,MAAAG,QAAAA;AAAA,QACE,YAAY,iBAAiB,CAAA,iBAAA,EAAoB,WAAW,CAAA,aAAA,EAAgB,QAAQ,OAAO,CAAA,CAAA,CAAA;AAAA,QAC3F;AAAA,UACE,GAAA,EAAK,WAAA;AAAA,UACL,KAAA,EAAO,MAAA;AAAA,UACP,GAAA,EAAK,EAAE,GAAG,OAAA,CAAQ,GAAA;AAAI;AACxB,OACF;AACA,MAAAH,OAAAA,CAAO,MAAM,2CAA2C,CAAA;AAAA,IAC1D,SAAS,KAAA,EAAO;AAEd,MAAA,MAAM,eAAe,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,OAAA,GAAU,OAAO,KAAK,CAAA;AAC1E,MAAAA,OAAAA,CAAO,OAAA,CAAQ,CAAA,oDAAA,EAAuD,YAAY,CAAA,CAAE,CAAA;AACpF,MAAAA,OAAAA,CAAO,MAAM,wEAAwE,CAAA;AAAA,IACvF;AAAA,EACF,CAAA,MAAO;AACL,IAAAA,OAAAA,CAAO,MAAM,4DAA4D,CAAA;AAAA,EAC3E;AAGA,EAAA,MAAM,4BAA4B,WAAW,CAAA;AAG7C,EAAA,MAAM,4BAAA,CAA6B,aAAaA,OAAM,CAAA;AAGtD,EAAA,MAAME,GAAAA,CAAG,UAAU,OAAO,CAAA;AAC1B,EAAA,MAAM,OAAA,GAAuB;AAAA,IAC3B,SAAS,OAAA,CAAQ,OAAA;AAAA,IACjB,kBAAA,EAAA,iBAAoB,IAAI,IAAA,EAAK,EAAE,WAAA,EAAY;AAAA,IAC3C,aAAa,OAAA,CAAQ,SAAA;AAAA,IACrB,cAAc,OAAA,CAAQ,YAAA;AAAA,IACtB,iBAAA,EAAmB,QAAQ,UAAA,CAAW,iBAAA;AAAA,IACtC,aAAa,cAAA,EAAe;AAAA,IAC5B,aAAA,EAAe,KAAA;AAAA,IACf,YAAA,EAAc;AAAA,GAChB;AAEA,EAAA,MAAMA,GAAAA,CAAG,SAAA;AAAA,IACF,KAAA,CAAA,IAAA,CAAK,SAAS,cAAc,CAAA;AAAA,IACjC;AAAA,MACE,OAAA,EAAS,CAAA;AAAA;AAAA,MACT,WAAA,EAAa,WAAA;AAAA,MACb,QAAA,EAAU,WAAA;AAAA,MACV,cAAA,EAAA,iBAAgB,IAAI,IAAA,EAAK,EAAE,WAAA,EAAY;AAAA,MACvC,cAAA,EAAgB,qBAAA;AAAA;AAAA,MAEhB,GAAG;AAAA,KACL;AAAA,IACA,EAAE,QAAQ,CAAA;AAAE,GACd;AAGA,EAAA,MAAMA,GAAAA,CAAG,SAAA;AAAA,IACF,KAAA,CAAA,IAAA,CAAK,SAAS,YAAY,CAAA;AAAA,IAC/B,CAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAOF;AACF;AAMA,eAAe,4BAA4B,WAAA,EAAoC;AAC7E,EAAA,MAAM,cAAA,GAAsB,KAAA,CAAA,IAAA,CAAK,WAAA,EAAa,KAAA,EAAO,WAAW,YAAY,CAAA;AAG5E,EAAA,MAAMA,GAAAA,CAAG,SAAA,CAAe,KAAA,CAAA,IAAA,CAAK,cAAA,EAAgB,WAAW,CAAC,CAAA;AACzD,EAAA,MAAMA,GAAAA,CAAG,SAAA;AAAA,IACF,KAAA,CAAA,IAAA,CAAK,cAAA,EAAgB,WAAA,EAAa,UAAU,CAAA;AAAA,IACjD,CAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAuBF;AAGA,EAAA,MAAMA,GAAAA,CAAG,SAAA,CAAe,KAAA,CAAA,IAAA,CAAK,cAAA,EAAgB,MAAM,CAAC,CAAA;AACpD,EAAA,MAAMA,GAAAA,CAAG,SAAA;AAAA,IACF,KAAA,CAAA,IAAA,CAAK,cAAA,EAAgB,MAAA,EAAQ,UAAU,CAAA;AAAA,IAC5C,CAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAgCF;AAGA,EAAA,MAAMA,GAAAA,CAAG,SAAA;AAAA,IACF,KAAA,CAAA,IAAA,CAAK,WAAA,EAAa,KAAA,EAAO,SAAA,EAAW,YAAY,UAAU,CAAA;AAAA,IAC/D,CAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA,GASF;AACF;AAKA,eAAe,4BAAA,CAA6B,aAAqBF,OAAAA,EAA+B;AAC9F,EAAA,MAAM,kBAAA,GAA0B,KAAA,CAAA,IAAA,CAAK,WAAA,EAAa,OAAA,EAAS,cAAc,+BAA+B,CAAA;AAGxG,EAAA,MAAME,GAAAA,CAAG,SAAA,CAAe,KAAA,CAAA,OAAA,CAAQ,kBAAkB,CAAC,CAAA;AAGnD,EAAA,MAAM,eAAA,GAAkB,oBAAoB,+BAA+B,CAAA;AAC3E,EAAA,IAAI,eAAA,EAAiB;AACnB,IAAA,MAAMA,GAAAA,CAAG,SAAA,CAAU,kBAAA,EAAoB,eAAe,CAAA;AACtD,IAAAF,OAAAA,CAAO,MAAM,mDAAmD,CAAA;AAChE,IAAA;AAAA,EACF;AAGA,EAAA,MAAME,GAAAA,CAAG,SAAA;AAAA,IACP,kBAAA;AAAA,IACA,CAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAiBF;AACA,EAAAF,OAAAA,CAAO,MAAM,gDAAgD,CAAA;AAC/D;AAKA,eAAe,aAAA,CAAc,WAAA,EAAqB,OAAA,EAAiBA,OAAAA,EAA+B;AAChG,EAAA,MAAM,OAAA,GAAe,KAAA,CAAA,IAAA,CAAK,OAAA,EAAS,iBAAiB,CAAA;AAEpD,EAAA,OAAO,IAAI,OAAA,CAAQ,CAACH,SAAAA,EAAS,MAAA,KAAW;AACtC,IAAAG,OAAAA,CAAO,aAAa,4BAA4B,CAAA;AAEhD,IAAA,MAAM,QAAA,GAAqB,CAAC,CAAA,sBAAA,EAAA,iBAAyB,IAAI,MAAK,EAAE,WAAA,EAAa,CAAA,CAAE,CAAA;AAC/E,IAAA,QAAA,CAAS,IAAA,CAAK,CAAA,mBAAA,EAAsB,WAAW,CAAA,CAAE,CAAA;AAEjD,IAAA,MAAM,QAAQF,KAAAA,CAAM,KAAA,EAAO,CAAC,SAAA,EAAW,oBAAoB,CAAA,EAAG;AAAA,MAC5D,GAAA,EAAK,WAAA;AAAA,MACL,GAAA,EAAK;AAAA,QACH,GAAG,OAAA,CAAQ,GAAA;AAAA,QACX,gCAAA,EAAkC;AAAA,OACpC;AAAA,MACA,KAAA,EAAO,IAAA;AAAA,MACP,KAAA,EAAO;AAAA,KACR,CAAA;AAED,IAAA,IAAI,MAAA,GAAS,EAAA;AACb,IAAA,IAAI,MAAA,GAAS,EAAA;AAEb,IAAA,KAAA,CAAM,MAAA,EAAQ,EAAA,CAAG,MAAA,EAAQ,CAAC,IAAA,KAAS;AACjC,MAAA,MAAA,IAAU,KAAK,QAAA,EAAS;AAAA,IAC1B,CAAC,CAAA;AAED,IAAA,KAAA,CAAM,MAAA,EAAQ,EAAA,CAAG,MAAA,EAAQ,CAAC,IAAA,KAAS;AACjC,MAAA,MAAA,IAAU,KAAK,QAAA,EAAS;AAAA,IAC1B,CAAC,CAAA;AAED,IAAA,KAAA,CAAM,EAAA,CAAG,OAAA,EAAS,CAAC,IAAA,KAAS;AAC1B,MAAA,QAAA,CAAS,IAAA,CAAK,CAAA,WAAA,EAAc,IAAI,CAAA,CAAE,CAAA;AAClC,MAAA,QAAA,CAAS,KAAK,gBAAgB,CAAA;AAC9B,MAAA,QAAA,CAAS,IAAA,CAAK,UAAU,SAAS,CAAA;AACjC,MAAA,QAAA,CAAS,KAAK,gBAAgB,CAAA;AAC9B,MAAA,QAAA,CAAS,IAAA,CAAK,UAAU,SAAS,CAAA;AAGjC,MAAA,IAAI;AACF,QAAAI,IAAG,aAAA,CAAc,OAAA,EAAS,QAAA,CAAS,IAAA,CAAK,IAAI,CAAC,CAAA;AAAA,MAC/C,CAAA,CAAA,MAAQ;AAAA,MAER;AAEA,MAAA,IAAI,SAAS,CAAA,EAAG;AACd,QAAAF,OAAAA,CAAO,eAAe,wBAAwB,CAAA;AAC9C,QAAAH,SAAAA,EAAQ;AAAA,MACV,CAAA,MAAO;AACL,QAAAG,OAAAA,CAAO,YAAY,oBAAoB,CAAA;AACvC,QAAAA,OAAAA,CAAO,KAAA,CAAM,CAAA,kBAAA,EAAqB,OAAO,CAAA,CAAE,CAAA;AAC3C,QAAA,MAAA,CAAO,IAAI,KAAA,CAAM,CAAA,6BAAA,EAAgC,IAAI,CAAA,MAAA,EAAS,OAAO,eAAe,CAAC,CAAA;AAAA,MACvF;AAAA,IACF,CAAC,CAAA;AAED,IAAA,KAAA,CAAM,EAAA,CAAG,OAAA,EAAS,CAAC,KAAA,KAAU;AAC3B,MAAA,QAAA,CAAS,IAAA,CAAK,CAAA,eAAA,EAAkB,KAAA,CAAM,OAAO,CAAA,CAAE,CAAA;AAC/C,MAAA,IAAI;AACF,QAAAE,IAAG,aAAA,CAAc,OAAA,EAAS,QAAA,CAAS,IAAA,CAAK,IAAI,CAAC,CAAA;AAAA,MAC/C,CAAA,CAAA,MAAQ;AAAA,MAER;AACA,MAAAF,OAAAA,CAAO,YAAY,oBAAoB,CAAA;AACvC,MAAA,MAAA,CAAO,KAAK,CAAA;AAAA,IACd,CAAC,CAAA;AAGD,IAAA,UAAA,CAAW,MAAM;AACf,MAAA,QAAA,CAAS,KAAK,kDAAkD,CAAA;AAChE,MAAA,IAAI;AACF,QAAAE,IAAG,aAAA,CAAc,OAAA,EAAS,QAAA,CAAS,IAAA,CAAK,IAAI,CAAC,CAAA;AAAA,MAC/C,CAAA,CAAA,MAAQ;AAAA,MAER;AACA,MAAA,KAAA,CAAM,IAAA,EAAK;AACX,MAAAF,OAAAA,CAAO,YAAY,uBAAuB,CAAA;AAC1C,MAAA,MAAA,CAAO,IAAI,KAAA,CAAM,uBAAuB,CAAC,CAAA;AAAA,IAC3C,GAAG,GAAM,CAAA;AAAA,EACX,CAAC,CAAA;AACH;AAKA,eAAe,iBAAA,CAAkB,SAAiB,OAAA,EAA6C;AAC7F,EAAA,MAAM,WAAA,GAAmB,KAAA,CAAA,IAAA,CAAK,OAAA,EAAS,cAAc,CAAA;AAErD,EAAA,IAAI,UAA+B,EAAC;AACpC,EAAA,IAAIE,GAAAA,CAAG,UAAA,CAAW,WAAW,CAAA,EAAG;AAC9B,IAAA,OAAA,GAAU,MAAMA,GAAAA,CAAG,QAAA,CAAS,WAAW,CAAA;AAAA,EACzC;AAEA,EAAA,MAAA,CAAO,MAAA,CAAO,SAAS,OAAO,CAAA;AAC9B,EAAA,MAAMA,IAAG,SAAA,CAAU,WAAA,EAAa,SAAS,EAAE,MAAA,EAAQ,GAAG,CAAA;AACxD;AAKA,SAAS,YAAA,GAAuB;AAE9B,EAAA,MAAM,aAAA,GAAgB;AAAA,IACf,KAAA,CAAA,IAAA,CAAKU,UAAAA,EAAW,IAAA,EAAM,IAAA,EAAM,QAAQ,CAAA;AAAA,IACpC,KAAA,CAAA,IAAA,CAAKA,UAAAA,EAAW,IAAA,EAAM,QAAQ,CAAA;AAAA,IAC9B,KAAA,CAAA,IAAA,CAAKA,YAAW,QAAQ;AAAA,GAC/B;AAEA,EAAA,KAAA,MAAW,KAAK,aAAA,EAAe;AAC7B,IAAA,IAAIV,GAAAA,CAAG,UAAA,CAAW,CAAC,CAAA,EAAG;AACpB,MAAA,OAAO,CAAA;AAAA,IACT;AAAA,EACF;AAGA,EAAA,OAAY,KAAA,CAAA,IAAA,CAAKU,UAAAA,EAAW,IAAA,EAAM,IAAA,EAAM,QAAQ,CAAA;AAClD;AAKA,SAAS,mBAAA,CACPZ,OAAAA,EACA,WAAA,EACA,WAAA,EACA,WAAA,EACM;AACN,EAAAA,QAAO,KAAA,EAAM;AACb,EAAAA,OAAAA,CAAO,OAAO,6BAA6B,CAAA;AAC3C,EAAAA,QAAO,KAAA,EAAM;AAEb,EAAAA,OAAAA,CAAO,KAAK,YAAY,CAAA;AACxB,EAAAA,QAAO,IAAA,CAAK;AAAA,IACV,4DAAA;AAAA,IACA,+DAAA;AAAA,IACA,uEAAA;AAAA,IACA,qEAAA;AAAA,IACA,kEAAA;AAAA,IACA,kEAAA;AAAA,IACA,4DAAA;AAAA,IACA,yDAAA;AAAA,IACA,sDAAA;AAAA,IACA;AAAA,GACD,CAAA;AAED,EAAA,IAAI,WAAA,EAAa;AACf,IAAAA,QAAO,KAAA,EAAM;AACb,IAAAA,OAAAA,CAAO,KAAK,wBAAwB,CAAA;AACpC,IAAAA,QAAO,KAAA,CAAM;AAAA,MACX,EAAE,KAAA,EAAO,SAAA,EAAW,KAAA,EAAO,YAAY,OAAA,EAAQ;AAAA,MAC/C,EAAE,KAAA,EAAO,UAAA,EAAY,KAAA,EAAO,YAAY,QAAA,EAAS;AAAA,MACjD,GAAI,WAAA,CAAY,IAAA,GAAO,CAAC,EAAE,KAAA,EAAO,MAAA,EAAQ,KAAA,EAAO,WAAA,CAAY,IAAA,EAAM,CAAA,GAAI;AAAC,KACxE,CAAA;AAAA,EACH;AAEA,EAAAA,QAAO,SAAA,CAAU;AAAA,IACf,aAAA;AAAA,IACA;AAAA,GACD,CAAA;AAED,EAAAA,OAAAA,CAAO,KAAK,YAAY,CAAA;AACxB,EAAAA,OAAAA,CAAO,IAAA,CAAK,CAAC,yBAAyB,CAAC,CAAA;AACzC;AAMA,SAAS,2BAAA,GAAsC;AAE7C,EAAA,MAAM,eAAA,GAAkB,oBAAoB,+BAA+B,CAAA;AAC3E,EAAA,IAAI,eAAA,EAAiB;AACnB,IAAA,OAAO,eAAA;AAAA,EACT;AAGA,EAAA,OAAO,CAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,CAAA;AAuET;AAKA,SAAS,sBAAsB,WAAA,EAA6B;AAC1D,EAAA,OAAO,CAAA;AAAA,4BAAA,EAAA,iBACqB,IAAI,IAAA,EAAK,EAAE,WAAA,EAAa;;AAAA;;AAAA;AAAA,SAAA,EAK3C,WAAW,CAAA;AAAA;AAAA,8BAAA,EAEU,WAAW,CAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,CAAA;AAoC3C;;;AO9mCA,WAAA,EAAA;;;ACsPO,SAAS,YAAY,KAAA,EAAmC;AAC7D,EAAA,OAAO,CAAC,YAAA,EAAc,YAAA,EAAc,aAAa,WAAW,CAAA,CAAE,SAAS,KAAK,CAAA;AAC9E;ACnPO,IAAM,eAAA,GAAkBT,EAAE,IAAA,CAAK;AAAA,EACpC,YAAA;AAAA,EACA,YAAA;AAAA,EACA,WAAA;AAAA,EACA;AACF,CAAC,CAAA;AAKM,IAAM,qBAAqBA,CAAAA,CAAE,IAAA,CAAK,CAAC,KAAA,EAAO,KAAK,CAAC,CAAA;AAKhD,IAAM,sBAAsBA,CAAAA,CAAE,IAAA,CAAK,CAAC,KAAA,EAAO,WAAA,EAAa,QAAQ,CAAC,CAAA;AAKjE,IAAM,iBAAiBA,CAAAA,CAAE,IAAA,CAAK,CAAC,MAAA,EAAQ,MAAA,EAAQ,OAAO,CAAC,CAAA;AAKvD,IAAM,mBAAA,GAAsBA,EAAE,IAAA,CAAK;AAAA,EACxC,SAAA;AAAA,EACA,SAAA;AAAA,EACA,UAAA;AAAA,EACA;AACF,CAAC,CAAA;AAKM,IAAM,sBAAsBA,CAAAA,CAAE,IAAA,CAAK,CAAC,SAAA,EAAW,SAAS,CAAC,CAAA;AAKzD,IAAM,mBAAA,GAAsBA,EAAE,MAAA,CAAO;AAAA,EAC1C,IAAA,EAAM,eAAA;AAAA,EACN,EAAA,EAAI,eAAA;AAAA,EACJ,EAAA,EAAIA,CAAAA,CAAE,MAAA,EAAO,CAAE,QAAA;AACjB,CAAC,CAAA;AAKgCA,EAAE,MAAA,CAAO;AAAA,EACxC,OAAA,EAAS,eAAA;AAAA,EACT,kBAAA,EAAoBA,CAAAA,CAAE,MAAA,EAAO,CAAE,QAAA,EAAS;AAAA,EACxC,WAAA,EAAaA,CAAAA,CAAE,MAAA,EAAO,CAAE,GAAA,GAAM,GAAA,CAAI,EAAE,CAAA,CAAE,GAAA,CAAI,EAAE,CAAA;AAAA,EAC5C,YAAA,EAAc,kBAAA;AAAA,EACd,iBAAA,EAAmBA,CAAAA,CAAE,MAAA,EAAO,CAAE,MAAM,eAAe,CAAA;AAAA,EACnD,WAAA,EAAaA,EAAE,MAAA,EAAO;AAAA,EACtB,aAAA,EAAe,mBAAA;AAAA,EACf,YAAA,EAAcA,CAAAA,CAAE,OAAA,EAAQ,CAAE,QAAA,EAAS;AAAA,EACnC,eAAA,EAAiB,gBAAgB,QAAA,EAAS;AAAA,EAC1C,cAAA,EAAgBA,CAAAA,CAAE,KAAA,CAAM,mBAAmB,EAAE,QAAA;AAC/C,CAAC;AAK6BA,EAAE,MAAA,CAAO;AAAA,EACrC,KAAKA,CAAAA,CAAE,MAAA,EAAO,CAAE,GAAA,GAAM,QAAA,EAAS;AAAA,EAC/B,SAAA,EAAWA,CAAAA,CAAE,MAAA,EAAO,CAAE,QAAA,EAAS;AAAA,EAC/B,SAAA,EAAW;AACb,CAAC;AAKoCA,EAAE,MAAA,CAAO;AAAA,EAC5C,SAAA,EAAWA,CAAAA,CAAE,MAAA,EAAO,CAAE,QAAA,EAAS;AAAA,EAC/B,KAAA,EAAO,cAAA;AAAA,EACP,SAAA,EAAW,mBAAA;AAAA,EACX,OAAA,EAASA,EAAE,MAAA,EAAO;AAAA,EAClB,SAASA,CAAAA,CAAE,MAAA,CAAOA,EAAE,OAAA,EAAS,EAAE,QAAA;AACjC,CAAC;AAKM,IAAM,kBAAA,GAAqBA,EAAE,MAAA,CAAO;AAAA,EACzC,SAAA,EAAWA,EAAE,OAAA,EAAQ;AAAA,EACrB,WAAA,EAAaA,CAAAA,CAAE,MAAA,EAAO,CAAE,QAAA,EAAS;AAAA,EACjC,KAAA,EAAOA,CAAAA,CAAE,MAAA,EAAO,CAAE,QAAA,EAAS;AAAA,EAC3B,iBAAiBA,CAAAA,CAAE,MAAA,GAAS,KAAA,CAAM,YAAY,EAAE,QAAA;AAClD,CAAC,CAAA;AAKyCA,EAAE,MAAA,CAAO;AAAA,EACjD,OAAA,EAAS,eAAA;AAAA,EACT,iBAAA,EAAmBA,CAAAA,CAAE,MAAA,EAAO,CAAE,MAAM,eAAe,CAAA;AAAA,EACnD,SAAA,EAAWA,CAAAA,CAAE,KAAA,CAAMA,CAAAA,CAAE,MAAA,EAAO,CAAE,KAAA,CAAM,OAAO,CAAC,CAAA,CAAE,GAAA,CAAI,CAAC,CAAA;AAAA,EACnD,YAAA,EAAc,mBAAmB,QAAA,EAAS;AAAA,EAC1C,QAAA,EAAUA,CAAAA,CAAE,MAAA,CAAO,kBAAkB,CAAA;AAAA,EACrC,aAAaA,CAAAA,CAAE,MAAA,EAAO,CAAE,QAAA,GAAW,QAAA;AACrC,CAAC;AAKsCA,EAAE,MAAA,CAAO;AAAA,EAC9C,EAAA,EAAI,eAAA;AAAA,EACJ,WAAA,EAAaA,EAAE,MAAA,EAAO;AAAA,EACtB,SAAA,EAAWA,CAAAA,CAAE,KAAA,CAAMA,CAAAA,CAAE,MAAA,EAAO,CAAE,KAAA,CAAM,OAAO,CAAC,CAAA,CAAE,GAAA,CAAI,CAAC,CAAA;AAAA,EACnD,iBAAA,EAAmBA,CAAAA,CAAE,MAAA,EAAO,CAAE,MAAM,eAAe,CAAA;AAAA,EACnD,YAAA,EAAc,kBAAA;AAAA,EACd,QAAA,EAAUA,EAAE,MAAA,EAAO;AAAA,EACnB,aAAA,EAAeA,EAAE,MAAA;AACnB,CAAC;AAKoCA,EAAE,MAAA,CAAO;AAAA,EAC5C,aAAaA,CAAAA,CAAE,MAAA,GAAS,GAAA,EAAI,CAAE,IAAI,CAAC,CAAA;AAAA,EACnC,eAAA,EAAiBA,EAAE,MAAA,EAAO;AAAA,EAC1B,YAAA,EAAc,kBAAA;AAAA,EACd,eAAA,EAAiB,eAAA;AAAA,EACjB,OAAA,EAASA,EAAE,OAAA,EAAQ;AAAA,EACnB,KAAA,EAAOA,CAAAA,CAAE,MAAA,EAAO,CAAE,QAAA;AACpB,CAAC;;;AF9GD,IAAM,kBAAA,GAAgD;AAAA,EACpD,UAAA,EAAY,YAAA;AAAA,EACZ,KAAA,EAAO,YAAA;AAAA,EACP,KAAA,EAAO;AACT,CAAA;AAEA,eAAsB,WAAA,CAAY,YAAoB,OAAA,EAAqC;AACzF,EAAA,MAAMS,UAAS,IAAI,MAAA,CAAO,EAAE,OAAA,EAAS,OAAA,CAAQ,SAAS,CAAA;AAGtD,EAAA,IAAI,OAAA,GAA8B,MAAA;AAClC,EAAA,IAAI,OAAA,CAAQ,OAAA,IAAW,OAAA,CAAQ,OAAA,KAAY,MAAA,EAAQ;AAEjD,IAAA,IAAI,OAAA,CAAQ,WAAW,kBAAA,EAAoB;AACzC,MAAA,MAAM,aAAA,GAAgB,kBAAA,CAAmB,OAAA,CAAQ,OAAO,CAAA;AACxD,MAAAA,QAAO,OAAA,CAAQ,CAAA,UAAA,EAAa,QAAQ,OAAO,CAAA,uBAAA,EAA0B,aAAa,CAAA,UAAA,CAAY,CAAA;AAC9F,MAAAA,OAAAA,CAAO,QAAQ,CAAA,2EAAA,CAA6E,CAAA;AAC5F,MAAA,OAAA,GAAU,aAAA;AAAA,IACZ,CAAA,MAAA,IAAW,WAAA,CAAY,OAAA,CAAQ,OAAO,CAAA,EAAG;AACvC,MAAA,OAAA,GAAU,OAAA,CAAQ,OAAA;AAAA,IACpB,CAAA,MAAO;AACL,MAAAA,OAAAA,CAAO,KAAA,CAAM,CAAA,iBAAA,EAAoB,OAAA,CAAQ,OAAO,CAAA,CAAE,CAAA;AAClD,MAAAA,QAAO,KAAA,CAAM,CAAA,gBAAA,EAAmB,gBAAgB,IAAA,CAAK,IAAI,CAAC,CAAA,MAAA,CAAQ,CAAA;AAClE,MAAAA,QAAO,KAAA,EAAM;AACb,MAAAA,OAAAA,CAAO,IAAA,CAAK,kBAAA,EAAoB,CAAA;AAChC,MAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,IAChB;AAAA,EACF;AAEA,EAAA,MAAM,gBAAA,GAAqC;AAAA,IACzC,SAAS,OAAA,CAAQ,OAAA;AAAA,IACjB,cAAc,OAAA,CAAQ,YAAA;AAAA,IACtB,OAAO,OAAA,CAAQ,KAAA;AAAA,IACf,OAAA;AAAA,IACA,SAAS,OAAA,CAAQ,OAAA;AAAA,IACjB,SAAS,OAAA,CAAQ;AAAA,GACnB;AAEA,EAAA,IAAI;AACF,IAAA,MAAM,MAAA,GAAS,MAAM,SAAA,CAAU,UAAA,EAAY,gBAAgB,CAAA;AAE3D,IAAA,IAAI,CAAC,OAAO,OAAA,EAAS;AACnB,MAAAA,OAAAA,CAAO,MAAM,kBAAkB,CAAA;AAC/B,MAAA,IAAI,MAAA,CAAO,MAAA,CAAO,MAAA,GAAS,CAAA,EAAG;AAC5B,QAAAA,OAAAA,CAAO,MAAM,SAAS,CAAA;AACtB,QAAA,KAAA,MAAW,KAAA,IAAS,OAAO,MAAA,EAAQ;AACjC,UAAAA,OAAAA,CAAO,KAAA,CAAM,CAAA,IAAA,EAAO,KAAK,CAAA,CAAE,CAAA;AAAA,QAC7B;AAAA,MACF;AACA,MAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,IAChB;AAAA,EACF,SAAS,KAAA,EAAO;AACd,IAAA,MAAM,UAAU,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,OAAA,GAAU,OAAO,KAAK,CAAA;AACrE,IAAAA,OAAAA,CAAO,KAAA,CAAM,CAAA,kBAAA,EAAqB,OAAO,CAAA,CAAE,CAAA;AAC3C,IAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,EAChB;AACF;AG3DA,IAAMkB,iBAAAA,GAAmB,QAAA;AACzB,IAAM,eAAA,GAAkB,OAAA;AAKxB,eAAsB,kBAAA,GAAuD;AAC3E,EAAA,MAAM,UAAgC,EAAC;AAGvC,EAAA,OAAA,CAAQ,IAAA,CAAK,kBAAkB,CAAA;AAG/B,EAAA,OAAA,CAAQ,IAAA,CAAK,iBAAiB,CAAA;AAG9B,EAAA,OAAA,CAAQ,IAAA,CAAK,UAAU,CAAA;AAGvB,EAAA,OAAA,CAAQ,IAAA,CAAK,MAAM,aAAA,EAAe,CAAA;AAElC,EAAA,MAAM,SAAS,OAAA,CAAQ,KAAA,CAAM,CAAC,CAAA,KAAM,CAAA,CAAE,WAAW,MAAM,CAAA;AAEvD,EAAA,OAAO,EAAE,QAAQ,OAAA,EAAQ;AAC3B;AAKA,SAAS,gBAAA,GAAuC;AAC9C,EAAA,MAAMd,QAAAA,GAAU,OAAA,CAAQ,OAAA,CAAQ,OAAA,CAAQ,MAAM,EAAE,CAAA;AAEhD,EAAA,IAAW,MAAA,CAAA,GAAA,CAAIA,QAAAA,EAASc,iBAAgB,CAAA,EAAG;AACzC,IAAA,OAAO;AAAA,MACL,IAAA,EAAM,SAAA;AAAA,MACN,MAAA,EAAQ,MAAA;AAAA,MACR,OAAA,EAAAd,QAAAA;AAAA,MACA,QAAA,EAAU,MAAMc,iBAAgB,CAAA,CAAA;AAAA,MAChC,OAAA,EAAS,WAAWd,QAAO,CAAA,aAAA;AAAA,KAC7B;AAAA,EACF;AAEA,EAAA,OAAO;AAAA,IACL,IAAA,EAAM,SAAA;AAAA,IACN,MAAA,EAAQ,MAAA;AAAA,IACR,OAAA,EAAAA,QAAAA;AAAA,IACA,QAAA,EAAU,MAAMc,iBAAgB,CAAA,CAAA;AAAA,IAChC,OAAA,EAAS,WAAWd,QAAO,CAAA,WAAA,CAAA;AAAA,IAC3B,GAAA,EAAK,sBAAsBc,iBAAgB,CAAA,6BAAA;AAAA,GAC7C;AACF;AAKA,SAAS,eAAA,GAAsC;AAC7C,EAAA,IAAI;AACF,IAAA,MAAMd,QAAAA,GAAUD,SAAS,eAAA,EAAiB,EAAE,UAAU,MAAA,EAAQ,EAAE,IAAA,EAAK;AAErE,IAAA,IAAW,MAAA,CAAA,GAAA,CAAIC,QAAAA,EAAS,eAAe,CAAA,EAAG;AACxC,MAAA,OAAO;AAAA,QACL,IAAA,EAAM,KAAA;AAAA,QACN,MAAA,EAAQ,MAAA;AAAA,QACR,OAAA,EAAAA,QAAAA;AAAA,QACA,QAAA,EAAU,MAAM,eAAe,CAAA,CAAA;AAAA,QAC/B,OAAA,EAAS,OAAOA,QAAO,CAAA,aAAA;AAAA,OACzB;AAAA,IACF;AAEA,IAAA,OAAO;AAAA,MACL,IAAA,EAAM,KAAA;AAAA,MACN,MAAA,EAAQ,MAAA;AAAA,MACR,OAAA,EAAAA,QAAAA;AAAA,MACA,QAAA,EAAU,MAAM,eAAe,CAAA,CAAA;AAAA,MAC/B,OAAA,EAAS,OAAOA,QAAO,CAAA,WAAA,CAAA;AAAA,MACvB,GAAA,EAAK,CAAA,sCAAA;AAAA,KACP;AAAA,EACF,CAAA,CAAA,MAAQ;AACN,IAAA,OAAO;AAAA,MACL,IAAA,EAAM,KAAA;AAAA,MACN,MAAA,EAAQ,MAAA;AAAA,MACR,OAAA,EAAS,qCAAA;AAAA,MACT,GAAA,EAAK;AAAA,KACP;AAAA,EACF;AACF;AAKA,SAAS,QAAA,GAA+B;AACtC,EAAA,IAAI;AACF,IAAA,MAAMA,QAAAA,GAAUD,SAAS,eAAA,EAAiB,EAAE,UAAU,MAAA,EAAQ,EAAE,IAAA,EAAK;AACrE,IAAA,MAAM,KAAA,GAAQC,QAAAA,CAAQ,KAAA,CAAM,iBAAiB,CAAA;AAC7C,IAAA,MAAM,UAAA,GAAa,KAAA,GAAQ,KAAA,CAAM,CAAC,CAAA,GAAI,SAAA;AAEtC,IAAA,OAAO;AAAA,MACL,IAAA,EAAM,KAAA;AAAA,MACN,MAAA,EAAQ,MAAA;AAAA,MACR,OAAA,EAAS,UAAA;AAAA,MACT,OAAA,EAAS,OAAO,UAAU,CAAA,aAAA;AAAA,KAC5B;AAAA,EACF,CAAA,CAAA,MAAQ;AACN,IAAA,OAAO;AAAA,MACL,IAAA,EAAM,KAAA;AAAA,MACN,MAAA,EAAQ,MAAA;AAAA,MACR,OAAA,EAAS,qCAAA;AAAA,MACT,GAAA,EAAK;AAAA,KACP;AAAA,EACF;AACF;AAKA,eAAe,aAAA,GAA6C;AAC1D,EAAA,MAAM,WAAqB,EAAC;AAG5B,EAAA,IAAI,MAAM,kBAAA,CAAmB,QAAQ,CAAA,EAAG;AACtC,IAAA,QAAA,CAAS,KAAK,gBAAgB,CAAA;AAAA,EAChC;AACA,EAAA,IAAI,MAAM,kBAAA,CAAmB,QAAQ,CAAA,EAAG;AACtC,IAAA,QAAA,CAAS,KAAK,eAAe,CAAA;AAAA,EAC/B;AAGA,EAAA,MAAM,yBAAyB,yBAAA,EAA0B;AACzD,EAAA,IAAI,sBAAA,IAA6Be,GAAA,CAAA,UAAA,CAAW,sBAAsB,CAAA,EAAG;AACnE,IAAA,MAAM,OAAA,GAAaA,gBAAY,sBAAsB,CAAA;AACrD,IAAA,IAAI,OAAA,CAAQ,KAAK,CAAC,CAAA,KAAM,EAAE,UAAA,CAAW,WAAW,CAAC,CAAA,EAAG;AAClD,MAAA,QAAA,CAAS,KAAK,qBAAqB,CAAA;AAAA,IACrC;AAAA,EACF;AAEA,EAAA,IAAI,QAAA,CAAS,SAAS,CAAA,EAAG;AACvB,IAAA,OAAO;AAAA,MACL,IAAA,EAAM,UAAA;AAAA,MACN,MAAA,EAAQ,MAAA;AAAA,MACR,OAAA,EAAS,CAAA,WAAA,EAAc,QAAA,CAAS,IAAA,CAAK,IAAI,CAAC,CAAA;AAAA,KAC5C;AAAA,EACF;AAEA,EAAA,OAAO;AAAA,IACL,IAAA,EAAM,UAAA;AAAA,IACN,MAAA,EAAQ,MAAA;AAAA,IACR,OAAA,EAAS,sDAAA;AAAA,IACT,GAAA,EAAK;AAAA,GACP;AACF;AAKA,eAAe,mBAAmB,OAAA,EAAgD;AAChF,EAAA,MAAM,KAAA,GAAQC,iBAAgB,OAAO,CAAA;AAErC,EAAA,KAAA,MAAW,eAAe,KAAA,EAAO;AAC/B,IAAA,IAAOD,GAAA,CAAA,UAAA,CAAW,WAAW,CAAA,EAAG;AAC9B,MAAA,OAAO,IAAA;AAAA,IACT;AAAA,EACF;AAGA,EAAA,IAAI;AACF,IAAA,MAAM,QAAA,GACJ,OAAA,KAAY,QAAA,GACR,CAAC,gBAAA,EAAkB,uBAAA,EAAyB,QAAQ,CAAA,GACpD,CAAC,eAAA,EAAiB,sBAAA,EAAwB,QAAQ,CAAA;AAExD,IAAA,KAAA,MAAW,OAAO,QAAA,EAAU;AAC1B,MAAA,IAAI;AACF,QAAAhB,QAAAA,CAAS,GAAG,GAAG,CAAA,UAAA,CAAA,EAAc,EAAE,QAAA,EAAU,MAAA,EAAQ,KAAA,EAAO,MAAA,EAAQ,CAAA;AAChE,QAAA,OAAO,IAAA;AAAA,MACT,CAAA,CAAA,MAAQ;AAAA,MAER;AAAA,IACF;AAAA,EACF,CAAA,CAAA,MAAQ;AAAA,EAER;AAEA,EAAA,OAAO,KAAA;AACT;AAKA,SAASiB,iBAAgB,OAAA,EAAwC;AAC/D,EAAA,MAAM,QAAkB,EAAC;AAEzB,EAAA,IAAI,OAAA,CAAQ,aAAa,OAAA,EAAS;AAChC,IAAA,MAAM,YAAA,GAAe,OAAA,CAAQ,GAAA,CAAI,cAAc,CAAA,IAAK,mBAAA;AACpD,IAAA,MAAM,eAAA,GAAkB,OAAA,CAAQ,GAAA,CAAI,mBAAmB,CAAA,IAAK,yBAAA;AAC5D,IAAA,MAAM,YAAA,GAAe,OAAA,CAAQ,GAAA,CAAI,cAAc,CAAA,IAAK,EAAA;AAEpD,IAAA,IAAI,YAAY,QAAA,EAAU;AACxB,MAAA,KAAA,CAAM,IAAA;AAAA,QACJ,GAAG,eAAe,CAAA,0CAAA,CAAA;AAAA,QAClB,GAAG,YAAY,CAAA,0CAAA,CAAA;AAAA,QACf,GAAG,YAAY,CAAA,0CAAA;AAAA,OACjB;AAAA,IACF,CAAA,MAAO;AACL,MAAA,KAAA,CAAM,IAAA;AAAA,QACJ,GAAG,YAAY,CAAA,yCAAA,CAAA;AAAA,QACf,GAAG,eAAe,CAAA,yCAAA,CAAA;AAAA,QAClB,GAAG,YAAY,CAAA,yCAAA;AAAA,OACjB;AAAA,IACF;AAAA,EACF,CAAA,MAAA,IAAW,OAAA,CAAQ,QAAA,KAAa,QAAA,EAAU;AACxC,IAAA,IAAI,YAAY,QAAA,EAAU;AACxB,MAAA,KAAA,CAAM,KAAK,gEAAgE,CAAA;AAAA,IAC7E,CAAA,MAAO;AACL,MAAA,KAAA,CAAM,KAAK,8DAA8D,CAAA;AAAA,IAC3E;AAAA,EACF,CAAA,MAAO;AAEL,IAAA,IAAI,YAAY,QAAA,EAAU;AACxB,MAAA,KAAA,CAAM,IAAA;AAAA,QACJ,yBAAA;AAAA,QACA,gCAAA;AAAA,QACA;AAAA,OACF;AAAA,IACF,CAAA,MAAO;AACL,MAAA,KAAA,CAAM,IAAA;AAAA,QACJ,wBAAA;AAAA,QACA,+BAAA;AAAA,QACA,oBAAA;AAAA,QACA;AAAA,OACF;AAAA,IACF;AAAA,EACF;AAEA,EAAA,OAAO,KAAA;AACT;AAKA,SAAS,yBAAA,GAA2C;AAElD,EAAA,IAAI,OAAA,CAAQ,IAAI,wBAAA,EAA0B;AACxC,IAAA,OAAO,QAAQ,GAAA,CAAI,wBAAA;AAAA,EACrB;AAGA,EAAA,IAAI,OAAA,CAAQ,aAAa,OAAA,EAAS;AAChC,IAAA,MAAM,YAAA,GAAe,QAAQ,GAAA,CAAI,YAAA;AACjC,IAAA,IAAI,YAAA,EAAc;AAChB,MAAA,OAAO,GAAG,YAAY,CAAA,eAAA,CAAA;AAAA,IACxB;AAAA,EACF,CAAA,MAAA,IAAW,OAAA,CAAQ,QAAA,KAAa,QAAA,EAAU;AACxC,IAAA,MAAM,IAAA,GAAO,QAAQ,GAAA,CAAI,IAAA;AACzB,IAAA,IAAI,IAAA,EAAM;AACR,MAAA,OAAO,GAAG,IAAI,CAAA,6BAAA,CAAA;AAAA,IAChB;AAAA,EACF,CAAA,MAAO;AACL,IAAA,MAAM,IAAA,GAAO,QAAQ,GAAA,CAAI,IAAA;AACzB,IAAA,IAAI,IAAA,EAAM;AACR,MAAA,OAAO,GAAG,IAAI,CAAA,qBAAA,CAAA;AAAA,IAChB;AAAA,EACF;AAEA,EAAA,OAAO,IAAA;AACT;AAKO,SAAS,wBAAA,CAAyB,QAAiCpB,OAAAA,EAAsB;AAC9F,EAAAA,QAAO,KAAA,EAAM;AAEb,EAAA,KAAA,MAAW,KAAA,IAAS,OAAO,OAAA,EAAS;AAClC,IAAa,MAAM,MAAA,KAAW,MAAA,GAAS,WAAM,KAAA,CAAM,MAAA,KAAW,SAAS,QAAA,GAAM;AAC7E,IAAc,MAAM,MAAA,KAAW,MAAA,GAAS,UAAU,KAAA,CAAM,MAAA,KAAW,SAAS,KAAA,GAAQ;AAEpF,IAAA,IAAI,KAAA,CAAM,WAAW,MAAA,EAAQ;AAC3B,MAAAA,OAAAA,CAAO,QAAQ,CAAA,EAAG,KAAA,CAAM,IAAI,CAAA,EAAA,EAAK,KAAA,CAAM,OAAO,CAAA,CAAE,CAAA;AAAA,IAClD,CAAA,MAAA,IAAW,KAAA,CAAM,MAAA,KAAW,MAAA,EAAQ;AAClC,MAAAA,OAAAA,CAAO,MAAM,CAAA,EAAG,KAAA,CAAM,IAAI,CAAA,EAAA,EAAK,KAAA,CAAM,OAAO,CAAA,CAAE,CAAA;AAC9C,MAAA,IAAI,MAAM,GAAA,EAAK;AACb,QAAAA,OAAAA,CAAO,IAAA,CAAK,CAAA,OAAA,EAAU,KAAA,CAAM,GAAG,CAAA,CAAE,CAAA;AAAA,MACnC;AAAA,IACF,CAAA,MAAO;AACL,MAAAA,OAAAA,CAAO,QAAQ,CAAA,EAAG,KAAA,CAAM,IAAI,CAAA,EAAA,EAAK,KAAA,CAAM,OAAO,CAAA,CAAE,CAAA;AAChD,MAAA,IAAI,MAAM,GAAA,EAAK;AACb,QAAAA,OAAAA,CAAO,IAAA,CAAK,CAAA,OAAA,EAAU,KAAA,CAAM,GAAG,CAAA,CAAE,CAAA;AAAA,MACnC;AAAA,IACF;AAAA,EACF;AAEA,EAAAA,QAAO,KAAA,EAAM;AAEb,EAAA,IAAI,OAAO,MAAA,EAAQ;AACjB,IAAAA,OAAAA,CAAO,QAAQ,8BAA8B,CAAA;AAAA,EAC/C,CAAA,MAAO;AACL,IAAAA,OAAAA,CAAO,MAAM,8DAA8D,CAAA;AAAA,EAC7E;AACF;;;AC9TA,WAAA,EAAA;ACGA,IAAMW,WAAAA,GAAaI,aAAAA,CAAc,MAAA,CAAA,IAAA,CAAY,GAAG,CAAA;AAChD,IAAMH,UAAAA,GAAiBS,cAAQV,WAAU,CAAA;AAKlC,SAAS,UAAA,GAAqB;AACnC,EAAA,IAAI;AAEF,IAAA,MAAM,aAAA,GAAgB;AAAA,MACfU,KAAA,CAAA,IAAA,CAAKT,UAAAA,EAAW,IAAA,EAAM,IAAA,EAAM,cAAc,CAAA;AAAA,MAC1CS,KAAA,CAAA,IAAA,CAAKT,UAAAA,EAAW,IAAA,EAAM,cAAc,CAAA;AAAA,MACpCS,KAAA,CAAA,IAAA,CAAKT,YAAW,cAAc;AAAA,KACrC;AAEA,IAAA,KAAA,MAAW,WAAW,aAAA,EAAe;AACnC,MAAA,IAAOU,GAAA,CAAA,UAAA,CAAW,OAAO,CAAA,EAAG;AAC1B,QAAA,MAAM,MAAM,IAAA,CAAK,KAAA,CAASA,GAAA,CAAA,YAAA,CAAa,OAAA,EAAS,MAAM,CAAC,CAAA;AACvD,QAAA,OAAO,IAAI,OAAA,IAAW,OAAA;AAAA,MACxB;AAAA,IACF;AAEA,IAAA,OAAO,OAAA;AAAA,EACT,CAAA,CAAA,MAAQ;AACN,IAAA,OAAO,OAAA;AAAA,EACT;AACF;AAKO,SAAS,cAAA,GAAyB;AACvC,EAAA,IAAI;AACF,IAAA,MAAM,aAAA,GAAgB;AAAA,MACfD,WAAKT,UAAAA,EAAW,IAAA,EAAM,IAAA,EAAM,QAAA,EAAU,QAAQ,cAAc,CAAA;AAAA,MAC5DS,KAAA,CAAA,IAAA,CAAKT,UAAAA,EAAW,IAAA,EAAM,QAAA,EAAU,QAAQ,cAAc;AAAA,KAC7D;AAEA,IAAA,KAAA,MAAW,WAAW,aAAA,EAAe;AACnC,MAAA,IAAOU,GAAA,CAAA,UAAA,CAAW,OAAO,CAAA,EAAG;AAC1B,QAAA,MAAM,MAAM,IAAA,CAAK,KAAA,CAASA,GAAA,CAAA,YAAA,CAAa,OAAA,EAAS,MAAM,CAAC,CAAA;AACvD,QAAA,OAAO,IAAI,OAAA,IAAW,OAAA;AAAA,MACxB;AAAA,IACF;AAEA,IAAA,OAAO,OAAA;AAAA,EACT,CAAA,CAAA,MAAQ;AACN,IAAA,OAAO,OAAA;AAAA,EACT;AACF;;;AD7CA,eAAsB,aAAa,OAAA,EAAsC;AACvE,EAAA,MAAMtB,OAAAA,GAAS,IAAI,MAAA,EAAO;AAE1B,EAAAA,OAAAA,CAAO,OAAO,0BAA0B,CAAA;AAGxC,EAAAA,OAAAA,CAAO,KAAK,WAAW,CAAA;AACvB,EAAAA,QAAO,KAAA,CAAM;AAAA,IACX,EAAE,KAAA,EAAO,WAAA,EAAa,KAAA,EAAO,YAAW,EAAE;AAAA,IAC1C,EAAE,KAAA,EAAO,YAAA,EAAc,KAAA,EAAO,gBAAe;AAAE,GAChD,CAAA;AACD,EAAAA,QAAO,KAAA,EAAM;AAGb,EAAAA,OAAAA,CAAO,KAAK,2BAA2B,CAAA;AACvC,EAAA,MAAM,MAAA,GAAS,MAAM,kBAAA,EAAmB;AAGxC,EAAA,wBAAA,CAAyB,QAAQA,OAAM,CAAA;AAGvC,EAAA,IAAI,CAAC,OAAO,MAAA,EAAQ;AAClB,IAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,EAChB;AACF;;;AE7BA,WAAA,EAAA;AAGA,IAAMW,WAAAA,GAAaI,aAAAA,CAAc,MAAA,CAAA,IAAA,CAAY,GAAG,CAAA;AAChD,IAAMH,UAAAA,GAAiBW,cAAQZ,WAAU,CAAA;AAOzC,eAAsB,cAAA,CAAe,YAAoB,OAAA,EAAwC;AAC/F,EAAA,MAAMX,OAAAA,GAAS,IAAI,MAAA,EAAO;AAC1B,EAAA,MAAM,YAAA,GAAoBuB,cAAQ,UAAU,CAAA;AAC5C,EAAA,MAAM,WAAA,GAAmBA,KAAA,CAAA,IAAA,CAAK,YAAA,EAAc,UAAU,CAAA;AAEtD,EAAAvB,OAAAA,CAAO,OAAO,cAAc,CAAA;AAG5B,EAAA,IAAI,CAACE,GAAAA,CAAG,UAAA,CAAW,WAAW,CAAA,EAAG;AAC/B,IAAAF,OAAAA,CAAO,MAAM,wCAAwC,CAAA;AACrD,IAAAA,OAAAA,CAAO,KAAK,uBAAuB,CAAA;AACnC,IAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,EAChB;AAGA,EAAA,MAAM,cAAA,GAAsBuB,KAAA,CAAA,IAAA,CAAK,WAAA,EAAa,QAAA,EAAU,aAAa,cAAc,CAAA;AACnF,EAAA,IAAI,cAAA,GAAiB,SAAA;AACrB,EAAA,IAAIrB,GAAAA,CAAG,UAAA,CAAW,cAAc,CAAA,EAAG;AACjC,IAAA,IAAI;AACF,MAAA,MAAM,GAAA,GAAM,MAAMA,GAAAA,CAAG,QAAA,CAAS,cAAc,CAAA;AAC5C,MAAA,cAAA,GAAiB,IAAI,OAAA,IAAW,SAAA;AAAA,IAClC,CAAA,CAAA,MAAQ;AAAA,IAER;AAAA,EACF;AAEA,EAAA,MAAM,mBAAmB,cAAA,EAAe;AAExC,EAAAF,OAAAA,CAAO,KAAK,sBAAsB,CAAA;AAClC,EAAAA,QAAO,KAAA,CAAM;AAAA,IACX,EAAE,KAAA,EAAO,WAAA,EAAa,KAAA,EAAO,cAAA,EAAe;AAAA,IAC5C,EAAE,KAAA,EAAO,WAAA,EAAa,KAAA,EAAO,gBAAA;AAAiB,GAC/C,CAAA;AACD,EAAAA,QAAO,KAAA,EAAM;AAGb,EAAA,IAAI,QAAQ,KAAA,EAAO;AACjB,IAAA,IAAI,mBAAmB,gBAAA,EAAkB;AACvC,MAAAA,OAAAA,CAAO,QAAQ,qBAAqB,CAAA;AAAA,IACtC,CAAA,MAAO;AACL,MAAAA,QAAO,IAAA,CAAK,CAAA,kBAAA,EAAqB,cAAc,CAAA,QAAA,EAAM,gBAAgB,CAAA,CAAE,CAAA;AACvE,MAAAA,OAAAA,CAAO,KAAK,0BAA0B,CAAA;AAAA,IACxC;AACA,IAAA;AAAA,EACF;AAGA,EAAA,IAAI,cAAA,KAAmB,gBAAA,IAAoB,CAAC,OAAA,CAAQ,KAAA,EAAO;AACzD,IAAAA,OAAAA,CAAO,QAAQ,qBAAqB,CAAA;AACpC,IAAA;AAAA,EACF;AAGA,EAAAA,OAAAA,CAAO,aAAa,yBAAyB,CAAA;AAE7C,EAAA,IAAI;AAEF,IAAA,MAAM,YAAYwB,aAAAA,EAAa;AAG/B,IAAA,MAAM,UAAA,GAAkBD,KAAA,CAAA,IAAA,CAAK,SAAA,EAAW,MAAM,CAAA;AAC9C,IAAA,MAAM,UAAA,GAAkBA,KAAA,CAAA,IAAA,CAAK,WAAA,EAAa,QAAA,EAAU,WAAW,CAAA;AAE/D,IAAA,IAAIrB,GAAAA,CAAG,UAAA,CAAW,UAAU,CAAA,EAAG;AAC7B,MAAA,MAAMA,GAAAA,CAAG,OAAO,UAAU,CAAA;AAC1B,MAAA,MAAMA,GAAAA,CAAG,IAAA,CAAK,UAAA,EAAY,UAAU,CAAA;AAAA,IACtC,CAAA,MAAO;AACL,MAAAF,OAAAA,CAAO,YAAY,gBAAgB,CAAA;AACnC,MAAAA,OAAAA,CAAO,MAAM,sCAAsC,CAAA;AACnD,MAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,IAChB;AAGA,IAAA,MAAM,aAAA,GAAqBuB,KAAA,CAAA,IAAA,CAAK,SAAA,EAAW,SAAS,CAAA;AACpD,IAAA,MAAM,aAAA,GAAqBA,KAAA,CAAA,IAAA,CAAK,WAAA,EAAa,QAAA,EAAU,mBAAmB,CAAA;AAE1E,IAAA,IAAIrB,GAAAA,CAAG,UAAA,CAAW,aAAa,CAAA,EAAG;AAChC,MAAA,MAAMA,GAAAA,CAAG,OAAO,aAAa,CAAA;AAC7B,MAAA,MAAMA,GAAAA,CAAG,IAAA,CAAK,aAAA,EAAe,aAAa,CAAA;AAAA,IAC5C;AAEA,IAAAF,OAAAA,CAAO,eAAe,mBAAmB,CAAA;AAEzC,IAAAA,QAAO,KAAA,EAAM;AACb,IAAAA,QAAO,OAAA,CAAQ,CAAA,UAAA,EAAa,cAAc,CAAA,QAAA,EAAM,gBAAgB,CAAA,CAAE,CAAA;AAClE,IAAAA,QAAO,KAAA,EAAM;AACb,IAAAA,OAAAA,CAAO,KAAK,yDAAyD,CAAA;AACrE,IAAAA,OAAAA,CAAO,IAAA,CAAK,CAAC,4BAA4B,CAAC,CAAA;AAAA,EAC5C,SAAS,KAAA,EAAO;AACd,IAAAA,OAAAA,CAAO,YAAY,gBAAgB,CAAA;AACnC,IAAA,MAAM,UAAU,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,OAAA,GAAU,OAAO,KAAK,CAAA;AACrE,IAAAA,OAAAA,CAAO,MAAM,OAAO,CAAA;AACpB,IAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,EAChB;AACF;AAKA,SAASwB,aAAAA,GAAuB;AAC9B,EAAA,MAAM,aAAA,GAAgB;AAAA,IACfD,KAAA,CAAA,IAAA,CAAKX,UAAAA,EAAW,IAAA,EAAM,IAAA,EAAM,QAAQ,CAAA;AAAA,IACpCW,KAAA,CAAA,IAAA,CAAKX,UAAAA,EAAW,IAAA,EAAM,QAAQ,CAAA;AAAA,IAC9BW,KAAA,CAAA,IAAA,CAAKX,YAAW,QAAQ;AAAA,GAC/B;AAEA,EAAA,KAAA,MAAW,KAAK,aAAA,EAAe;AAC7B,IAAA,IAAIV,GAAAA,CAAG,UAAA,CAAW,CAAC,CAAA,EAAG;AACpB,MAAA,OAAO,CAAA;AAAA,IACT;AAAA,EACF;AAEA,EAAA,OAAYqB,KAAA,CAAA,IAAA,CAAKX,UAAAA,EAAW,IAAA,EAAM,IAAA,EAAM,QAAQ,CAAA;AAClD;;;AC5HA,WAAA,EAAA;AAeA,eAAsB,aAAA,CAAc,YAAoB,OAAA,EAAuC;AAC7F,EAAA,MAAMZ,UAAS,IAAI,MAAA,CAAO,EAAE,OAAA,EAAS,OAAA,CAAQ,SAAS,CAAA;AACtD,EAAA,MAAM,YAAA,GAAoByB,cAAQ,UAAU,CAAA;AAC5C,EAAA,MAAM,WAAA,GAAmBA,KAAA,CAAA,IAAA,CAAK,YAAA,EAAc,UAAU,CAAA;AACtD,EAAqBA,KAAA,CAAA,IAAA,CAAK,YAAA,EAAc,OAAO;AAE/C,EAAAzB,OAAAA,CAAO,OAAO,aAAa,CAAA;AAC3B,EAAAA,OAAAA,CAAO,IAAA,CAAK,CAAA,YAAA,EAAe,YAAY,CAAA,CAAE,CAAA;AACzC,EAAAA,QAAO,KAAA,EAAM;AAEb,EAAA,MAAM,cAAkC,EAAC;AAGzC,EAAA,WAAA,CAAY,IAAA,CAAK,MAAM,qBAAA,CAAsB,YAAA,EAAc,WAAW,CAAC,CAAA;AAGvE,EAAA,WAAA,CAAY,IAAA,CAAK,MAAM,gBAAA,CAAiB,WAAW,CAAC,CAAA;AAGpD,EAAA,WAAA,CAAY,KAAK,MAAM,uBAAA,CAAwB,YAAA,EAAc,WAAA,EAAaA,OAAM,CAAC,CAAA;AAGjF,EAAA,WAAA,CAAY,IAAA,CAAK,MAAM,gBAAA,CAAiB,WAAW,CAAC,CAAA;AAGpD,EAAA,WAAA,CAAY,IAAA,CAAK,MAAM,mBAAA,CAAoB,WAAW,CAAC,CAAA;AAGvD,EAAA,WAAA,CAAY,IAAA,CAAK,MAAM,eAAA,CAAgB,WAAW,CAAC,CAAA;AAGnD,EAAAA,QAAO,KAAA,EAAM;AACb,EAAAA,OAAAA,CAAO,KAAK,qBAAqB,CAAA;AACjC,EAAAA,QAAO,KAAA,EAAM;AAEb,EAAA,IAAI,SAAA,GAAY,KAAA;AAChB,EAAA,IAAI,WAAA,GAAc,KAAA;AAClB,EAAA,MAAM,UAA8B,EAAC;AAErC,EAAA,KAAA,MAAW,QAAQ,WAAA,EAAa;AAC9B,IAAA,IAAI,IAAA,CAAK,WAAW,IAAA,EAAM;AACxB,MAAAA,OAAAA,CAAO,QAAQ,CAAA,EAAG,IAAA,CAAK,IAAI,CAAA,EAAA,EAAK,IAAA,CAAK,OAAO,CAAA,CAAE,CAAA;AAAA,IAChD,CAAA,MAAA,IAAW,IAAA,CAAK,MAAA,KAAW,MAAA,EAAQ;AACjC,MAAAA,OAAAA,CAAO,QAAQ,CAAA,EAAG,IAAA,CAAK,IAAI,CAAA,EAAA,EAAK,IAAA,CAAK,OAAO,CAAA,CAAE,CAAA;AAC9C,MAAA,WAAA,GAAc,IAAA;AACd,MAAA,IAAI,IAAA,CAAK,GAAA,EAAK,OAAA,CAAQ,IAAA,CAAK,IAAI,CAAA;AAAA,IACjC,CAAA,MAAO;AACL,MAAAA,OAAAA,CAAO,MAAM,CAAA,EAAG,IAAA,CAAK,IAAI,CAAA,EAAA,EAAK,IAAA,CAAK,OAAO,CAAA,CAAE,CAAA;AAC5C,MAAA,SAAA,GAAY,IAAA;AACZ,MAAA,IAAI,IAAA,CAAK,GAAA,EAAK,OAAA,CAAQ,IAAA,CAAK,IAAI,CAAA;AAAA,IACjC;AAAA,EACF;AAEA,EAAAA,QAAO,KAAA,EAAM;AAGb,EAAA,IAAI,OAAA,CAAQ,GAAA,IAAO,OAAA,CAAQ,MAAA,GAAS,CAAA,EAAG;AACrC,IAAAA,OAAAA,CAAO,KAAK,6BAA6B,CAAA;AACzC,IAAAA,QAAO,KAAA,EAAM;AAEb,IAAA,KAAA,MAAW,QAAQ,OAAA,EAAS;AAC1B,MAAA,IAAI,KAAK,GAAA,EAAK;AACZ,QAAAA,OAAAA,CAAO,YAAA,CAAa,CAAA,QAAA,EAAW,IAAA,CAAK,IAAI,CAAA,GAAA,CAAK,CAAA;AAC7C,QAAA,IAAI;AACF,UAAA,MAAM,KAAK,GAAA,EAAI;AACf,UAAAA,OAAAA,CAAO,cAAA,CAAe,CAAA,OAAA,EAAU,IAAA,CAAK,IAAI,CAAA,CAAE,CAAA;AAAA,QAC7C,SAAS,KAAA,EAAO;AACd,UAAAA,OAAAA,CAAO,WAAA,CAAY,CAAA,eAAA,EAAkB,IAAA,CAAK,IAAI,CAAA,CAAE,CAAA;AAChD,UAAA,MAAM,UAAU,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,OAAA,GAAU,OAAO,KAAK,CAAA;AACrE,UAAAA,OAAAA,CAAO,MAAM,OAAO,CAAA;AAAA,QACtB;AAAA,MACF;AAAA,IACF;AAEA,IAAAA,QAAO,KAAA,EAAM;AACb,IAAAA,OAAAA,CAAO,KAAK,uCAAuC,CAAA;AAAA,EACrD,WAAW,OAAA,CAAQ,MAAA,GAAS,CAAA,IAAK,CAAC,QAAQ,GAAA,EAAK;AAC7C,IAAAA,OAAAA,CAAO,IAAA,CAAK,CAAA,MAAA,EAAS,OAAA,CAAQ,MAAM,CAAA,6DAAA,CAA+D,CAAA;AAAA,EACpG;AAGA,EAAA,IAAI,SAAA,EAAW;AACb,IAAAA,QAAO,KAAA,EAAM;AACb,IAAAA,OAAAA,CAAO,MAAM,gCAAgC,CAAA;AAC7C,IAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,EAChB,WAAW,WAAA,EAAa;AACtB,IAAAA,QAAO,KAAA,EAAM;AACb,IAAAA,OAAAA,CAAO,QAAQ,iDAAiD,CAAA;AAAA,EAClE,CAAA,MAAO;AACL,IAAAA,QAAO,KAAA,EAAM;AACb,IAAAA,OAAAA,CAAO,QAAQ,qCAAqC,CAAA;AAAA,EACtD;AACF;AAEA,eAAe,qBAAA,CAAsB,aAAqB,WAAA,EAAgD;AACxG,EAAA,IAAI,CAACE,GAAAA,CAAG,UAAA,CAAW,WAAW,CAAA,EAAG;AAC/B,IAAA,OAAO;AAAA,MACL,IAAA,EAAM,mBAAA;AAAA,MACN,MAAA,EAAQ,OAAA;AAAA,MACR,OAAA,EAAS;AAAA,KACX;AAAA,EACF;AAEA,EAAA,MAAM,WAAA,GAAmBuB,KAAA,CAAA,IAAA,CAAK,WAAA,EAAa,OAAA,EAAS,cAAc,CAAA;AAClE,EAAA,IAAI,CAACvB,GAAAA,CAAG,UAAA,CAAW,WAAW,CAAA,EAAG;AAC/B,IAAA,OAAO;AAAA,MACL,IAAA,EAAM,mBAAA;AAAA,MACN,MAAA,EAAQ,MAAA;AAAA,MACR,OAAA,EAAS,4BAAA;AAAA,MACT,KAAK,YAAY;AACf,QAAA,MAAMA,GAAAA,CAAG,SAAA,CAAeuB,KAAA,CAAA,IAAA,CAAK,WAAA,EAAa,OAAO,CAAC,CAAA;AAClD,QAAA,MAAMvB,GAAAA,CAAG,UAAU,WAAA,EAAa;AAAA,UAC9B,OAAA,EAAS,KAAA;AAAA,UACT,WAAA,EAAa,WAAA;AAAA,UACb,QAAA,EAAU,WAAA;AAAA,UACV,cAAA,EAAA,iBAAgB,IAAI,IAAA,EAAK,EAAE,WAAA;AAAY,SACzC,EAAG,EAAE,MAAA,EAAQ,CAAA,EAAG,CAAA;AAAA,MAClB;AAAA,KACF;AAAA,EACF;AAEA,EAAA,OAAO;AAAA,IACL,IAAA,EAAM,mBAAA;AAAA,IACN,MAAA,EAAQ,IAAA;AAAA,IACR,OAAA,EAAS;AAAA,GACX;AACF;AAEA,eAAe,iBAAiB,WAAA,EAAgD;AAC9E,EAAA,MAAM,eAAA,GAAuBuB,KAAA,CAAA,IAAA,CAAK,WAAA,EAAa,cAAc,CAAA;AAE7D,EAAA,IAAI,CAACvB,GAAAA,CAAG,UAAA,CAAW,eAAe,CAAA,EAAG;AACnC,IAAA,OAAO;AAAA,MACL,IAAA,EAAM,cAAA;AAAA,MACN,MAAA,EAAQ,OAAA;AAAA,MACR,OAAA,EAAS,wBAAA;AAAA,MACT,KAAK,YAAY;AACf,QAAAC,SAAS,gCAAA,EAAkC,EAAE,KAAK,WAAA,EAAa,KAAA,EAAO,QAAQ,CAAA;AAAA,MAChF;AAAA,KACF;AAAA,EACF;AAGA,EAAA,MAAM,cAAA,GAAsBsB,KAAA,CAAA,IAAA,CAAK,eAAA,EAAiB,aAAA,EAAe,MAAM,CAAA;AACvE,EAAA,IAAI,CAACvB,GAAAA,CAAG,UAAA,CAAW,cAAc,CAAA,EAAG;AAClC,IAAA,OAAO;AAAA,MACL,IAAA,EAAM,cAAA;AAAA,MACN,MAAA,EAAQ,OAAA;AAAA,MACR,OAAA,EAAS,gCAAA;AAAA,MACT,KAAK,YAAY;AACf,QAAAC,SAAS,gCAAA,EAAkC,EAAE,KAAK,WAAA,EAAa,KAAA,EAAO,QAAQ,CAAA;AAAA,MAChF;AAAA,KACF;AAAA,EACF;AAEA,EAAA,OAAO;AAAA,IACL,IAAA,EAAM,cAAA;AAAA,IACN,MAAA,EAAQ,IAAA;AAAA,IACR,OAAA,EAAS;AAAA,GACX;AACF;AAEA,eAAe,uBAAA,CACb,WAAA,EACA,WAAA,EACAH,OAAAA,EAC2B;AAE3B,EAAA,MAAM,iBAAA,GAAyByB,KAAA,CAAA,IAAA,CAAK,WAAA,EAAa,OAAA,EAAS,UAAU,CAAA;AACpE,EAAA,MAAM,iBAAA,GAAoBvB,GAAAA,CAAG,UAAA,CAAW,iBAAiB,KACvDA,GAAAA,CAAG,WAAA,CAAY,iBAAiB,CAAA,CAAE,IAAA,CAAK,CAAA,CAAA,KAAK,CAAA,CAAE,UAAA,CAAW,WAAW,CAAC,CAAA;AAEvE,EAAA,IAAI,iBAAA,EAAmB;AACrB,IAAA,OAAO;AAAA,MACL,IAAA,EAAM,qBAAA;AAAA,MACN,MAAA,EAAQ,IAAA;AAAA,MACR,OAAA,EAAS;AAAA,KACX;AAAA,EACF;AAGA,EAAA,MAAM,UAAA,GAAkBuB,KAAA,CAAA,IAAA,CAAK,WAAA,EAAa,iBAAiB,CAAA;AAC3D,EAAA,IAAIvB,GAAAA,CAAG,UAAA,CAAW,UAAU,CAAA,EAAG;AAC7B,IAAA,MAAM,OAAA,GAAUA,GAAAA,CAAG,YAAA,CAAa,UAAA,EAAY,MAAM,CAAA;AAClD,IAAA,IAAI,QAAQ,QAAA,CAAS,iBAAiB,KAAK,OAAA,CAAQ,QAAA,CAAS,iBAAiB,CAAA,EAAG;AAC9E,MAAA,OAAO;AAAA,QACL,IAAA,EAAM,qBAAA;AAAA,QACN,MAAA,EAAQ,IAAA;AAAA,QACR,OAAA,EAAS;AAAA,OACX;AAAA,IACF;AAAA,EACF;AAEA,EAAA,OAAO;AAAA,IACL,IAAA,EAAM,qBAAA;AAAA,IACN,MAAA,EAAQ,MAAA;AAAA,IACR,OAAA,EAAS,wBAAA;AAAA,IACT,KAAK,YAAY;AACf,MAAA,MAAM,cAAA,CAAe,aAAaF,OAAM,CAAA;AAAA,IAC1C;AAAA,GACF;AACF;AAEA,eAAe,iBAAiB,WAAA,EAAgD;AAC9E,EAAA,MAAM,aAAA,GAAgB;AAAA,IACpB,cAAA;AAAA,IACA,sBAAA;AAAA,IACA,eAAA;AAAA,IACA;AAAA,GACF;AAEA,EAAA,MAAM,UAAoB,EAAC;AAC3B,EAAA,KAAA,MAAW,QAAQ,aAAA,EAAe;AAChC,IAAA,IAAI,CAACE,GAAAA,CAAG,UAAA,CAAgBuB,WAAK,WAAA,EAAa,IAAI,CAAC,CAAA,EAAG;AAChD,MAAA,OAAA,CAAQ,KAAK,IAAI,CAAA;AAAA,IACnB;AAAA,EACF;AAEA,EAAA,IAAI,OAAA,CAAQ,SAAS,CAAA,EAAG;AACtB,IAAA,OAAO;AAAA,MACL,IAAA,EAAM,qBAAA;AAAA,MACN,MAAA,EAAQ,OAAA;AAAA,MACR,OAAA,EAAS,CAAA,SAAA,EAAY,OAAA,CAAQ,IAAA,CAAK,IAAI,CAAC,CAAA;AAAA,KACzC;AAAA,EACF;AAEA,EAAA,OAAO;AAAA,IACL,IAAA,EAAM,qBAAA;AAAA,IACN,MAAA,EAAQ,IAAA;AAAA,IACR,OAAA,EAAS;AAAA,GACX;AACF;AAEA,eAAe,oBAAoB,WAAA,EAAgD;AACjF,EAAA,MAAM,UAAA,GAAkBA,KAAA,CAAA,IAAA,CAAK,WAAA,EAAa,QAAA,EAAU,WAAW,CAAA;AAC/D,EAAA,MAAM,aAAA,GAAqBA,KAAA,CAAA,IAAA,CAAK,WAAA,EAAa,QAAA,EAAU,mBAAmB,CAAA;AAE1E,EAAA,MAAM,SAAmB,EAAC;AAE1B,EAAA,IAAI,CAACvB,GAAAA,CAAG,UAAA,CAAgBuB,WAAK,UAAA,EAAY,cAAc,CAAC,CAAA,EAAG;AACzD,IAAA,MAAA,CAAO,KAAK,YAAY,CAAA;AAAA,EAC1B;AAEA,EAAA,IAAI,CAACvB,GAAAA,CAAG,UAAA,CAAgBuB,WAAK,aAAA,EAAe,cAAc,CAAC,CAAA,EAAG;AAC5D,IAAA,MAAA,CAAO,KAAK,oBAAoB,CAAA;AAAA,EAClC;AAEA,EAAA,IAAI,MAAA,CAAO,SAAS,CAAA,EAAG;AACrB,IAAA,OAAO;AAAA,MACL,IAAA,EAAM,iBAAA;AAAA,MACN,MAAA,EAAQ,OAAA;AAAA,MACR,OAAA,EAAS,CAAA,SAAA,EAAY,MAAA,CAAO,IAAA,CAAK,IAAI,CAAC,CAAA;AAAA,KACxC;AAAA,EACF;AAEA,EAAA,OAAO;AAAA,IACL,IAAA,EAAM,iBAAA;AAAA,IACN,MAAA,EAAQ,IAAA;AAAA,IACR,OAAA,EAAS;AAAA,GACX;AACF;AAEA,eAAe,gBAAgB,WAAA,EAAgD;AAC7E,EAAA,IAAI,CAACvB,GAAAA,CAAG,UAAA,CAAgBuB,WAAK,WAAA,EAAa,cAAc,CAAC,CAAA,EAAG;AAC1D,IAAA,OAAO;AAAA,MACL,IAAA,EAAM,YAAA;AAAA,MACN,MAAA,EAAQ,MAAA;AAAA,MACR,OAAA,EAAS;AAAA,KACX;AAAA,EACF;AAEA,EAAA,IAAI;AACF,IAAAtB,SAAS,kBAAA,EAAoB,EAAE,KAAK,WAAA,EAAa,KAAA,EAAO,QAAQ,CAAA;AAChE,IAAA,OAAO;AAAA,MACL,IAAA,EAAM,YAAA;AAAA,MACN,MAAA,EAAQ,IAAA;AAAA,MACR,OAAA,EAAS;AAAA,KACX;AAAA,EACF,SAAS,KAAA,EAAO;AACd,IAAA,OAAO;AAAA,MACL,IAAA,EAAM,YAAA;AAAA,MACN,MAAA,EAAQ,MAAA;AAAA,MACR,OAAA,EAAS;AAAA,KACX;AAAA,EACF;AACF;;;AC5SA,WAAA,EAAA;AAQA,eAAsB,gBAAA,CAAiB,YAAoB,OAAA,EAA0C;AACnG,EAAA,MAAMH,OAAAA,GAAS,IAAI,MAAA,EAAO;AAC1B,EAAA,MAAM,YAAA,GAAoB0B,cAAQ,UAAU,CAAA;AAC5C,EAAA,MAAM,WAAA,GAAmBA,KAAA,CAAA,IAAA,CAAK,YAAA,EAAc,UAAU,CAAA;AACtD,EAAA,MAAM,OAAA,GAAeA,KAAA,CAAA,IAAA,CAAK,YAAA,EAAc,OAAO,CAAA;AAC/C,EAAA,MAAM,UAAA,GAAkBA,KAAA,CAAA,IAAA,CAAK,YAAA,EAAc,SAAA,EAAW,SAAS,CAAA;AAE/D,EAAA1B,OAAAA,CAAO,OAAO,gBAAgB,CAAA;AAG9B,EAAA,IAAI,CAACE,IAAG,UAAA,CAAW,WAAW,KAAK,CAACA,GAAAA,CAAG,UAAA,CAAW,OAAO,CAAA,EAAG;AAC1D,IAAAF,OAAAA,CAAO,MAAM,wCAAwC,CAAA;AACrD,IAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,EAChB;AAGA,EAAAA,OAAAA,CAAO,KAAK,gCAAgC,CAAA;AAC5C,EAAAA,QAAO,KAAA,EAAM;AAEb,EAAA,MAAM,WAAyD,EAAC;AAEhE,EAAA,IAAIE,GAAAA,CAAG,UAAA,CAAW,WAAW,CAAA,EAAG;AAC9B,IAAA,IAAI,QAAQ,SAAA,EAAW;AAErB,MAAA,QAAA,CAAS,IAAA,CAAK;AAAA,QACZ,IAAA,EAAWwB,KAAA,CAAA,IAAA,CAAK,WAAA,EAAa,QAAQ,CAAA;AAAA,QACrC,WAAA,EAAa;AAAA,OACd,CAAA;AACD,MAAA,QAAA,CAAS,IAAA,CAAK;AAAA,QACZ,IAAA,EAAWA,KAAA,CAAA,IAAA,CAAK,WAAA,EAAa,cAAc,CAAA;AAAA,QAC3C,WAAA,EAAa;AAAA,OACd,CAAA;AAAA,IACH,CAAA,MAAO;AACL,MAAA,QAAA,CAAS,IAAA,CAAK;AAAA,QACZ,IAAA,EAAM,WAAA;AAAA,QACN,WAAA,EAAa;AAAA,OACd,CAAA;AAAA,IACH;AAAA,EACF;AAEA,EAAA,IAAIxB,GAAAA,CAAG,UAAA,CAAW,OAAO,CAAA,EAAG;AAC1B,IAAA,QAAA,CAAS,IAAA,CAAK;AAAA,MACZ,IAAA,EAAM,OAAA;AAAA,MACN,WAAA,EAAa;AAAA,KACd,CAAA;AAAA,EACH;AAEA,EAAA,IAAI,CAAC,OAAA,CAAQ,WAAA,IAAeA,GAAAA,CAAG,UAAA,CAAW,UAAU,CAAA,EAAG;AAErD,IAAA,MAAM,WAAA,GAAcA,GAAAA,CAAG,WAAA,CAAY,UAAU,EAC1C,MAAA,CAAO,CAAA,CAAA,KAAK,CAAA,CAAE,UAAA,CAAW,OAAO,CAAA,IAAK,CAAA,CAAE,QAAA,CAAS,YAAY,CAAC,CAAA;AAEhE,IAAA,IAAI,WAAA,CAAY,SAAS,CAAA,EAAG;AAC1B,MAAA,KAAA,MAAW,UAAU,WAAA,EAAa;AAChC,QAAA,QAAA,CAAS,IAAA,CAAK;AAAA,UACZ,IAAA,EAAWwB,KAAA,CAAA,IAAA,CAAK,UAAA,EAAY,MAAM,CAAA;AAAA,UAClC,WAAA,EAAa,mBAAmB,MAAM,CAAA;AAAA,SACvC,CAAA;AAAA,MACH;AAAA,IACF;AAAA,EACF;AAEA,EAAA,IAAI,QAAA,CAAS,WAAW,CAAA,EAAG;AACzB,IAAA1B,OAAAA,CAAO,KAAK,oBAAoB,CAAA;AAChC,IAAA;AAAA,EACF;AAEA,EAAA,KAAA,MAAW,QAAQ,QAAA,EAAU;AAC3B,IAAAA,OAAAA,CAAO,IAAA,CAAK,CAAC,IAAA,CAAK,WAAW,CAAC,CAAA;AAAA,EAChC;AAEA,EAAAA,QAAO,KAAA,EAAM;AAGb,EAAA,IAAI,CAAC,QAAQ,KAAA,EAAO;AAClB,IAAA,MAAM,SAAA,GAAY,MAAM,gBAAA,EAAiB;AACzC,IAAA,IAAI,CAAC,SAAA,EAAW;AACd,MAAAA,OAAAA,CAAO,KAAK,sBAAsB,CAAA;AAClC,MAAA;AAAA,IACF;AAAA,EACF;AAGA,EAAAA,OAAAA,CAAO,aAAa,kBAAkB,CAAA;AAEtC,EAAA,IAAI;AACF,IAAA,KAAA,MAAW,QAAQ,QAAA,EAAU;AAC3B,MAAA,IAAIE,GAAAA,CAAG,UAAA,CAAW,IAAA,CAAK,IAAI,CAAA,EAAG;AAC5B,QAAA,MAAMA,GAAAA,CAAG,MAAA,CAAO,IAAA,CAAK,IAAI,CAAA;AAAA,MAC3B;AAAA,IACF;AAGA,IAAA,IAAIA,GAAAA,CAAG,UAAA,CAAW,UAAU,CAAA,EAAG;AAC7B,MAAA,MAAM,SAAA,GAAYA,GAAAA,CAAG,WAAA,CAAY,UAAU,CAAA;AAC3C,MAAA,IAAI,SAAA,CAAU,WAAW,CAAA,EAAG;AAC1B,QAAA,MAAMA,GAAAA,CAAG,OAAO,UAAU,CAAA;AAAA,MAC5B;AAAA,IACF;AAGA,IAAA,MAAM,SAAA,GAAiBwB,KAAA,CAAA,IAAA,CAAK,YAAA,EAAc,SAAS,CAAA;AACnD,IAAA,IAAIxB,GAAAA,CAAG,UAAA,CAAW,SAAS,CAAA,EAAG;AAC5B,MAAA,MAAM,SAAA,GAAYA,GAAAA,CAAG,WAAA,CAAY,SAAS,CAAA;AAC1C,MAAA,IAAI,SAAA,CAAU,WAAW,CAAA,EAAG;AAC1B,QAAA,MAAMA,GAAAA,CAAG,OAAO,SAAS,CAAA;AAAA,MAC3B;AAAA,IACF;AAEA,IAAAF,OAAAA,CAAO,eAAe,2BAA2B,CAAA;AAEjD,IAAAA,QAAO,KAAA,EAAM;AACb,IAAAA,OAAAA,CAAO,QAAQ,8CAA8C,CAAA;AAE7D,IAAA,IAAI,QAAQ,SAAA,EAAW;AACrB,MAAAA,OAAAA,CAAO,KAAK,wCAAwC,CAAA;AAAA,IACtD;AACA,IAAA,IAAI,QAAQ,WAAA,EAAa;AACvB,MAAAA,OAAAA,CAAO,KAAK,4CAA4C,CAAA;AAAA,IAC1D;AAAA,EACF,SAAS,KAAA,EAAO;AACd,IAAAA,OAAAA,CAAO,YAAY,kBAAkB,CAAA;AACrC,IAAA,MAAM,UAAU,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,OAAA,GAAU,OAAO,KAAK,CAAA;AACrE,IAAAA,OAAAA,CAAO,MAAM,OAAO,CAAA;AACpB,IAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,EAChB;AACF;AAKA,SAAS,gBAAA,GAAqC;AAC5C,EAAA,OAAO,IAAI,OAAA,CAAQ,CAACH,SAAAA,KAAY;AAC9B,IAAA,MAAM,KAAc,QAAA,CAAA,eAAA,CAAgB;AAAA,MAClC,OAAO,OAAA,CAAQ,KAAA;AAAA,MACf,QAAQ,OAAA,CAAQ;AAAA,KACjB,CAAA;AAED,IAAA,EAAA,CAAG,QAAA,CAAS,4CAAA,EAA8C,CAAC,MAAA,KAAW;AACpE,MAAA,EAAA,CAAG,KAAA,EAAM;AACT,MAAAA,SAAAA,CAAQ,OAAO,WAAA,EAAY,KAAM,OAAO,MAAA,CAAO,WAAA,OAAkB,KAAK,CAAA;AAAA,IACxE,CAAC,CAAA;AAAA,EACH,CAAC,CAAA;AACH;AClJO,SAAS8B,aAAYC,QAAAA,EAAwB;AAClD,EAAAA,SACG,OAAA,CAAQ,MAAM,EACd,WAAA,CAAY,qCAAqC,EACjD,MAAA,CAAO,oBAAA,EAAsB,qBAAA,EAAuB,YAAY,EAChE,MAAA,CAAO,SAAA,EAAW,qCAAqC,CAAA,CACvD,MAAA,CAAO,OAAO,OAAA,KAAY;AACzB,IAAA,MAAM,WAAW,OAAA,CAAQ,QAAA;AAGzB,IAAA,IAAIC,UAAAA,CAAWC,KAAK,QAAA,EAAU,YAAY,CAAC,CAAA,IAAK,CAAC,QAAQ,KAAA,EAAO;AAC9D,MAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,mCAAA,EAAiC,QAAQ,CAAA,CAAE,CAAA;AACvD,MAAA,OAAA,CAAQ,IAAI,+BAA+B,CAAA;AAC3C,MAAA;AAAA,IACF;AAEA,IAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,qBAAA,EAAwB,QAAQ,CAAA,GAAA,CAAK,CAAA;AAEjD,IAAA,IAAI;AACF,MAAA,MAAM,MAAA,GAAS,MAAM,cAAA,CAAe,QAAQ,CAAA;AAE5C,MAAA,IAAI,OAAO,OAAA,EAAS;AAClB,QAAA,OAAA,CAAQ,IAAI,sCAAiC,CAAA;AAC7C,QAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,YAAA,EAAe,QAAQ,CAAA,WAAA,CAAa,CAAA;AAChD,QAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,YAAA,EAAe,QAAQ,CAAA,aAAA,CAAe,CAAA;AAClD,QAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,YAAA,EAAe,QAAQ,CAAA,gBAAA,CAAkB,CAAA;AACrD,QAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,YAAA,EAAe,QAAQ,CAAA,eAAA,CAAiB,CAAA;AACpD,QAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,YAAA,EAAe,QAAQ,CAAA,UAAA,CAAY,CAAA;AAC/C,QAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,YAAA,EAAe,QAAQ,CAAA,SAAA,CAAW,CAAA;AAAA,MAChD,CAAA,MAAO;AACL,QAAA,OAAA,CAAQ,KAAA,CAAM,CAAA,kCAAA,EAAgC,MAAA,CAAO,KAAK,CAAA,CAAE,CAAA;AAC5D,QAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,MAChB;AAAA,IACF,SAAS,KAAA,EAAO;AACd,MAAA,OAAA,CAAQ,KAAA,CAAM,qCAAgC,KAAA,YAAiB,KAAA,GAAQ,MAAM,OAAA,GAAU,MAAA,CAAO,KAAK,CAAC,CAAA,CAAE,CAAA;AACtG,MAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,IAChB;AAAA,EACF,CAAC,CAAA;AACL;ACzCO,SAAS,cAAcF,QAAAA,EAAwB;AACpD,EAAAA,QAAAA,CACG,OAAA,CAAQ,QAAQ,CAAA,CAChB,YAAY,qCAAqC,CAAA,CACjD,MAAA,CAAO,eAAA,EAAiB,qCAAqC,IAAI,CAAA,CACjE,MAAA,CAAO,oBAAA,EAAsB,oBAAoB,OAAA,CAAQ,GAAA,EAAK,CAAA,CAC9D,OAAO,0BAAA,EAA4B,8BAAA,EAAgC,KAAK,CAAA,CACxE,OAAO,oBAAA,EAAsB,qBAAA,EAAuB,YAAY,CAAA,CAChE,OAAO,WAAA,EAAa,mDAAmD,CAAA,CACvE,MAAA,CAAO,CAAC,OAAA,KAAY;AACnB,IAAA,IAAI;AACF,MAAA,MAAM,SAAS,mBAAA,CAAoB;AAAA,QACjC,UAAU,OAAA,CAAQ,QAAA;AAAA,QAClB,WAAW,OAAA,CAAQ,MAAA;AAAA,QACnB,aAAA,EAAe,UAAA,CAAW,OAAA,CAAQ,aAAa,CAAA;AAAA,QAC/C,gBAAA,EAAkB,IAAA;AAAA,QAClB,cAAA,EAAgB,IAAA;AAAA,QAChB,YAAA,EAAc;AAAA,OACf,CAAA;AAED,MAAA,OAAA,CAAQ,GAAA,CAAI,4BAAA,CAA6B,MAAM,CAAC,CAAA;AAEhD,MAAA,IAAI,MAAA,CAAO,KAAA,CAAM,aAAA,KAAkB,CAAA,EAAG;AACpC,QAAA,OAAA,CAAQ,IAAI,0EAAgE,CAAA;AAAA,MAC9E;AAEA,MAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,IAChB,SAAS,KAAA,EAAO;AACd,MAAA,OAAA,CAAQ,KAAA,CAAM,yBAAoB,KAAA,YAAiB,KAAA,GAAQ,MAAM,OAAA,GAAU,MAAA,CAAO,KAAK,CAAC,CAAA,CAAE,CAAA;AAC1F,MAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,IAChB;AAAA,EACF,CAAC,CAAA;AACL;AChCO,SAAS,cAAcA,QAAAA,EAAwB;AACpD,EAAAA,QAAAA,CACG,OAAA,CAAQ,QAAQ,CAAA,CAChB,YAAY,0BAA0B,CAAA,CACtC,MAAA,CAAO,oBAAA,EAAsB,qBAAA,EAAuB,YAAY,CAAA,CAChE,MAAA,CAAO,CAAC,OAAA,KAAY;AACnB,IAAA,IAAI;AACF,MAAA,MAAM,MAAA,GAAS,cAAA,CAAe,OAAA,CAAQ,QAAQ,CAAA;AAC9C,MAAA,OAAA,CAAQ,GAAA,CAAI,iBAAA,CAAkB,MAAM,CAAC,CAAA;AACrC,MAAA,OAAA,CAAQ,IAAA,CAAK,MAAA,CAAO,MAAA,KAAW,OAAA,GAAU,IAAI,CAAC,CAAA;AAAA,IAChD,SAAS,KAAA,EAAO;AACd,MAAA,OAAA,CAAQ,KAAA,CAAM,+BAA0B,KAAA,YAAiB,KAAA,GAAQ,MAAM,OAAA,GAAU,MAAA,CAAO,KAAK,CAAC,CAAA,CAAE,CAAA;AAChG,MAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,IAChB;AAAA,EACF,CAAC,CAAA;AACL;ACfO,SAAS,aAAaA,QAAAA,EAAwB;AACnD,EAAAA,QAAAA,CACG,OAAA,CAAQ,OAAO,CAAA,CACf,YAAY,sBAAsB,CAAA,CAClC,MAAA,CAAO,oBAAA,EAAsB,qBAAA,EAAuB,YAAY,CAAA,CAChE,MAAA,CAAO,CAAC,OAAA,KAAY;AACnB,IAAA,IAAI;AACF,MAAA,MAAM,KAAA,GAAQ,QAAA,CAAS,OAAA,CAAQ,QAAQ,CAAA;AACvC,MAAA,OAAA,CAAQ,GAAA,CAAI,WAAA,CAAY,KAAK,CAAC,CAAA;AAC9B,MAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,IAChB,SAAS,KAAA,EAAO;AACd,MAAA,OAAA,CAAQ,KAAA,CAAM,gCAA2B,KAAA,YAAiB,KAAA,GAAQ,MAAM,OAAA,GAAU,MAAA,CAAO,KAAK,CAAC,CAAA,CAAE,CAAA;AACjG,MAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,IAChB;AAAA,EACF,CAAC,CAAA;AACL;ACfO,SAAS,aAAaA,QAAAA,EAAwB;AACnD,EAAAA,QAAAA,CACG,OAAA,CAAQ,OAAO,CAAA,CACf,YAAY,0BAA0B,CAAA,CACtC,MAAA,CAAO,oBAAA,EAAsB,qBAAA,EAAuB,YAAY,CAAA,CAChE,MAAA,CAAO,mCAAmC,8BAAA,EAAgC,KAAK,CAAA,CAC/E,MAAA,CAAO,4BAAA,EAA8B,0BAA0B,CAAA,CAC/D,MAAA,CAAO,iCAAiC,6BAA6B,CAAA,CACrE,MAAA,CAAO,wBAAA,EAA0B,qCAAA,EAAuC,KAAK,CAAA,CAC7E,MAAA,CAAO,CAAC,OAAA,KAAY;AACnB,IAAA,IAAI;AACF,MAAA,MAAM,SAAS,KAAA,CAAM;AAAA,QACnB,UAAU,OAAA,CAAQ,QAAA;AAAA,QAClB,oBAAA,EAAsB,QAAA,CAAS,OAAA,CAAQ,oBAAA,EAAsB,EAAE,CAAA;AAAA,QAC/D,sBAAA,EAAwB,QAAQ,sBAAA,IAA0B,KAAA;AAAA,QAC1D,yBAAA,EAA2B,QAAQ,yBAAA,IAA6B,KAAA;AAAA,QAChE,YAAA,EAAc,QAAA,CAAS,OAAA,CAAQ,YAAA,EAAc,EAAE;AAAA,OAChD,CAAA;AAED,MAAA,OAAA,CAAQ,GAAA,CAAI,iBAAA,CAAkB,MAAM,CAAC,CAAA;AAErC,MAAA,IAAI,MAAA,CAAO,MAAA,CAAO,MAAA,GAAS,CAAA,EAAG;AAC5B,QAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,MAChB,CAAA,MAAO;AACL,QAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,MAChB;AAAA,IACF,SAAS,KAAA,EAAO;AACd,MAAA,OAAA,CAAQ,KAAA,CAAM,gCAA2B,KAAA,YAAiB,KAAA,GAAQ,MAAM,OAAA,GAAU,MAAA,CAAO,KAAK,CAAC,CAAA,CAAE,CAAA;AACjG,MAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,IAChB;AAAA,EACF,CAAC,CAAA;AACL;AC/BO,SAAS,aAAaA,QAAAA,EAAwB;AACnD,EAAAA,QAAAA,CACG,QAAQ,OAAO,CAAA,CACf,YAAY,sDAAsD,CAAA,CAClE,cAAA,CAAe,eAAA,EAAiB,oDAAoD,CAAA,CACpF,eAAe,gBAAA,EAAkB,wCAAwC,CAAA,CACzE,MAAA,CAAO,WAAA,EAAa,oCAAoC,EACxD,MAAA,CAAO,WAAA,EAAa,oBAAA,EAAsB,IAAI,CAAA,CAC9C,MAAA,CAAO,aAAa,iBAAiB,CAAA,CACrC,MAAA,CAAO,kBAAA,EAAoB,iCAAiC,CAAA,CAC5D,OAAO,oBAAA,EAAsB,gBAAgB,CAAA,CAC7C,MAAA,CAAO,gCAAA,EAAkC,sCAAsC,EAC/E,MAAA,CAAO,0BAAA,EAA4B,mCAAmC,CAAA,CACtE,MAAA,CAAO,oBAAA,EAAsB,uBAAuB,YAAY,CAAA,CAChE,MAAA,CAAO,CAAC,OAAA,KAAY;AACnB,IAAA,IAAI;AAEF,MAAA,MAAM,UAAA,GAAa,CAAC,SAAA,EAAW,WAAA,EAAa,QAAQ,CAAA;AACpD,MAAA,IAAI,CAAC,UAAA,CAAW,QAAA,CAAS,OAAA,CAAQ,IAAI,CAAA,EAAG;AACtC,QAAA,OAAA,CAAQ,KAAA,CAAM,wBAAmB,OAAA,CAAQ,IAAI,qBAAqB,UAAA,CAAW,IAAA,CAAK,IAAI,CAAC,CAAA,CAAE,CAAA;AACzF,QAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,MAChB;AAGA,MAAA,MAAM,OAAA,GAAU,OAAA,CAAQ,OAAA,GAAU,KAAA,GAAQ,IAAA;AAE1C,MAAA,MAAM,SAAS,eAAA,CAAgB;AAAA,QAC7B,MAAM,OAAA,CAAQ,IAAA;AAAA,QACd,WAAW,OAAA,CAAQ,OAAA;AAAA,QACnB,IAAI,OAAA,CAAQ,EAAA;AAAA,QACZ,OAAA;AAAA,QACA,SAAS,OAAA,CAAQ,OAAA;AAAA,QACjB,UAAU,OAAA,CAAQ,QAAA;AAAA,QAClB,kBAAkB,OAAA,CAAQ,gBAAA;AAAA,QAC1B,eAAe,OAAA,CAAQ,aAAA;AAAA,QACvB,UAAU,OAAA,CAAQ;AAAA,OACnB,CAAA;AAED,MAAA,OAAA,CAAQ,GAAA,CAAI,iBAAA,CAAkB,MAAM,CAAC,CAAA;AAErC,MAAA,IAAI,CAAC,OAAO,OAAA,EAAS;AACnB,QAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,MAChB;AAEA,MAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,IAChB,SAAS,KAAA,EAAO;AACd,MAAA,OAAA,CAAQ,KAAA,CAAM,gCAA2B,KAAA,YAAiB,KAAA,GAAQ,MAAM,OAAA,GAAU,MAAA,CAAO,KAAK,CAAC,CAAA,CAAE,CAAA;AACjG,MAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,IAChB;AAAA,EACF,CAAC,CAAA;AACL;AClDO,SAAS,oBAAoBA,QAAAA,EAAwB;AAC1D,EAAAA,QAAAA,CACG,QAAQ,eAAe,CAAA,CACvB,YAAY,qCAAqC,CAAA,CACjD,cAAA,CAAe,oBAAA,EAAsB,iCAAiC,CAAA,CACtE,OAAO,oBAAA,EAAsB,qBAAA,EAAuB,YAAY,CAAA,CAChE,MAAA,CAAO,qBAAA,EAAuB,yBAAyB,WAAW,CAAA,CAClE,MAAA,CAAO,CAAC,OAAA,KAAY;AACnB,IAAA,IAAI;AACF,MAAA,MAAM,SAAS,eAAA,CAAgB;AAAA,QAC7B,UAAU,OAAA,CAAQ,QAAA;AAAA,QAClB,UAAU,OAAA,CAAQ,QAAA;AAAA,QAClB,SAAS,OAAA,CAAQ;AAAA,OAClB,CAAA;AAED,MAAA,OAAA,CAAQ,GAAA,CAAI,wBAAA,CAAyB,MAAM,CAAC,CAAA;AAE5C,MAAA,IAAI,MAAA,CAAO,OAAA,CAAQ,QAAA,GAAW,CAAA,EAAG;AAC/B,QAAA,OAAA,CAAQ,GAAA,CAAI;AAAA,kDAAA,EAAgD,OAAA,CAAQ,QAAQ,CAAA,qBAAA,CAAuB,CAAA;AAAA,MACrG;AAEA,MAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,IAChB,SAAS,KAAA,EAAO;AACd,MAAA,OAAA,CAAQ,KAAA,CAAM,gCAA2B,KAAA,YAAiB,KAAA,GAAQ,MAAM,OAAA,GAAU,MAAA,CAAO,KAAK,CAAC,CAAA,CAAE,CAAA;AACjG,MAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,IAChB;AAAA,EACF,CAAC,CAAA;AACL;AC3BO,SAAS,kBAAkBA,QAAAA,EAAwB;AACxD,EAAAA,QAAAA,CACG,QAAQ,aAAa,CAAA,CACrB,YAAY,qDAAqD,CAAA,CACjE,cAAA,CAAe,eAAA,EAAiB,iCAAiC,CAAA,CACjE,OAAO,oBAAA,EAAsB,qBAAA,EAAuB,YAAY,CAAA,CAChE,MAAA,CAAO,aAAa,8BAA8B,CAAA,CAClD,MAAA,CAAO,CAAC,OAAA,KAAY;AACnB,IAAA,IAAI;AACF,MAAA,MAAM,SAAS,aAAA,CAAc;AAAA,QAC3B,UAAU,OAAA,CAAQ,IAAA;AAAA,QAClB,UAAU,OAAA,CAAQ,QAAA;AAAA,QAClB,MAAA,EAAQ,QAAQ,MAAA,IAAU;AAAA,OAC3B,CAAA;AAED,MAAA,OAAA,CAAQ,GAAA,CAAI,sBAAA,CAAuB,MAAM,CAAC,CAAA;AAE1C,MAAA,IAAI,CAAC,OAAO,OAAA,EAAS;AACnB,QAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,MAChB;AAEA,MAAA,IAAI,MAAA,CAAO,MAAA,IAAU,MAAA,CAAO,QAAA,EAAU;AACpC,QAAA,OAAA,CAAQ,IAAI,oDAA6C,CAAA;AAAA,MAC3D;AAEA,MAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,IAChB,SAAS,KAAA,EAAO;AACd,MAAA,OAAA,CAAQ,KAAA,CAAM,8BAAyB,KAAA,YAAiB,KAAA,GAAQ,MAAM,OAAA,GAAU,MAAA,CAAO,KAAK,CAAC,CAAA,CAAE,CAAA;AAC/F,MAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,IAChB;AAAA,EACF,CAAC,CAAA;AACL;AC/BO,SAAS,mBAAmBA,QAAAA,EAAwB;AACzD,EAAAA,QAAAA,CACG,OAAA,CAAQ,cAAc,CAAA,CACtB,WAAA,CAAY,4DAA4D,CAAA,CACxE,cAAA,CAAe,oBAAA,EAAsB,iCAAiC,CAAA,CACtE,MAAA,CAAO,oBAAA,EAAsB,qBAAA,EAAuB,YAAY,CAAA,CAChE,MAAA,CAAO,qBAAA,EAAuB,uBAAA,EAAyB,WAAW,CAAA,CAClE,MAAA,CAAO,WAAA,EAAa,8BAA8B,CAAA,CAClD,MAAA,CAAO,CAAC,OAAA,KAAY;AACnB,IAAA,IAAI;AACF,MAAA,MAAM,SAAS,cAAA,CAAe;AAAA,QAC5B,UAAU,OAAA,CAAQ,QAAA;AAAA,QAClB,UAAU,OAAA,CAAQ,QAAA;AAAA,QAClB,SAAS,OAAA,CAAQ,OAAA;AAAA,QACjB,MAAA,EAAQ,QAAQ,MAAA,IAAU;AAAA,OAC3B,CAAA;AAED,MAAA,OAAA,CAAQ,GAAA,CAAI,uBAAA,CAAwB,MAAM,CAAC,CAAA;AAE3C,MAAA,IAAI,MAAA,CAAO,OAAA,CAAQ,MAAA,GAAS,CAAA,EAAG;AAC7B,QAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,MAChB;AAEA,MAAA,IAAI,OAAA,CAAQ,MAAA,IAAU,MAAA,CAAO,OAAA,CAAQ,UAAU,CAAA,EAAG;AAChD,QAAA,OAAA,CAAQ,IAAI,oDAA6C,CAAA;AAAA,MAC3D;AAEA,MAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,IAChB,SAAS,KAAA,EAAO;AACd,MAAA,OAAA,CAAQ,KAAA,CAAM,+BAA0B,KAAA,YAAiB,KAAA,GAAQ,MAAM,OAAA,GAAU,MAAA,CAAO,KAAK,CAAC,CAAA,CAAE,CAAA;AAChG,MAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,IAChB;AAAA,EACF,CAAC,CAAA;AACL;;;ACtBO,SAAS,YAAYA,QAAAA,EAA2B;AACrD,EAAA,MAAM,OAAOA,QAAAA,CACV,OAAA,CAAQ,MAAM,CAAA,CACd,YAAY,kDAAkD,CAAA;AAGjE,EAAAD,aAAY,IAAI,CAAA;AAChB,EAAA,aAAA,CAAc,IAAI,CAAA;AAClB,EAAA,aAAA,CAAc,IAAI,CAAA;AAClB,EAAA,YAAA,CAAa,IAAI,CAAA;AACjB,EAAA,YAAA,CAAa,IAAI,CAAA;AACjB,EAAA,YAAA,CAAa,IAAI,CAAA;AACjB,EAAA,mBAAA,CAAoB,IAAI,CAAA;AACxB,EAAA,iBAAA,CAAkB,IAAI,CAAA;AACtB,EAAA,kBAAA,CAAmB,IAAI,CAAA;AAEvB,EAAA,OAAO,IAAA;AACT;;;AC7BA,WAAA,EAAA;AACA,qBAAA,EAAA;AA2BO,SAAS,aAAA,CAAc,IAAY,OAAA,EAA0C;AAClF,EAAA,MAAM,WAAA,GAAmBI,KAAA,CAAA,OAAA,CAAQ,OAAA,CAAQ,WAAW,CAAA;AAGpD,EAAA,MAAM,GAAA,GAAM,iBAAiB,EAAE,CAAA;AAC/B,EAAA,IAAI,GAAA,CAAI,WAAW,CAAA,EAAG;AACpB,IAAA,OAAO;AAAA,MACL,KAAA,EAAO,KAAA;AAAA,MACP,UAAU,CAAC;AAAA,QACT,IAAI,EAAA,IAAM,SAAA;AAAA,QACV,KAAA,EAAO,KAAA;AAAA,QACP,KAAA,EAAO,KAAA;AAAA,QACP,MAAA,EAAQ,CAAC,0EAA0E,CAAA;AAAA,QACnF,UAAU;AAAC,OACZ;AAAA,KACH;AAAA,EACF;AAGA,EAAA,MAAM,YAAA,GAAe,gBAAA,CAAiB,WAAA,EAAa,GAAG,CAAA;AAEtD,EAAA,MAAM,UAAsC,EAAC;AAC7C,EAAA,IAAI,QAAA,GAAW,IAAA;AAEf,EAAA,KAAA,MAAW,aAAa,GAAA,EAAK;AAC3B,IAAA,MAAM,WAAA,GAAc,YAAA,CAAa,GAAA,CAAI,SAAS,CAAA;AAE9C,IAAA,IAAI,CAAC,WAAA,EAAa;AAChB,MAAA,OAAA,CAAQ,IAAA,CAAK;AAAA,QACX,EAAA,EAAI,SAAA;AAAA,QACJ,KAAA,EAAO,KAAA;AAAA,QACP,KAAA,EAAO,KAAA;AAAA,QACP,MAAA,EAAQ,CAAC,wBAAwB,CAAA;AAAA,QACjC,UAAU;AAAC,OACZ,CAAA;AACD,MAAA,QAAA,GAAW,KAAA;AACX,MAAA;AAAA,IACF;AAEA,IAAA,MAAM,OAAA,GAAU,WAAA,CAAY,WAAA,EAAa,WAAW,CAAA;AACpD,IAAA,IAAI,CAAC,OAAA,EAAS;AACZ,MAAA,OAAA,CAAQ,IAAA,CAAK;AAAA,QACX,EAAA,EAAI,SAAA;AAAA,QACJ,KAAA,EAAO,IAAA;AAAA,QACP,KAAA,EAAO,KAAA;AAAA,QACP,MAAA,EAAQ,CAAC,8BAA8B,CAAA;AAAA,QACvC,UAAU;AAAC,OACZ,CAAA;AACD,MAAA,QAAA,GAAW,KAAA;AACX,MAAA;AAAA,IACF;AAEA,IAAA,MAAM,UAAA,GAAa,iCAAiC,OAAO,CAAA;AAC3D,IAAA,OAAA,CAAQ,IAAA,CAAK;AAAA,MACX,EAAA,EAAI,SAAA;AAAA,MACJ,KAAA,EAAO,IAAA;AAAA,MACP,OAAO,UAAA,CAAW,KAAA;AAAA,MAClB,QAAQ,UAAA,CAAW,MAAA;AAAA,MACnB,UAAU,UAAA,CAAW;AAAA,KACtB,CAAA;AAED,IAAA,IAAI,CAAC,WAAW,KAAA,EAAO;AACrB,MAAA,QAAA,GAAW,KAAA;AAAA,IACb;AAAA,EACF;AAEA,EAAA,OAAO,EAAE,KAAA,EAAO,QAAA,EAAU,QAAA,EAAU,OAAA,EAAQ;AAC9C;AAKA,eAAsB,eAAA,CAAgB,IAAY,OAAA,EAA2C;AAC3F,EAAA,MAAM/B,OAAAA,GAAS,IAAI,MAAA,EAAO;AAC1B,EAAA,MAAM,MAAA,GAAS,aAAA,CAAc,EAAA,EAAI,OAAO,CAAA;AAGxC,EAAA,IAAI,QAAQ,IAAA,EAAM;AAChB,IAAA,OAAA,CAAQ,IAAI,IAAA,CAAK,SAAA,CAAU,MAAA,EAAQ,IAAA,EAAM,CAAC,CAAC,CAAA;AAAA,EAC7C,CAAA,MAAO;AACL,IAAAA,OAAAA,CAAO,OAAO,oBAAoB,CAAA;AAElC,IAAA,KAAA,MAAW,OAAA,IAAW,OAAO,QAAA,EAAU;AACrC,MAAA,IAAI,QAAQ,KAAA,EAAO;AACjB,QAAAA,OAAAA,CAAO,OAAA,CAAQ,CAAA,EAAG,OAAA,CAAQ,EAAE,CAAA,0BAAA,CAA4B,CAAA;AAAA,MAC1D,CAAA,MAAA,IAAW,CAAC,OAAA,CAAQ,KAAA,EAAO;AACzB,QAAAA,OAAAA,CAAO,KAAA,CAAM,CAAA,EAAG,OAAA,CAAQ,EAAE,CAAA,WAAA,CAAa,CAAA;AAAA,MACzC,CAAA,MAAO;AACL,QAAAA,OAAAA,CAAO,KAAA,CAAM,CAAA,EAAG,OAAA,CAAQ,EAAE,CAAA,WAAA,CAAa,CAAA;AACvC,QAAA,KAAA,MAAW,GAAA,IAAO,QAAQ,MAAA,EAAQ;AAChC,UAAAA,OAAAA,CAAO,IAAA,CAAK,CAAA,IAAA,EAAO,GAAG,CAAA,CAAE,CAAA;AAAA,QAC1B;AAAA,MACF;AAEA,MAAA,KAAA,MAAW,IAAA,IAAQ,QAAQ,QAAA,EAAU;AACnC,QAAAA,OAAAA,CAAO,OAAA,CAAQ,CAAA,IAAA,EAAO,IAAI,CAAA,CAAE,CAAA;AAAA,MAC9B;AAAA,IACF;AAEA,IAAAA,QAAO,KAAA,EAAM;AACb,IAAA,IAAI,OAAO,KAAA,EAAO;AAChB,MAAAA,OAAAA,CAAO,QAAQ,2CAA2C,CAAA;AAAA,IAC5D,CAAA,MAAO;AACL,MAAAA,OAAAA,CAAO,MAAM,6BAA6B,CAAA;AAAA,IAC5C;AAAA,EACF;AAEA,EAAA,OAAO,MAAA,CAAO,QAAQ,CAAA,GAAI,CAAA;AAC5B;;;ACtIA,WAAA,EAAA;AAEA,sBAAA,EAAA;AAmEA,eAAsB,gBAAA,CAAiB,KAAa,OAAA,EAAmD;AACrG,EAAA,MAAMA,OAAAA,GAAS,IAAI,MAAA,EAAO;AAC1B,EAAA,MAAM,WAAA,GAAmBgC,KAAA,CAAA,OAAA,CAAQ,OAAA,CAAQ,WAAW,CAAA;AACpD,EAAA,MAAM,WAAA,GAAc,QAAQ,GAAA,EAAI;AAChC,EAAA,MAAM,QAAA,GAAgBA,KAAA,CAAA,IAAA,CAAK,WAAA,EAAa,OAAA,EAAS,MAAM,CAAA;AAEvD,EAAA,MAAM,GAAA,GAAuB;AAAA,IAC3B,WAAA;AAAA,IACA,WAAA;AAAA,IACA,QAAA;AAAA,IACA,MAAA,EAAQ,QAAQ,MAAA,IAAU,KAE5B,CAAA;AAEA,EAAA,MAAM,gBAAA,GAAqC;AAAA,IACzC,UAAA,EAAY,GAAA;AAAA,IACZ,WAAW,OAAA,CAAQ,SAAA;AAAA,IACnB,cAAc,OAAA,CAAQ,YAAA;AAAA,IACtB,QAAQ,OAAA,CAAQ,MAAA;AAAA,IAChB,SAAS,OAAA,CAAQ;AAAA,GACnB;AAGA,EAAA,MAAM,UAAA,GAAa,kBAAA,CAAmB,GAAA,EAAK,gBAAgB,CAAA;AAE3D,EAAA,IAAI,CAAC,WAAW,OAAA,EAAS;AACvB,IAAAhC,OAAAA,CAAO,MAAM,sCAAsC,CAAA;AACnD,IAAAA,OAAAA,CAAO,KAAA,CAAM,UAAA,CAAW,KAAA,IAAS,eAAe,CAAA;AAChD,IAAA,OAAO,CAAA;AAAA,EACT;AAEA,EAAA,MAAM,OAAO,UAAA,CAAW,IAAA;AAGxB,EAAA,IAAI,QAAQ,MAAA,EAAQ;AAClB,IAAA,OAAA,CAAQ,GAAA,CAAI,mBAAA,CAAoB,IAAI,CAAC,CAAA;AACrC,IAAA,OAAA,CAAQ,IAAI,4CAA4C,CAAA;AACxD,IAAA,OAAA,CAAQ,IAAI,iDAAiD,CAAA;AAC7D,IAAA,OAAO,CAAA;AAAA,EACT;AAGA,EAAAA,OAAAA,CAAO,OAAO,wBAAwB,CAAA;AACtC,EAAAA,QAAO,IAAA,CAAK,CAAA,aAAA,EAAgB,IAAA,CAAK,QAAA,CAAS,MAAM,CAAA,cAAA,CAAgB,CAAA;AAChE,EAAAA,OAAAA,CAAO,IAAA,CAAK,CAAA,aAAA,EAAgB,IAAA,CAAK,WAAW,CAAA,CAAE,CAAA;AAC9C,EAAAA,OAAAA,CAAO,IAAA,CAAK,CAAA,YAAA,EAAe,IAAA,CAAK,SAAS,CAAA,CAAE,CAAA;AAC3C,EAAAA,OAAAA,CAAO,IAAA,CAAK,CAAA,eAAA,EAAkB,IAAA,CAAK,YAAY,CAAA,CAAE,CAAA;AACjD,EAAAA,QAAO,KAAA,EAAM;AAGb,EAAA,KAAA,MAAW,IAAA,IAAQ,KAAK,QAAA,EAAU;AAChC,IAAAA,OAAAA,CAAO,QAAQ,IAAI,CAAA;AAAA,EACrB;AAEA,EAAA,MAAM,MAAA,GAAS,MAAM,qBAAA,CAAsB,GAAA,EAAK,MAAM,EAAE,OAAA,EAAS,OAAA,CAAQ,OAAA,EAAS,CAAA;AAElF,EAAA,IAAI,CAAC,OAAO,OAAA,EAAS;AACnB,IAAAA,OAAAA,CAAO,MAAM,wBAAwB,CAAA;AACrC,IAAAA,OAAAA,CAAO,KAAA,CAAM,MAAA,CAAO,KAAA,IAAS,eAAe,CAAA;AAG5C,IAAA,IAAI,MAAA,CAAO,MAAM,YAAA,EAAc;AAC7B,MAAA,MAAMiC,MAAAA,GAAQ,OAAO,IAAA,CAAK,YAAA;AAC1B,MAAAjC,QAAO,KAAA,EAAM;AACb,MAAAA,OAAAA,CAAO,KAAK,CAAA,WAAA,EAAciC,MAAAA,CAAM,kBAAkB,MAAM,CAAA,CAAA,EAAIA,MAAAA,CAAM,aAAa,CAAA,CAAE,CAAA;AACjF,MAAAjC,QAAO,IAAA,CAAK,CAAA,WAAA,EAAciC,MAAAA,CAAM,gBAAA,IAAoB,SAAS,CAAA,CAAE,CAAA;AAAA,IACjE;AAEA,IAAA,OAAO,CAAA;AAAA,EACT;AAEA,EAAAjC,QAAO,KAAA,EAAM;AACb,EAAAA,OAAAA,CAAO,QAAQ,0BAA0B,CAAA;AACzC,EAAAA,OAAAA,CAAO,KAAK,kBAAkB,CAAA;AAC9B,EAAA,KAAA,MAAW,IAAA,IAAQ,MAAA,CAAO,IAAA,CAAM,cAAA,EAAgB;AAC9C,IAAAA,OAAAA,CAAO,IAAA,CAAK,CAAA,IAAA,EAAO,IAAI,CAAA,CAAE,CAAA;AAAA,EAC3B;AAGA,EAAA,MAAM,KAAA,GAAQ,OAAO,IAAA,CAAM,YAAA;AAC3B,EAAAA,QAAO,KAAA,EAAM;AACb,EAAAA,OAAAA,CAAO,KAAK,CAAA,gBAAA,CAAkB,CAAA;AAC9B,EAAAA,OAAAA,CAAO,IAAA,CAAK,CAAA,kBAAA,EAAqB,KAAA,CAAM,eAAe,CAAA,CAAE,CAAA;AACxD,EAAAA,OAAAA,CAAO,IAAA,CAAK,CAAA,cAAA,EAAA,CAAA,CAAmB,KAAA,CAAM,OAAA,GAAW,KAAA,CAAM,SAAA,IAAa,GAAA,EAAM,OAAA,CAAQ,CAAC,CAAC,CAAA,CAAA,CAAG,CAAA;AAEtF,EAAAA,QAAO,KAAA,EAAM;AACb,EAAAA,OAAAA,CAAO,KAAK,aAAa,CAAA;AACzB,EAAAA,OAAAA,CAAO,IAAA,CAAK,kCAAA,GAAqC,GAAG,CAAA;AACpD,EAAAA,OAAAA,CAAO,KAAK,wCAAA,GAA2C,GAAA,CAAI,MAAM,GAAG,CAAA,CAAE,CAAC,CAAA,GAAI,GAAG,CAAA;AAE9E,EAAA,OAAO,CAAA;AACT;;;AChKO,SAAS,eAAe4B,QAAAA,EAAwB;AACrD,EAAA,MAAM,UAAUA,QAAAA,CACb,OAAA,CAAQ,SAAS,CAAA,CACjB,YAAY,gDAAgD,CAAA;AAE/D,EAAA,OAAA,CACG,QAAQ,eAAe,CAAA,CACvB,YAAY,gDAAgD,CAAA,CAC5D,OAAO,uBAAA,EAAyB,4BAAA,EAA8B,UAAU,CAAA,CACxE,OAAO,QAAA,EAAU,gBAAgB,EACjC,MAAA,CAAO,OAAO,IAAY,OAAA,KAAY;AACrC,IAAA,MAAM,QAAA,GAAW,MAAM,eAAA,CAAgB,EAAA,EAAI,OAAO,CAAA;AAClD,IAAA,OAAA,CAAQ,QAAA,GAAW,QAAA;AAAA,EACrB,CAAC,CAAA;AAEH,EAAA,OAAA,CACG,OAAA,CAAQ,iBAAiB,CAAA,CACzB,WAAA,CAAY,+BAA+B,CAAA,CAC3C,MAAA,CAAO,uBAAA,EAAyB,4BAAA,EAA8B,UAAU,CAAA,CACxE,MAAA,CAAO,qBAAA,EAAuB,sCAAsC,QAAQ,CAAA,CAC5E,MAAA,CAAO,wBAAA,EAA0B,uCAAA,EAAyC,QAAQ,CAAA,CAClF,MAAA,CAAO,aAAa,2CAA2C,CAAA,CAC/D,MAAA,CAAO,WAAA,EAAa,sBAAsB,CAAA,CAC1C,MAAA,CAAO,OAAO,KAAa,OAAA,KAAY;AACtC,IAAA,MAAM,QAAA,GAAW,MAAM,gBAAA,CAAiB,GAAA,EAAK,OAAO,CAAA;AACpD,IAAA,OAAA,CAAQ,QAAA,GAAW,QAAA;AAAA,EACrB,CAAC,CAAA;AAEH,EAAA,OAAA,CACG,QAAQ,YAAY,CAAA,CACpB,WAAA,CAAY,uCAAuC,EACnD,MAAA,CAAO,uBAAA,EAAyB,4BAAA,EAA8B,UAAU,EACxE,MAAA,CAAO,QAAA,EAAU,gBAAgB,CAAA,CACjC,MAAA,CAAO,OAAO,OAAA,KAAY;AACzB,IAAA,MAAM,EAAE,gBAAA,EAAAM,iBAAAA,EAAiB,GAAI,MAAM,OAAA,CAAA,OAAA,EAAA,CAAA,IAAA,CAAA,OAAA,eAAA,EAAA,EAAA,kBAAA,CAAA,CAAA;AACnC,IAAA,MAAM,QAAA,GAAW,MAAMA,iBAAAA,CAAiB,OAAO,CAAA;AAC/C,IAAA,OAAA,CAAQ,QAAA,GAAW,QAAA;AAAA,EACrB,CAAC,CAAA;AACL;;;AChCA,IAAM,UAAU,UAAA,EAAW;AAE3B,OAAA,CACG,IAAA,CAAK,MAAM,CAAA,CACX,WAAA,CAAY,wGAAwG,CAAA,CACpH,OAAA,CAAQ,OAAA,EAAS,eAAA,EAAiB,4BAA4B,CAAA;AAEjE,OAAA,CACG,OAAA,CAAQ,aAAa,CAAA,CACrB,WAAA,CAAY,8BAA8B,CAAA,CAC1C,MAAA,CAAO,YAAA,EAAc,kBAAkB,EACvC,MAAA,CAAO,iBAAA,EAAmB,2BAA2B,CAAA,CACrD,OAAO,aAAA,EAAe,iCAAiC,CAAA,CACvD,MAAA,CAAO,kBAAA,EAAoB,gFAAA,EAAkF,MAAM,CAAA,CACnH,OAAO,cAAA,EAAgB,4BAA4B,CAAA,CACnD,MAAA,CAAO,aAAa,sBAAsB,CAAA,CAC1C,MAAA,CAAO,OAAO,YAAoB,OAAA,KAAY;AAC7C,EAAA,MAAM,WAAA,CAAY,YAAY,OAAO,CAAA;AACvC,CAAC,CAAA;AAEH,OAAA,CACG,QAAQ,gBAAgB,CAAA,CACxB,WAAA,CAAY,gDAAgD,EAC5D,MAAA,CAAO,SAAA,EAAW,oCAAoC,CAAA,CACtD,OAAO,aAAA,EAAe,sCAAsC,EAC5D,MAAA,CAAO,OAAO,YAAgC,OAAA,KAAY;AACzD,EAAA,MAAM,cAAA,CAAe,UAAA,IAAc,GAAA,EAAK,OAAO,CAAA;AACjD,CAAC,CAAA;AAEH,OAAA,CACG,OAAA,CAAQ,OAAO,CAAA,CACf,WAAA,CAAY,+CAA+C,CAAA,CAC3D,MAAA,CAAO,OAAA,EAAS,qCAAqC,CAAA,CACrD,MAAA,CAAO,OAAO,OAAA,KAAY;AACzB,EAAA,MAAM,aAAoB,CAAA;AAC5B,CAAC,CAAA;AAEH,OAAA,CACG,QAAQ,eAAe,CAAA,CACvB,WAAA,CAAY,wDAAwD,EACpE,MAAA,CAAO,OAAA,EAAS,qCAAqC,CAAA,CACrD,OAAO,WAAA,EAAa,iCAAiC,EACrD,MAAA,CAAO,OAAO,YAAgC,OAAA,KAAY;AACzD,EAAA,MAAM,aAAA,CAAc,UAAA,IAAc,GAAA,EAAK,OAAO,CAAA;AAChD,CAAC,CAAA;AAEH,OAAA,CACG,OAAA,CAAQ,kBAAkB,CAAA,CAC1B,WAAA,CAAY,4BAA4B,CAAA,CACxC,MAAA,CAAO,gBAAgB,8BAA8B,CAAA,CACrD,OAAO,gBAAA,EAAkB,qCAAqC,EAC9D,MAAA,CAAO,aAAA,EAAe,0BAA0B,CAAA,CAChD,MAAA,CAAO,OAAO,UAAA,EAAoB,OAAA,KAAY;AAC7C,EAAA,MAAM,gBAAA,CAAiB,YAAY,OAAO,CAAA;AAC5C,CAAC,CAAA;AAGH,WAAA,CAAY,OAAO,CAAA;AAGnB,cAAA,CAAe,OAAO,CAAA;AAGtB,OAAA,CAAQ,mBAAmB,yCAAyC,CAAA;AAGpE,OAAA,CAAQ,KAAA,EAAM","file":"cli.js","sourcesContent":["/**\n * Logger - Colorful console output utilities\n */\n\nimport chalk from 'chalk';\nimport ora, { type Ora } from 'ora';\n\nexport class Logger {\n  private spinner: Ora | null = null;\n  private verbose: boolean;\n\n  constructor(options: { verbose?: boolean } = {}) {\n    this.verbose = options.verbose ?? false;\n  }\n\n  header(text: string): void {\n    console.log('');\n    console.log(chalk.green('' + ''.repeat(text.length + 6) + ''));\n    console.log(chalk.green('   ') + chalk.bold.green(text) + chalk.green('   '));\n    console.log(chalk.green('' + ''.repeat(text.length + 6) + ''));\n    console.log('');\n  }\n\n  step(current: number, total: number, message: string): void {\n    this.stopSpinner();\n    console.log(chalk.yellow(`[${current}/${total}]`) + ' ' + message);\n  }\n\n  startSpinner(message: string): void {\n    this.stopSpinner();\n    this.spinner = ora(message).start();\n  }\n\n  updateSpinner(message: string): void {\n    if (this.spinner) {\n      this.spinner.text = message;\n    }\n  }\n\n  succeedSpinner(message?: string): void {\n    if (this.spinner) {\n      this.spinner.succeed(message);\n      this.spinner = null;\n    }\n  }\n\n  failSpinner(message?: string): void {\n    if (this.spinner) {\n      this.spinner.fail(message);\n      this.spinner = null;\n    }\n  }\n\n  stopSpinner(): void {\n    if (this.spinner) {\n      this.spinner.stop();\n      this.spinner = null;\n    }\n  }\n\n  info(message: string): void {\n    console.log(chalk.cyan('') + ' ' + message);\n  }\n\n  success(message: string): void {\n    console.log(chalk.green('') + ' ' + message);\n  }\n\n  warning(message: string): void {\n    console.log(chalk.yellow('') + ' ' + chalk.yellow(message));\n  }\n\n  error(message: string): void {\n    console.log(chalk.red('') + ' ' + chalk.red(message));\n  }\n\n  debug(message: string): void {\n    if (this.verbose) {\n      console.log(chalk.gray('  ' + message));\n    }\n  }\n\n  list(items: string[], indent: number = 2): void {\n    const prefix = ' '.repeat(indent);\n    for (const item of items) {\n      console.log(prefix + chalk.dim('') + ' ' + item);\n    }\n  }\n\n  table(rows: Array<{ label: string; value: string }>): void {\n    const maxLabelLength = Math.max(...rows.map((r) => r.label.length));\n    for (const row of rows) {\n      const paddedLabel = row.label.padEnd(maxLabelLength);\n      console.log('  ' + chalk.dim(paddedLabel) + '  ' + row.value);\n    }\n  }\n\n  nextSteps(steps: string[]): void {\n    console.log('');\n    console.log(chalk.cyan('Next steps:'));\n    steps.forEach((step, i) => {\n      console.log(chalk.dim(`  ${i + 1}.`) + ' ' + step);\n    });\n    console.log('');\n  }\n\n  blank(): void {\n    console.log('');\n  }\n\n  divider(): void {\n    console.log(chalk.dim(''.repeat(50)));\n  }\n}\n\n// Singleton instance for simple usage\nexport const logger = new Logger();\n","/**\n * Workflow types - Simple, testable workflow definitions\n *\n * Schema version: 1.0.0\n */\n\nimport { z } from 'zod';\n\n// Environment types\nexport type ExecutionEnvironment = 'vscode-local' | 'github-web' | 'cli-terminal' | 'ci-pipeline' | 'unknown';\n\n// Batch mode - only serial is currently implemented\nexport type BatchMode = 'serial' | 'parallel';  // Full type for future\nexport type ImplementedBatchMode = 'serial';     // What's actually available now\n\n// Learning modes\nexport type LearningMode = 'strict' | 'batch' | 'none';\n\n// Journey status schema\nexport const JourneyStatusSchema = z.enum([\n  'proposed',\n  'defined',\n  'clarified',\n  'implemented',\n  'quarantined',\n  'deprecated'\n]);\n\nexport type JourneyStatus = z.infer<typeof JourneyStatusSchema>;\n\n// Journey frontmatter schema (for validation)\nexport const JourneyFrontmatterSchema = z.object({\n  id: z.string().regex(/^JRN-\\d{4}$/, 'Journey ID must match JRN-XXXX pattern'),\n  title: z.string().min(1, 'Title is required'),\n  status: JourneyStatusSchema,\n  tests: z.array(z.string()).optional().default([]),\n  tier: z.enum(['smoke', 'release', 'regression']).optional(),\n  actor: z.string().optional(),\n  scope: z.string().optional(),\n}).passthrough(); // Allow additional fields\n\nexport type JourneyFrontmatter = z.infer<typeof JourneyFrontmatterSchema>;\n\n// Workflow context\nexport interface WorkflowContext {\n  projectRoot: string;\n  harnessRoot: string;\n  llkbRoot: string;\n  dryRun: boolean;\n  environment: ExecutionEnvironment;\n}\n\n// Journey info\nexport interface JourneyInfo {\n  id: string;\n  path: string;\n  status: JourneyStatus;\n  title: string;\n  tests: string[];\n}\n\n// Session state (tracks progress across journeys)\nexport interface SessionState {\n  // Session metadata\n  sessionId: string;\n  schemaVersion: string;\n  savedAt?: string;\n\n  // Journey tracking\n  journeysRequested: string[];\n  journeysCompleted: string[];\n  journeysFailed: string[];\n  currentJourneyIndex: number;\n  totalJourneys: number;\n\n  // Execution modes (only serial implemented)\n  batchMode: ImplementedBatchMode;\n  learningMode: LearningMode;\n\n  // LLKB tracking\n  llkbExportCount: number;\n  llkbSkippedExports: number;\n  lastLlkbExportTime: number;\n\n  // Timing\n  startTime: number;\n  endTime?: number;\n\n  // Per-journey state (reset between journeys)\n  currentJourneyId: string | null;\n  verificationPassed: boolean;\n  testsGenerated: string[];\n}\n\n// Validation result\nexport interface ValidationResult {\n  valid: boolean;\n  errors: string[];\n  warnings: string[];\n}\n\n// Workflow result\nexport interface WorkflowResult<T = unknown> {\n  success: boolean;\n  data?: T;\n  error?: string;\n  warnings?: string[];\n}\n\n// LLKB config schema\nexport const LLKBConfigSchema = z.object({\n  enabled: z.boolean(),\n  version: z.string().optional(),\n  minConfidence: z.number().min(0).max(1).optional(),\n}).passthrough();\n\nexport type LLKBConfig = z.infer<typeof LLKBConfigSchema>;\n\n// Batch limits\nexport const BATCH_LIMITS = {\n  SOFT_LIMIT: 10,\n  HARD_LIMIT: 50,\n} as const;\n\n// Default timeout for commands (5 minutes)\nexport const DEFAULT_COMMAND_TIMEOUT_MS = 5 * 60 * 1000;\n\n// Session schema version\nexport const SESSION_SCHEMA_VERSION = '1.0.0';\n\n// Generate a simple session ID\nfunction generateSessionId(): string {\n  const timestamp = Date.now().toString(36);\n  const random = Math.random().toString(36).substring(2, 8);\n  return `sess_${timestamp}_${random}`;\n}\n\n// Create initial session state\nexport function createSessionState(\n  journeyIds: string[],\n  batchMode: ImplementedBatchMode,\n  learningMode: LearningMode\n): SessionState {\n  return {\n    sessionId: generateSessionId(),\n    schemaVersion: SESSION_SCHEMA_VERSION,\n    journeysRequested: journeyIds,\n    journeysCompleted: [],\n    journeysFailed: [],\n    currentJourneyIndex: 0,\n    totalJourneys: journeyIds.length,\n    batchMode,\n    learningMode,\n    llkbExportCount: 0,\n    llkbSkippedExports: 0,\n    lastLlkbExportTime: 0,\n    startTime: Date.now(),\n    currentJourneyId: null,\n    verificationPassed: false,\n    testsGenerated: [],\n  };\n}\n","/**\n * Journey Validation Logic\n *\n * Extracted from artk.journey-implement.md pseudocode.\n * Now testable as pure TypeScript functions.\n *\n * Security fixes applied:\n * - Path traversal protection (Windows + Unix)\n * - Zod schema validation with detailed error messages\n * - Input sanitization\n * - Duplicate journey detection\n */\n\nimport * as fs from 'fs';\nimport * as path from 'path';\nimport * as yaml from 'yaml';\nimport {\n  ValidationResult,\n  JourneyInfo,\n  JourneyFrontmatter,\n  JourneyFrontmatterSchema,\n  LLKBConfigSchema,\n  BATCH_LIMITS,\n  ImplementedBatchMode,\n  LearningMode,\n} from './types.js';\n\n/**\n * Validate that a path stays within its root directory (path traversal protection)\n * Works on both Windows and Unix, handles case sensitivity appropriately\n */\nexport function isPathSafe(targetPath: string, rootPath: string): boolean {\n  // Resolve to absolute paths\n  const normalizedTarget = path.resolve(targetPath);\n  const normalizedRoot = path.resolve(rootPath);\n\n  // On Windows, paths are case-insensitive\n  const isWindows = process.platform === 'win32';\n\n  const targetToCheck = isWindows ? normalizedTarget.toLowerCase() : normalizedTarget;\n  const rootToCheck = isWindows ? normalizedRoot.toLowerCase() : normalizedRoot;\n\n  // Must start with root + separator, or be exactly root\n  const rootWithSep = rootToCheck + path.sep;\n\n  return targetToCheck === rootToCheck || targetToCheck.startsWith(rootWithSep);\n}\n\n/**\n * Validate journey ID format (strict validation, no injection risk)\n */\nexport function isValidJourneyId(id: string): boolean {\n  return /^JRN-\\d{4}$/.test(id);\n}\n\n/**\n * Result type for frontmatter parsing with detailed errors\n */\nexport type ParseResult = {\n  success: true;\n  data: JourneyFrontmatter;\n} | {\n  success: false;\n  error: string;\n  details?: string[];\n};\n\n/**\n * Parse journey frontmatter from a markdown file with Zod validation\n * Returns detailed error information on failure\n */\nexport function parseJourneyFrontmatter(content: string): ParseResult {\n  const match = content.match(/^---\\n([\\s\\S]*?)\\n---/);\n  if (!match) {\n    return {\n      success: false,\n      error: 'No YAML frontmatter found. File must start with --- and end frontmatter with ---',\n    };\n  }\n\n  try {\n    const parsed = yaml.parse(match[1]);\n    const result = JourneyFrontmatterSchema.safeParse(parsed);\n\n    if (!result.success) {\n      const details = result.error.issues.map(issue =>\n        `${issue.path.join('.')}: ${issue.message}`\n      );\n      return {\n        success: false,\n        error: 'Invalid frontmatter schema',\n        details,\n      };\n    }\n\n    return { success: true, data: result.data };\n  } catch (e) {\n    return {\n      success: false,\n      error: `YAML parse error: ${e instanceof Error ? e.message : String(e)}`,\n    };\n  }\n}\n\n/**\n * Result type for loading a journey with detailed errors\n */\nexport interface LoadJourneyResult {\n  journey: JourneyInfo | null;\n  error?: string;\n  details?: string[];\n}\n\n/**\n * Load a journey file and extract its info\n * Returns detailed error information on failure\n */\nexport function loadJourney(journeyPath: string, harnessRoot?: string): LoadJourneyResult {\n  // Path traversal check if harnessRoot provided\n  if (harnessRoot && !isPathSafe(journeyPath, harnessRoot)) {\n    return { journey: null, error: 'Path traversal detected - path outside allowed directory' };\n  }\n\n  try {\n    if (!fs.existsSync(journeyPath)) {\n      return { journey: null, error: 'File not found' };\n    }\n\n    const content = fs.readFileSync(journeyPath, 'utf-8');\n    const parseResult = parseJourneyFrontmatter(content);\n\n    if (!parseResult.success) {\n      return {\n        journey: null,\n        error: parseResult.error,\n        details: parseResult.details,\n      };\n    }\n\n    return {\n      journey: {\n        id: parseResult.data.id,\n        path: journeyPath,\n        status: parseResult.data.status,\n        title: parseResult.data.title,\n        tests: parseResult.data.tests,\n      },\n    };\n  } catch (e) {\n    return {\n      journey: null,\n      error: `File read error: ${e instanceof Error ? e.message : String(e)}`,\n    };\n  }\n}\n\n/**\n * Validate that a journey is ready for implementation\n */\nexport function validateJourneyForImplementation(journey: JourneyInfo): ValidationResult {\n  const errors: string[] = [];\n  const warnings: string[] = [];\n\n  // Check ID (should already be validated, but double-check)\n  if (!journey.id) {\n    errors.push('Journey is missing required field: id');\n  } else if (!isValidJourneyId(journey.id)) {\n    errors.push(`Journey ID \"${journey.id}\" does not match pattern JRN-XXXX`);\n  }\n\n  // Check status\n  const validStatuses: JourneyInfo['status'][] = ['clarified', 'defined'];\n  if (!validStatuses.includes(journey.status)) {\n    if (journey.status === 'proposed') {\n      errors.push(`Journey status is \"proposed\". Must be at least \"defined\" (preferably \"clarified\") before implementation.`);\n    } else if (journey.status === 'implemented') {\n      warnings.push('Journey is already implemented. Re-running will regenerate tests.');\n    } else if (journey.status === 'quarantined') {\n      errors.push('Journey is quarantined. Resolve issues before re-implementing.');\n    } else if (journey.status === 'deprecated') {\n      errors.push('Journey is deprecated and should not be implemented.');\n    }\n  }\n\n  // Warn if not clarified\n  if (journey.status === 'defined') {\n    warnings.push('Journey is \"defined\" but not \"clarified\". Consider running /artk.journey-clarify first for better test generation.');\n  }\n\n  return {\n    valid: errors.length === 0,\n    errors,\n    warnings,\n  };\n}\n\n/**\n * Validate LLKB exists and is enabled\n */\nexport function validateLLKB(llkbRoot: string): ValidationResult {\n  const errors: string[] = [];\n  const warnings: string[] = [];\n\n  try {\n    // Check directory exists\n    if (!fs.existsSync(llkbRoot)) {\n      errors.push(`LLKB directory not found: ${llkbRoot}`);\n      errors.push('Run /artk.discover-foundation to create LLKB.');\n      return { valid: false, errors, warnings };\n    }\n\n    // Check config exists\n    const configPath = path.join(llkbRoot, 'config.yml');\n    if (!fs.existsSync(configPath)) {\n      errors.push(`LLKB config not found: ${configPath}`);\n      return { valid: false, errors, warnings };\n    }\n\n    // Parse and validate config with Zod\n    const configContent = fs.readFileSync(configPath, 'utf-8');\n    const configParsed = yaml.parse(configContent);\n    const configResult = LLKBConfigSchema.safeParse(configParsed);\n\n    if (!configResult.success) {\n      const details = configResult.error.issues.map(issue =>\n        `${issue.path.join('.')}: ${issue.message}`\n      ).join('; ');\n      errors.push(`Invalid LLKB config: ${details}`);\n      return { valid: false, errors, warnings };\n    }\n\n    if (configResult.data.enabled === false) {\n      errors.push('LLKB is disabled in config.yml. Set enabled: true to use LLKB.');\n    }\n\n    // Check minConfidence if present\n    if (configResult.data.minConfidence !== undefined) {\n      if (configResult.data.minConfidence < 0.5) {\n        warnings.push(`LLKB minConfidence is ${configResult.data.minConfidence}, which may include low-quality patterns.`);\n      }\n    }\n\n    // Check required files\n    const requiredFiles = ['components.json', 'lessons.json'];\n    for (const file of requiredFiles) {\n      const filePath = path.join(llkbRoot, file);\n      if (!fs.existsSync(filePath)) {\n        warnings.push(`LLKB file missing: ${file}. Will be created during export.`);\n      }\n    }\n\n    return {\n      valid: errors.length === 0,\n      errors,\n      warnings,\n    };\n  } catch (e) {\n    const message = e instanceof Error ? e.message : String(e);\n    return {\n      valid: false,\n      errors: [`Failed to validate LLKB: ${message}`],\n      warnings,\n    };\n  }\n}\n\n/**\n * Validate batch mode parameter\n * NOTE: Only 'serial' is currently implemented. 'parallel' will fail explicitly.\n */\nexport function validateBatchMode(batchMode: string): {\n  valid: boolean;\n  normalized: ImplementedBatchMode;\n  warning?: string;\n  error?: string;\n} {\n  const input = batchMode.toLowerCase().trim();\n\n  // Deprecated alias - warn but use serial\n  if (input === 'subagent') {\n    return {\n      valid: true,\n      normalized: 'serial',\n      warning: 'batchMode=subagent is deprecated. Parallel mode is not yet implemented; using serial.',\n    };\n  }\n\n  // Explicit parallel request - fail with clear message\n  if (input === 'parallel') {\n    return {\n      valid: false,\n      normalized: 'serial',\n      error: 'Parallel mode (--batch-mode=parallel) is not yet implemented. Use --batch-mode=serial or omit the flag.',\n    };\n  }\n\n  // Serial or empty (default)\n  if (input === 'serial' || input === '') {\n    return { valid: true, normalized: 'serial' };\n  }\n\n  // Unknown mode\n  return {\n    valid: false,\n    normalized: 'serial',\n    error: `Unknown batch mode: \"${batchMode}\". Valid option: serial`,\n  };\n}\n\n/**\n * Validate learning mode parameter\n */\nexport function validateLearningMode(learningMode: string): {\n  valid: boolean;\n  normalized: LearningMode;\n  error?: string;\n} {\n  const normalized = learningMode.toLowerCase().trim();\n\n  if (normalized === 'strict' || normalized === 'batch' || normalized === 'none') {\n    return { valid: true, normalized };\n  }\n\n  // Invalid - return strict as fallback (but mark as invalid)\n  return {\n    valid: false,\n    normalized: 'strict',\n    error: `Unknown learning mode: \"${learningMode}\". Valid options: strict, batch, none`,\n  };\n}\n\n/**\n * Result type for finding journey files\n */\nexport interface FindJourneyFilesResult {\n  found: Map<string, string | null>;\n  duplicates: Map<string, string[]>;  // ID -> list of paths where found\n}\n\n/**\n * Find all journey files matching IDs\n * Detects duplicates across status folders and warns\n * Path traversal protection: validates all returned paths stay within harnessRoot\n */\nexport function findJourneyFiles(harnessRoot: string, journeyIds: string[]): FindJourneyFilesResult {\n  const found = new Map<string, string | null>();\n  const duplicates = new Map<string, string[]>();\n  const journeysDir = path.join(harnessRoot, 'journeys');\n\n  // Validate journey IDs first (prevents directory injection)\n  const validIds = journeyIds.filter(isValidJourneyId);\n\n  for (const id of validIds) {\n    const locations: string[] = [];\n    // Priority order: clarified > defined > proposed > implemented > quarantined > deprecated\n    const statuses = ['clarified', 'defined', 'proposed', 'implemented', 'quarantined', 'deprecated'];\n\n    for (const status of statuses) {\n      const statusDir = path.join(journeysDir, status);\n\n      // Path traversal protection\n      if (!isPathSafe(statusDir, harnessRoot)) {\n        continue;\n      }\n\n      try {\n        if (!fs.existsSync(statusDir)) continue;\n\n        const files = fs.readdirSync(statusDir);\n        const match = files.find(f => f.startsWith(`${id}__`) && f.endsWith('.md'));\n\n        if (match) {\n          const fullPath = path.join(statusDir, match);\n\n          // Verify path safety before adding\n          if (isPathSafe(fullPath, harnessRoot)) {\n            locations.push(fullPath);\n          }\n        }\n      } catch {\n        // Permission or filesystem errors - skip this directory\n        continue;\n      }\n    }\n\n    if (locations.length > 1) {\n      // Duplicate detected - record all locations\n      duplicates.set(id, locations);\n      // Use first match (highest priority status)\n      found.set(id, locations[0]);\n    } else if (locations.length === 1) {\n      found.set(id, locations[0]);\n    } else {\n      found.set(id, null);\n    }\n  }\n\n  // Add invalid IDs as not found\n  for (const id of journeyIds) {\n    if (!validIds.includes(id) && !found.has(id)) {\n      found.set(id, null);\n    }\n  }\n\n  return { found, duplicates };\n}\n\n/**\n * Parse journey list from user input\n * Handles:\n * - Single: JRN-0001\n * - Comma-separated: JRN-0001,JRN-0002\n * - Ranges: JRN-0001..JRN-0010 (inclusive, handles backwards ranges)\n * - Combinations: JRN-0001,JRN-0003..JRN-0005,JRN-0010\n *\n * Returns deduplicated, sorted list of valid IDs\n */\nexport function parseJourneyList(input: string): string[] {\n  const ids = new Set<string>();\n\n  // Split by comma\n  const parts = input.split(',').map(p => p.trim()).filter(Boolean);\n\n  for (const part of parts) {\n    // Check for range (supports both forward and backward ranges)\n    const rangeMatch = part.match(/^(JRN-(\\d{4}))\\.\\.JRN-(\\d{4})$/);\n    if (rangeMatch) {\n      const start = parseInt(rangeMatch[2], 10);\n      const end = parseInt(rangeMatch[3], 10);\n\n      // Handle both forward and backward ranges\n      const min = Math.min(start, end);\n      const max = Math.max(start, end);\n\n      for (let i = min; i <= max; i++) {\n        ids.add(`JRN-${i.toString().padStart(4, '0')}`);\n      }\n    } else if (isValidJourneyId(part)) {\n      ids.add(part);\n    }\n    // Invalid IDs are silently ignored (filtered out)\n  }\n\n  // Return sorted, deduplicated array\n  return Array.from(ids).sort((a, b) => {\n    const numA = parseInt(a.replace('JRN-', ''), 10);\n    const numB = parseInt(b.replace('JRN-', ''), 10);\n    return numA - numB;\n  });\n}\n\n/**\n * Validate batch size limits\n */\nexport function validateBatchSize(count: number): {\n  valid: boolean;\n  warning?: string;\n  error?: string;\n} {\n  if (count <= 0) {\n    return { valid: false, error: 'At least one journey ID required' };\n  }\n\n  if (count > BATCH_LIMITS.HARD_LIMIT) {\n    return {\n      valid: false,\n      error: `Too many journeys: ${count}. Maximum is ${BATCH_LIMITS.HARD_LIMIT}. Use smaller batches.`\n    };\n  }\n\n  if (count > BATCH_LIMITS.SOFT_LIMIT) {\n    return {\n      valid: true,\n      warning: `Processing ${count} journeys. Consider using smaller batches (${BATCH_LIMITS.SOFT_LIMIT} or fewer) for better results.`\n    };\n  }\n\n  return { valid: true };\n}\n","/**\n * Journey Implement Workflow\n *\n * This is the testable logic extracted from artk.journey-implement.md.\n * The prompt now just calls these CLI commands instead of containing pseudocode.\n *\n * Security fixes applied:\n * - No shell: true (prevents command injection)\n * - Path traversal protection\n * - Proper argument handling (no split(' '))\n * - Environment detection\n * - Terminal access checks\n */\n\nimport * as fs from 'fs';\nimport * as path from 'path';\nimport { spawn } from 'child_process';\nimport {\n  WorkflowContext,\n  WorkflowResult,\n  JourneyInfo,\n  SessionState,\n  ExecutionEnvironment,\n  ImplementedBatchMode,\n  LearningMode,\n  createSessionState,\n  BATCH_LIMITS,\n  DEFAULT_COMMAND_TIMEOUT_MS,\n  SESSION_SCHEMA_VERSION,\n} from './types.js';\nimport {\n  loadJourney,\n  validateJourneyForImplementation,\n  validateLLKB,\n  validateBatchMode,\n  validateLearningMode,\n  findJourneyFiles,\n  parseJourneyList,\n  validateBatchSize,\n  isPathSafe,\n} from './journey-validate.js';\n\nexport interface ImplementOptions {\n  journeyIds: string;\n  batchMode?: string;\n  learningMode?: string;\n  dryRun?: boolean;\n  verbose?: boolean;\n}\n\nexport interface ImplementPlan {\n  journeys: JourneyInfo[];\n  batchMode: ImplementedBatchMode;  // Only 'serial' is implemented\n  learningMode: LearningMode;\n  llkbExportCommand: CommandSpec;\n  autogenCommands: CommandSpec[];\n  warnings: string[];\n  environment: ExecutionEnvironment;\n}\n\n/**\n * Command specification - safe alternative to string commands\n * Prevents command injection by separating command from arguments\n */\nexport interface CommandSpec {\n  /** The executable (npx, npm, etc) */\n  executable: string;\n  /** Array of arguments - never concatenated as string */\n  args: string[];\n  /** Working directory */\n  cwd?: string;\n  /** Human-readable description */\n  description: string;\n}\n\n/**\n * Detect the current execution environment\n * Enhanced detection for various IDEs and environments\n */\nexport function detectEnvironment(): ExecutionEnvironment {\n  // VS Code (includes Copilot, Claude Code, etc.)\n  if (process.env.VSCODE_PID || process.env.VSCODE_CWD || process.env.TERM_PROGRAM === 'vscode') {\n    return 'vscode-local';\n  }\n\n  // Cursor IDE (VS Code fork)\n  if (process.env.CURSOR_TRACE_ID || process.env.TERM_PROGRAM === 'Cursor') {\n    return 'vscode-local'; // Cursor behaves like VS Code\n  }\n\n  // JetBrains IDEs (IntelliJ, WebStorm, PyCharm, etc.)\n  if (process.env.JETBRAINS_IDE || process.env.TERMINAL_EMULATOR?.includes('JetBrains')) {\n    return 'vscode-local'; // JetBrains has terminal access\n  }\n\n  // CI/CD pipelines\n  if (\n    process.env.GITHUB_ACTIONS === 'true' ||\n    process.env.GITLAB_CI === 'true' ||\n    process.env.JENKINS_URL ||\n    process.env.CIRCLECI === 'true' ||\n    process.env.TRAVIS === 'true' ||\n    process.env.CI === 'true'\n  ) {\n    return 'ci-pipeline';\n  }\n\n  // GitHub Codespace or web-based Copilot (no terminal)\n  if (process.env.CODESPACES === 'true' || process.env.GITHUB_CODESPACE_TOKEN) {\n    return 'github-web';\n  }\n\n  // WSL (Windows Subsystem for Linux) - has terminal access\n  if (process.env.WSL_DISTRO_NAME || process.env.WSLENV) {\n    return 'cli-terminal';\n  }\n\n  // Docker container - has terminal access\n  if (fs.existsSync('/.dockerenv') || process.env.container === 'docker') {\n    return 'cli-terminal';\n  }\n\n  // Standard CLI terminal\n  if (process.stdout.isTTY) {\n    return 'cli-terminal';\n  }\n\n  return 'unknown';\n}\n\n/**\n * Check if terminal access is available for command execution\n */\nexport function hasTerminalAccess(environment: ExecutionEnvironment): { available: boolean; reason?: string } {\n  switch (environment) {\n    case 'vscode-local':\n      return { available: true };\n    case 'cli-terminal':\n      return { available: true };\n    case 'ci-pipeline':\n      return { available: true };\n    case 'github-web':\n      return {\n        available: false,\n        reason: 'GitHub.com Copilot does not have terminal access. Use VS Code with Copilot extension or CLI instead.',\n      };\n    case 'unknown':\n      return {\n        available: false,\n        reason: 'Unknown environment. Cannot determine terminal access availability.',\n      };\n  }\n}\n\n/**\n * Build the implementation plan (what would happen)\n */\nexport function buildImplementPlan(\n  ctx: WorkflowContext,\n  options: ImplementOptions\n): WorkflowResult<ImplementPlan> {\n  const errors: string[] = [];\n  const warnings: string[] = [];\n\n  // Detect environment\n  const environment = detectEnvironment();\n\n  // Check terminal access\n  const terminalCheck = hasTerminalAccess(environment);\n  if (!terminalCheck.available && !options.dryRun) {\n    return {\n      success: false,\n      error: terminalCheck.reason || 'Terminal access not available',\n    };\n  }\n\n  if (!terminalCheck.available && options.dryRun) {\n    warnings.push(`${terminalCheck.reason} Showing plan only.`);\n  }\n\n  // Parse journey list\n  const journeyIds = parseJourneyList(options.journeyIds);\n  if (journeyIds.length === 0) {\n    return {\n      success: false,\n      error: 'No valid journey IDs provided. Use format: JRN-0001 or JRN-0001,JRN-0002 or JRN-0001..JRN-0010',\n    };\n  }\n\n  // Validate batch size\n  const batchSizeResult = validateBatchSize(journeyIds.length);\n  if (!batchSizeResult.valid) {\n    return { success: false, error: batchSizeResult.error };\n  }\n  if (batchSizeResult.warning) {\n    warnings.push(batchSizeResult.warning);\n  }\n\n  // Validate batch mode (parallel is explicitly rejected by validateBatchMode)\n  const batchModeResult = validateBatchMode(options.batchMode || 'serial');\n  if (!batchModeResult.valid) {\n    return {\n      success: false,\n      error: batchModeResult.error || `Invalid batch mode: ${options.batchMode}. Valid option: serial`,\n    };\n  }\n  if (batchModeResult.warning) {\n    warnings.push(batchModeResult.warning);\n  }\n\n  // Validate learning mode\n  const learningModeResult = validateLearningMode(options.learningMode || 'strict');\n  if (!learningModeResult.valid) {\n    return {\n      success: false,\n      error: `Invalid learning mode: ${options.learningMode}. Valid values: strict, batch, none`,\n    };\n  }\n\n  // Special case: batch learning mode with serial execution\n  if (batchModeResult.normalized === 'serial' && learningModeResult.normalized === 'batch') {\n    warnings.push('learningMode=batch with serial mode behaves the same as learningMode=strict (no batches in serial mode).');\n  }\n\n  // Validate LLKB\n  const llkbResult = validateLLKB(ctx.llkbRoot);\n  if (!llkbResult.valid) {\n    return {\n      success: false,\n      error: llkbResult.errors.join('\\n'),\n    };\n  }\n  warnings.push(...llkbResult.warnings);\n\n  // Find and validate journeys\n  const findResult = findJourneyFiles(ctx.harnessRoot, journeyIds);\n  const journeys: JourneyInfo[] = [];\n\n  // Warn about duplicate journeys in multiple status folders\n  for (const [id, paths] of findResult.duplicates) {\n    warnings.push(\n      `Journey ${id} found in multiple locations: ${paths.map(p => path.basename(path.dirname(p))).join(', ')}. Using highest priority.`\n    );\n  }\n\n  for (const id of journeyIds) {\n    const journeyPath = findResult.found.get(id);\n    if (!journeyPath) {\n      errors.push(`Journey not found: ${id}`);\n      continue;\n    }\n\n    // Path traversal protection\n    if (!isPathSafe(journeyPath, ctx.harnessRoot)) {\n      errors.push(`Invalid journey path (security): ${id}`);\n      continue;\n    }\n\n    const loadResult = loadJourney(journeyPath, ctx.harnessRoot);\n    if (!loadResult.journey) {\n      // Include detailed error information from Zod validation\n      const errorMsg = loadResult.error || 'Unknown error';\n      const details = loadResult.details ? `: ${loadResult.details.join(', ')}` : '';\n      errors.push(`Failed to parse journey ${id}: ${errorMsg}${details}`);\n      continue;\n    }\n\n    const validation = validateJourneyForImplementation(loadResult.journey);\n    if (!validation.valid) {\n      errors.push(`Journey ${id}: ${validation.errors.join(', ')}`);\n    }\n    warnings.push(...validation.warnings.map(w => `Journey ${id}: ${w}`));\n\n    journeys.push(loadResult.journey);\n  }\n\n  if (errors.length > 0) {\n    return {\n      success: false,\n      error: errors.join('\\n'),\n    };\n  }\n\n  // Build safe commands (no string concatenation!)\n  const llkbExportCommand: CommandSpec = {\n    executable: 'npx',\n    args: [\n      'artk',\n      'llkb',\n      'export',\n      '--for-autogen',\n      '--llkb-root',\n      ctx.llkbRoot,\n      '--output',\n      ctx.harnessRoot,\n      '--min-confidence',\n      '0.7',\n    ],\n    cwd: ctx.projectRoot,\n    description: 'Export LLKB for AutoGen consumption',\n  };\n\n  const autogenCommands: CommandSpec[] = journeys.map(j => {\n    const testsDir = path.join(ctx.harnessRoot, 'tests');\n    const llkbConfig = path.join(ctx.harnessRoot, 'autogen-llkb.config.yml');\n    const llkbGlossary = path.join(ctx.harnessRoot, 'llkb-glossary.ts');\n\n    return {\n      executable: 'npx',\n      args: [\n        'artk-autogen',\n        'generate',\n        j.path,\n        '-o',\n        testsDir,\n        '-m',\n        '--llkb-config',\n        llkbConfig,\n        '--llkb-glossary',\n        llkbGlossary,\n      ],\n      cwd: ctx.projectRoot,\n      description: `Generate tests for ${j.id}`,\n    };\n  });\n\n  return {\n    success: true,\n    data: {\n      journeys,\n      batchMode: batchModeResult.normalized,\n      learningMode: learningModeResult.normalized,\n      llkbExportCommand,\n      autogenCommands,\n      warnings,\n      environment,\n    },\n  };\n}\n\n/**\n * Format a CommandSpec as a human-readable string (for display only!)\n * Never use this for actual execution\n */\nfunction formatCommand(cmd: CommandSpec): string {\n  // Quote arguments that contain spaces or special characters\n  const quotedArgs = cmd.args.map(arg => {\n    if (arg.includes(' ') || arg.includes('\"') || arg.includes('$') || arg.includes('`')) {\n      // Escape any existing double quotes and wrap in double quotes\n      return `\"${arg.replace(/\"/g, '\\\\\"')}\"`;\n    }\n    return arg;\n  });\n  return `${cmd.executable} ${quotedArgs.join(' ')}`;\n}\n\n/**\n * Get the path where session state should be persisted\n */\nexport function getSessionFilePath(harnessRoot: string): string {\n  return path.join(harnessRoot, '.artk', 'session.json');\n}\n\n/**\n * Save session state to disk for recovery/debugging\n * Called after each journey to enable resume on failure\n */\nexport async function saveSessionState(harnessRoot: string, state: SessionState): Promise<boolean> {\n  try {\n    const sessionPath = getSessionFilePath(harnessRoot);\n    const sessionDir = path.dirname(sessionPath);\n\n    // Ensure .artk directory exists\n    if (!fs.existsSync(sessionDir)) {\n      fs.mkdirSync(sessionDir, { recursive: true });\n    }\n\n    // Add savedAt timestamp\n    const stateToSave: SessionState = {\n      ...state,\n      savedAt: new Date().toISOString(),\n    };\n\n    fs.writeFileSync(sessionPath, JSON.stringify(stateToSave, null, 2), 'utf-8');\n    return true;\n  } catch {\n    // Session persistence failure is non-fatal\n    return false;\n  }\n}\n\n/**\n * Load session state from disk (for resume functionality)\n */\nexport function loadSessionState(harnessRoot: string): SessionState | null {\n  try {\n    const sessionPath = getSessionFilePath(harnessRoot);\n    if (!fs.existsSync(sessionPath)) {\n      return null;\n    }\n\n    const content = fs.readFileSync(sessionPath, 'utf-8');\n    const state = JSON.parse(content) as SessionState;\n\n    // Validate schema version\n    if (state.schemaVersion !== SESSION_SCHEMA_VERSION) {\n      return null; // Incompatible version\n    }\n\n    return state;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Parse generated test file path from AutoGen stdout\n * Looks for patterns like \"Generated: /path/to/JRN-0001.spec.ts\" or \"Created test file: ...\"\n */\nexport function parseGeneratedTestFile(stdout: string, journeyId: string): string | null {\n  // Pattern 1: \"Generated: /path/to/file.spec.ts\"\n  const generatedMatch = stdout.match(/Generated:\\s*(.+\\.spec\\.ts)/i);\n  if (generatedMatch) {\n    return generatedMatch[1].trim();\n  }\n\n  // Pattern 2: \"Created test file: /path/to/file.spec.ts\"\n  const createdMatch = stdout.match(/Created test file:\\s*(.+\\.spec\\.ts)/i);\n  if (createdMatch) {\n    return createdMatch[1].trim();\n  }\n\n  // Pattern 3: \"Output: /path/to/file.spec.ts\"\n  const outputMatch = stdout.match(/Output:\\s*(.+\\.spec\\.ts)/i);\n  if (outputMatch) {\n    return outputMatch[1].trim();\n  }\n\n  // Pattern 4: Look for journey ID in path\n  const journeyPathMatch = stdout.match(new RegExp(`(\\\\S*${journeyId}\\\\S*\\\\.spec\\\\.ts)`, 'i'));\n  if (journeyPathMatch) {\n    return journeyPathMatch[1].trim();\n  }\n\n  // Fallback: use convention-based naming\n  return null;\n}\n\n/**\n * Get test file name with fallback to convention\n */\nfunction getTestFileName(stdout: string, journey: JourneyInfo): string {\n  const parsed = parseGeneratedTestFile(stdout, journey.id);\n  if (parsed) {\n    return path.basename(parsed);\n  }\n  // Convention-based fallback\n  return `${journey.id}.spec.ts`;\n}\n\n/**\n * Format the implementation plan as human-readable output\n */\nexport function formatImplementPlan(plan: ImplementPlan): string {\n  const lines: string[] = [];\n\n  lines.push('');\n  lines.push('  JOURNEY IMPLEMENTATION PLAN                                   ');\n  lines.push('');\n  lines.push('');\n\n  lines.push(`Environment: ${plan.environment}`);\n  lines.push(`Batch Mode: ${plan.batchMode}`);\n  lines.push(`Learning Mode: ${plan.learningMode}`);\n  lines.push(`Journeys: ${plan.journeys.length}`);\n  lines.push('');\n\n  lines.push('Journeys to implement:');\n  for (const j of plan.journeys) {\n    lines.push(`  - ${j.id}: ${j.title} (status: ${j.status})`);\n  }\n  lines.push('');\n\n  lines.push('Commands that will be executed:');\n  lines.push('');\n  lines.push('1. Export LLKB for AutoGen:');\n  lines.push(`   ${formatCommand(plan.llkbExportCommand)}`);\n  lines.push('');\n\n  lines.push('2. Run AutoGen for each journey:');\n  for (let i = 0; i < plan.autogenCommands.length; i++) {\n    lines.push(`   [${i + 1}] ${formatCommand(plan.autogenCommands[i])}`);\n  }\n  lines.push('');\n\n  if (plan.warnings.length > 0) {\n    lines.push('Warnings:');\n    for (const w of plan.warnings) {\n      lines.push(`    ${w}`);\n    }\n    lines.push('');\n  }\n\n  lines.push('');\n\n  return lines.join('\\n');\n}\n\n/**\n * Result of command execution\n */\nexport interface CommandResult {\n  success: boolean;\n  stdout: string;\n  stderr: string;\n  timedOut?: boolean;\n}\n\n/**\n * Execute a command safely (no shell injection risk)\n * Uses spawn with explicit args array, NOT shell: true\n *\n * @param cmd - Command specification\n * @param timeoutMs - Timeout in milliseconds (default: 5 minutes)\n */\nasync function execCommand(\n  cmd: CommandSpec,\n  timeoutMs: number = DEFAULT_COMMAND_TIMEOUT_MS\n): Promise<CommandResult> {\n  return new Promise((resolve) => {\n    const proc = spawn(cmd.executable, cmd.args, {\n      cwd: cmd.cwd,\n      shell: false, // CRITICAL: Never use shell: true with user input\n      stdio: ['pipe', 'pipe', 'pipe'],\n    });\n\n    let stdout = '';\n    let stderr = '';\n    let killed = false;\n\n    // Set up timeout\n    const timer = setTimeout(() => {\n      killed = true;\n      proc.kill('SIGTERM');\n      // Give process 5 seconds to clean up before SIGKILL\n      setTimeout(() => {\n        if (!proc.killed) {\n          proc.kill('SIGKILL');\n        }\n      }, 5000);\n    }, timeoutMs);\n\n    proc.stdout.on('data', (data) => { stdout += data.toString(); });\n    proc.stderr.on('data', (data) => { stderr += data.toString(); });\n\n    proc.on('close', (code) => {\n      clearTimeout(timer);\n      if (killed) {\n        resolve({\n          success: false,\n          stdout,\n          stderr: `Command timed out after ${Math.round(timeoutMs / 1000)} seconds`,\n          timedOut: true,\n        });\n      } else {\n        resolve({ success: code === 0, stdout, stderr });\n      }\n    });\n\n    proc.on('error', (err) => {\n      clearTimeout(timer);\n      resolve({ success: false, stdout, stderr: err.message });\n    });\n  });\n}\n\n/**\n * Execute the implementation workflow with session state tracking\n */\nexport async function executeImplementation(\n  ctx: WorkflowContext,\n  plan: ImplementPlan,\n  options: { verbose?: boolean; timeoutMs?: number }\n): Promise<WorkflowResult<{ testsGenerated: string[]; sessionState: SessionState; warnings: string[] }>> {\n  const timeoutMs = options.timeoutMs ?? DEFAULT_COMMAND_TIMEOUT_MS;\n  const warnings: string[] = [];\n\n  // Initialize session state\n  const sessionState = createSessionState(\n    plan.journeys.map(j => j.id),\n    plan.batchMode,\n    plan.learningMode\n  );\n\n  // Persist initial session state\n  await saveSessionState(ctx.harnessRoot, sessionState);\n\n  const testsGenerated: string[] = [];\n\n  // Step 1: Export LLKB\n  if (options.verbose) {\n    console.log('\\n Exporting LLKB for AutoGen...');\n    console.log(`   ${formatCommand(plan.llkbExportCommand)}`);\n  }\n\n  const llkbResult = await execCommand(plan.llkbExportCommand, timeoutMs);\n  if (!llkbResult.success) {\n    sessionState.endTime = Date.now();\n    await saveSessionState(ctx.harnessRoot, sessionState);\n\n    if (llkbResult.timedOut) {\n      return {\n        success: false,\n        error: `LLKB export timed out after ${Math.round(timeoutMs / 1000)} seconds`,\n      };\n    }\n    return {\n      success: false,\n      error: `LLKB export failed: ${llkbResult.stderr}`,\n    };\n  }\n  sessionState.llkbExportCount++;\n  sessionState.lastLlkbExportTime = Date.now();\n  await saveSessionState(ctx.harnessRoot, sessionState);\n\n  // Step 2: Run AutoGen for each journey\n  for (let i = 0; i < plan.journeys.length; i++) {\n    const journey = plan.journeys[i];\n    const command = plan.autogenCommands[i];\n\n    // Update session state\n    sessionState.currentJourneyIndex = i;\n    sessionState.currentJourneyId = journey.id;\n    await saveSessionState(ctx.harnessRoot, sessionState);\n\n    if (options.verbose) {\n      console.log(`\\n [${i + 1}/${plan.journeys.length}] Generating tests for ${journey.id}...`);\n      console.log(`   ${formatCommand(command)}`);\n    }\n\n    const result = await execCommand(command, timeoutMs);\n\n    if (!result.success) {\n      sessionState.journeysFailed.push(journey.id);\n      sessionState.endTime = Date.now();\n      await saveSessionState(ctx.harnessRoot, sessionState);\n\n      const errorMsg = result.timedOut\n        ? `AutoGen timed out for ${journey.id} after ${Math.round(timeoutMs / 1000)} seconds`\n        : `AutoGen failed for ${journey.id}: ${result.stderr}`;\n\n      return {\n        success: false,\n        error: errorMsg,\n        data: { testsGenerated, sessionState, warnings },\n      };\n    }\n\n    // Parse generated test file from AutoGen output (with fallback)\n    const testFile = getTestFileName(result.stdout, journey);\n    testsGenerated.push(testFile);\n    sessionState.testsGenerated.push(testFile);\n    sessionState.journeysCompleted.push(journey.id);\n    await saveSessionState(ctx.harnessRoot, sessionState);\n\n    if (options.verbose) {\n      console.log(`    Generated: ${testFile}`);\n    }\n\n    // Re-export LLKB if learningMode=strict and not last journey\n    if (plan.learningMode === 'strict' && i < plan.journeys.length - 1) {\n      if (options.verbose) {\n        console.log('\\n Re-exporting LLKB with learned patterns...');\n      }\n      const reExportResult = await execCommand(plan.llkbExportCommand, timeoutMs);\n      if (reExportResult.success) {\n        sessionState.llkbExportCount++;\n        sessionState.lastLlkbExportTime = Date.now();\n      } else {\n        sessionState.llkbSkippedExports++;\n        // In strict mode, LLKB re-export failures ALWAYS get a warning\n        const warnMsg = reExportResult.timedOut\n          ? `LLKB re-export timed out after journey ${journey.id}. Continuing without updated patterns.`\n          : `LLKB re-export failed after journey ${journey.id}: ${reExportResult.stderr}. Continuing without updated patterns.`;\n        warnings.push(warnMsg);\n        if (options.verbose) {\n          console.log(`     ${warnMsg}`);\n        }\n      }\n      await saveSessionState(ctx.harnessRoot, sessionState);\n    }\n  }\n\n  // Finalize session state\n  sessionState.endTime = Date.now();\n  sessionState.currentJourneyId = null;\n  sessionState.verificationPassed = true; // Will be set by verify step\n  await saveSessionState(ctx.harnessRoot, sessionState);\n\n  return {\n    success: true,\n    data: { testsGenerated, sessionState, warnings },\n    warnings: warnings.length > 0 ? warnings : undefined,\n  };\n}\n","/**\n * ARTK Workflows - Testable logic extracted from prompts\n */\n\nexport * from './types.js';\nexport * from './journey-validate.js';\nexport * from './journey-implement.js';\n","/**\n * artk journey check-llkb\n *\n * Check if LLKB is configured and ready.\n * Replaces the LLKB validation pseudocode in artk.journey-implement.md\n */\n\nimport * as path from 'path';\nimport { Logger } from '../../lib/logger.js';\nimport { validateLLKB, ValidationResult } from '../../lib/workflows/index.js';\n\nexport interface CheckLlkbOptions {\n  harnessRoot: string;\n  json?: boolean;\n}\n\nexport interface CheckLlkbResult {\n  valid: boolean;\n  llkbRoot: string;\n  errors: string[];\n  warnings: string[];\n}\n\n/**\n * Run the check-llkb command and return structured result\n * Separated from CLI output for testability\n */\nexport function runCheckLlkb(options: CheckLlkbOptions): CheckLlkbResult {\n  const harnessRoot = path.resolve(options.harnessRoot);\n  const llkbRoot = path.join(harnessRoot, '.artk', 'llkb');\n\n  const result = validateLLKB(llkbRoot);\n\n  return {\n    valid: result.valid,\n    llkbRoot,\n    errors: result.errors,\n    warnings: result.warnings,\n  };\n}\n\n/**\n * CLI entry point - handles output formatting and exit codes\n */\nexport async function checkLlkbCommand(options: CheckLlkbOptions): Promise<number> {\n  const logger = new Logger();\n  const result = runCheckLlkb(options);\n\n  if (options.json) {\n    console.log(JSON.stringify(result, null, 2));\n  } else {\n    logger.header('LLKB Check');\n    logger.info(`LLKB Root: ${result.llkbRoot}`);\n    logger.blank();\n\n    if (result.valid) {\n      logger.success('LLKB is configured and ready');\n    } else {\n      logger.error('LLKB is not ready');\n      for (const err of result.errors) {\n        logger.info(`  - ${err}`);\n      }\n    }\n\n    for (const warn of result.warnings) {\n      logger.warning(`  - ${warn}`);\n    }\n  }\n\n  return result.valid ? 0 : 1;\n}\n","/**\n * Bootstrap - Core installation logic\n *\n * This module implements the complete ARTK bootstrap process,\n * replacing the shell scripts (bootstrap.sh/bootstrap.ps1) with\n * a unified TypeScript implementation.\n */\n\nimport { execSync, spawn, SpawnOptions } from 'child_process';\nimport fs from 'fs-extra';\nimport * as path from 'path';\nimport { fileURLToPath } from 'url';\nimport { Logger } from './logger.js';\nimport { detectEnvironment, type EnvironmentInfo } from './environment.js';\nimport { resolveBrowser, updateArtkConfigBrowser, type BrowserInfo } from './browser-resolver.js';\nimport { validateArtkConfig } from './config-validator.js';\nimport { promptVariant, isInteractive } from './prompts.js';\nimport {\n  type VariantId,\n  type ArtkContext,\n} from './variants/index.js';\nimport {\n  getVariantDefinition,\n  getRecommendedVariant,\n  isVariantCompatible,\n  VARIANT_DEFINITIONS,\n} from './variants/variant-definitions.js';\nimport {\n  getNodeMajorVersion,\n  detectModuleSystem,\n} from './variants/variant-detector.js';\nimport {\n  getArtkVersion,\n  generateVariantFeatures,\n  generateReadonlyMarker,\n  generateAiIgnore,\n} from './variants/variant-files.js';\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = path.dirname(__filename);\n\n// Path to bundled bootstrap templates (copied during build)\nconst BOOTSTRAP_TEMPLATES_PATH = path.resolve(__dirname, '..', 'assets', 'bootstrap-templates');\n\n/**\n * Read a bundled template file\n * @returns Template content or null if not found\n */\nfunction readBundledTemplate(templateName: string): string | null {\n  const templatePath = path.join(BOOTSTRAP_TEMPLATES_PATH, templateName);\n  if (fs.existsSync(templatePath)) {\n    const content = fs.readFileSync(templatePath, 'utf8');\n    // Skip header comment (first 10 lines are documentation)\n    const lines = content.split('\\n');\n    return lines.slice(10).join('\\n');\n  }\n  return null;\n}\n\nexport interface BootstrapOptions {\n  skipNpm?: boolean;\n  skipBrowsers?: boolean;\n  force?: boolean;\n  variant?: VariantId | 'auto';\n  prompts?: boolean;\n  verbose?: boolean;\n}\n\nexport interface BootstrapResult {\n  success: boolean;\n  projectPath: string;\n  artkE2ePath: string;\n  browserInfo?: BrowserInfo;\n  environment?: EnvironmentInfo;\n  errors: string[];\n}\n\ninterface BackupState {\n  configPath: string | null;\n  configBackupPath: string | null;\n  contextPath: string | null;\n  contextBackupPath: string | null;\n}\n\n/**\n * Bootstrap ARTK in a target project\n */\nexport async function bootstrap(\n  targetPath: string,\n  options: BootstrapOptions = {}\n): Promise<BootstrapResult> {\n  const logger = new Logger({ verbose: options.verbose });\n  const errors: string[] = [];\n\n  const resolvedPath = path.resolve(targetPath);\n  const artkE2ePath = path.join(resolvedPath, 'artk-e2e');\n  const artkDir = path.join(resolvedPath, '.artk');\n  const logsDir = path.join(artkDir, 'logs');\n\n  logger.header('ARTK Bootstrap Installation');\n  logger.table([\n    { label: 'Target', value: resolvedPath },\n    { label: 'ARTK E2E', value: artkE2ePath },\n  ]);\n\n  // Validate target directory\n  if (!fs.existsSync(resolvedPath)) {\n    logger.error(`Target directory does not exist: ${resolvedPath}`);\n    return { success: false, projectPath: resolvedPath, artkE2ePath, errors: ['Target directory does not exist'] };\n  }\n\n  // Check for existing installation\n  if (fs.existsSync(artkE2ePath) && !options.force) {\n    logger.error('ARTK is already installed in this project. Use --force to overwrite.');\n    return { success: false, projectPath: resolvedPath, artkE2ePath, errors: ['Already installed'] };\n  }\n\n  // Create backup state for rollback\n  const backup: BackupState = {\n    configPath: null,\n    configBackupPath: null,\n    contextPath: null,\n    contextBackupPath: null,\n  };\n\n  // Create logs directory early\n  await fs.ensureDir(logsDir);\n\n  try {\n    // Backup existing config if doing a force overwrite\n    if (options.force) {\n      const configPath = path.join(artkE2ePath, 'artk.config.yml');\n      if (fs.existsSync(configPath)) {\n        backup.configPath = configPath;\n        backup.configBackupPath = `${configPath}.bootstrap-backup`;\n        await fs.copy(configPath, backup.configBackupPath);\n        logger.debug('Backed up existing artk.config.yml');\n      }\n\n      const contextPath = path.join(artkDir, 'context.json');\n      if (fs.existsSync(contextPath)) {\n        backup.contextPath = contextPath;\n        backup.contextBackupPath = `${contextPath}.bootstrap-backup`;\n        await fs.copy(contextPath, backup.contextBackupPath);\n        logger.debug('Backed up existing context.json');\n      }\n    }\n\n    // Step 1: Detect environment and select variant\n    logger.step(1, 7, 'Detecting environment and selecting variant...');\n    const environment = await detectEnvironment(resolvedPath);\n    const nodeMajor = getNodeMajorVersion();\n    const detectedModuleSystem = detectModuleSystem(resolvedPath);\n\n    let selectedVariant: VariantId;\n\n    if (options.variant && options.variant !== 'auto') {\n      // User explicitly specified a variant\n      selectedVariant = options.variant;\n\n      // Warn if variant is incompatible with current Node version\n      if (!isVariantCompatible(selectedVariant, nodeMajor)) {\n        const variantDef = getVariantDefinition(selectedVariant);\n        logger.warning(`Variant '${selectedVariant}' is designed for Node ${variantDef.nodeRange.join('/')}`);\n        logger.warning(`You are running Node ${nodeMajor}. This may cause compatibility issues.`);\n      }\n    } else {\n      // Auto-detect: use Node version + module system\n      try {\n        selectedVariant = getRecommendedVariant(nodeMajor, detectedModuleSystem);\n        logger.debug(`Auto-selected variant: ${selectedVariant} (Node ${nodeMajor}, ${detectedModuleSystem})`);\n      } catch (error) {\n        // Node version too old\n        const message = error instanceof Error ? error.message : String(error);\n        logger.error(message);\n        throw error;\n      }\n    }\n\n    const variantDef = getVariantDefinition(selectedVariant);\n    logger.success(`Variant: ${selectedVariant} (${variantDef.displayName})`);\n    logger.debug(`Node.js: ${environment.nodeVersion} (major: ${nodeMajor})`);\n    logger.debug(`Module system: ${detectedModuleSystem}`);\n    logger.debug(`Playwright: ${variantDef.playwrightVersion}`);\n    logger.debug(`Platform: ${environment.platform}/${environment.arch}`);\n\n    // Step 2: Create directory structure\n    logger.step(2, 7, 'Creating artk-e2e/ structure...');\n    await createDirectoryStructure(artkE2ePath);\n    logger.success('Directory structure created');\n\n    // Step 3: Install @artk/core to vendor\n    logger.step(3, 7, `Installing @artk/core (${selectedVariant}) to vendor/...`);\n    await installVendorPackages(artkE2ePath, selectedVariant, logger);\n    logger.success(`@artk/core installed to vendor/ (${variantDef.displayName})`);\n\n    // Step 4: Install prompts\n    if (options.prompts !== false) {\n      logger.step(4, 7, 'Installing prompts to .github/prompts/...');\n      await installPrompts(resolvedPath, logger);\n      logger.success('Prompts installed');\n    } else {\n      logger.step(4, 7, 'Skipping prompts installation (--no-prompts)');\n    }\n\n    // Step 5: Create configuration files\n    logger.step(5, 7, 'Creating configuration files...');\n    const projectName = path.basename(resolvedPath);\n    await createConfigurationFiles(artkE2ePath, artkDir, resolvedPath, {\n      projectName,\n      variant: selectedVariant,\n      variantDef,\n      nodeMajor,\n      moduleSystem: detectedModuleSystem,\n    }, logger);\n    logger.success('Configuration files created');\n\n    // Validate generated config\n    const configPath = path.join(artkE2ePath, 'artk.config.yml');\n    const configValidation = validateArtkConfig(configPath, logger);\n    if (!configValidation.valid) {\n      logger.error('Generated configuration validation failed:');\n      for (const error of configValidation.errors) {\n        logger.error(`  - ${error}`);\n      }\n      throw new Error('Configuration validation failed');\n    }\n\n    if (configValidation.warnings.length > 0) {\n      for (const warning of configValidation.warnings) {\n        logger.warning(`Config: ${warning}`);\n      }\n    }\n\n    // Step 6: npm install\n    if (!options.skipNpm) {\n      logger.step(6, 7, 'Running npm install...');\n      await runNpmInstall(artkE2ePath, logsDir, logger);\n      logger.success('npm install completed');\n    } else {\n      logger.step(6, 7, 'Skipping npm install (--skip-npm)');\n    }\n\n    // Step 7: Browser configuration\n    let browserInfo: BrowserInfo | undefined;\n    if (!options.skipBrowsers && !options.skipNpm) {\n      logger.step(7, 7, 'Configuring browsers...');\n      browserInfo = await resolveBrowser(resolvedPath, logger, { logsDir });\n\n      // Install Playwright browsers if using bundled channel\n      if (browserInfo.channel === 'bundled') {\n        logger.debug('Installing Playwright browsers...');\n        try {\n          execSync('npx playwright install chromium', {\n            cwd: artkE2ePath,\n            stdio: 'pipe',\n            env: { ...process.env },\n            timeout: 300000, // 5 minute timeout\n          });\n          logger.debug('Playwright browsers installed');\n        } catch (error) {\n          // Non-blocking - browser resolver already configured fallback\n          logger.warning('Playwright browser installation failed, using system browser fallback');\n          // Update browser info to use system browser\n          if (browserInfo.channel === 'bundled') {\n            browserInfo = await resolveBrowser(resolvedPath, logger, {\n              logsDir,\n              skipBundled: true,\n            });\n          }\n        }\n      }\n\n      // Update config with browser info\n      const configPath = path.join(artkE2ePath, 'artk.config.yml');\n      updateArtkConfigBrowser(configPath, browserInfo);\n\n      // Update context.json with browser metadata\n      await updateContextJson(artkDir, { browser: browserInfo });\n      logger.success(`Browser configured: ${browserInfo.channel} (${browserInfo.strategy})`);\n    } else {\n      logger.step(7, 7, 'Skipping browser configuration');\n    }\n\n    // Success - clean up backups\n    await cleanupBackup(backup);\n\n    // Success!\n    printSuccessSummary(logger, resolvedPath, artkE2ePath, browserInfo);\n\n    return {\n      success: true,\n      projectPath: resolvedPath,\n      artkE2ePath,\n      browserInfo,\n      environment,\n      errors: [],\n    };\n  } catch (error) {\n    const errorMessage = error instanceof Error ? error.message : String(error);\n    logger.error(`Bootstrap failed: ${errorMessage}`);\n    errors.push(errorMessage);\n\n    // Attempt rollback\n    await rollbackOnFailure(backup, logger);\n\n    return {\n      success: false,\n      projectPath: resolvedPath,\n      artkE2ePath,\n      errors,\n    };\n  }\n}\n\n/**\n * Roll back changes on failure\n */\nasync function rollbackOnFailure(backup: BackupState, logger: Logger): Promise<void> {\n  logger.warning('Attempting to roll back changes...');\n\n  try {\n    // Restore config backup\n    if (backup.configBackupPath && fs.existsSync(backup.configBackupPath)) {\n      if (backup.configPath) {\n        await fs.copy(backup.configBackupPath, backup.configPath);\n        await fs.remove(backup.configBackupPath);\n        logger.debug('Restored artk.config.yml from backup');\n      }\n    }\n\n    // Restore context backup\n    if (backup.contextBackupPath && fs.existsSync(backup.contextBackupPath)) {\n      if (backup.contextPath) {\n        await fs.copy(backup.contextBackupPath, backup.contextPath);\n        await fs.remove(backup.contextBackupPath);\n        logger.debug('Restored context.json from backup');\n      }\n    }\n\n    logger.warning('Partial rollback completed. Some files may need manual cleanup.');\n  } catch (rollbackError) {\n    logger.error(`Rollback failed: ${rollbackError}`);\n    logger.error('Manual cleanup may be required.');\n  }\n}\n\n/**\n * Clean up backup files after successful bootstrap\n */\nasync function cleanupBackup(backup: BackupState): Promise<void> {\n  try {\n    if (backup.configBackupPath && fs.existsSync(backup.configBackupPath)) {\n      await fs.remove(backup.configBackupPath);\n    }\n    if (backup.contextBackupPath && fs.existsSync(backup.contextBackupPath)) {\n      await fs.remove(backup.contextBackupPath);\n    }\n  } catch {\n    // Best effort cleanup\n  }\n}\n\n/**\n * Create the artk-e2e directory structure\n */\nasync function createDirectoryStructure(artkE2ePath: string): Promise<void> {\n  const directories = [\n    'vendor/artk-core',\n    'vendor/artk-core-autogen',\n    'src/modules/foundation/auth',\n    'src/modules/foundation/navigation',\n    'src/modules/foundation/selectors',\n    'src/modules/foundation/data',\n    'src/modules/features',\n    'config',\n    'tests/setup',\n    'tests/foundation',\n    'tests/smoke',\n    'tests/release',\n    'tests/regression',\n    'tests/journeys',\n    'docs',\n    'journeys',\n    '.auth-states',\n  ];\n\n  for (const dir of directories) {\n    await fs.ensureDir(path.join(artkE2ePath, dir));\n  }\n}\n\n/**\n * Install @artk/core and @artk/core-autogen to vendor directory\n */\nasync function installVendorPackages(artkE2ePath: string, variant: VariantId, logger: Logger): Promise<void> {\n  // Get the assets directory (bundled with CLI)\n  const assetsDir = getAssetsDir();\n  const variantDef = getVariantDefinition(variant);\n\n  // Copy @artk/core with variant-specific dist folder\n  const coreSource = path.join(assetsDir, 'core');\n  const coreTarget = path.join(artkE2ePath, 'vendor', 'artk-core');\n\n  if (fs.existsSync(coreSource)) {\n    // First, copy the base files (package.json, etc.)\n    await fs.copy(coreSource, coreTarget, {\n      overwrite: true,\n      filter: (src) => {\n        // Skip all dist folders initially - we'll copy the right one\n        const relativePath = path.relative(coreSource, src);\n        return !relativePath.startsWith('dist');\n      },\n    });\n\n    // Now copy the correct dist folder based on variant\n    const distSource = path.join(coreSource, variantDef.distDirectory);\n    const distTarget = path.join(coreTarget, 'dist'); // Always install to 'dist' for simplicity\n\n    if (fs.existsSync(distSource)) {\n      await fs.copy(distSource, distTarget, { overwrite: true });\n      logger.debug(`Copied @artk/core ${variantDef.distDirectory}  vendor/artk-core/dist`);\n    } else {\n      // Fallback: try the default dist folder\n      const defaultDist = path.join(coreSource, 'dist');\n      if (fs.existsSync(defaultDist)) {\n        await fs.copy(defaultDist, distTarget, { overwrite: true });\n        logger.warning(`Variant dist '${variantDef.distDirectory}' not found, using default dist`);\n      } else {\n        logger.warning(`No dist folder found for @artk/core`);\n      }\n    }\n\n    // Generate variant-specific files\n    const context: ArtkContext = {\n      variant,\n      variantInstalledAt: new Date().toISOString(),\n      nodeVersion: getNodeMajorVersion(),\n      moduleSystem: variantDef.moduleSystem,\n      playwrightVersion: variantDef.playwrightVersion,\n      artkVersion: getArtkVersion(),\n      installMethod: 'cli',\n      overrideUsed: false,\n    };\n\n    // Write variant-features.json\n    const features = generateVariantFeatures(variant);\n    await fs.writeJson(path.join(coreTarget, 'variant-features.json'), features, { spaces: 2 });\n\n    // Write READONLY.md\n    const readonlyContent = generateReadonlyMarker(variantDef, context);\n    await fs.writeFile(path.join(coreTarget, 'READONLY.md'), readonlyContent);\n\n    // Write .ai-ignore\n    const aiIgnoreContent = generateAiIgnore(variant);\n    await fs.writeFile(path.join(coreTarget, '.ai-ignore'), aiIgnoreContent);\n\n    logger.debug(`Copied @artk/core from bundled assets (variant: ${variant})`);\n  } else {\n    logger.warning(`@artk/core assets not found at ${coreSource}`);\n    // Create minimal package.json for development\n    await fs.writeJson(path.join(coreTarget, 'package.json'), {\n      name: '@artk/core',\n      version: '1.0.0',\n      main: './dist/index.js',\n    });\n  }\n\n  // Copy @artk/core-autogen (same for all variants currently)\n  const autogenSource = path.join(assetsDir, 'autogen');\n  const autogenTarget = path.join(artkE2ePath, 'vendor', 'artk-core-autogen');\n\n  if (fs.existsSync(autogenSource)) {\n    await fs.copy(autogenSource, autogenTarget, { overwrite: true });\n    logger.debug(`Copied @artk/core-autogen from bundled assets`);\n  } else {\n    logger.warning(`@artk/core-autogen assets not found at ${autogenSource}`);\n    await fs.writeJson(path.join(autogenTarget, 'package.json'), {\n      name: '@artk/core-autogen',\n      version: '0.1.0',\n      main: './dist/index.js',\n    });\n  }\n}\n\n/**\n * Install prompts to .github/prompts/\n */\nasync function installPrompts(projectPath: string, logger: Logger): Promise<void> {\n  const assetsDir = getAssetsDir();\n  const promptsSource = path.join(assetsDir, 'prompts');\n  const promptsTarget = path.join(projectPath, '.github', 'prompts');\n\n  await fs.ensureDir(promptsTarget);\n\n  if (fs.existsSync(promptsSource)) {\n    const promptFiles = await fs.readdir(promptsSource);\n    let installed = 0;\n\n    for (const file of promptFiles) {\n      if (file.endsWith('.md') && file.startsWith('artk.')) {\n        const source = path.join(promptsSource, file);\n        // Rename artk.*.md to artk.*.prompt.md\n        const targetName = file.replace(/\\.md$/, '.prompt.md');\n        const target = path.join(promptsTarget, targetName);\n\n        await fs.copy(source, target, { overwrite: true });\n        installed++;\n        logger.debug(`Installed prompt: ${targetName}`);\n      }\n    }\n\n    logger.debug(`Installed ${installed} prompt files`);\n  } else {\n    logger.warning(`Prompts assets not found at ${promptsSource}`);\n  }\n}\n\n/**\n * Create configuration files (package.json, playwright.config.ts, etc.)\n */\nasync function createConfigurationFiles(\n  artkE2ePath: string,\n  artkDir: string,\n  projectPath: string,\n  options: {\n    projectName: string;\n    variant: VariantId;\n    variantDef: import('./variants/index.js').Variant;\n    nodeMajor: number;\n    moduleSystem: 'esm' | 'cjs';\n  },\n  logger: Logger\n): Promise<void> {\n  // Determine Playwright version based on variant\n  const playwrightVersionMap: Record<string, string> = {\n    '1.57.x': '^1.57.0',\n    '1.49.x': '^1.49.0',\n    '1.33.x': '^1.33.0',\n  };\n  const playwrightVersion = playwrightVersionMap[options.variantDef.playwrightVersion];\n  if (!playwrightVersion) {\n    throw new Error(`Unknown Playwright version for variant ${options.variant}: ${options.variantDef.playwrightVersion}. Add mapping to playwrightVersionMap.`);\n  }\n\n  // Determine @types/node version based on variant's Node.js target\n  const nodeTypesMap: Record<VariantId, string> = {\n    'legacy-14': '^14.0.0',\n    'legacy-16': '^16.0.0',\n    'modern-esm': '^20.0.0',\n    'modern-cjs': '^20.0.0',\n  };\n  const nodeTypesVersion = nodeTypesMap[options.variant];\n\n  // package.json\n  await fs.writeJson(\n    path.join(artkE2ePath, 'package.json'),\n    {\n      name: 'artk-e2e',\n      version: '1.0.0',\n      private: true,\n      scripts: {\n        test: 'playwright test',\n        'test:smoke': 'playwright test --grep @smoke',\n        'test:release': 'playwright test --grep @release',\n        'test:regression': 'playwright test --grep @regression',\n        'test:validation': 'playwright test --project=validation',\n        'test:ui': 'playwright test --ui',\n        report: 'playwright show-report',\n        typecheck: 'tsc --noEmit',\n      },\n      dependencies: {\n        yaml: '^2.3.4',\n      },\n      devDependencies: {\n        '@artk/core': 'file:./vendor/artk-core',\n        '@artk/core-autogen': 'file:./vendor/artk-core-autogen',\n        '@playwright/test': playwrightVersion,\n        '@types/node': nodeTypesVersion,\n        typescript: '^5.3.0',\n      },\n    },\n    { spaces: 2 }\n  );\n  logger.debug(`Using Playwright ${playwrightVersion} for variant ${options.variant}`);\n\n  // playwright.config.ts\n  await fs.writeFile(\n    path.join(artkE2ePath, 'playwright.config.ts'),\n    getPlaywrightConfigTemplate()\n  );\n\n  // tsconfig.json\n  await fs.writeJson(\n    path.join(artkE2ePath, 'tsconfig.json'),\n    {\n      compilerOptions: {\n        target: 'ES2022',\n        module: 'CommonJS',\n        moduleResolution: 'Node',\n        lib: ['ES2022', 'DOM'],\n        strict: true,\n        esModuleInterop: true,\n        allowSyntheticDefaultImports: true,\n        skipLibCheck: true,\n        forceConsistentCasingInFileNames: true,\n        outDir: './dist',\n        rootDir: '.',\n        declaration: true,\n        resolveJsonModule: true,\n        baseUrl: '.',\n        paths: {\n          '@artk/core': ['./vendor/artk-core/dist'],\n          '@artk/core/*': ['./vendor/artk-core/dist/*'],\n        },\n      },\n      include: ['tests/**/*', 'src/**/*', 'config/**/*', '*.ts'],\n      exclude: ['node_modules', 'dist', 'vendor'],\n    },\n    { spaces: 2 }\n  );\n\n  // artk.config.yml\n  await fs.writeFile(\n    path.join(artkE2ePath, 'artk.config.yml'),\n    getArtkConfigTemplate(options.projectName)\n  );\n\n  // .gitignore\n  await fs.writeFile(\n    path.join(artkE2ePath, '.gitignore'),\n    `node_modules/\ndist/\ntest-results/\nplaywright-report/\n.auth-states/\n*.local\n`\n  );\n\n  // Foundation modules generation using @artk/core's generator\n  // This ensures feature parity with shell script bootstrap\n  const coreGeneratorPath = path.join(artkE2ePath, 'vendor', 'artk-core', 'scripts', 'generate-foundation.ts');\n  if (fs.existsSync(coreGeneratorPath)) {\n    logger.debug('Generating foundation modules via @artk/core...');\n    try {\n      // Use tsx to run the TypeScript generator directly\n      execSync(\n        `npx tsx \"${coreGeneratorPath}\" --projectRoot=\"${projectPath}\" --variant=\"${options.variant}\"`,\n        {\n          cwd: artkE2ePath,\n          stdio: 'pipe',\n          env: { ...process.env },\n        }\n      );\n      logger.debug('Foundation modules generated successfully');\n    } catch (error) {\n      // Non-blocking - foundation modules will be created by /artk.discover-foundation\n      const errorMessage = error instanceof Error ? error.message : String(error);\n      logger.warning(`Foundation module generation failed (non-blocking): ${errorMessage}`);\n      logger.debug('Foundation modules will be created by /artk.discover-foundation prompt');\n    }\n  } else {\n    logger.debug('Foundation generator not found in vendor, using stubs only');\n  }\n\n  // Create additional module stubs (selectors, data, features)\n  await createAdditionalModuleStubs(artkE2ePath);\n\n  // Copy foundation validation spec from bundled template\n  await copyFoundationValidationSpec(artkE2ePath, logger);\n\n  // .artk/context.json with full variant metadata\n  await fs.ensureDir(artkDir);\n  const context: ArtkContext = {\n    variant: options.variant,\n    variantInstalledAt: new Date().toISOString(),\n    nodeVersion: options.nodeMajor,\n    moduleSystem: options.moduleSystem,\n    playwrightVersion: options.variantDef.playwrightVersion,\n    artkVersion: getArtkVersion(),\n    installMethod: 'cli',\n    overrideUsed: false,\n  };\n\n  await fs.writeJson(\n    path.join(artkDir, 'context.json'),\n    {\n      version: 1, // Integer version as per schema\n      projectRoot: projectPath,\n      artkRoot: artkE2ePath,\n      initialized_at: new Date().toISOString(),\n      next_suggested: '/artk.init-playbook',\n      // Variant-specific metadata\n      ...context,\n    },\n    { spaces: 2 }\n  );\n\n  // .artk/.gitignore\n  await fs.writeFile(\n    path.join(artkDir, '.gitignore'),\n    `# ARTK temporary files\nbrowsers/\nheal-logs/\nlogs/\n*.heal.json\nselector-catalog.local.json\n`\n  );\n}\n\n/**\n * Create additional module stubs (selectors, data, features)\n * The main foundation modules (auth, config, navigation) are generated by template processor\n */\nasync function createAdditionalModuleStubs(artkE2ePath: string): Promise<void> {\n  const foundationPath = path.join(artkE2ePath, 'src', 'modules', 'foundation');\n\n  // Selectors stub\n  await fs.ensureDir(path.join(foundationPath, 'selectors'));\n  await fs.writeFile(\n    path.join(foundationPath, 'selectors', 'index.ts'),\n    `/**\n * Selectors Module - Locator utilities\n *\n * This file will be populated by /artk.discover-foundation\n * Provides data-testid helpers and selector utilities.\n */\n\nimport type { Page, Locator } from '@playwright/test';\n\n/**\n * Get element by data-testid\n */\nexport function getByTestId(page: Page, testId: string): Locator {\n  return page.locator(\\`[data-testid=\"\\${testId}\"]\\`);\n}\n\n/**\n * Get all elements by data-testid prefix\n */\nexport function getAllByTestIdPrefix(page: Page, prefix: string): Locator {\n  return page.locator(\\`[data-testid^=\"\\${prefix}\"]\\`);\n}\n`\n  );\n\n  // Data stub\n  await fs.ensureDir(path.join(foundationPath, 'data'));\n  await fs.writeFile(\n    path.join(foundationPath, 'data', 'index.ts'),\n    `/**\n * Data Module - Test data builders and cleanup\n *\n * This file will be populated by /artk.discover-foundation\n * Provides test data factories and cleanup utilities.\n */\n\n/**\n * Generate unique test identifier\n */\nexport function generateTestId(prefix: string = 'test'): string {\n  const timestamp = Date.now();\n  const random = Math.random().toString(36).substring(2, 8);\n  return \\`\\${prefix}_\\${timestamp}_\\${random}\\`;\n}\n\n/**\n * Cleanup registry for test data\n */\nconst cleanupRegistry: Array<() => Promise<void>> = [];\n\nexport function registerCleanup(fn: () => Promise<void>): void {\n  cleanupRegistry.push(fn);\n}\n\nexport async function runCleanup(): Promise<void> {\n  for (const cleanup of cleanupRegistry.reverse()) {\n    await cleanup();\n  }\n  cleanupRegistry.length = 0;\n}\n`\n  );\n\n  // Features index\n  await fs.writeFile(\n    path.join(artkE2ePath, 'src', 'modules', 'features', 'index.ts'),\n    `/**\n * Feature Modules - Journey-specific page objects\n *\n * These modules are created as Journeys are implemented and provide\n * page objects and flows for specific feature areas.\n */\n\nexport {};\n`\n  );\n}\n\n/**\n * Copy foundation validation spec from bundled template\n */\nasync function copyFoundationValidationSpec(artkE2ePath: string, logger: Logger): Promise<void> {\n  const validationSpecDest = path.join(artkE2ePath, 'tests', 'foundation', 'foundation.validation.spec.ts');\n\n  // Ensure directory exists\n  await fs.ensureDir(path.dirname(validationSpecDest));\n\n  // Try to read from bundled template\n  const bundledTemplate = readBundledTemplate('foundation.validation.spec.ts');\n  if (bundledTemplate) {\n    await fs.writeFile(validationSpecDest, bundledTemplate);\n    logger.debug('Created foundation validation tests from template');\n    return;\n  }\n\n  // Fallback: create minimal validation spec\n  await fs.writeFile(\n    validationSpecDest,\n    `import { test, expect } from '@playwright/test';\n\ntest.describe('ARTK Foundation Validation', () => {\n  test('baseURL is configured', async ({ baseURL }) => {\n    expect(baseURL).toBeTruthy();\n    expect(baseURL).toMatch(/^https?:\\\\/\\\\//);\n  });\n\n  test('baseURL is not a placeholder', async ({ baseURL }) => {\n    expect(baseURL).not.toContain('\\${');\n  });\n\n  test('Playwright is correctly installed', async ({ browserName }) => {\n    expect(browserName).toBeTruthy();\n  });\n});\n`\n  );\n  logger.debug('Created foundation validation tests (fallback)');\n}\n\n/**\n * Run npm install in artk-e2e directory\n */\nasync function runNpmInstall(artkE2ePath: string, logsDir: string, logger: Logger): Promise<void> {\n  const logFile = path.join(logsDir, 'npm-install.log');\n\n  return new Promise((resolve, reject) => {\n    logger.startSpinner('Installing dependencies...');\n\n    const logLines: string[] = [`npm install started - ${new Date().toISOString()}`];\n    logLines.push(`Working directory: ${artkE2ePath}`);\n\n    const child = spawn('npm', ['install', '--legacy-peer-deps'], {\n      cwd: artkE2ePath,\n      env: {\n        ...process.env,\n        PLAYWRIGHT_SKIP_BROWSER_DOWNLOAD: '1',\n      },\n      shell: true,\n      stdio: 'pipe',\n    });\n\n    let stdout = '';\n    let stderr = '';\n\n    child.stdout?.on('data', (data) => {\n      stdout += data.toString();\n    });\n\n    child.stderr?.on('data', (data) => {\n      stderr += data.toString();\n    });\n\n    child.on('close', (code) => {\n      logLines.push(`Exit code: ${code}`);\n      logLines.push('--- STDOUT ---');\n      logLines.push(stdout || '(empty)');\n      logLines.push('--- STDERR ---');\n      logLines.push(stderr || '(empty)');\n\n      // Write log file\n      try {\n        fs.writeFileSync(logFile, logLines.join('\\n'));\n      } catch {\n        // Best effort\n      }\n\n      if (code === 0) {\n        logger.succeedSpinner('Dependencies installed');\n        resolve();\n      } else {\n        logger.failSpinner('npm install failed');\n        logger.debug(`Details saved to: ${logFile}`);\n        reject(new Error(`npm install failed with code ${code}. See ${logFile} for details.`));\n      }\n    });\n\n    child.on('error', (error) => {\n      logLines.push(`Process error: ${error.message}`);\n      try {\n        fs.writeFileSync(logFile, logLines.join('\\n'));\n      } catch {\n        // Best effort\n      }\n      logger.failSpinner('npm install failed');\n      reject(error);\n    });\n\n    // Timeout after 5 minutes\n    setTimeout(() => {\n      logLines.push('TIMEOUT: Installation took longer than 5 minutes');\n      try {\n        fs.writeFileSync(logFile, logLines.join('\\n'));\n      } catch {\n        // Best effort\n      }\n      child.kill();\n      logger.failSpinner('npm install timed out');\n      reject(new Error('npm install timed out'));\n    }, 300000);\n  });\n}\n\n/**\n * Update context.json with additional metadata\n */\nasync function updateContextJson(artkDir: string, updates: Record<string, any>): Promise<void> {\n  const contextPath = path.join(artkDir, 'context.json');\n\n  let context: Record<string, any> = {};\n  if (fs.existsSync(contextPath)) {\n    context = await fs.readJson(contextPath);\n  }\n\n  Object.assign(context, updates);\n  await fs.writeJson(contextPath, context, { spaces: 2 });\n}\n\n/**\n * Get the assets directory path\n */\nfunction getAssetsDir(): string {\n  // Try relative to the built CLI\n  const possiblePaths = [\n    path.join(__dirname, '..', '..', 'assets'),\n    path.join(__dirname, '..', 'assets'),\n    path.join(__dirname, 'assets'),\n  ];\n\n  for (const p of possiblePaths) {\n    if (fs.existsSync(p)) {\n      return p;\n    }\n  }\n\n  // Fallback to development path\n  return path.join(__dirname, '..', '..', 'assets');\n}\n\n/**\n * Print success summary\n */\nfunction printSuccessSummary(\n  logger: Logger,\n  projectPath: string,\n  artkE2ePath: string,\n  browserInfo?: BrowserInfo\n): void {\n  logger.blank();\n  logger.header('ARTK Installation Complete!');\n  logger.blank();\n\n  logger.info('Installed:');\n  logger.list([\n    'artk-e2e/                             - E2E test workspace',\n    'artk-e2e/vendor/artk-core/            - @artk/core (vendored)',\n    'artk-e2e/vendor/artk-core-autogen/    - @artk/core-autogen (vendored)',\n    'artk-e2e/package.json                 - Test workspace dependencies',\n    'artk-e2e/playwright.config.ts         - Playwright configuration',\n    'artk-e2e/tsconfig.json                - TypeScript configuration',\n    'artk-e2e/artk.config.yml              - ARTK configuration',\n    '.github/prompts/                      - Copilot prompts',\n    '.artk/context.json                    - ARTK context',\n    '.artk/browsers/                       - Playwright browsers cache',\n  ]);\n\n  if (browserInfo) {\n    logger.blank();\n    logger.info('Browser configuration:');\n    logger.table([\n      { label: 'channel', value: browserInfo.channel },\n      { label: 'strategy', value: browserInfo.strategy },\n      ...(browserInfo.path ? [{ label: 'path', value: browserInfo.path }] : []),\n    ]);\n  }\n\n  logger.nextSteps([\n    'cd artk-e2e',\n    'Open VS Code and use /artk.init-playbook in Copilot Chat',\n  ]);\n\n  logger.info('Run tests:');\n  logger.list(['cd artk-e2e && npm test']);\n}\n\n/**\n * Playwright config template\n * Reads from bundled template or falls back to inline version\n */\nfunction getPlaywrightConfigTemplate(): string {\n  // Try to read from bundled template first\n  const bundledTemplate = readBundledTemplate('playwright.config.template.ts');\n  if (bundledTemplate) {\n    return bundledTemplate;\n  }\n\n  // Fallback: inline template (synchronized with PowerShell/Bash)\n  return `import { defineConfig, devices } from '@playwright/test';\nimport * as fs from 'fs';\nimport * as path from 'path';\n\nfunction loadArtkConfig(): Record<string, any> {\n  const configPath = path.join(__dirname, 'artk.config.yml');\n  if (!fs.existsSync(configPath)) {\n    console.warn('[ARTK] Config not found, using defaults');\n    return { environments: { local: { baseUrl: 'http://localhost:3000' } } };\n  }\n  try {\n    const yaml = require('yaml');\n    return yaml.parse(fs.readFileSync(configPath, 'utf8'));\n  } catch (e: any) {\n    console.error(\\`[ARTK] Failed to parse artk.config.yml: \\${e.message}\\`);\n    return { environments: { local: { baseUrl: 'http://localhost:3000' } } };\n  }\n}\n\nconst _missingEnvVars: string[] = [];\n\nfunction resolveEnvVars(value: string): string {\n  if (typeof value !== 'string') return String(value);\n  return value.replace(\n    /\\\\$\\\\{([A-Z_][A-Z0-9_]*)(:-([^}]*))?\\\\}/gi,\n    (match, varName, _hasDefault, defaultValue) => {\n      const envValue = process.env[varName];\n      if (envValue !== undefined && envValue !== '') return envValue;\n      if (defaultValue !== undefined) return defaultValue;\n      _missingEnvVars.push(varName);\n      return '';\n    }\n  );\n}\n\nconst artkConfig = loadArtkConfig();\nconst env = process.env.ARTK_ENV || 'local';\nconst rawBaseUrl = artkConfig.environments?.[env]?.baseUrl || 'http://localhost:3000';\nconst baseURL = resolveEnvVars(rawBaseUrl);\nconst browserChannel = artkConfig.browsers?.channel;\n\nif (_missingEnvVars.length > 0) {\n  const unique = [...new Set(_missingEnvVars)];\n  console.warn(\\`[ARTK] Missing env vars (no defaults): \\${unique.join(', ')}\\`);\n}\n\nconst browserUse: Record<string, any> = { ...devices['Desktop Chrome'] };\nif (browserChannel && browserChannel !== 'bundled') {\n  browserUse.channel = browserChannel;\n}\n\nexport default defineConfig({\n  testDir: './tests',\n  fullyParallel: true,\n  forbidOnly: !!process.env.CI,\n  retries: process.env.CI ? 2 : 0,\n  workers: process.env.CI ? 1 : undefined,\n  reporter: [['html', { open: 'never' }]],\n  timeout: artkConfig.settings?.timeout || 30000,\n  use: {\n    baseURL,\n    trace: 'on-first-retry',\n    screenshot: 'only-on-failure',\n  },\n  projects: [\n    { name: 'setup', testMatch: /.*\\\\.setup\\\\.ts/ },\n    { name: 'chromium', use: browserUse, dependencies: ['setup'] },\n    { name: 'validation', testMatch: /foundation\\\\.validation\\\\.spec\\\\.ts/, use: { ...browserUse, baseURL } },\n  ],\n});\n`;\n}\n\n/**\n * ARTK config template\n */\nfunction getArtkConfigTemplate(projectName: string): string {\n  return `# ARTK Configuration\n# Generated by @artk/cli on ${new Date().toISOString()}\n\nversion: 1\n\napp:\n  name: \"${projectName}\"\n  type: web\n  description: \"E2E tests for ${projectName}\"\n\nenvironments:\n  local:\n    baseUrl: \\${ARTK_BASE_URL:-http://localhost:3000}\n  intg:\n    baseUrl: \\${ARTK_INTG_URL:-https://intg.example.com}\n  ctlq:\n    baseUrl: \\${ARTK_CTLQ_URL:-https://ctlq.example.com}\n  prod:\n    baseUrl: \\${ARTK_PROD_URL:-https://example.com}\n\nauth:\n  provider: oidc\n  storageStateDir: ./.auth-states\n  # roles:\n  #   admin:\n  #     username: \\${ADMIN_USER}\n  #     password: \\${ADMIN_PASS}\n\nsettings:\n  parallel: true\n  retries: 2\n  timeout: 30000\n  traceOnFailure: true\n\nbrowsers:\n  enabled:\n    - chromium\n  channel: bundled\n  strategy: auto\n  viewport:\n    width: 1280\n    height: 720\n  headless: true\n`;\n}\n","/**\n * Environment detection utilities\n *\n * Detects the target project's module system (ESM vs CommonJS)\n * and other environment characteristics.\n */\n\nimport * as fs from 'fs';\nimport * as path from 'path';\n\nexport interface EnvironmentInfo {\n  moduleSystem: 'esm' | 'commonjs' | 'unknown';\n  nodeVersion: string;\n  npmVersion: string | null;\n  hasGit: boolean;\n  hasPlaywright: boolean;\n  hasArtkCore: boolean;\n  platform: NodeJS.Platform;\n  arch: string;\n  isCI: boolean;\n}\n\n/**\n * Detect the target project's environment\n */\nexport async function detectEnvironment(projectPath: string): Promise<EnvironmentInfo> {\n  const resolvedPath = path.resolve(projectPath);\n\n  return {\n    moduleSystem: detectModuleSystem(resolvedPath),\n    nodeVersion: process.version,\n    npmVersion: await detectNpmVersion(),\n    hasGit: await detectGit(resolvedPath),\n    hasPlaywright: detectPlaywright(resolvedPath),\n    hasArtkCore: detectArtkCore(resolvedPath),\n    platform: process.platform,\n    arch: process.arch,\n    isCI: detectCI(),\n  };\n}\n\n/**\n * Detect the module system from package.json and file extensions\n */\nfunction detectModuleSystem(projectPath: string): 'esm' | 'commonjs' | 'unknown' {\n  const packageJsonPath = path.join(projectPath, 'package.json');\n\n  // Check package.json \"type\" field\n  if (fs.existsSync(packageJsonPath)) {\n    try {\n      const pkg = JSON.parse(fs.readFileSync(packageJsonPath, 'utf8'));\n      if (pkg.type === 'module') {\n        return 'esm';\n      }\n      if (pkg.type === 'commonjs' || !pkg.type) {\n        // Check for ESM indicators even without \"type\": \"module\"\n        const hasEsmConfig = fs.existsSync(path.join(projectPath, 'tsconfig.json'));\n        if (hasEsmConfig) {\n          try {\n            const tsconfig = JSON.parse(fs.readFileSync(path.join(projectPath, 'tsconfig.json'), 'utf8'));\n            const module = tsconfig.compilerOptions?.module?.toLowerCase();\n            if (module && (module.includes('esnext') || module.includes('es20') || module === 'nodenext')) {\n              return 'esm';\n            }\n          } catch {\n            // Ignore tsconfig parse errors\n          }\n        }\n        return 'commonjs';\n      }\n    } catch {\n      // Ignore parse errors\n    }\n  }\n\n  // Check for .mjs files (strong ESM indicator)\n  const srcDir = path.join(projectPath, 'src');\n  if (fs.existsSync(srcDir)) {\n    try {\n      const files = fs.readdirSync(srcDir, { recursive: true }) as string[];\n      const hasMjs = files.some((f) => f.endsWith('.mjs'));\n      const hasCjs = files.some((f) => f.endsWith('.cjs'));\n      if (hasMjs && !hasCjs) return 'esm';\n      if (hasCjs && !hasMjs) return 'commonjs';\n    } catch {\n      // Ignore read errors\n    }\n  }\n\n  return 'unknown';\n}\n\n/**\n * Get npm version\n */\nasync function detectNpmVersion(): Promise<string | null> {\n  try {\n    const { execSync } = await import('child_process');\n    const version = execSync('npm --version', { encoding: 'utf8' }).trim();\n    return version;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Check if the project is a git repository\n */\nasync function detectGit(projectPath: string): Promise<boolean> {\n  // Check for .git directory\n  if (fs.existsSync(path.join(projectPath, '.git'))) {\n    return true;\n  }\n\n  // Check if we're in a subdirectory of a git repo\n  try {\n    const { execSync } = await import('child_process');\n    execSync('git rev-parse --git-dir', { cwd: projectPath, encoding: 'utf8', stdio: 'pipe' });\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Check if Playwright is installed\n */\nfunction detectPlaywright(projectPath: string): boolean {\n  const playwrightPath = path.join(projectPath, 'node_modules', '@playwright', 'test');\n  return fs.existsSync(playwrightPath);\n}\n\n/**\n * Check if @artk/core is installed\n */\nfunction detectArtkCore(projectPath: string): boolean {\n  // Check vendor location\n  const vendorPath = path.join(projectPath, 'artk-e2e', 'vendor', 'artk-core');\n  if (fs.existsSync(vendorPath)) return true;\n\n  // Check node_modules\n  const nodeModulesPath = path.join(projectPath, 'node_modules', '@artk', 'core');\n  return fs.existsSync(nodeModulesPath);\n}\n\n/**\n * Detect CI environment\n */\nexport function isCI(): boolean {\n  return !!(\n    process.env.CI ||\n    process.env.GITHUB_ACTIONS ||\n    process.env.GITLAB_CI ||\n    process.env.JENKINS_HOME ||\n    process.env.CIRCLECI ||\n    process.env.TRAVIS ||\n    process.env.TF_BUILD ||\n    process.env.USER === 'jenkins' ||\n    process.env.USER === 'gitlab-runner' ||\n    process.env.USER === 'circleci'\n  );\n}\n\n// Alias for backwards compatibility\nfunction detectCI(): boolean {\n  return isCI();\n}\n\n/**\n * Get OS and architecture for browser downloads\n */\nexport function getOsArch(): { os: string; arch: string } {\n  let os: string;\n  switch (process.platform) {\n    case 'darwin':\n      os = 'macos';\n      break;\n    case 'win32':\n      os = 'windows';\n      break;\n    case 'linux':\n      os = 'linux';\n      break;\n    default:\n      os = 'unknown';\n  }\n\n  let arch: string;\n  switch (process.arch) {\n    case 'x64':\n      arch = 'x64';\n      break;\n    case 'arm64':\n      arch = 'arm64';\n      break;\n    case 'ia32':\n      arch = 'x86';\n      break;\n    default:\n      arch = 'unknown';\n  }\n\n  return { os, arch };\n}\n","/**\n * Browser resolver\n *\n * Handles browser detection and installation for Playwright tests.\n * Implements a fallback chain: release cache  bundled install  system browsers\n */\n\nimport { execSync, spawn, SpawnOptions } from 'child_process';\nimport * as fs from 'fs';\nimport * as path from 'path';\nimport * as https from 'https';\nimport * as crypto from 'crypto';\nimport { getOsArch, isCI } from './environment.js';\nimport { Logger } from './logger.js';\n\nexport type BrowserChannel = 'bundled' | 'msedge' | 'chrome' | 'chrome-beta' | 'chrome-dev';\nexport type BrowserStrategy = 'auto' | 'bundled-only' | 'system-only' | 'prefer-system' | 'prefer-bundled';\n\nexport interface BrowserInfo {\n  channel: BrowserChannel;\n  version: string | null;\n  path: string | null;\n  strategy: 'release-cache' | 'bundled-install' | 'system' | 'auto';\n}\n\nexport interface BrowserResolverOptions {\n  artkE2ePath: string;\n  browsersCachePath: string;\n  logger: Logger;\n  skipInstall?: boolean;\n  strategy?: BrowserStrategy;\n  logsDir?: string;\n}\n\n/**\n * Resolve and configure browsers for Playwright\n */\nexport async function resolveBrowser(\n  targetPath: string,\n  logger?: Logger,\n  options: { strategy?: BrowserStrategy; logsDir?: string; skipBundled?: boolean } = {}\n): Promise<BrowserInfo> {\n  const log = logger || new Logger();\n  const artkE2ePath = path.join(targetPath, 'artk-e2e');\n  const browsersCachePath = path.join(targetPath, '.artk', 'browsers');\n  const logsDir = options.logsDir || path.join(targetPath, '.artk', 'logs');\n\n  // Ensure directories exist\n  fs.mkdirSync(browsersCachePath, { recursive: true });\n  fs.mkdirSync(logsDir, { recursive: true });\n\n  // Set environment for Playwright\n  process.env.PLAYWRIGHT_BROWSERS_PATH = browsersCachePath;\n\n  // Determine effective strategy\n  let strategy = options.strategy || 'auto';\n\n  // If skipBundled is set, force system-only strategy\n  if (options.skipBundled) {\n    log.debug('skipBundled option set - using system browsers only');\n    strategy = 'system-only';\n  }\n\n  // CI environment forces bundled browsers for reproducibility\n  if (isCI() && strategy !== 'system-only') {\n    log.info('CI environment detected - using bundled browsers for reproducibility');\n    strategy = 'bundled-only';\n  }\n\n  // Strategy-based resolution\n  switch (strategy) {\n    case 'bundled-only':\n      return await resolveBundledOnly(artkE2ePath, browsersCachePath, logsDir, log);\n\n    case 'system-only':\n      return await resolveSystemOnly(logsDir, log);\n\n    case 'prefer-system':\n      return await resolvePreferSystem(artkE2ePath, browsersCachePath, logsDir, log);\n\n    case 'prefer-bundled':\n    case 'auto':\n    default:\n      return await resolveAuto(artkE2ePath, browsersCachePath, logsDir, log);\n  }\n}\n\n/**\n * Strategy: bundled-only - Only use bundled browsers, fail if can't install\n */\nasync function resolveBundledOnly(\n  artkE2ePath: string,\n  browsersCachePath: string,\n  logsDir: string,\n  logger: Logger\n): Promise<BrowserInfo> {\n  // Try release cache first\n  logger.debug('Strategy: bundled-only - trying release cache...');\n  const releaseCacheResult = await tryReleaseCacheBrowsers(artkE2ePath, browsersCachePath, logsDir, logger);\n  if (releaseCacheResult) {\n    return releaseCacheResult;\n  }\n\n  // Try bundled install\n  logger.debug('Release cache unavailable, trying bundled install...');\n  const bundledResult = await tryBundledInstall(artkE2ePath, browsersCachePath, logsDir, logger);\n  if (bundledResult) {\n    return bundledResult;\n  }\n\n  // Fail - bundled-only strategy requires bundled browsers\n  throw new Error(\n    'Strategy is \"bundled-only\" but bundled browser installation failed.\\n' +\n    'Solutions:\\n' +\n    '  1. Check network connectivity\\n' +\n    '  2. Grant permissions for Playwright browser installation\\n' +\n    '  3. Set ARTK_PLAYWRIGHT_BROWSERS_REPO for release cache\\n' +\n    `  4. Check logs at: ${logsDir}`\n  );\n}\n\n/**\n * Strategy: system-only - Only use system browser, fail if not found\n */\nasync function resolveSystemOnly(logsDir: string, logger: Logger): Promise<BrowserInfo> {\n  logger.debug('Strategy: system-only - detecting system browsers...');\n  const systemResult = await detectSystemBrowser(logsDir, logger);\n\n  if (systemResult.channel !== 'bundled') {\n    return systemResult;\n  }\n\n  // Fail - system-only strategy requires system browsers\n  throw new Error(\n    'Strategy is \"system-only\" but no system browsers found.\\n' +\n    'Solutions:\\n' +\n    '  1. Install Microsoft Edge: https://microsoft.com/edge\\n' +\n    '  2. Install Google Chrome: https://google.com/chrome\\n' +\n    '  3. Change strategy in artk.config.yml to \"auto\" or \"prefer-bundled\"\\n' +\n    `  4. Check logs at: ${logsDir}`\n  );\n}\n\n/**\n * Strategy: prefer-system - Try system first, then bundled as fallback\n */\nasync function resolvePreferSystem(\n  artkE2ePath: string,\n  browsersCachePath: string,\n  logsDir: string,\n  logger: Logger\n): Promise<BrowserInfo> {\n  logger.debug('Strategy: prefer-system - checking system browsers first...');\n\n  // Try system browsers first\n  const systemResult = await detectSystemBrowser(logsDir, logger);\n  if (systemResult.channel !== 'bundled') {\n    logger.success(`Using system browser: ${systemResult.channel}`);\n    return systemResult;\n  }\n\n  // Fall back to bundled\n  logger.debug('No system browsers found, falling back to bundled...');\n\n  const releaseCacheResult = await tryReleaseCacheBrowsers(artkE2ePath, browsersCachePath, logsDir, logger);\n  if (releaseCacheResult) {\n    return releaseCacheResult;\n  }\n\n  const bundledResult = await tryBundledInstall(artkE2ePath, browsersCachePath, logsDir, logger);\n  if (bundledResult) {\n    return bundledResult;\n  }\n\n  return failWithDiagnostics(logsDir, logger);\n}\n\n/**\n * Strategy: auto/prefer-bundled - Try release cache  bundled  system\n */\nasync function resolveAuto(\n  artkE2ePath: string,\n  browsersCachePath: string,\n  logsDir: string,\n  logger: Logger\n): Promise<BrowserInfo> {\n  // Try release cache first (fastest)\n  logger.debug('Attempting to download pre-built browsers from release cache...');\n  const releaseCacheResult = await tryReleaseCacheBrowsers(artkE2ePath, browsersCachePath, logsDir, logger);\n  if (releaseCacheResult) {\n    return releaseCacheResult;\n  }\n\n  // Try bundled Playwright install\n  logger.debug('Attempting bundled Playwright browser install...');\n  const bundledResult = await tryBundledInstall(artkE2ePath, browsersCachePath, logsDir, logger);\n  if (bundledResult) {\n    return bundledResult;\n  }\n\n  // Fall back to system browsers\n  logger.debug('Detecting system browsers...');\n  const systemResult = await detectSystemBrowser(logsDir, logger);\n  if (systemResult.channel !== 'bundled') {\n    return systemResult;\n  }\n\n  return failWithDiagnostics(logsDir, logger);\n}\n\n/**\n * Fail with diagnostic information when all fallbacks fail\n */\nfunction failWithDiagnostics(logsDir: string, logger: Logger): never {\n  logger.error('ERROR: No browsers available');\n  logger.error('ARTK tried:');\n  logger.error('  1. Pre-built browser cache: Unavailable');\n  logger.error('  2. Bundled Chromium install: Failed');\n  logger.error('  3. System Microsoft Edge: Not found');\n  logger.error('  4. System Google Chrome: Not found');\n  logger.error('');\n  logger.error('Solutions:');\n  logger.error('  1. Install Microsoft Edge: https://microsoft.com/edge');\n  logger.error('  2. Install Google Chrome: https://google.com/chrome');\n  logger.error('  3. Set ARTK_PLAYWRIGHT_BROWSERS_REPO for release cache');\n  logger.error('  4. Grant permissions for Playwright browser installation');\n  logger.error(`  5. Check logs at: ${logsDir}`);\n\n  throw new Error('No browsers available. See error messages above for solutions.');\n}\n\n/**\n * Try to download pre-built browsers from GitHub release\n */\nasync function tryReleaseCacheBrowsers(\n  artkE2ePath: string,\n  browsersCachePath: string,\n  logsDir: string,\n  logger: Logger\n): Promise<BrowserInfo | null> {\n  const logFile = path.join(logsDir, 'release-cache-download.log');\n  const logLines: string[] = [`Release cache download attempt - ${new Date().toISOString()}`];\n\n  // Get Chromium revision from Playwright\n  const browsersJsonPath = path.join(artkE2ePath, 'node_modules', 'playwright-core', 'browsers.json');\n  if (!fs.existsSync(browsersJsonPath)) {\n    logLines.push('browsers.json not found, skipping release cache');\n    writeLogFile(logFile, logLines);\n    logger.debug('browsers.json not found, skipping release cache');\n    return null;\n  }\n\n  try {\n    const browsersJson = JSON.parse(fs.readFileSync(browsersJsonPath, 'utf8'));\n    const chromium = browsersJson.browsers?.find((b: any) => b.name === 'chromium');\n    if (!chromium?.revision) {\n      logLines.push('Chromium revision not found in browsers.json');\n      writeLogFile(logFile, logLines);\n      logger.debug('Chromium revision not found in browsers.json');\n      return null;\n    }\n\n    logLines.push(`Chromium revision: ${chromium.revision}`);\n\n    const { os, arch } = getOsArch();\n    if (os === 'unknown' || arch === 'unknown') {\n      logLines.push(`Unsupported OS/arch: ${os}/${arch}`);\n      writeLogFile(logFile, logLines);\n      logger.debug(`Unsupported OS/arch: ${os}/${arch}`);\n      return null;\n    }\n\n    logLines.push(`OS/arch: ${os}/${arch}`);\n\n    // Check if already cached\n    const cachedPath = path.join(browsersCachePath, `chromium-${chromium.revision}`);\n    if (fs.existsSync(cachedPath)) {\n      logLines.push(`Browsers already cached: ${cachedPath}`);\n      writeLogFile(logFile, logLines);\n      logger.debug(`Browsers already cached: ${cachedPath}`);\n      return {\n        channel: 'bundled',\n        version: chromium.revision,\n        path: cachedPath,\n        strategy: 'release-cache',\n      };\n    }\n\n    // Get Playwright version for tag\n    const playwrightPkgPath = path.join(artkE2ePath, 'node_modules', '@playwright', 'test', 'package.json');\n    let playwrightVersion = '1.57.0';\n    if (fs.existsSync(playwrightPkgPath)) {\n      const pkg = JSON.parse(fs.readFileSync(playwrightPkgPath, 'utf8'));\n      playwrightVersion = pkg.version;\n    }\n\n    logLines.push(`Playwright version: ${playwrightVersion}`);\n\n    // Try to download from release\n    const repo = process.env.ARTK_PLAYWRIGHT_BROWSERS_REPO;\n    if (!repo) {\n      logLines.push('ARTK_PLAYWRIGHT_BROWSERS_REPO not set, skipping release cache');\n      writeLogFile(logFile, logLines);\n      logger.debug('ARTK_PLAYWRIGHT_BROWSERS_REPO not set, skipping release cache');\n      return null;\n    }\n\n    const tag = process.env.ARTK_PLAYWRIGHT_BROWSERS_TAG || `playwright-browsers-${playwrightVersion}`;\n    const asset = `chromium-${chromium.revision}-${os}-${arch}.zip`;\n    const baseUrl = `https://github.com/${repo}/releases/download/${tag}`;\n    const zipUrl = `${baseUrl}/${asset}`;\n    const shaUrl = `${baseUrl}/${asset}.sha256`;\n\n    logLines.push(`Repo: ${repo}`);\n    logLines.push(`Tag: ${tag}`);\n    logLines.push(`Asset: ${asset}`);\n    logLines.push(`URL: ${zipUrl}`);\n\n    logger.startSpinner('Downloading pre-built browsers from release cache...');\n\n    const zipPath = path.join(browsersCachePath, asset);\n    const shaPath = `${zipPath}.sha256`;\n\n    try {\n      // Download ZIP file\n      logLines.push('Downloading ZIP...');\n      await downloadFile(zipUrl, zipPath, 30000);\n      logLines.push(`ZIP downloaded: ${fs.statSync(zipPath).size} bytes`);\n\n      // Download SHA256 checksum\n      logLines.push('Downloading SHA256...');\n      await downloadFile(shaUrl, shaPath, 10000);\n\n      // Verify checksum\n      const expectedHash = fs.readFileSync(shaPath, 'utf8').split(/\\s+/)[0].trim().toLowerCase();\n      const actualHash = await computeSha256(zipPath);\n\n      logLines.push(`Expected SHA256: ${expectedHash}`);\n      logLines.push(`Actual SHA256: ${actualHash}`);\n\n      if (expectedHash !== actualHash) {\n        logLines.push('ERROR: SHA256 checksum mismatch!');\n        writeLogFile(logFile, logLines);\n        logger.failSpinner('Browser cache checksum mismatch');\n        fs.unlinkSync(zipPath);\n        fs.unlinkSync(shaPath);\n        return null;\n      }\n\n      logLines.push('Checksum verified');\n\n      // Extract ZIP\n      logLines.push('Extracting ZIP...');\n      await extractZip(zipPath, browsersCachePath);\n      logLines.push(`Extracted to: ${browsersCachePath}`);\n\n      // Clean up\n      fs.unlinkSync(zipPath);\n      fs.unlinkSync(shaPath);\n\n      logLines.push('SUCCESS: Browser cache downloaded and verified');\n      writeLogFile(logFile, logLines);\n\n      logger.succeedSpinner('Pre-built browsers downloaded from release cache');\n\n      return {\n        channel: 'bundled',\n        version: chromium.revision,\n        path: path.join(browsersCachePath, `chromium-${chromium.revision}`),\n        strategy: 'release-cache',\n      };\n    } catch (downloadError) {\n      logLines.push(`Download failed: ${downloadError}`);\n      writeLogFile(logFile, logLines);\n      logger.failSpinner('Release cache download failed');\n\n      // Clean up partial downloads\n      if (fs.existsSync(zipPath)) fs.unlinkSync(zipPath);\n      if (fs.existsSync(shaPath)) fs.unlinkSync(shaPath);\n\n      return null;\n    }\n  } catch (error) {\n    logLines.push(`Release cache check failed: ${error}`);\n    writeLogFile(logFile, logLines);\n    logger.debug(`Release cache check failed: ${error}`);\n    return null;\n  }\n}\n\n/**\n * Download a file from URL to local path\n */\nfunction downloadFile(url: string, destPath: string, timeoutMs: number): Promise<void> {\n  return new Promise((resolve, reject) => {\n    const file = fs.createWriteStream(destPath);\n\n    const request = https.get(url, { timeout: timeoutMs }, (response) => {\n      // Handle redirects\n      if (response.statusCode === 301 || response.statusCode === 302) {\n        const redirectUrl = response.headers.location;\n        if (redirectUrl) {\n          file.close();\n          fs.unlinkSync(destPath);\n          downloadFile(redirectUrl, destPath, timeoutMs).then(resolve).catch(reject);\n          return;\n        }\n      }\n\n      if (response.statusCode !== 200) {\n        file.close();\n        fs.unlinkSync(destPath);\n        reject(new Error(`HTTP ${response.statusCode}: ${url}`));\n        return;\n      }\n\n      response.pipe(file);\n      file.on('finish', () => {\n        file.close();\n        resolve();\n      });\n    });\n\n    request.on('error', (err) => {\n      file.close();\n      if (fs.existsSync(destPath)) fs.unlinkSync(destPath);\n      reject(err);\n    });\n\n    request.on('timeout', () => {\n      request.destroy();\n      file.close();\n      if (fs.existsSync(destPath)) fs.unlinkSync(destPath);\n      reject(new Error(`Download timeout: ${url}`));\n    });\n  });\n}\n\n/**\n * Compute SHA256 hash of a file\n */\nfunction computeSha256(filePath: string): Promise<string> {\n  return new Promise((resolve, reject) => {\n    const hash = crypto.createHash('sha256');\n    const stream = fs.createReadStream(filePath);\n\n    stream.on('data', (data) => hash.update(data));\n    stream.on('end', () => resolve(hash.digest('hex').toLowerCase()));\n    stream.on('error', reject);\n  });\n}\n\n/**\n * Extract ZIP file using built-in unzip or tar commands\n */\nasync function extractZip(zipPath: string, destDir: string): Promise<void> {\n  return new Promise((resolve, reject) => {\n    // Try unzip first (most common), then bsdtar\n    const commands = [\n      { cmd: 'unzip', args: ['-q', zipPath, '-d', destDir] },\n      { cmd: 'bsdtar', args: ['-xf', zipPath, '-C', destDir] },\n      { cmd: 'tar', args: ['-xzf', zipPath, '-C', destDir] },\n    ];\n\n    const tryCommand = (index: number) => {\n      if (index >= commands.length) {\n        reject(new Error('No suitable unzip command found (tried: unzip, bsdtar, tar)'));\n        return;\n      }\n\n      const { cmd, args } = commands[index];\n      const child = spawn(cmd, args, { stdio: 'pipe' });\n\n      child.on('error', () => {\n        // Command not found, try next\n        tryCommand(index + 1);\n      });\n\n      child.on('close', (code) => {\n        if (code === 0) {\n          resolve();\n        } else {\n          // Command failed, try next\n          tryCommand(index + 1);\n        }\n      });\n    };\n\n    tryCommand(0);\n  });\n}\n\n/**\n * Write log lines to file\n */\nfunction writeLogFile(logPath: string, lines: string[]): void {\n  try {\n    fs.writeFileSync(logPath, lines.join('\\n') + '\\n');\n  } catch {\n    // Best effort logging\n  }\n}\n\n/**\n * Try to install bundled Playwright browsers\n */\nasync function tryBundledInstall(\n  artkE2ePath: string,\n  browsersCachePath: string,\n  logsDir: string,\n  logger: Logger\n): Promise<BrowserInfo | null> {\n  const logFile = path.join(logsDir, 'playwright-browser-install.log');\n\n  return new Promise((resolve) => {\n    logger.startSpinner('Installing Playwright browsers...');\n\n    const logLines: string[] = [`Playwright browser install attempt - ${new Date().toISOString()}`];\n    logLines.push(`Working directory: ${artkE2ePath}`);\n    logLines.push(`Browsers cache: ${browsersCachePath}`);\n\n    const child = spawn('npx', ['playwright', 'install', 'chromium'], {\n      cwd: artkE2ePath,\n      env: {\n        ...process.env,\n        PLAYWRIGHT_BROWSERS_PATH: browsersCachePath,\n      },\n      shell: true,\n      stdio: 'pipe',\n    });\n\n    let stdout = '';\n    let stderr = '';\n\n    child.stdout?.on('data', (data) => {\n      stdout += data.toString();\n    });\n\n    child.stderr?.on('data', (data) => {\n      stderr += data.toString();\n    });\n\n    child.on('close', (code) => {\n      logLines.push(`Exit code: ${code}`);\n      logLines.push('--- STDOUT ---');\n      logLines.push(stdout || '(empty)');\n      logLines.push('--- STDERR ---');\n      logLines.push(stderr || '(empty)');\n      writeLogFile(logFile, logLines);\n\n      if (code === 0) {\n        logger.succeedSpinner('Playwright browsers installed');\n        resolve({\n          channel: 'bundled',\n          version: null,\n          path: browsersCachePath,\n          strategy: 'bundled-install',\n        });\n      } else {\n        logger.failSpinner('Failed to install Playwright browsers');\n        logger.debug(`Exit code: ${code}`);\n        logger.debug(`Details saved to: ${logFile}`);\n        resolve(null);\n      }\n    });\n\n    child.on('error', (error) => {\n      logLines.push(`Process error: ${error.message}`);\n      writeLogFile(logFile, logLines);\n      logger.failSpinner('Failed to install Playwright browsers');\n      logger.debug(`Error: ${error.message}`);\n      resolve(null);\n    });\n\n    // Timeout after 5 minutes\n    setTimeout(() => {\n      logLines.push('TIMEOUT: Installation took longer than 5 minutes');\n      writeLogFile(logFile, logLines);\n      child.kill();\n      logger.failSpinner('Browser installation timed out');\n      resolve(null);\n    }, 300000);\n  });\n}\n\n/**\n * Detect system browsers (Edge, Chrome)\n */\nasync function detectSystemBrowser(logsDir: string, logger: Logger): Promise<BrowserInfo> {\n  const logFile = path.join(logsDir, 'system-browser-detect.log');\n  const logLines: string[] = [`System browser detection - ${new Date().toISOString()}`];\n  logLines.push(`Platform: ${process.platform}`);\n\n  // Try Microsoft Edge first\n  logLines.push('Checking Microsoft Edge...');\n  const edgeInfo = await tryDetectBrowser('msedge', logLines, logger);\n  if (edgeInfo) {\n    logLines.push(`SUCCESS: Found Edge at ${edgeInfo.path} (${edgeInfo.version})`);\n    writeLogFile(logFile, logLines);\n    logger.success(`Detected Microsoft Edge: ${edgeInfo.version || 'unknown version'}`);\n    return edgeInfo;\n  }\n\n  // Try Google Chrome\n  logLines.push('Checking Google Chrome...');\n  const chromeInfo = await tryDetectBrowser('chrome', logLines, logger);\n  if (chromeInfo) {\n    logLines.push(`SUCCESS: Found Chrome at ${chromeInfo.path} (${chromeInfo.version})`);\n    writeLogFile(logFile, logLines);\n    logger.success(`Detected Google Chrome: ${chromeInfo.version || 'unknown version'}`);\n    return chromeInfo;\n  }\n\n  logLines.push('No system browsers found');\n  writeLogFile(logFile, logLines);\n\n  return {\n    channel: 'bundled',\n    version: null,\n    path: null,\n    strategy: 'auto',\n  };\n}\n\n/**\n * Try to detect a specific browser\n */\nasync function tryDetectBrowser(\n  browser: 'msedge' | 'chrome',\n  logLines: string[],\n  logger: Logger\n): Promise<BrowserInfo | null> {\n  const paths = getBrowserPaths(browser);\n\n  for (const browserPath of paths) {\n    logLines.push(`  Checking path: ${browserPath}`);\n    if (fs.existsSync(browserPath)) {\n      const version = await getBrowserVersion(browserPath);\n      logLines.push(`    Found! Version: ${version || 'unknown'}`);\n      return {\n        channel: browser,\n        version,\n        path: browserPath,\n        strategy: 'system',\n      };\n    } else {\n      logLines.push('    Not found');\n    }\n  }\n\n  // Try command-line detection\n  const commands =\n    browser === 'msedge'\n      ? ['microsoft-edge', 'microsoft-edge-stable']\n      : ['google-chrome', 'google-chrome-stable'];\n\n  for (const cmd of commands) {\n    logLines.push(`  Checking command: ${cmd}`);\n    try {\n      const output = execSync(`${cmd} --version`, { encoding: 'utf8', stdio: 'pipe', timeout: 5000 });\n      const versionMatch = output.match(/(\\d+\\.\\d+\\.\\d+\\.\\d+)/);\n      logLines.push(`    Found! Version: ${versionMatch ? versionMatch[1] : 'unknown'}`);\n      return {\n        channel: browser,\n        version: versionMatch ? versionMatch[1] : null,\n        path: cmd,\n        strategy: 'system',\n      };\n    } catch (err) {\n      logLines.push(`    Not found: ${err instanceof Error ? err.message : 'unknown error'}`);\n    }\n  }\n\n  return null;\n}\n\n/**\n * Get browser version from executable path\n */\nasync function getBrowserVersion(browserPath: string): Promise<string | null> {\n  try {\n    const output = execSync(`\"${browserPath}\" --version`, { encoding: 'utf8', stdio: 'pipe', timeout: 5000 });\n    const versionMatch = output.match(/(\\d+\\.\\d+\\.\\d+\\.\\d+)/);\n    return versionMatch ? versionMatch[1] : null;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Get browser executable paths for the current platform\n */\nfunction getBrowserPaths(browser: 'msedge' | 'chrome'): string[] {\n  const paths: string[] = [];\n\n  if (process.platform === 'win32') {\n    const programFiles = process.env['ProgramFiles'] || 'C:\\\\Program Files';\n    const programFilesX86 = process.env['ProgramFiles(x86)'] || 'C:\\\\Program Files (x86)';\n    const localAppData = process.env['LOCALAPPDATA'] || '';\n\n    if (browser === 'msedge') {\n      paths.push(\n        `${programFilesX86}\\\\Microsoft\\\\Edge\\\\Application\\\\msedge.exe`,\n        `${programFiles}\\\\Microsoft\\\\Edge\\\\Application\\\\msedge.exe`,\n        `${localAppData}\\\\Microsoft\\\\Edge\\\\Application\\\\msedge.exe`\n      );\n    } else {\n      paths.push(\n        `${programFiles}\\\\Google\\\\Chrome\\\\Application\\\\chrome.exe`,\n        `${programFilesX86}\\\\Google\\\\Chrome\\\\Application\\\\chrome.exe`,\n        `${localAppData}\\\\Google\\\\Chrome\\\\Application\\\\chrome.exe`\n      );\n    }\n  } else if (process.platform === 'darwin') {\n    if (browser === 'msedge') {\n      paths.push('/Applications/Microsoft Edge.app/Contents/MacOS/Microsoft Edge');\n    } else {\n      paths.push('/Applications/Google Chrome.app/Contents/MacOS/Google Chrome');\n    }\n  } else {\n    // Linux\n    if (browser === 'msedge') {\n      paths.push('/usr/bin/microsoft-edge', '/usr/bin/microsoft-edge-stable', '/snap/bin/microsoft-edge');\n    } else {\n      paths.push(\n        '/usr/bin/google-chrome',\n        '/usr/bin/google-chrome-stable',\n        '/snap/bin/chromium',\n        '/usr/bin/chromium-browser'\n      );\n    }\n  }\n\n  return paths;\n}\n\n/**\n * Update artk.config.yml with browser configuration\n */\nexport function updateArtkConfigBrowser(configPath: string, browserInfo: BrowserInfo): void {\n  if (!fs.existsSync(configPath)) {\n    return;\n  }\n\n  let content = fs.readFileSync(configPath, 'utf8');\n\n  // Check if browsers section exists\n  if (!/^\\s*browsers\\s*:/m.test(content)) {\n    // Add browsers section\n    content += `\nbrowsers:\n  enabled:\n    - chromium\n  channel: ${browserInfo.channel}\n  strategy: ${browserInfo.strategy}\n  viewport:\n    width: 1280\n    height: 720\n  headless: true\n`;\n  } else {\n    // Update channel in existing section\n    content = content.replace(\n      /^(\\s*channel\\s*:\\s*).*$/m,\n      `$1${browserInfo.channel}`\n    );\n    content = content.replace(\n      /^(\\s*strategy\\s*:\\s*).*$/m,\n      `$1${browserInfo.strategy}`\n    );\n  }\n\n  fs.writeFileSync(configPath, content);\n}\n","/**\n * Config Validator - Validates artk.config.yml\n *\n * Uses Zod schemas to validate the ARTK configuration file format.\n */\n\nimport * as fs from 'fs';\nimport * as path from 'path';\nimport { z } from 'zod';\nimport yaml from 'yaml';\nimport { Logger } from './logger.js';\n\n/**\n * Schema for environment configuration\n */\nconst environmentSchema = z.object({\n  baseUrl: z.string().url().or(z.string().regex(/^\\$\\{[^}]+\\}$/)), // Allow env var placeholders\n}).passthrough();\n\n/**\n * Schema for auth configuration\n */\nconst authSchema = z.object({\n  provider: z.enum(['oidc', 'saml', 'basic', 'custom', 'none']).default('oidc'),\n  storageStateDir: z.string().default('./.auth-states'),\n  roles: z.record(z.object({\n    username: z.string().optional(),\n    password: z.string().optional(),\n  })).optional(),\n}).passthrough();\n\n/**\n * Schema for browser configuration\n */\nconst browserSchema = z.object({\n  enabled: z.array(z.enum(['chromium', 'firefox', 'webkit'])).default(['chromium']),\n  channel: z.enum(['bundled', 'msedge', 'chrome', 'chrome-beta', 'chrome-dev']).default('bundled'),\n  strategy: z.enum(['auto', 'bundled-only', 'system-only', 'prefer-system', 'prefer-bundled']).default('auto'),\n  viewport: z.object({\n    width: z.number().min(320).max(3840).default(1280),\n    height: z.number().min(240).max(2160).default(720),\n  }).optional(),\n  headless: z.boolean().default(true),\n}).passthrough();\n\n/**\n * Schema for settings\n */\nconst settingsSchema = z.object({\n  parallel: z.boolean().default(true),\n  retries: z.number().min(0).max(10).default(2),\n  timeout: z.number().min(1000).max(300000).default(30000),\n  traceOnFailure: z.boolean().default(true),\n}).passthrough();\n\n/**\n * Main ARTK config schema\n */\nconst artkConfigSchema = z.object({\n  version: z.string().default('1.0'),\n  app: z.object({\n    name: z.string(),\n    type: z.enum(['web', 'mobile', 'api']).default('web'),\n    description: z.string().optional(),\n  }),\n  environments: z.record(environmentSchema),\n  auth: authSchema.optional(),\n  settings: settingsSchema.optional(),\n  browsers: browserSchema.optional(),\n}).passthrough();\n\nexport type ArtkConfig = z.infer<typeof artkConfigSchema>;\n\nexport interface ValidationResult {\n  valid: boolean;\n  errors: string[];\n  warnings: string[];\n  config?: ArtkConfig;\n}\n\n/**\n * Validate an artk.config.yml file\n */\nexport function validateArtkConfig(configPath: string, logger?: Logger): ValidationResult {\n  const log = logger || new Logger();\n  const result: ValidationResult = {\n    valid: true,\n    errors: [],\n    warnings: [],\n  };\n\n  // Check if file exists\n  if (!fs.existsSync(configPath)) {\n    result.valid = false;\n    result.errors.push(`Config file not found: ${configPath}`);\n    return result;\n  }\n\n  try {\n    // Read and parse YAML\n    const content = fs.readFileSync(configPath, 'utf8');\n    const rawConfig = yaml.parse(content);\n\n    if (!rawConfig || typeof rawConfig !== 'object') {\n      result.valid = false;\n      result.errors.push('Config file is empty or invalid YAML');\n      return result;\n    }\n\n    // Validate against schema\n    const parseResult = artkConfigSchema.safeParse(rawConfig);\n\n    if (!parseResult.success) {\n      result.valid = false;\n\n      for (const error of parseResult.error.errors) {\n        const path = error.path.join('.');\n        result.errors.push(`${path}: ${error.message}`);\n      }\n\n      return result;\n    }\n\n    result.config = parseResult.data;\n\n    // Additional validation checks\n    const additionalWarnings = checkAdditionalValidation(parseResult.data);\n    result.warnings.push(...additionalWarnings);\n\n    log.debug(`Config validation passed for ${configPath}`);\n    return result;\n\n  } catch (error) {\n    result.valid = false;\n    const errorMessage = error instanceof Error ? error.message : String(error);\n    result.errors.push(`Failed to parse config: ${errorMessage}`);\n    return result;\n  }\n}\n\n/**\n * Additional validation checks beyond schema validation\n */\nfunction checkAdditionalValidation(config: ArtkConfig): string[] {\n  const warnings: string[] = [];\n\n  // Check if at least one environment is defined\n  if (Object.keys(config.environments).length === 0) {\n    warnings.push('No environments defined - at least one is recommended');\n  }\n\n  // Check for common environment names\n  const commonEnvs = ['local', 'dev', 'intg', 'staging', 'prod'];\n  const hasCommonEnv = commonEnvs.some(env => env in config.environments);\n  if (!hasCommonEnv) {\n    warnings.push(`Consider using standard environment names: ${commonEnvs.join(', ')}`);\n  }\n\n  // Check browser settings\n  if (config.browsers?.strategy === 'system-only') {\n    warnings.push('system-only browser strategy may fail in CI environments');\n  }\n\n  // Check auth settings\n  if (config.auth?.provider === 'none' && config.auth?.roles) {\n    warnings.push('Auth roles defined but provider is \"none\"');\n  }\n\n  // Check timeout settings\n  if (config.settings?.timeout && config.settings.timeout < 5000) {\n    warnings.push('Very short timeout (< 5s) may cause flaky tests');\n  }\n\n  return warnings;\n}\n\n/**\n * Validate and load config from a path\n */\nexport function loadAndValidateConfig(configPath: string, logger?: Logger): ArtkConfig | null {\n  const result = validateArtkConfig(configPath, logger);\n\n  if (!result.valid) {\n    const log = logger || new Logger();\n    log.error('Configuration validation failed:');\n    for (const error of result.errors) {\n      log.error(`  - ${error}`);\n    }\n    return null;\n  }\n\n  if (result.warnings.length > 0) {\n    const log = logger || new Logger();\n    log.warning('Configuration warnings:');\n    for (const warning of result.warnings) {\n      log.warning(`  - ${warning}`);\n    }\n  }\n\n  return result.config || null;\n}\n\n/**\n * Create a default config\n */\nexport function createDefaultConfig(projectName: string): ArtkConfig {\n  return {\n    version: '1.0',\n    app: {\n      name: projectName,\n      type: 'web',\n      description: `E2E tests for ${projectName}`,\n    },\n    environments: {\n      local: { baseUrl: 'http://localhost:3000' },\n      intg: { baseUrl: 'https://intg.example.com' },\n      ctlq: { baseUrl: 'https://ctlq.example.com' },\n      prod: { baseUrl: 'https://example.com' },\n    },\n    auth: {\n      provider: 'oidc',\n      storageStateDir: './.auth-states',\n    },\n    settings: {\n      parallel: true,\n      retries: 2,\n      timeout: 30000,\n      traceOnFailure: true,\n    },\n    browsers: {\n      enabled: ['chromium'],\n      channel: 'bundled',\n      strategy: 'auto',\n      viewport: { width: 1280, height: 720 },\n      headless: true,\n    },\n  };\n}\n","/**\n * ARTK Variant Definitions\n *\n * Constant mapping of all 4 variants with their complete metadata.\n */\n\nimport type { Variant, VariantId } from './variant-types.js';\n\n/**\n * Complete definitions for all ARTK variants.\n *\n * Node.js version ranges only include LTS versions (even numbers: 14, 16, 18, 20, 22).\n * Non-LTS versions (15, 17, 19, 21) have short support windows and are not recommended\n * for production use, so they are intentionally excluded.\n */\nexport const VARIANT_DEFINITIONS: Record<VariantId, Variant> = {\n  'modern-esm': {\n    id: 'modern-esm',\n    displayName: 'Modern ESM',\n    nodeRange: ['18', '20', '22'], // LTS only\n    playwrightVersion: '1.57.x',\n    moduleSystem: 'esm',\n    tsTarget: 'ES2022',\n    distDirectory: 'dist',\n  },\n\n  'modern-cjs': {\n    id: 'modern-cjs',\n    displayName: 'Modern CJS',\n    nodeRange: ['18', '20', '22'], // LTS only\n    playwrightVersion: '1.57.x',\n    moduleSystem: 'cjs',\n    tsTarget: 'ES2022',\n    distDirectory: 'dist-cjs',\n  },\n\n  'legacy-16': {\n    id: 'legacy-16',\n    displayName: 'Legacy Node 16',\n    nodeRange: ['16', '18', '20'], // LTS only\n    playwrightVersion: '1.49.x',\n    moduleSystem: 'cjs',\n    tsTarget: 'ES2021',\n    distDirectory: 'dist-legacy-16',\n  },\n\n  'legacy-14': {\n    id: 'legacy-14',\n    displayName: 'Legacy Node 14',\n    nodeRange: ['14', '16', '18'], // LTS only\n    playwrightVersion: '1.33.x',\n    moduleSystem: 'cjs',\n    tsTarget: 'ES2020',\n    distDirectory: 'dist-legacy-14',\n  },\n};\n\n/**\n * Array of all variant IDs.\n */\nexport const ALL_VARIANT_IDS: VariantId[] = [\n  'modern-esm',\n  'modern-cjs',\n  'legacy-16',\n  'legacy-14',\n];\n\n/**\n * Get variant definition by ID.\n */\nexport function getVariantDefinition(id: VariantId): Variant {\n  return VARIANT_DEFINITIONS[id];\n}\n\n/**\n * Get all variant definitions as an array.\n */\nexport function getAllVariants(): Variant[] {\n  return Object.values(VARIANT_DEFINITIONS);\n}\n\n/**\n * Get variant IDs that support a given Node.js major version.\n */\nexport function getVariantsForNodeVersion(nodeMajor: number): VariantId[] {\n  return ALL_VARIANT_IDS.filter((id) =>\n    VARIANT_DEFINITIONS[id].nodeRange.includes(String(nodeMajor))\n  );\n}\n\n/**\n * Get the recommended variant for a Node.js version and module system.\n *\n * Priority:\n * 1. Node 18+: modern-esm (if ESM) or modern-cjs (if CJS)\n * 2. Node 16-17: legacy-16\n * 3. Node 14-15: legacy-14\n * 4. Node < 14: Error (unsupported)\n */\nexport function getRecommendedVariant(\n  nodeMajor: number,\n  moduleSystem: 'esm' | 'cjs'\n): VariantId {\n  if (nodeMajor >= 18) {\n    return moduleSystem === 'esm' ? 'modern-esm' : 'modern-cjs';\n  }\n\n  if (nodeMajor >= 16) {\n    return 'legacy-16';\n  }\n\n  if (nodeMajor >= 14) {\n    return 'legacy-14';\n  }\n\n  throw new Error(\n    `Node.js ${nodeMajor} is not supported. ARTK requires Node.js 14 or higher.`\n  );\n}\n\n/**\n * Check if a variant is compatible with a Node.js version.\n */\nexport function isVariantCompatible(\n  variantId: VariantId,\n  nodeMajor: number\n): boolean {\n  const variant = VARIANT_DEFINITIONS[variantId];\n  return variant.nodeRange.includes(String(nodeMajor));\n}\n\n/**\n * Get display information for CLI help text.\n */\nexport function getVariantHelpText(): string {\n  const lines = ['Available variants:'];\n\n  for (const variant of getAllVariants()) {\n    const nodeRange = variant.nodeRange.join(', ');\n    lines.push(\n      `  ${variant.id.padEnd(12)} - ${variant.displayName} (Node ${nodeRange}, Playwright ${variant.playwrightVersion})`\n    );\n  }\n\n  return lines.join('\\n');\n}\n\n/**\n * Minimum supported Node.js version.\n */\nexport const MIN_NODE_VERSION = 14;\n\n/**\n * Maximum supported Node.js version (current LTS + next).\n */\nexport const MAX_NODE_VERSION = 22;\n","/**\n * ARTK Variant Detection Logic\n *\n * Detects Node.js version and module system to select the appropriate variant.\n */\n\nimport * as fs from 'fs';\nimport * as path from 'path';\nimport type {\n  VariantId,\n  ModuleSystem,\n  DetectionResult,\n  VariantSelectionOptions,\n} from './variant-types.js';\nimport {\n  getRecommendedVariant,\n  isVariantCompatible,\n  MIN_NODE_VERSION,\n  VARIANT_DEFINITIONS,\n} from './variant-definitions.js';\n\n/**\n * Get the current Node.js major version.\n */\nexport function getNodeMajorVersion(): number {\n  const version = process.version;\n  const match = version.match(/^v(\\d+)/);\n  if (!match) {\n    throw new Error(`Unable to parse Node.js version: ${version}`);\n  }\n  return parseInt(match[1], 10);\n}\n\n/**\n * Get the full Node.js version string.\n */\nexport function getNodeVersionFull(): string {\n  return process.version;\n}\n\n/**\n * Find the nearest package.json by walking up the directory tree.\n * This handles monorepo scenarios where the target directory might not\n * have its own package.json but inherits from a parent.\n *\n * @returns The path to the nearest package.json, or null if none found\n */\nfunction findNearestPackageJson(startPath: string): string | null {\n  let currentPath = path.resolve(startPath);\n  const root = path.parse(currentPath).root;\n\n  while (currentPath !== root) {\n    const packageJsonPath = path.join(currentPath, 'package.json');\n    if (fs.existsSync(packageJsonPath)) {\n      return packageJsonPath;\n    }\n    currentPath = path.dirname(currentPath);\n  }\n\n  return null;\n}\n\n/**\n * Detect module system from package.json in target directory or ancestors.\n *\n * Rules:\n * 1. Check target directory's package.json first\n * 2. If not found, walk up to parent directories (monorepo support)\n * 3. If package.json has \"type\": \"module\" -> ESM\n * 4. If package.json has \"type\": \"commonjs\" -> CJS\n * 5. If package.json has no \"type\" field -> CJS (Node.js default)\n * 6. If no package.json exists anywhere -> CJS (safe default)\n */\nexport function detectModuleSystem(targetPath: string): ModuleSystem {\n  // First check the target directory itself\n  const targetPackageJson = path.join(targetPath, 'package.json');\n\n  if (fs.existsSync(targetPackageJson)) {\n    try {\n      const content = fs.readFileSync(targetPackageJson, 'utf-8');\n      const pkg = JSON.parse(content) as { type?: string };\n\n      if (pkg.type === 'module') {\n        return 'esm';\n      }\n\n      // \"commonjs\" or no type field -> CJS\n      return 'cjs';\n    } catch {\n      // Parse error, continue to parent search\n    }\n  }\n\n  // Monorepo support: check parent directories\n  const nearestPackageJson = findNearestPackageJson(targetPath);\n\n  if (nearestPackageJson) {\n    try {\n      const content = fs.readFileSync(nearestPackageJson, 'utf-8');\n      const pkg = JSON.parse(content) as { type?: string };\n\n      if (pkg.type === 'module') {\n        return 'esm';\n      }\n\n      // \"commonjs\" or no type field -> CJS\n      return 'cjs';\n    } catch {\n      // Parse error, default to CJS\n      return 'cjs';\n    }\n  }\n\n  // No package.json found anywhere, default to CJS\n  return 'cjs';\n}\n\n/**\n * Detect environment and select appropriate variant.\n */\nexport function detectEnvironment(targetPath: string): DetectionResult {\n  try {\n    const nodeVersion = getNodeMajorVersion();\n    const nodeVersionFull = getNodeVersionFull();\n\n    // Check minimum version\n    if (nodeVersion < MIN_NODE_VERSION) {\n      return {\n        nodeVersion,\n        nodeVersionFull,\n        moduleSystem: 'cjs',\n        selectedVariant: 'legacy-14', // Will fail validation later\n        success: false,\n        error: `Node.js ${nodeVersion} is not supported. ARTK requires Node.js ${MIN_NODE_VERSION} or higher.`,\n      };\n    }\n\n    const moduleSystem = detectModuleSystem(targetPath);\n    const selectedVariant = getRecommendedVariant(nodeVersion, moduleSystem);\n\n    return {\n      nodeVersion,\n      nodeVersionFull,\n      moduleSystem,\n      selectedVariant,\n      success: true,\n    };\n  } catch (error) {\n    const message =\n      error instanceof Error ? error.message : 'Unknown detection error';\n    return {\n      nodeVersion: 0,\n      nodeVersionFull: process.version,\n      moduleSystem: 'cjs',\n      selectedVariant: 'modern-cjs',\n      success: false,\n      error: message,\n    };\n  }\n}\n\n/**\n * Select variant based on options (with optional override).\n */\nexport function selectVariant(options: VariantSelectionOptions): DetectionResult {\n  const detection = detectEnvironment(options.targetPath);\n\n  // If override is specified, use it (but validate compatibility)\n  if (options.overrideVariant) {\n    const isCompatible = isVariantCompatible(\n      options.overrideVariant,\n      detection.nodeVersion\n    );\n\n    if (!isCompatible) {\n      const variant = VARIANT_DEFINITIONS[options.overrideVariant];\n      return {\n        ...detection,\n        selectedVariant: options.overrideVariant,\n        success: false,\n        error: `Variant '${options.overrideVariant}' is not compatible with Node.js ${detection.nodeVersion}. ` +\n          `This variant supports Node.js ${variant.nodeRange.join(', ')}.`,\n      };\n    }\n\n    return {\n      ...detection,\n      selectedVariant: options.overrideVariant,\n      success: true,\n    };\n  }\n\n  return detection;\n}\n\n/**\n * Validate that the selected variant can run on the current Node.js version.\n */\nexport function validateVariantCompatibility(\n  variantId: VariantId,\n  nodeVersion?: number\n): { valid: boolean; error?: string } {\n  const nodeMajor = nodeVersion ?? getNodeMajorVersion();\n  const variant = VARIANT_DEFINITIONS[variantId];\n\n  if (!variant) {\n    return {\n      valid: false,\n      error: `Unknown variant: ${variantId}`,\n    };\n  }\n\n  if (!isVariantCompatible(variantId, nodeMajor)) {\n    return {\n      valid: false,\n      error: `Variant '${variantId}' requires Node.js ${variant.nodeRange.join(' or ')}, ` +\n        `but current version is ${nodeMajor}.`,\n    };\n  }\n\n  return { valid: true };\n}\n\n/**\n * Check if the project has an existing ARTK installation.\n */\nexport function hasExistingInstallation(targetPath: string): boolean {\n  const contextPath = path.join(targetPath, '.artk', 'context.json');\n  return fs.existsSync(contextPath);\n}\n\n/**\n * Read existing context from .artk/context.json.\n */\nexport function readExistingContext(\n  targetPath: string\n): { variant: VariantId; nodeVersion: number } | null {\n  const contextPath = path.join(targetPath, '.artk', 'context.json');\n\n  if (!fs.existsSync(contextPath)) {\n    return null;\n  }\n\n  try {\n    const content = fs.readFileSync(contextPath, 'utf-8');\n    const context = JSON.parse(content) as {\n      variant?: string;\n      nodeVersion?: number;\n    };\n\n    if (context.variant && context.nodeVersion) {\n      return {\n        variant: context.variant as VariantId,\n        nodeVersion: context.nodeVersion,\n      };\n    }\n\n    return null;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Check if the environment has changed since last installation.\n */\nexport function detectEnvironmentChange(\n  targetPath: string\n): {\n  changed: boolean;\n  reason?: string;\n  currentNodeVersion: number;\n  previousNodeVersion?: number;\n  currentVariant: VariantId;\n  previousVariant?: VariantId;\n} {\n  const current = detectEnvironment(targetPath);\n  const existing = readExistingContext(targetPath);\n\n  if (!existing) {\n    return {\n      changed: false,\n      currentNodeVersion: current.nodeVersion,\n      currentVariant: current.selectedVariant,\n    };\n  }\n\n  const nodeVersionChanged = current.nodeVersion !== existing.nodeVersion;\n  const variantWouldChange = current.selectedVariant !== existing.variant;\n\n  if (nodeVersionChanged || variantWouldChange) {\n    let reason = '';\n\n    if (nodeVersionChanged) {\n      reason = `Node.js version changed from ${existing.nodeVersion} to ${current.nodeVersion}`;\n    }\n\n    if (variantWouldChange && !nodeVersionChanged) {\n      reason = `Module system change detected, variant would change from ${existing.variant} to ${current.selectedVariant}`;\n    }\n\n    return {\n      changed: true,\n      reason,\n      currentNodeVersion: current.nodeVersion,\n      previousNodeVersion: existing.nodeVersion,\n      currentVariant: current.selectedVariant,\n      previousVariant: existing.variant,\n    };\n  }\n\n  return {\n    changed: false,\n    currentNodeVersion: current.nodeVersion,\n    previousNodeVersion: existing.nodeVersion,\n    currentVariant: current.selectedVariant,\n    previousVariant: existing.variant,\n  };\n}\n","/**\n * ARTK Variant File Operations\n *\n * Shared utilities for copying variant files and generating AI protection markers.\n * Used by both init and upgrade commands.\n */\n\nimport * as fs from 'fs';\nimport * as path from 'path';\nimport { fileURLToPath } from 'url';\nimport type { VariantId, ArtkContext } from './variant-types.js';\nimport { VARIANT_DEFINITIONS, getVariantDefinition } from './variant-definitions.js';\n\n// ESM-compatible __dirname\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = path.dirname(__filename);\n\n/**\n * Get the ARTK version from package.json or fallback.\n */\nexport function getArtkVersion(): string {\n  // Try to read from CLI package.json\n  const possiblePaths = [\n    path.join(__dirname, '..', '..', 'package.json'),\n    path.join(__dirname, '..', '..', '..', 'package.json'),\n    path.join(process.cwd(), 'cli', 'package.json'),\n  ];\n\n  for (const pkgPath of possiblePaths) {\n    try {\n      if (fs.existsSync(pkgPath)) {\n        const pkg = JSON.parse(fs.readFileSync(pkgPath, 'utf-8')) as { version?: string; name?: string };\n        if (pkg.name?.includes('artk') && pkg.version) {\n          return pkg.version;\n        }\n      }\n    } catch {\n      // Continue to next path\n    }\n  }\n\n  return '1.0.0';\n}\n\n/**\n * Find the ARTK core source directory.\n */\nexport function findArtkCorePath(): string | null {\n  const possiblePaths = [\n    // ARTK_CORE_PATH environment variable\n    process.env.ARTK_CORE_PATH,\n    // Relative to CLI (npm package structure)\n    path.join(__dirname, '..', '..', 'vendor', 'artk-core'),\n    // Development: relative to CLI source\n    path.join(__dirname, '..', '..', '..', '..', 'core', 'typescript'),\n    // Monorepo: from CWD\n    path.join(process.cwd(), 'core', 'typescript'),\n  ].filter(Boolean) as string[];\n\n  for (const corePath of possiblePaths) {\n    if (fs.existsSync(corePath) && fs.existsSync(path.join(corePath, 'package.json'))) {\n      return corePath;\n    }\n  }\n\n  return null;\n}\n\n/**\n * Get the dist directory for a variant.\n */\nexport function getVariantDistPath(corePath: string, variant: VariantId): string {\n  const variantDef = getVariantDefinition(variant);\n  return path.join(corePath, variantDef.distDirectory);\n}\n\n/**\n * Check if variant build files exist and are valid.\n */\nexport function validateVariantBuildFiles(variant: VariantId): {\n  valid: boolean;\n  corePath?: string;\n  distPath?: string;\n  error?: string;\n} {\n  const corePath = findArtkCorePath();\n\n  if (!corePath) {\n    return {\n      valid: false,\n      error: `ARTK core not found. Set ARTK_CORE_PATH environment variable or run from ARTK repository.`,\n    };\n  }\n\n  const variantDef = getVariantDefinition(variant);\n  const distPath = path.join(corePath, variantDef.distDirectory);\n\n  if (!fs.existsSync(distPath)) {\n    return {\n      valid: false,\n      corePath,\n      error: `Variant build files not found for '${variant}'.\n\nThe ${variantDef.distDirectory}/ directory is missing.\n\nTo build all variants, run from the ARTK repository:\n  cd core/typescript\n  npm run build:variants\n\nAvailable variants: modern-esm, modern-cjs, legacy-16, legacy-14`,\n    };\n  }\n\n  // Check for essential files\n  const indexFile = path.join(distPath, 'index.js');\n  if (!fs.existsSync(indexFile)) {\n    return {\n      valid: false,\n      corePath,\n      distPath,\n      error: `Variant '${variant}' dist directory exists but is incomplete (missing index.js).\n\nRebuild with:\n  cd core/typescript\n  npm run build:variants`,\n    };\n  }\n\n  return { valid: true, corePath, distPath };\n}\n\n/**\n * Copy directory recursively.\n */\nfunction copyDirectoryRecursive(src: string, dest: string): void {\n  if (!fs.existsSync(dest)) {\n    fs.mkdirSync(dest, { recursive: true });\n  }\n\n  const entries = fs.readdirSync(src, { withFileTypes: true });\n\n  for (const entry of entries) {\n    const srcPath = path.join(src, entry.name);\n    const destPath = path.join(dest, entry.name);\n\n    if (entry.isDirectory()) {\n      copyDirectoryRecursive(srcPath, destPath);\n    } else {\n      fs.copyFileSync(srcPath, destPath);\n    }\n  }\n}\n\n/**\n * Get autogen dist directory for a variant.\n */\nfunction getAutogenDistDirectory(variant: VariantId): string {\n  switch (variant) {\n    case 'modern-esm':\n      return 'dist';\n    case 'modern-cjs':\n      return 'dist-cjs';\n    case 'legacy-16':\n      return 'dist-legacy-16';\n    case 'legacy-14':\n      return 'dist-legacy-14';\n    default:\n      return 'dist';\n  }\n}\n\n/**\n * Copy variant files to vendor directory.\n */\nexport function copyVariantFiles(\n  variant: VariantId,\n  targetPath: string\n): { success: boolean; error?: string; copiedFiles: number; warnings?: string[] } {\n  const validation = validateVariantBuildFiles(variant);\n\n  if (!validation.valid || !validation.corePath || !validation.distPath) {\n    return {\n      success: false,\n      error: validation.error,\n      copiedFiles: 0,\n    };\n  }\n\n  const vendorCorePath = path.join(targetPath, 'artk-e2e', 'vendor', 'artk-core');\n  const vendorAutogenPath = path.join(targetPath, 'artk-e2e', 'vendor', 'artk-core-autogen');\n  const autogenPath = path.join(validation.corePath, 'autogen');\n\n  let copiedFiles = 0;\n  const warnings: string[] = [];\n\n  try {\n    // Create vendor directories\n    fs.mkdirSync(path.join(vendorCorePath, 'dist'), { recursive: true });\n    fs.mkdirSync(vendorAutogenPath, { recursive: true });\n\n    // Copy variant dist files\n    copyDirectoryRecursive(validation.distPath, path.join(vendorCorePath, 'dist'));\n    copiedFiles += countFiles(validation.distPath);\n\n    // Copy core package.json\n    const corePackageJson = path.join(validation.corePath, 'package.json');\n    if (fs.existsSync(corePackageJson)) {\n      fs.copyFileSync(corePackageJson, path.join(vendorCorePath, 'package.json'));\n      copiedFiles++;\n    }\n\n    // Copy version.json if exists\n    const versionJson = path.join(validation.corePath, 'version.json');\n    if (fs.existsSync(versionJson)) {\n      fs.copyFileSync(versionJson, path.join(vendorCorePath, 'version.json'));\n      copiedFiles++;\n    }\n\n    // Copy README.md if exists\n    const readme = path.join(validation.corePath, 'README.md');\n    if (fs.existsSync(readme)) {\n      fs.copyFileSync(readme, path.join(vendorCorePath, 'README.md'));\n      copiedFiles++;\n    }\n\n    // Copy autogen package (variant-specific dist if available, fallback to default)\n    const autogenDistDir = getAutogenDistDirectory(variant);\n    let autogenDist = path.join(autogenPath, autogenDistDir);\n\n    // Require variant-specific autogen dist to exist (FR-003: matching configurations)\n    // Do NOT fallback to default dist - this would create a variant mismatch\n    if (!fs.existsSync(autogenDist)) {\n      return {\n        success: false,\n        error:\n          `Autogen package not found for variant '${variant}'. ` +\n          `Expected at: ${autogenDist}. ` +\n          `Both @artk/core and @artk/core-autogen must use the same variant. ` +\n          `Please build all variants with: npm run build:variants`,\n        copiedFiles,\n      };\n    }\n\n    copyDirectoryRecursive(autogenDist, path.join(vendorAutogenPath, 'dist'));\n    copiedFiles += countFiles(autogenDist);\n\n    const autogenPackageJson = path.join(autogenPath, 'package.json');\n    if (fs.existsSync(autogenPackageJson)) {\n      fs.copyFileSync(autogenPackageJson, path.join(vendorAutogenPath, 'package.json'));\n      copiedFiles++;\n    }\n\n    return {\n      success: true,\n      copiedFiles,\n      warnings: warnings.length > 0 ? warnings : undefined,\n    };\n  } catch (error) {\n    const message = error instanceof Error ? error.message : 'Unknown error';\n    return {\n      success: false,\n      error: `Failed to copy variant files: ${message}`,\n      copiedFiles,\n    };\n  }\n}\n\n/**\n * Count files in a directory recursively.\n */\nfunction countFiles(dir: string): number {\n  let count = 0;\n  const entries = fs.readdirSync(dir, { withFileTypes: true });\n\n  for (const entry of entries) {\n    if (entry.isDirectory()) {\n      count += countFiles(path.join(dir, entry.name));\n    } else {\n      count++;\n    }\n  }\n\n  return count;\n}\n\n/**\n * Generate variant-features.json content.\n */\nexport function generateVariantFeatures(variant: VariantId): Record<string, unknown> {\n  const variantDef = VARIANT_DEFINITIONS[variant];\n\n  // Define features based on variant\n  const features: Record<string, { available: boolean; alternative?: string; notes?: string }> = {};\n\n  // Common features available in all variants\n  const commonFeatures = [\n    'route_from_har',\n    'locator_filter',\n    'web_first_assertions',\n    'trace_viewer',\n    'api_testing',\n    'storage_state',\n    'video_recording',\n    'screenshot_assertions',\n    'request_interception',\n    'browser_contexts',\n    'test_fixtures',\n    'parallel_execution',\n    'retry_logic',\n  ];\n\n  for (const feature of commonFeatures) {\n    features[feature] = { available: true };\n  }\n\n  // Modern features (Playwright 1.57+)\n  if (variant === 'modern-esm' || variant === 'modern-cjs') {\n    features['aria_snapshots'] = { available: true };\n    features['clock_api'] = { available: true };\n    features['locator_or'] = { available: true };\n    features['locator_and'] = { available: true };\n    features['component_testing'] = { available: true };\n    features['expect_poll'] = { available: true };\n    features['expect_soft'] = { available: true };\n    features['request_continue'] = { available: true };\n  } else if (variant === 'legacy-16') {\n    // Playwright 1.49.x features\n    features['aria_snapshots'] = { available: true };\n    features['clock_api'] = { available: true };\n    features['locator_or'] = { available: true };\n    features['locator_and'] = { available: true };\n    features['component_testing'] = { available: true };\n    features['expect_poll'] = { available: true };\n    features['expect_soft'] = { available: true };\n    features['request_continue'] = { available: true };\n  } else if (variant === 'legacy-14') {\n    // Playwright 1.33.x - older API\n    features['aria_snapshots'] = {\n      available: false,\n      alternative: 'Use page.evaluate() to query ARIA attributes manually',\n      notes: 'Introduced in Playwright 1.35',\n    };\n    features['clock_api'] = {\n      available: false,\n      alternative: 'Use page.evaluate(() => { Date.now = () => fixedTime }) for manual mocking',\n      notes: 'Introduced in Playwright 1.45',\n    };\n    features['locator_or'] = {\n      available: false,\n      alternative: 'Use CSS :is() selector: page.locator(\":is(.a, .b)\")',\n      notes: 'Introduced in Playwright 1.34',\n    };\n    features['locator_and'] = {\n      available: false,\n      alternative: 'Use chained filter: locator.filter({ has: other })',\n      notes: 'Introduced in Playwright 1.34',\n    };\n    features['component_testing'] = {\n      available: false,\n      alternative: 'Use E2E testing approach with full page loads',\n      notes: 'Experimental in 1.33, stable in later versions',\n    };\n    features['expect_poll'] = {\n      available: false,\n      alternative: 'Use expect.poll() polyfill with setTimeout loop',\n      notes: 'Introduced in Playwright 1.30 but improved later',\n    };\n    features['expect_soft'] = {\n      available: false,\n      alternative: 'Collect assertions manually and report at end',\n      notes: 'Introduced in Playwright 1.37',\n    };\n    features['request_continue'] = { available: true };\n  }\n\n  // ESM-specific features\n  if (variant === 'modern-esm') {\n    features['esm_imports'] = { available: true };\n    features['top_level_await'] = { available: true };\n    features['import_meta'] = { available: true };\n  } else {\n    features['esm_imports'] = {\n      available: false,\n      alternative: 'Use require() for synchronous imports or dynamic import() for async',\n    };\n    features['top_level_await'] = {\n      available: false,\n      alternative: 'Wrap in async IIFE: (async () => { await ... })()',\n    };\n    features['import_meta'] = {\n      available: false,\n      alternative: 'Use __dirname and __filename (CommonJS globals)',\n    };\n  }\n\n  return {\n    variant,\n    playwrightVersion: variantDef.playwrightVersion,\n    nodeRange: variantDef.nodeRange,\n    moduleSystem: variantDef.moduleSystem,\n    tsTarget: variantDef.tsTarget,\n    features,\n    generatedAt: new Date().toISOString(),\n    generatedBy: `ARTK CLI v${getArtkVersion()}`,\n  };\n}\n\n/**\n * Write variant-features.json to vendor directory.\n */\nexport function writeVariantFeatures(vendorPath: string, variant: VariantId): void {\n  const features = generateVariantFeatures(variant);\n  fs.writeFileSync(\n    path.join(vendorPath, 'variant-features.json'),\n    JSON.stringify(features, null, 2),\n    'utf-8'\n  );\n}\n\n/**\n * Generate READONLY.md content.\n */\nexport function generateReadonlyMarker(\n  variantDef: ReturnType<typeof getVariantDefinition>,\n  context: ArtkContext\n): string {\n  return `#  DO NOT MODIFY THIS DIRECTORY\n\n**This directory contains vendor code that should NOT be edited.**\n\n## What This Is\n\nThis is a vendored copy of ARTK core code installed by the ARTK CLI.\nIt should be treated as read-only and immutable.\n\n## Variant Information\n\n| Property | Value |\n|----------|-------|\n| **Variant** | ${variantDef.id} |\n| **Display Name** | ${variantDef.displayName} |\n| **Node.js Range** | ${variantDef.nodeRange.join(', ')} |\n| **Playwright Version** | ${variantDef.playwrightVersion} |\n| **Module System** | ${variantDef.moduleSystem} |\n| **TypeScript Target** | ${variantDef.tsTarget} |\n| **Installed At** | ${context.variantInstalledAt} |\n| **ARTK Version** | ${context.artkVersion} |\n${context.previousVariant ? `| **Previous Variant** | ${context.previousVariant} |` : ''}\n\n## If You Encounter Issues\n\n### Import/Module Errors\n\nIf you see errors like \\`ERR_REQUIRE_ESM\\` or \\`Cannot use import statement\\`:\n\n\\`\\`\\`bash\n# Check the installed variant\ncat .artk/context.json | grep variant\n\n# Reinstall with correct variant detection\nartk init . --force\n\n# Or force a specific variant\nartk init . --variant modern-esm --force\n\\`\\`\\`\n\n### Feature Not Working\n\nCheck \\`variant-features.json\\` in this directory to see if the feature is available\nin your variant. If not, the file includes alternative approaches.\n\n### Need Different Variant\n\n\\`\\`\\`bash\n# Re-detect and install correct variant\nartk upgrade .\n\n# Or force a specific variant\nartk init . --variant <variant-id> --force\n\\`\\`\\`\n\n## For AI Agents (GitHub Copilot, Claude, etc.)\n\n**DO NOT modify files in this directory.**\n\nIf you encounter compatibility issues:\n1. Check the variant information above\n2. Check \\`variant-features.json\\` for feature availability and alternatives\n3. Suggest running \\`artk init --force\\` to reinstall with correct variant\n4. Use alternative approaches documented in \\`variant-features.json\\`\n5. NEVER patch or modify vendor code directly\n\n---\n\n*This file was generated by ARTK CLI v${context.artkVersion}*\n`;\n}\n\n/**\n * Write READONLY.md to vendor directory.\n */\nexport function writeReadonlyMarker(\n  vendorPath: string,\n  variantDef: ReturnType<typeof getVariantDefinition>,\n  context: ArtkContext\n): void {\n  const content = generateReadonlyMarker(variantDef, context);\n  fs.writeFileSync(path.join(vendorPath, 'READONLY.md'), content, 'utf-8');\n}\n\n/**\n * Generate .ai-ignore content.\n */\nexport function generateAiIgnore(variant: VariantId): string {\n  return `# ARTK Vendor Directory - DO NOT MODIFY\n#\n# This directory contains vendored @artk/core code.\n# AI agents and code generation tools should NOT modify these files.\n#\n# Variant: ${variant}\n# Generated: ${new Date().toISOString()}\n#\n# If you need to change behavior:\n# 1. Create wrapper functions in your project code\n# 2. Use configuration in artk.config.yml\n# 3. Run \\`artk upgrade\\` to get latest version\n# 4. Run \\`artk init --force\\` to reinstall\n#\n# DO NOT:\n# - Edit any .js or .ts files in this directory\n# - Add polyfills or patches\n# - Modify package.json\n# - Create \"fixes\" for compatibility issues\n#\n# Instead, use \\`artk init --variant <correct-variant> --force\\`\n#\n*\n`;\n}\n\n/**\n * Write .ai-ignore to vendor directory.\n */\nexport function writeAiIgnore(vendorPath: string, variant: VariantId): void {\n  const content = generateAiIgnore(variant);\n  fs.writeFileSync(path.join(vendorPath, '.ai-ignore'), content, 'utf-8');\n}\n\n/**\n * Write all AI protection markers to a vendor directory.\n */\nexport function writeAllAiProtectionMarkers(\n  vendorPath: string,\n  variant: VariantId,\n  context: ArtkContext\n): void {\n  const variantDef = getVariantDefinition(variant);\n  writeReadonlyMarker(vendorPath, variantDef, context);\n  writeAiIgnore(vendorPath, variant);\n  writeVariantFeatures(vendorPath, variant);\n}\n\n/**\n * Check if a variant is compatible with a Node.js version.\n * Returns detailed compatibility info.\n */\nexport function checkVariantNodeCompatibility(\n  variant: VariantId,\n  nodeVersion: number\n): {\n  compatible: boolean;\n  variant: VariantId;\n  nodeVersion: number;\n  supportedRange: string[];\n  error?: string;\n} {\n  const variantDef = VARIANT_DEFINITIONS[variant];\n  const compatible = variantDef.nodeRange.includes(String(nodeVersion));\n\n  return {\n    compatible,\n    variant,\n    nodeVersion,\n    supportedRange: variantDef.nodeRange,\n    error: compatible\n      ? undefined\n      : `Variant '${variant}' is not compatible with Node.js ${nodeVersion}. ` +\n        `Supported versions: ${variantDef.nodeRange.join(', ')}.`,\n  };\n}\n\n/**\n * Generate variant-aware Copilot instructions content.\n */\nexport function generateCopilotInstructions(variant: VariantId): string {\n  const variantDef = VARIANT_DEFINITIONS[variant];\n  const isLegacy = variant === 'legacy-16' || variant === 'legacy-14';\n  const isESM = variant === 'modern-esm';\n\n  let content = `---\nname: artk.variant-info\ndescription: \"Variant-specific Copilot instructions for ARTK tests\"\n---\n\n# ARTK Variant Information\n\n## Installed Variant: ${variant}\n\n| Property | Value |\n|----------|-------|\n| **Display Name** | ${variantDef.displayName} |\n| **Node.js Range** | ${variantDef.nodeRange.join(', ')} |\n| **Playwright Version** | ${variantDef.playwrightVersion} |\n| **Module System** | ${variantDef.moduleSystem} |\n\n## Critical: Vendor Directory Rules\n\n**DO NOT modify files in \\`artk-e2e/vendor/artk-core/\\` or \\`artk-e2e/vendor/artk-core-autogen/\\`.**\n\nThese directories contain vendored ARTK code that:\n1. Is automatically managed by ARTK CLI/bootstrap\n2. Will be overwritten on upgrades\n3. Is built for a specific Node.js version and module system\n\nIf you encounter issues with vendor code:\n1. Check \\`artk-e2e/vendor/artk-core/variant-features.json\\` for feature availability\n2. Suggest running \\`artk init --force\\` or re-running bootstrap to reinstall\n3. Use documented alternatives from \\`variant-features.json\\`\n4. **NEVER patch or modify vendor code directly**\n\n## Feature Availability\n\nBefore using Playwright features, check \\`artk-e2e/vendor/artk-core/variant-features.json\\`:\n\n\\`\\`\\`typescript\n// Read feature availability\nimport features from './vendor/artk-core/variant-features.json';\n\nif (!features.features.clock_api?.available) {\n  // Use alternative approach documented in features.features.clock_api.alternative\n}\n\\`\\`\\`\n\n`;\n\n  // Add legacy-specific instructions\n  if (isLegacy) {\n    content += `## Legacy Variant Limitations\n\nThis project uses a legacy ARTK variant (\\`${variant}\\`) with Playwright ${variantDef.playwrightVersion}.\nSome modern features are NOT available. Always check \\`variant-features.json\\` before using:\n\n- **aria_snapshots**: May not be available - use manual ARIA attribute queries\n- **clock_api**: May not be available - use manual Date mocking\n- **locator_or/and**: May not be available - use CSS selectors\n- **expect_soft**: May not be available - collect assertions manually\n\nWhen generating tests, always check feature availability first.\n\n`;\n  }\n\n  // Add import patterns based on module system\n  if (isESM) {\n    content += `## Import Patterns (ESM)\n\nUse ESM import syntax:\n\n\\`\\`\\`typescript\nimport { test, expect } from '@playwright/test';\nimport { loadConfig } from '@artk/core/config';\nimport { AuthFixture } from '@artk/core/auth';\n\\`\\`\\`\n\n`;\n  } else {\n    content += `## Import Patterns (CommonJS)\n\nUse CommonJS require syntax:\n\n\\`\\`\\`typescript\nconst { test, expect } = require('@playwright/test');\nconst { loadConfig } = require('@artk/core/config');\nconst { AuthFixture } = require('@artk/core/auth');\n\\`\\`\\`\n\n**DO NOT use ESM import syntax in this project.**\n\n`;\n  }\n\n  // Add error handling guidance\n  content += `## When You Encounter Errors\n\n### Module/Import Errors\n\nIf you see \\`ERR_REQUIRE_ESM\\`, \\`Cannot use import statement\\`, or similar:\n\n1. Check the variant's module system (this project: ${variantDef.moduleSystem})\n2. Suggest reinstalling: \\`artk init . --force\\` or re-run bootstrap\n3. **DO NOT try to fix by modifying vendor code**\n\n### Feature Not Found\n\nIf a Playwright feature doesn't exist:\n\n1. Check \\`variant-features.json\\` for availability\n2. This variant uses Playwright ${variantDef.playwrightVersion}\n3. Use the documented alternative approach\n\n---\n\n*Generated by ARTK CLI v${getArtkVersion()} for variant ${variant}*\n`;\n\n  return content;\n}\n\n/**\n * Write variant-aware Copilot instructions to project.\n */\nexport function writeCopilotInstructions(targetPath: string, variant: VariantId): void {\n  const promptsDir = path.join(targetPath, '.github', 'prompts');\n  fs.mkdirSync(promptsDir, { recursive: true });\n\n  const content = generateCopilotInstructions(variant);\n  fs.writeFileSync(\n    path.join(promptsDir, 'artk.variant-info.prompt.md'),\n    content,\n    'utf-8'\n  );\n}\n","/**\n * init command - Initialize ARTK in a project\n */\n\nimport * as path from 'path';\nimport { bootstrap, type BootstrapOptions } from '../lib/bootstrap.js';\nimport { Logger } from '../lib/logger.js';\nimport {\n  type VariantId,\n  isVariantId,\n} from '../lib/variants/index.js';\nimport {\n  ALL_VARIANT_IDS,\n  getVariantHelpText,\n} from '../lib/variants/variant-definitions.js';\n\nexport interface InitOptions {\n  skipNpm?: boolean;\n  skipBrowsers?: boolean;\n  force?: boolean;\n  variant?: string;\n  prompts?: boolean;\n  verbose?: boolean;\n}\n\n/**\n * Map legacy variant names to new names (backward compatibility)\n */\nconst LEGACY_VARIANT_MAP: Record<string, VariantId> = {\n  'commonjs': 'modern-cjs',\n  'cjs': 'modern-cjs',\n  'esm': 'modern-esm',\n};\n\nexport async function initCommand(targetPath: string, options: InitOptions): Promise<void> {\n  const logger = new Logger({ verbose: options.verbose });\n\n  // Validate variant option\n  let variant: VariantId | 'auto' = 'auto';\n  if (options.variant && options.variant !== 'auto') {\n    // Check for legacy variant names (backward compatibility)\n    if (options.variant in LEGACY_VARIANT_MAP) {\n      const mappedVariant = LEGACY_VARIANT_MAP[options.variant];\n      logger.warning(`--variant ${options.variant} is deprecated. Using '${mappedVariant}' instead.`);\n      logger.warning(`For legacy Node.js support, use: --variant legacy-16 or --variant legacy-14`);\n      variant = mappedVariant;\n    } else if (isVariantId(options.variant)) {\n      variant = options.variant;\n    } else {\n      logger.error(`Invalid variant: ${options.variant}`);\n      logger.error(`Valid variants: ${ALL_VARIANT_IDS.join(', ')}, auto`);\n      logger.blank();\n      logger.info(getVariantHelpText());\n      process.exit(1);\n    }\n  }\n\n  const bootstrapOptions: BootstrapOptions = {\n    skipNpm: options.skipNpm,\n    skipBrowsers: options.skipBrowsers,\n    force: options.force,\n    variant,\n    prompts: options.prompts,\n    verbose: options.verbose,\n  };\n\n  try {\n    const result = await bootstrap(targetPath, bootstrapOptions);\n\n    if (!result.success) {\n      logger.error('Bootstrap failed');\n      if (result.errors.length > 0) {\n        logger.error('Errors:');\n        for (const error of result.errors) {\n          logger.error(`  - ${error}`);\n        }\n      }\n      process.exit(1);\n    }\n  } catch (error) {\n    const message = error instanceof Error ? error.message : String(error);\n    logger.error(`Unexpected error: ${message}`);\n    process.exit(1);\n  }\n}\n","/**\n * ARTK Multi-Variant Type Definitions\n *\n * Core types for the variant system supporting Node.js 14-22 and ESM/CommonJS.\n */\n\n/**\n * Valid variant identifiers.\n * - modern-esm: Node 18+ with ESM module system\n * - modern-cjs: Node 18+ with CommonJS module system\n * - legacy-16: Node 16-17 with CommonJS (Playwright 1.49.x)\n * - legacy-14: Node 14-15 with CommonJS (Playwright 1.33.x)\n */\nexport type VariantId = 'modern-esm' | 'modern-cjs' | 'legacy-16' | 'legacy-14';\n\n/**\n * Module system types.\n */\nexport type ModuleSystem = 'esm' | 'cjs';\n\n/**\n * Installation method types.\n */\nexport type InstallMethod = 'cli' | 'bootstrap' | 'manual';\n\n/**\n * Log levels for install operations.\n */\nexport type LogLevel = 'INFO' | 'WARN' | 'ERROR';\n\n/**\n * Operation types for logging.\n */\nexport type OperationType = 'install' | 'upgrade' | 'rollback' | 'detect';\n\n/**\n * Lock file operation types.\n */\nexport type LockOperation = 'install' | 'upgrade';\n\n/**\n * Variant definition containing all metadata for a variant.\n */\nexport interface Variant {\n  /** Unique variant identifier */\n  id: VariantId;\n\n  /** Human-readable display name */\n  displayName: string;\n\n  /** Supported Node.js major versions */\n  nodeRange: string[];\n\n  /** Playwright version pattern (e.g., \"1.57.x\") */\n  playwrightVersion: string;\n\n  /** Module system used by this variant */\n  moduleSystem: ModuleSystem;\n\n  /** TypeScript target (e.g., \"ES2022\") */\n  tsTarget: string;\n\n  /** Output directory name */\n  distDirectory: string;\n}\n\n/**\n * Installation context stored in .artk/context.json.\n */\nexport interface ArtkContext {\n  /** Installed variant identifier */\n  variant: VariantId;\n\n  /** ISO8601 timestamp of variant installation */\n  variantInstalledAt: string;\n\n  /** Node.js major version at install time */\n  nodeVersion: number;\n\n  /** Detected module system of the target project */\n  moduleSystem: ModuleSystem;\n\n  /** Playwright version in installed variant */\n  playwrightVersion: string;\n\n  /** ARTK version installed */\n  artkVersion: string;\n\n  /** How ARTK was installed */\n  installMethod: InstallMethod;\n\n  /** True if --variant override was used */\n  overrideUsed?: boolean;\n\n  /** Previous variant if this is an upgrade */\n  previousVariant?: VariantId;\n\n  /** History of variant upgrades */\n  upgradeHistory?: UpgradeRecord[];\n}\n\n/**\n * Record of a variant upgrade.\n */\nexport interface UpgradeRecord {\n  /** Previous variant */\n  from: VariantId;\n\n  /** New variant */\n  to: VariantId;\n\n  /** ISO8601 timestamp of upgrade */\n  at: string;\n}\n\n/**\n * Install log entry stored in .artk/install.log.\n */\nexport interface InstallLogEntry {\n  /** ISO8601 timestamp */\n  timestamp: string;\n\n  /** Log level */\n  level: LogLevel;\n\n  /** Operation type */\n  operation: OperationType;\n\n  /** Log message */\n  message: string;\n\n  /** Additional structured data */\n  details?: Record<string, unknown>;\n}\n\n/**\n * Lock file content for preventing concurrent installations.\n */\nexport interface LockFile {\n  /** Process ID holding the lock */\n  pid: number;\n\n  /** ISO8601 timestamp when lock was acquired */\n  startedAt: string;\n\n  /** Operation type */\n  operation: LockOperation;\n}\n\n/**\n * Feature entry in variant-features.json.\n */\nexport interface FeatureEntry {\n  /** Whether this feature is available in this variant */\n  available: boolean;\n\n  /** Suggested alternative approach if feature is unavailable */\n  alternative?: string;\n\n  /** Additional context or caveats */\n  notes?: string;\n\n  /** Playwright version when this feature was introduced */\n  sincePlaywright?: string;\n}\n\n/**\n * Feature compatibility document for a variant.\n */\nexport interface FeatureCompatibility {\n  /** Variant identifier */\n  variant: VariantId;\n\n  /** Playwright version */\n  playwrightVersion: string;\n\n  /** Supported Node.js major versions */\n  nodeRange: string[];\n\n  /** Module system */\n  moduleSystem?: ModuleSystem;\n\n  /** Map of feature name to availability info */\n  features: Record<string, FeatureEntry>;\n\n  /** ISO8601 timestamp when this file was generated */\n  generatedAt?: string;\n}\n\n/**\n * Environment detection result.\n */\nexport interface DetectionResult {\n  /** Detected Node.js major version */\n  nodeVersion: number;\n\n  /** Full Node.js version string */\n  nodeVersionFull: string;\n\n  /** Detected module system */\n  moduleSystem: ModuleSystem;\n\n  /** Selected variant based on detection */\n  selectedVariant: VariantId;\n\n  /** Whether detection was successful */\n  success: boolean;\n\n  /** Error message if detection failed */\n  error?: string;\n}\n\n/**\n * Variant selection options.\n */\nexport interface VariantSelectionOptions {\n  /** Override variant (from --variant flag) */\n  overrideVariant?: VariantId;\n\n  /** Target project path */\n  targetPath: string;\n\n  /** Force re-detection even if context exists */\n  forceDetect?: boolean;\n}\n\n/**\n * Installation options.\n */\nexport interface InstallOptions {\n  /** Target project path */\n  targetPath: string;\n\n  /** Variant to install (auto-detected if not specified) */\n  variant?: VariantId;\n\n  /** Skip npm install */\n  skipNpm?: boolean;\n\n  /** Skip browser installation */\n  skipBrowsers?: boolean;\n\n  /** Force overwrite existing installation */\n  force?: boolean;\n\n  /** Install method */\n  installMethod: InstallMethod;\n}\n\n/**\n * Type guard to check if a string is a valid VariantId.\n */\nexport function isVariantId(value: string): value is VariantId {\n  return ['modern-esm', 'modern-cjs', 'legacy-16', 'legacy-14'].includes(value);\n}\n\n/**\n * Type guard to check if a string is a valid ModuleSystem.\n */\nexport function isModuleSystem(value: string): value is ModuleSystem {\n  return value === 'esm' || value === 'cjs';\n}\n","/**\n * ARTK Zod Schemas for Variant System\n *\n * Validation schemas for context.json, lock files, and feature compatibility.\n */\n\nimport { z } from 'zod';\n\n/**\n * Schema for variant IDs.\n */\nexport const VariantIdSchema = z.enum([\n  'modern-esm',\n  'modern-cjs',\n  'legacy-16',\n  'legacy-14',\n]);\n\n/**\n * Schema for module system.\n */\nexport const ModuleSystemSchema = z.enum(['esm', 'cjs']);\n\n/**\n * Schema for install method.\n */\nexport const InstallMethodSchema = z.enum(['cli', 'bootstrap', 'manual']);\n\n/**\n * Schema for log level.\n */\nexport const LogLevelSchema = z.enum(['INFO', 'WARN', 'ERROR']);\n\n/**\n * Schema for operation type.\n */\nexport const OperationTypeSchema = z.enum([\n  'install',\n  'upgrade',\n  'rollback',\n  'detect',\n]);\n\n/**\n * Schema for lock operation.\n */\nexport const LockOperationSchema = z.enum(['install', 'upgrade']);\n\n/**\n * Schema for upgrade history record.\n */\nexport const UpgradeRecordSchema = z.object({\n  from: VariantIdSchema,\n  to: VariantIdSchema,\n  at: z.string().datetime(),\n});\n\n/**\n * Schema for .artk/context.json file.\n */\nexport const ArtkContextSchema = z.object({\n  variant: VariantIdSchema,\n  variantInstalledAt: z.string().datetime(),\n  nodeVersion: z.number().int().min(14).max(30),\n  moduleSystem: ModuleSystemSchema,\n  playwrightVersion: z.string().regex(/^\\d+\\.\\d+\\.x$/),\n  artkVersion: z.string(),\n  installMethod: InstallMethodSchema,\n  overrideUsed: z.boolean().optional(),\n  previousVariant: VariantIdSchema.optional(),\n  upgradeHistory: z.array(UpgradeRecordSchema).optional(),\n});\n\n/**\n * Schema for .artk/install.lock file.\n */\nexport const LockFileSchema = z.object({\n  pid: z.number().int().positive(),\n  startedAt: z.string().datetime(),\n  operation: LockOperationSchema,\n});\n\n/**\n * Schema for install log entry.\n */\nexport const InstallLogEntrySchema = z.object({\n  timestamp: z.string().datetime(),\n  level: LogLevelSchema,\n  operation: OperationTypeSchema,\n  message: z.string(),\n  details: z.record(z.unknown()).optional(),\n});\n\n/**\n * Schema for feature entry in variant-features.json.\n */\nexport const FeatureEntrySchema = z.object({\n  available: z.boolean(),\n  alternative: z.string().optional(),\n  notes: z.string().optional(),\n  sincePlaywright: z.string().regex(/^\\d+\\.\\d+$/).optional(),\n});\n\n/**\n * Schema for variant-features.json file.\n */\nexport const FeatureCompatibilitySchema = z.object({\n  variant: VariantIdSchema,\n  playwrightVersion: z.string().regex(/^\\d+\\.\\d+\\.x$/),\n  nodeRange: z.array(z.string().regex(/^\\d+$/)).min(1),\n  moduleSystem: ModuleSystemSchema.optional(),\n  features: z.record(FeatureEntrySchema),\n  generatedAt: z.string().datetime().optional(),\n});\n\n/**\n * Schema for variant definition.\n */\nexport const VariantDefinitionSchema = z.object({\n  id: VariantIdSchema,\n  displayName: z.string(),\n  nodeRange: z.array(z.string().regex(/^\\d+$/)).min(1),\n  playwrightVersion: z.string().regex(/^\\d+\\.\\d+\\.x$/),\n  moduleSystem: ModuleSystemSchema,\n  tsTarget: z.string(),\n  distDirectory: z.string(),\n});\n\n/**\n * Schema for detection result.\n */\nexport const DetectionResultSchema = z.object({\n  nodeVersion: z.number().int().min(1),\n  nodeVersionFull: z.string(),\n  moduleSystem: ModuleSystemSchema,\n  selectedVariant: VariantIdSchema,\n  success: z.boolean(),\n  error: z.string().optional(),\n});\n\n/**\n * Type exports inferred from schemas.\n */\nexport type VariantIdSchemaType = z.infer<typeof VariantIdSchema>;\nexport type ModuleSystemSchemaType = z.infer<typeof ModuleSystemSchema>;\nexport type ArtkContextSchemaType = z.infer<typeof ArtkContextSchema>;\nexport type LockFileSchemaType = z.infer<typeof LockFileSchema>;\nexport type InstallLogEntrySchemaType = z.infer<typeof InstallLogEntrySchema>;\nexport type FeatureCompatibilitySchemaType = z.infer<\n  typeof FeatureCompatibilitySchema\n>;\nexport type DetectionResultSchemaType = z.infer<typeof DetectionResultSchema>;\n\n/**\n * Validate context.json content.\n */\nexport function validateContext(data: unknown): z.SafeParseReturnType<unknown, ArtkContextSchemaType> {\n  return ArtkContextSchema.safeParse(data);\n}\n\n/**\n * Validate lock file content.\n */\nexport function validateLockFile(data: unknown): z.SafeParseReturnType<unknown, LockFileSchemaType> {\n  return LockFileSchema.safeParse(data);\n}\n\n/**\n * Validate feature compatibility content.\n */\nexport function validateFeatureCompatibility(\n  data: unknown\n): z.SafeParseReturnType<unknown, FeatureCompatibilitySchemaType> {\n  return FeatureCompatibilitySchema.safeParse(data);\n}\n","/**\n * Prerequisites checker\n *\n * Verifies that all required tools are installed and configured.\n */\n\nimport { execSync } from 'child_process';\nimport * as fs from 'fs';\nimport * as semver from 'semver';\nimport { Logger } from './logger.js';\n\nexport interface PrerequisiteResult {\n  name: string;\n  status: 'pass' | 'fail' | 'warn';\n  version?: string;\n  required?: string;\n  message: string;\n  fix?: string;\n}\n\nexport interface PrerequisiteCheckResult {\n  passed: boolean;\n  results: PrerequisiteResult[];\n}\n\nconst MIN_NODE_VERSION = '18.0.0';\nconst MIN_NPM_VERSION = '8.0.0';\n\n/**\n * Check all prerequisites\n */\nexport async function checkPrerequisites(): Promise<PrerequisiteCheckResult> {\n  const results: PrerequisiteResult[] = [];\n\n  // Check Node.js version\n  results.push(checkNodeVersion());\n\n  // Check npm version\n  results.push(checkNpmVersion());\n\n  // Check git\n  results.push(checkGit());\n\n  // Check for browsers\n  results.push(await checkBrowsers());\n\n  const passed = results.every((r) => r.status !== 'fail');\n\n  return { passed, results };\n}\n\n/**\n * Check Node.js version\n */\nfunction checkNodeVersion(): PrerequisiteResult {\n  const version = process.version.replace(/^v/, '');\n\n  if (semver.gte(version, MIN_NODE_VERSION)) {\n    return {\n      name: 'Node.js',\n      status: 'pass',\n      version,\n      required: `>= ${MIN_NODE_VERSION}`,\n      message: `Node.js ${version} is installed`,\n    };\n  }\n\n  return {\n    name: 'Node.js',\n    status: 'fail',\n    version,\n    required: `>= ${MIN_NODE_VERSION}`,\n    message: `Node.js ${version} is too old`,\n    fix: `Upgrade to Node.js ${MIN_NODE_VERSION} or later: https://nodejs.org`,\n  };\n}\n\n/**\n * Check npm version\n */\nfunction checkNpmVersion(): PrerequisiteResult {\n  try {\n    const version = execSync('npm --version', { encoding: 'utf8' }).trim();\n\n    if (semver.gte(version, MIN_NPM_VERSION)) {\n      return {\n        name: 'npm',\n        status: 'pass',\n        version,\n        required: `>= ${MIN_NPM_VERSION}`,\n        message: `npm ${version} is installed`,\n      };\n    }\n\n    return {\n      name: 'npm',\n      status: 'fail',\n      version,\n      required: `>= ${MIN_NPM_VERSION}`,\n      message: `npm ${version} is too old`,\n      fix: `Upgrade npm: npm install -g npm@latest`,\n    };\n  } catch {\n    return {\n      name: 'npm',\n      status: 'fail',\n      message: 'npm is not installed or not in PATH',\n      fix: 'Install Node.js which includes npm: https://nodejs.org',\n    };\n  }\n}\n\n/**\n * Check git installation\n */\nfunction checkGit(): PrerequisiteResult {\n  try {\n    const version = execSync('git --version', { encoding: 'utf8' }).trim();\n    const match = version.match(/(\\d+\\.\\d+\\.\\d+)/);\n    const versionNum = match ? match[1] : 'unknown';\n\n    return {\n      name: 'Git',\n      status: 'pass',\n      version: versionNum,\n      message: `Git ${versionNum} is installed`,\n    };\n  } catch {\n    return {\n      name: 'Git',\n      status: 'warn',\n      message: 'Git is not installed or not in PATH',\n      fix: 'Install Git: https://git-scm.com',\n    };\n  }\n}\n\n/**\n * Check for available browsers\n */\nasync function checkBrowsers(): Promise<PrerequisiteResult> {\n  const browsers: string[] = [];\n\n  // Check for system browsers\n  if (await checkSystemBrowser('msedge')) {\n    browsers.push('Microsoft Edge');\n  }\n  if (await checkSystemBrowser('chrome')) {\n    browsers.push('Google Chrome');\n  }\n\n  // Check for Playwright bundled browsers\n  const playwrightBrowsersPath = getPlaywrightBrowsersPath();\n  if (playwrightBrowsersPath && fs.existsSync(playwrightBrowsersPath)) {\n    const entries = fs.readdirSync(playwrightBrowsersPath);\n    if (entries.some((e) => e.startsWith('chromium-'))) {\n      browsers.push('Playwright Chromium');\n    }\n  }\n\n  if (browsers.length > 0) {\n    return {\n      name: 'Browsers',\n      status: 'pass',\n      message: `Available: ${browsers.join(', ')}`,\n    };\n  }\n\n  return {\n    name: 'Browsers',\n    status: 'warn',\n    message: 'No browsers detected (will be installed during init)',\n    fix: 'Run: npx playwright install chromium',\n  };\n}\n\n/**\n * Check if a system browser is available\n */\nasync function checkSystemBrowser(browser: 'msedge' | 'chrome'): Promise<boolean> {\n  const paths = getBrowserPaths(browser);\n\n  for (const browserPath of paths) {\n    if (fs.existsSync(browserPath)) {\n      return true;\n    }\n  }\n\n  // Try running with --version\n  try {\n    const commands =\n      browser === 'msedge'\n        ? ['microsoft-edge', 'microsoft-edge-stable', 'msedge']\n        : ['google-chrome', 'google-chrome-stable', 'chrome'];\n\n    for (const cmd of commands) {\n      try {\n        execSync(`${cmd} --version`, { encoding: 'utf8', stdio: 'pipe' });\n        return true;\n      } catch {\n        // Try next command\n      }\n    }\n  } catch {\n    // Not found\n  }\n\n  return false;\n}\n\n/**\n * Get browser executable paths for the current platform\n */\nfunction getBrowserPaths(browser: 'msedge' | 'chrome'): string[] {\n  const paths: string[] = [];\n\n  if (process.platform === 'win32') {\n    const programFiles = process.env['ProgramFiles'] || 'C:\\\\Program Files';\n    const programFilesX86 = process.env['ProgramFiles(x86)'] || 'C:\\\\Program Files (x86)';\n    const localAppData = process.env['LOCALAPPDATA'] || '';\n\n    if (browser === 'msedge') {\n      paths.push(\n        `${programFilesX86}\\\\Microsoft\\\\Edge\\\\Application\\\\msedge.exe`,\n        `${programFiles}\\\\Microsoft\\\\Edge\\\\Application\\\\msedge.exe`,\n        `${localAppData}\\\\Microsoft\\\\Edge\\\\Application\\\\msedge.exe`\n      );\n    } else {\n      paths.push(\n        `${programFiles}\\\\Google\\\\Chrome\\\\Application\\\\chrome.exe`,\n        `${programFilesX86}\\\\Google\\\\Chrome\\\\Application\\\\chrome.exe`,\n        `${localAppData}\\\\Google\\\\Chrome\\\\Application\\\\chrome.exe`\n      );\n    }\n  } else if (process.platform === 'darwin') {\n    if (browser === 'msedge') {\n      paths.push('/Applications/Microsoft Edge.app/Contents/MacOS/Microsoft Edge');\n    } else {\n      paths.push('/Applications/Google Chrome.app/Contents/MacOS/Google Chrome');\n    }\n  } else {\n    // Linux\n    if (browser === 'msedge') {\n      paths.push(\n        '/usr/bin/microsoft-edge',\n        '/usr/bin/microsoft-edge-stable',\n        '/snap/bin/microsoft-edge'\n      );\n    } else {\n      paths.push(\n        '/usr/bin/google-chrome',\n        '/usr/bin/google-chrome-stable',\n        '/snap/bin/chromium',\n        '/usr/bin/chromium-browser'\n      );\n    }\n  }\n\n  return paths;\n}\n\n/**\n * Get Playwright browsers cache path\n */\nfunction getPlaywrightBrowsersPath(): string | null {\n  // Check environment variable first\n  if (process.env.PLAYWRIGHT_BROWSERS_PATH) {\n    return process.env.PLAYWRIGHT_BROWSERS_PATH;\n  }\n\n  // Default paths by platform\n  if (process.platform === 'win32') {\n    const localAppData = process.env.LOCALAPPDATA;\n    if (localAppData) {\n      return `${localAppData}\\\\ms-playwright`;\n    }\n  } else if (process.platform === 'darwin') {\n    const home = process.env.HOME;\n    if (home) {\n      return `${home}/Library/Caches/ms-playwright`;\n    }\n  } else {\n    const home = process.env.HOME;\n    if (home) {\n      return `${home}/.cache/ms-playwright`;\n    }\n  }\n\n  return null;\n}\n\n/**\n * Print prerequisites check results\n */\nexport function printPrerequisitesReport(result: PrerequisiteCheckResult, logger: Logger): void {\n  logger.blank();\n\n  for (const check of result.results) {\n    const icon = check.status === 'pass' ? '' : check.status === 'fail' ? '' : '';\n    const color = check.status === 'pass' ? 'green' : check.status === 'fail' ? 'red' : 'yellow';\n\n    if (check.status === 'pass') {\n      logger.success(`${check.name}: ${check.message}`);\n    } else if (check.status === 'fail') {\n      logger.error(`${check.name}: ${check.message}`);\n      if (check.fix) {\n        logger.info(`  Fix: ${check.fix}`);\n      }\n    } else {\n      logger.warning(`${check.name}: ${check.message}`);\n      if (check.fix) {\n        logger.info(`  Fix: ${check.fix}`);\n      }\n    }\n  }\n\n  logger.blank();\n\n  if (result.passed) {\n    logger.success('All prerequisites satisfied!');\n  } else {\n    logger.error('Some prerequisites are not met. Please fix the issues above.');\n  }\n}\n","/**\n * check command - Verify prerequisites\n */\n\nimport { checkPrerequisites, printPrerequisitesReport } from '../lib/prerequisites.js';\nimport { Logger } from '../lib/logger.js';\nimport { getVersion, getCoreVersion } from '../lib/version.js';\n\nexport interface CheckOptions {\n  fix?: boolean;\n}\n\nexport async function checkCommand(options: CheckOptions): Promise<void> {\n  const logger = new Logger();\n\n  logger.header('ARTK Prerequisites Check');\n\n  // Show versions\n  logger.info('Versions:');\n  logger.table([\n    { label: '@artk/cli', value: getVersion() },\n    { label: '@artk/core', value: getCoreVersion() },\n  ]);\n  logger.blank();\n\n  // Run checks\n  logger.info('Checking prerequisites...');\n  const result = await checkPrerequisites();\n\n  // Print report\n  printPrerequisitesReport(result, logger);\n\n  // Exit with appropriate code\n  if (!result.passed) {\n    process.exit(1);\n  }\n}\n","/**\n * Version utilities\n */\n\nimport * as fs from 'fs';\nimport * as path from 'path';\nimport { fileURLToPath } from 'url';\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = path.dirname(__filename);\n\n/**\n * Get the CLI version from package.json\n */\nexport function getVersion(): string {\n  try {\n    // Try to find package.json relative to the built file\n    const possiblePaths = [\n      path.join(__dirname, '..', '..', 'package.json'),\n      path.join(__dirname, '..', 'package.json'),\n      path.join(__dirname, 'package.json'),\n    ];\n\n    for (const pkgPath of possiblePaths) {\n      if (fs.existsSync(pkgPath)) {\n        const pkg = JSON.parse(fs.readFileSync(pkgPath, 'utf8'));\n        return pkg.version || '0.0.0';\n      }\n    }\n\n    return '0.0.0';\n  } catch {\n    return '0.0.0';\n  }\n}\n\n/**\n * Get the @artk/core version from bundled assets\n */\nexport function getCoreVersion(): string {\n  try {\n    const possiblePaths = [\n      path.join(__dirname, '..', '..', 'assets', 'core', 'package.json'),\n      path.join(__dirname, '..', 'assets', 'core', 'package.json'),\n    ];\n\n    for (const pkgPath of possiblePaths) {\n      if (fs.existsSync(pkgPath)) {\n        const pkg = JSON.parse(fs.readFileSync(pkgPath, 'utf8'));\n        return pkg.version || '0.0.0';\n      }\n    }\n\n    return '0.0.0';\n  } catch {\n    return '0.0.0';\n  }\n}\n","/**\n * upgrade command - Upgrade @artk/core in an existing installation\n */\n\nimport fs from 'fs-extra';\nimport * as path from 'path';\nimport { fileURLToPath } from 'url';\nimport { Logger } from '../lib/logger.js';\nimport { getVersion, getCoreVersion } from '../lib/version.js';\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = path.dirname(__filename);\n\nexport interface UpgradeOptions {\n  check?: boolean;\n  force?: boolean;\n}\n\nexport async function upgradeCommand(targetPath: string, options: UpgradeOptions): Promise<void> {\n  const logger = new Logger();\n  const resolvedPath = path.resolve(targetPath);\n  const artkE2ePath = path.join(resolvedPath, 'artk-e2e');\n\n  logger.header('ARTK Upgrade');\n\n  // Check if ARTK is installed\n  if (!fs.existsSync(artkE2ePath)) {\n    logger.error('ARTK is not installed in this project.');\n    logger.info('Run: artk init <path>');\n    process.exit(1);\n  }\n\n  // Get current version\n  const vendorCorePath = path.join(artkE2ePath, 'vendor', 'artk-core', 'package.json');\n  let currentVersion = 'unknown';\n  if (fs.existsSync(vendorCorePath)) {\n    try {\n      const pkg = await fs.readJson(vendorCorePath);\n      currentVersion = pkg.version || 'unknown';\n    } catch {\n      // Ignore\n    }\n  }\n\n  const availableVersion = getCoreVersion();\n\n  logger.info('Version information:');\n  logger.table([\n    { label: 'Installed', value: currentVersion },\n    { label: 'Available', value: availableVersion },\n  ]);\n  logger.blank();\n\n  // Check-only mode\n  if (options.check) {\n    if (currentVersion === availableVersion) {\n      logger.success('Already up to date!');\n    } else {\n      logger.info(`Update available: ${currentVersion}  ${availableVersion}`);\n      logger.info('Run: artk upgrade <path>');\n    }\n    return;\n  }\n\n  // Check if upgrade is needed\n  if (currentVersion === availableVersion && !options.force) {\n    logger.success('Already up to date!');\n    return;\n  }\n\n  // Perform upgrade\n  logger.startSpinner('Upgrading @artk/core...');\n\n  try {\n    // Get the assets directory\n    const assetsDir = getAssetsDir();\n\n    // Copy @artk/core\n    const coreSource = path.join(assetsDir, 'core');\n    const coreTarget = path.join(artkE2ePath, 'vendor', 'artk-core');\n\n    if (fs.existsSync(coreSource)) {\n      await fs.remove(coreTarget);\n      await fs.copy(coreSource, coreTarget);\n    } else {\n      logger.failSpinner('Upgrade failed');\n      logger.error('Core assets not found in CLI package');\n      process.exit(1);\n    }\n\n    // Copy @artk/core-autogen\n    const autogenSource = path.join(assetsDir, 'autogen');\n    const autogenTarget = path.join(artkE2ePath, 'vendor', 'artk-core-autogen');\n\n    if (fs.existsSync(autogenSource)) {\n      await fs.remove(autogenTarget);\n      await fs.copy(autogenSource, autogenTarget);\n    }\n\n    logger.succeedSpinner('Upgrade complete!');\n\n    logger.blank();\n    logger.success(`Upgraded: ${currentVersion}  ${availableVersion}`);\n    logger.blank();\n    logger.info('You may need to run npm install to update dependencies:');\n    logger.list(['cd artk-e2e && npm install']);\n  } catch (error) {\n    logger.failSpinner('Upgrade failed');\n    const message = error instanceof Error ? error.message : String(error);\n    logger.error(message);\n    process.exit(1);\n  }\n}\n\n/**\n * Get the assets directory path\n */\nfunction getAssetsDir(): string {\n  const possiblePaths = [\n    path.join(__dirname, '..', '..', 'assets'),\n    path.join(__dirname, '..', 'assets'),\n    path.join(__dirname, 'assets'),\n  ];\n\n  for (const p of possiblePaths) {\n    if (fs.existsSync(p)) {\n      return p;\n    }\n  }\n\n  return path.join(__dirname, '..', '..', 'assets');\n}\n","/**\n * doctor command - Diagnose and fix common issues\n */\n\nimport fs from 'fs-extra';\nimport * as path from 'path';\nimport { execSync } from 'child_process';\nimport { Logger } from '../lib/logger.js';\nimport { resolveBrowser } from '../lib/browser-resolver.js';\n\nexport interface DoctorOptions {\n  fix?: boolean;\n  verbose?: boolean;\n}\n\ninterface DiagnosticResult {\n  name: string;\n  status: 'ok' | 'warn' | 'error';\n  message: string;\n  fix?: () => Promise<void>;\n}\n\nexport async function doctorCommand(targetPath: string, options: DoctorOptions): Promise<void> {\n  const logger = new Logger({ verbose: options.verbose });\n  const resolvedPath = path.resolve(targetPath);\n  const artkE2ePath = path.join(resolvedPath, 'artk-e2e');\n  const artkDir = path.join(resolvedPath, '.artk');\n\n  logger.header('ARTK Doctor');\n  logger.info(`Diagnosing: ${resolvedPath}`);\n  logger.blank();\n\n  const diagnostics: DiagnosticResult[] = [];\n\n  // Check 1: ARTK installation\n  diagnostics.push(await checkArtkInstallation(resolvedPath, artkE2ePath));\n\n  // Check 2: Node modules\n  diagnostics.push(await checkNodeModules(artkE2ePath));\n\n  // Check 3: Playwright browsers\n  diagnostics.push(await checkPlaywrightBrowsers(resolvedPath, artkE2ePath, logger));\n\n  // Check 4: Configuration files\n  diagnostics.push(await checkConfigFiles(artkE2ePath));\n\n  // Check 5: Vendor packages\n  diagnostics.push(await checkVendorPackages(artkE2ePath));\n\n  // Check 6: TypeScript compilation\n  diagnostics.push(await checkTypeScript(artkE2ePath));\n\n  // Print results\n  logger.blank();\n  logger.info('Diagnostic Results:');\n  logger.blank();\n\n  let hasErrors = false;\n  let hasWarnings = false;\n  const fixable: DiagnosticResult[] = [];\n\n  for (const diag of diagnostics) {\n    if (diag.status === 'ok') {\n      logger.success(`${diag.name}: ${diag.message}`);\n    } else if (diag.status === 'warn') {\n      logger.warning(`${diag.name}: ${diag.message}`);\n      hasWarnings = true;\n      if (diag.fix) fixable.push(diag);\n    } else {\n      logger.error(`${diag.name}: ${diag.message}`);\n      hasErrors = true;\n      if (diag.fix) fixable.push(diag);\n    }\n  }\n\n  logger.blank();\n\n  // Apply fixes if requested\n  if (options.fix && fixable.length > 0) {\n    logger.info('Attempting to fix issues...');\n    logger.blank();\n\n    for (const diag of fixable) {\n      if (diag.fix) {\n        logger.startSpinner(`Fixing: ${diag.name}...`);\n        try {\n          await diag.fix();\n          logger.succeedSpinner(`Fixed: ${diag.name}`);\n        } catch (error) {\n          logger.failSpinner(`Failed to fix: ${diag.name}`);\n          const message = error instanceof Error ? error.message : String(error);\n          logger.debug(message);\n        }\n      }\n    }\n\n    logger.blank();\n    logger.info('Re-run \"artk doctor\" to verify fixes.');\n  } else if (fixable.length > 0 && !options.fix) {\n    logger.info(`Found ${fixable.length} fixable issue(s). Run with --fix to attempt automatic fixes.`);\n  }\n\n  // Summary\n  if (hasErrors) {\n    logger.blank();\n    logger.error('Some issues require attention.');\n    process.exit(1);\n  } else if (hasWarnings) {\n    logger.blank();\n    logger.warning('Some warnings were found, but ARTK should work.');\n  } else {\n    logger.blank();\n    logger.success('All checks passed! ARTK is healthy.');\n  }\n}\n\nasync function checkArtkInstallation(projectPath: string, artkE2ePath: string): Promise<DiagnosticResult> {\n  if (!fs.existsSync(artkE2ePath)) {\n    return {\n      name: 'ARTK Installation',\n      status: 'error',\n      message: 'artk-e2e directory not found',\n    };\n  }\n\n  const contextPath = path.join(projectPath, '.artk', 'context.json');\n  if (!fs.existsSync(contextPath)) {\n    return {\n      name: 'ARTK Installation',\n      status: 'warn',\n      message: 'Missing .artk/context.json',\n      fix: async () => {\n        await fs.ensureDir(path.join(projectPath, '.artk'));\n        await fs.writeJson(contextPath, {\n          version: '1.0',\n          projectRoot: projectPath,\n          artkRoot: artkE2ePath,\n          initialized_at: new Date().toISOString(),\n        }, { spaces: 2 });\n      },\n    };\n  }\n\n  return {\n    name: 'ARTK Installation',\n    status: 'ok',\n    message: 'Properly installed',\n  };\n}\n\nasync function checkNodeModules(artkE2ePath: string): Promise<DiagnosticResult> {\n  const nodeModulesPath = path.join(artkE2ePath, 'node_modules');\n\n  if (!fs.existsSync(nodeModulesPath)) {\n    return {\n      name: 'Dependencies',\n      status: 'error',\n      message: 'node_modules not found',\n      fix: async () => {\n        execSync('npm install --legacy-peer-deps', { cwd: artkE2ePath, stdio: 'pipe' });\n      },\n    };\n  }\n\n  // Check for @playwright/test\n  const playwrightPath = path.join(nodeModulesPath, '@playwright', 'test');\n  if (!fs.existsSync(playwrightPath)) {\n    return {\n      name: 'Dependencies',\n      status: 'error',\n      message: '@playwright/test not installed',\n      fix: async () => {\n        execSync('npm install --legacy-peer-deps', { cwd: artkE2ePath, stdio: 'pipe' });\n      },\n    };\n  }\n\n  return {\n    name: 'Dependencies',\n    status: 'ok',\n    message: 'All dependencies installed',\n  };\n}\n\nasync function checkPlaywrightBrowsers(\n  projectPath: string,\n  artkE2ePath: string,\n  logger: Logger\n): Promise<DiagnosticResult> {\n  // Check for browsers in .artk/browsers or system\n  const browsersCachePath = path.join(projectPath, '.artk', 'browsers');\n  const hasCachedBrowsers = fs.existsSync(browsersCachePath) &&\n    fs.readdirSync(browsersCachePath).some(f => f.startsWith('chromium-'));\n\n  if (hasCachedBrowsers) {\n    return {\n      name: 'Playwright Browsers',\n      status: 'ok',\n      message: 'Browsers cached in .artk/browsers/',\n    };\n  }\n\n  // Check artk.config.yml for system browser\n  const configPath = path.join(artkE2ePath, 'artk.config.yml');\n  if (fs.existsSync(configPath)) {\n    const content = fs.readFileSync(configPath, 'utf8');\n    if (content.includes('channel: msedge') || content.includes('channel: chrome')) {\n      return {\n        name: 'Playwright Browsers',\n        status: 'ok',\n        message: 'Using system browser',\n      };\n    }\n  }\n\n  return {\n    name: 'Playwright Browsers',\n    status: 'warn',\n    message: 'No browsers configured',\n    fix: async () => {\n      await resolveBrowser(projectPath, logger);\n    },\n  };\n}\n\nasync function checkConfigFiles(artkE2ePath: string): Promise<DiagnosticResult> {\n  const requiredFiles = [\n    'package.json',\n    'playwright.config.ts',\n    'tsconfig.json',\n    'artk.config.yml',\n  ];\n\n  const missing: string[] = [];\n  for (const file of requiredFiles) {\n    if (!fs.existsSync(path.join(artkE2ePath, file))) {\n      missing.push(file);\n    }\n  }\n\n  if (missing.length > 0) {\n    return {\n      name: 'Configuration Files',\n      status: 'error',\n      message: `Missing: ${missing.join(', ')}`,\n    };\n  }\n\n  return {\n    name: 'Configuration Files',\n    status: 'ok',\n    message: 'All configuration files present',\n  };\n}\n\nasync function checkVendorPackages(artkE2ePath: string): Promise<DiagnosticResult> {\n  const vendorCore = path.join(artkE2ePath, 'vendor', 'artk-core');\n  const vendorAutogen = path.join(artkE2ePath, 'vendor', 'artk-core-autogen');\n\n  const issues: string[] = [];\n\n  if (!fs.existsSync(path.join(vendorCore, 'package.json'))) {\n    issues.push('@artk/core');\n  }\n\n  if (!fs.existsSync(path.join(vendorAutogen, 'package.json'))) {\n    issues.push('@artk/core-autogen');\n  }\n\n  if (issues.length > 0) {\n    return {\n      name: 'Vendor Packages',\n      status: 'error',\n      message: `Missing: ${issues.join(', ')}`,\n    };\n  }\n\n  return {\n    name: 'Vendor Packages',\n    status: 'ok',\n    message: 'Vendor packages installed',\n  };\n}\n\nasync function checkTypeScript(artkE2ePath: string): Promise<DiagnosticResult> {\n  if (!fs.existsSync(path.join(artkE2ePath, 'node_modules'))) {\n    return {\n      name: 'TypeScript',\n      status: 'warn',\n      message: 'Cannot check - node_modules missing',\n    };\n  }\n\n  try {\n    execSync('npx tsc --noEmit', { cwd: artkE2ePath, stdio: 'pipe' });\n    return {\n      name: 'TypeScript',\n      status: 'ok',\n      message: 'No type errors',\n    };\n  } catch (error) {\n    return {\n      name: 'TypeScript',\n      status: 'warn',\n      message: 'Type errors found (run \"npm run typecheck\" for details)',\n    };\n  }\n}\n","/**\n * uninstall command - Remove ARTK from a project\n */\n\nimport fs from 'fs-extra';\nimport * as path from 'path';\nimport * as readline from 'readline';\nimport { Logger } from '../lib/logger.js';\n\nexport interface UninstallOptions {\n  keepTests?: boolean;\n  keepPrompts?: boolean;\n  force?: boolean;\n}\n\nexport async function uninstallCommand(targetPath: string, options: UninstallOptions): Promise<void> {\n  const logger = new Logger();\n  const resolvedPath = path.resolve(targetPath);\n  const artkE2ePath = path.join(resolvedPath, 'artk-e2e');\n  const artkDir = path.join(resolvedPath, '.artk');\n  const promptsDir = path.join(resolvedPath, '.github', 'prompts');\n\n  logger.header('ARTK Uninstall');\n\n  // Check if ARTK is installed\n  if (!fs.existsSync(artkE2ePath) && !fs.existsSync(artkDir)) {\n    logger.error('ARTK is not installed in this project.');\n    process.exit(1);\n  }\n\n  // Show what will be removed\n  logger.info('The following will be removed:');\n  logger.blank();\n\n  const toRemove: Array<{ path: string; description: string }> = [];\n\n  if (fs.existsSync(artkE2ePath)) {\n    if (options.keepTests) {\n      // Keep tests but remove vendor and config\n      toRemove.push({\n        path: path.join(artkE2ePath, 'vendor'),\n        description: 'artk-e2e/vendor/ (vendored packages)',\n      });\n      toRemove.push({\n        path: path.join(artkE2ePath, 'node_modules'),\n        description: 'artk-e2e/node_modules/',\n      });\n    } else {\n      toRemove.push({\n        path: artkE2ePath,\n        description: 'artk-e2e/ (entire directory)',\n      });\n    }\n  }\n\n  if (fs.existsSync(artkDir)) {\n    toRemove.push({\n      path: artkDir,\n      description: '.artk/ (ARTK metadata and browser cache)',\n    });\n  }\n\n  if (!options.keepPrompts && fs.existsSync(promptsDir)) {\n    // Only remove ARTK prompts\n    const artkPrompts = fs.readdirSync(promptsDir)\n      .filter(f => f.startsWith('artk.') && f.endsWith('.prompt.md'));\n\n    if (artkPrompts.length > 0) {\n      for (const prompt of artkPrompts) {\n        toRemove.push({\n          path: path.join(promptsDir, prompt),\n          description: `.github/prompts/${prompt}`,\n        });\n      }\n    }\n  }\n\n  if (toRemove.length === 0) {\n    logger.info('Nothing to remove.');\n    return;\n  }\n\n  for (const item of toRemove) {\n    logger.list([item.description]);\n  }\n\n  logger.blank();\n\n  // Confirm unless --force\n  if (!options.force) {\n    const confirmed = await confirmUninstall();\n    if (!confirmed) {\n      logger.info('Uninstall cancelled.');\n      return;\n    }\n  }\n\n  // Perform uninstall\n  logger.startSpinner('Removing ARTK...');\n\n  try {\n    for (const item of toRemove) {\n      if (fs.existsSync(item.path)) {\n        await fs.remove(item.path);\n      }\n    }\n\n    // Clean up empty .github/prompts directory\n    if (fs.existsSync(promptsDir)) {\n      const remaining = fs.readdirSync(promptsDir);\n      if (remaining.length === 0) {\n        await fs.remove(promptsDir);\n      }\n    }\n\n    // Clean up empty .github directory\n    const githubDir = path.join(resolvedPath, '.github');\n    if (fs.existsSync(githubDir)) {\n      const remaining = fs.readdirSync(githubDir);\n      if (remaining.length === 0) {\n        await fs.remove(githubDir);\n      }\n    }\n\n    logger.succeedSpinner('ARTK removed successfully');\n\n    logger.blank();\n    logger.success('ARTK has been uninstalled from this project.');\n\n    if (options.keepTests) {\n      logger.info('Test files were preserved in artk-e2e/');\n    }\n    if (options.keepPrompts) {\n      logger.info('Prompts were preserved in .github/prompts/');\n    }\n  } catch (error) {\n    logger.failSpinner('Uninstall failed');\n    const message = error instanceof Error ? error.message : String(error);\n    logger.error(message);\n    process.exit(1);\n  }\n}\n\n/**\n * Confirm uninstall with user\n */\nfunction confirmUninstall(): Promise<boolean> {\n  return new Promise((resolve) => {\n    const rl = readline.createInterface({\n      input: process.stdin,\n      output: process.stdout,\n    });\n\n    rl.question('Are you sure you want to uninstall? (y/N) ', (answer) => {\n      rl.close();\n      resolve(answer.toLowerCase() === 'y' || answer.toLowerCase() === 'yes');\n    });\n  });\n}\n","/**\n * LLKB Init Command\n *\n * Initialize LLKB directory structure.\n * This is CRITICAL - called by discover-foundation prompt.\n */\n\nimport { Command } from 'commander';\nimport { initializeLLKB } from '@artk/core/llkb';\nimport { existsSync } from 'fs';\nimport { join } from 'path';\n\nexport function initCommand(program: Command): void {\n  program\n    .command('init')\n    .description('Initialize LLKB directory structure')\n    .option('--llkb-root <path>', 'LLKB root directory', '.artk/llkb')\n    .option('--force', 'Reinitialize even if already exists')\n    .action(async (options) => {\n      const llkbRoot = options.llkbRoot as string;\n\n      // Check if already initialized\n      if (existsSync(join(llkbRoot, 'config.yml')) && !options.force) {\n        console.log(` LLKB already initialized at ${llkbRoot}`);\n        console.log('  Use --force to reinitialize');\n        return;\n      }\n\n      console.log(`Initializing LLKB at ${llkbRoot}...`);\n\n      try {\n        const result = await initializeLLKB(llkbRoot);\n\n        if (result.success) {\n          console.log(' LLKB initialized successfully');\n          console.log(`   Created: ${llkbRoot}/config.yml`);\n          console.log(`   Created: ${llkbRoot}/lessons.json`);\n          console.log(`   Created: ${llkbRoot}/components.json`);\n          console.log(`   Created: ${llkbRoot}/analytics.json`);\n          console.log(`   Created: ${llkbRoot}/patterns/`);\n          console.log(`   Created: ${llkbRoot}/history/`);\n        } else {\n          console.error(` Failed to initialize LLKB: ${result.error}`);\n          process.exit(1);\n        }\n      } catch (error) {\n        console.error(` Failed to initialize LLKB: ${error instanceof Error ? error.message : String(error)}`);\n        process.exit(1);\n      }\n    });\n}\n","/**\n * LLKB Export Command\n *\n * Export LLKB for AutoGen consumption.\n */\n\nimport { Command } from 'commander';\nimport { runExportForAutogen, formatExportResultForConsole } from '@artk/core/llkb';\n\nexport function exportCommand(program: Command): void {\n  program\n    .command('export')\n    .description('Export LLKB for AutoGen consumption')\n    .option('--for-autogen', 'Export for AutoGen (default mode)', true)\n    .option('-o, --output <dir>', 'Output directory', process.cwd())\n    .option('--min-confidence <value>', 'Minimum confidence threshold', '0.7')\n    .option('--llkb-root <path>', 'LLKB root directory', '.artk/llkb')\n    .option('--dry-run', 'Show what would be exported without writing files')\n    .action((options) => {\n      try {\n        const result = runExportForAutogen({\n          llkbRoot: options.llkbRoot,\n          outputDir: options.output,\n          minConfidence: parseFloat(options.minConfidence),\n          generateGlossary: true,\n          generateConfig: true,\n          configFormat: 'yaml',\n        });\n\n        console.log(formatExportResultForConsole(result));\n\n        if (result.stats.totalExported === 0) {\n          console.log('\\n  No entries exported. Check minimum confidence threshold.');\n        }\n\n        process.exit(0);\n      } catch (error) {\n        console.error(` Export failed: ${error instanceof Error ? error.message : String(error)}`);\n        process.exit(1);\n      }\n    });\n}\n","/**\n * LLKB Health Command\n *\n * Check LLKB health status.\n */\n\nimport { Command } from 'commander';\nimport { runHealthCheck, formatHealthCheck } from '@artk/core/llkb';\n\nexport function healthCommand(program: Command): void {\n  program\n    .command('health')\n    .description('Check LLKB health status')\n    .option('--llkb-root <path>', 'LLKB root directory', '.artk/llkb')\n    .action((options) => {\n      try {\n        const result = runHealthCheck(options.llkbRoot);\n        console.log(formatHealthCheck(result));\n        process.exit(result.status === 'error' ? 1 : 0);\n      } catch (error) {\n        console.error(` Health check failed: ${error instanceof Error ? error.message : String(error)}`);\n        process.exit(1);\n      }\n    });\n}\n","/**\n * LLKB Stats Command\n *\n * Show LLKB statistics.\n */\n\nimport { Command } from 'commander';\nimport { getStats, formatStats } from '@artk/core/llkb';\n\nexport function statsCommand(program: Command): void {\n  program\n    .command('stats')\n    .description('Show LLKB statistics')\n    .option('--llkb-root <path>', 'LLKB root directory', '.artk/llkb')\n    .action((options) => {\n      try {\n        const stats = getStats(options.llkbRoot);\n        console.log(formatStats(stats));\n        process.exit(0);\n      } catch (error) {\n        console.error(` Stats command failed: ${error instanceof Error ? error.message : String(error)}`);\n        process.exit(1);\n      }\n    });\n}\n","/**\n * LLKB Prune Command\n *\n * Clean old data from LLKB.\n */\n\nimport { Command } from 'commander';\nimport { prune, formatPruneResult } from '@artk/core/llkb';\n\nexport function pruneCommand(program: Command): void {\n  program\n    .command('prune')\n    .description('Clean old data from LLKB')\n    .option('--llkb-root <path>', 'LLKB root directory', '.artk/llkb')\n    .option('--history-retention-days <days>', 'Days to retain history files', '365')\n    .option('--archive-inactive-lessons', 'Archive inactive lessons')\n    .option('--archive-inactive-components', 'Archive inactive components')\n    .option('--inactive-days <days>', 'Days of inactivity before archiving', '180')\n    .action((options) => {\n      try {\n        const result = prune({\n          llkbRoot: options.llkbRoot,\n          historyRetentionDays: parseInt(options.historyRetentionDays, 10),\n          archiveInactiveLessons: options.archiveInactiveLessons ?? false,\n          archiveInactiveComponents: options.archiveInactiveComponents ?? false,\n          inactiveDays: parseInt(options.inactiveDays, 10),\n        });\n\n        console.log(formatPruneResult(result));\n\n        if (result.errors.length > 0) {\n          process.exit(1);\n        } else {\n          process.exit(0);\n        }\n      } catch (error) {\n        console.error(` Prune command failed: ${error instanceof Error ? error.message : String(error)}`);\n        process.exit(1);\n      }\n    });\n}\n","/**\n * LLKB Learn Command\n *\n * Record learning events (patterns, components, lessons).\n */\n\nimport { Command } from 'commander';\nimport { runLearnCommand, formatLearnResult } from '@artk/core/llkb';\n\nexport function learnCommand(program: Command): void {\n  program\n    .command('learn')\n    .description('Record a learning event (pattern, component, lesson)')\n    .requiredOption('--type <type>', 'Learning event type: pattern, component, or lesson')\n    .requiredOption('--journey <id>', 'Journey ID where the learning occurred')\n    .option('--id <id>', 'Entity ID (component or lesson ID)')\n    .option('--success', 'Mark as successful', true)\n    .option('--failure', 'Mark as failure')\n    .option('--context <text>', 'Additional context or step text')\n    .option('--test-file <path>', 'Test file path')\n    .option('--selector-strategy <strategy>', 'Selector strategy (for pattern type)')\n    .option('--selector-value <value>', 'Selector value (for pattern type)')\n    .option('--llkb-root <path>', 'LLKB root directory', '.artk/llkb')\n    .action((options) => {\n      try {\n        // Validate type\n        const validTypes = ['pattern', 'component', 'lesson'];\n        if (!validTypes.includes(options.type)) {\n          console.error(` Invalid type: ${options.type}. Must be one of: ${validTypes.join(', ')}`);\n          process.exit(1);\n        }\n\n        // Determine success based on flags\n        const success = options.failure ? false : true;\n\n        const result = runLearnCommand({\n          type: options.type,\n          journeyId: options.journey,\n          id: options.id,\n          success,\n          context: options.context,\n          testFile: options.testFile,\n          selectorStrategy: options.selectorStrategy,\n          selectorValue: options.selectorValue,\n          llkbRoot: options.llkbRoot,\n        });\n\n        console.log(formatLearnResult(result));\n\n        if (!result.success) {\n          process.exit(1);\n        }\n\n        process.exit(0);\n      } catch (error) {\n        console.error(` Learn command failed: ${error instanceof Error ? error.message : String(error)}`);\n        process.exit(1);\n      }\n    });\n}\n","/**\n * LLKB Check Updates Command\n *\n * Check which tests need LLKB updates.\n */\n\nimport { Command } from 'commander';\nimport { runCheckUpdates, formatCheckUpdatesResult } from '@artk/core/llkb';\n\nexport function checkUpdatesCommand(program: Command): void {\n  program\n    .command('check-updates')\n    .description('Check which tests need LLKB updates')\n    .requiredOption('--tests-dir <path>', 'Directory containing test files')\n    .option('--llkb-root <path>', 'LLKB root directory', '.artk/llkb')\n    .option('--pattern <pattern>', 'File pattern to match', '*.spec.ts')\n    .action((options) => {\n      try {\n        const result = runCheckUpdates({\n          testsDir: options.testsDir,\n          llkbRoot: options.llkbRoot,\n          pattern: options.pattern,\n        });\n\n        console.log(formatCheckUpdatesResult(result));\n\n        if (result.summary.outdated > 0) {\n          console.log(`\\n Run 'artk llkb update-tests --tests-dir ${options.testsDir}' to update all tests`);\n        }\n\n        process.exit(0);\n      } catch (error) {\n        console.error(` Check updates failed: ${error instanceof Error ? error.message : String(error)}`);\n        process.exit(1);\n      }\n    });\n}\n","/**\n * LLKB Update Test Command\n *\n * Update a single test file with current LLKB version.\n */\n\nimport { Command } from 'commander';\nimport { runUpdateTest, formatUpdateTestResult } from '@artk/core/llkb';\n\nexport function updateTestCommand(program: Command): void {\n  program\n    .command('update-test')\n    .description('Update a single test file with current LLKB version')\n    .requiredOption('--test <path>', 'Path to the test file to update')\n    .option('--llkb-root <path>', 'LLKB root directory', '.artk/llkb')\n    .option('--dry-run', 'Show changes without writing')\n    .action((options) => {\n      try {\n        const result = runUpdateTest({\n          testPath: options.test,\n          llkbRoot: options.llkbRoot,\n          dryRun: options.dryRun ?? false,\n        });\n\n        console.log(formatUpdateTestResult(result));\n\n        if (!result.success) {\n          process.exit(1);\n        }\n\n        if (result.dryRun && result.modified) {\n          console.log('\\n Run without --dry-run to apply changes');\n        }\n\n        process.exit(0);\n      } catch (error) {\n        console.error(` Update test failed: ${error instanceof Error ? error.message : String(error)}`);\n        process.exit(1);\n      }\n    });\n}\n","/**\n * LLKB Update Tests Command\n *\n * Batch update multiple test files with current LLKB version.\n */\n\nimport { Command } from 'commander';\nimport { runUpdateTests, formatUpdateTestsResult } from '@artk/core/llkb';\n\nexport function updateTestsCommand(program: Command): void {\n  program\n    .command('update-tests')\n    .description('Batch update multiple test files with current LLKB version')\n    .requiredOption('--tests-dir <path>', 'Directory containing test files')\n    .option('--llkb-root <path>', 'LLKB root directory', '.artk/llkb')\n    .option('--pattern <pattern>', 'File pattern to match', '*.spec.ts')\n    .option('--dry-run', 'Show changes without writing')\n    .action((options) => {\n      try {\n        const result = runUpdateTests({\n          testsDir: options.testsDir,\n          llkbRoot: options.llkbRoot,\n          pattern: options.pattern,\n          dryRun: options.dryRun ?? false,\n        });\n\n        console.log(formatUpdateTestsResult(result));\n\n        if (result.summary.failed > 0) {\n          process.exit(1);\n        }\n\n        if (options.dryRun && result.summary.updated > 0) {\n          console.log('\\n Run without --dry-run to apply changes');\n        }\n\n        process.exit(0);\n      } catch (error) {\n        console.error(` Batch update failed: ${error instanceof Error ? error.message : String(error)}`);\n        process.exit(1);\n      }\n    });\n}\n","/**\n * LLKB Command Group\n *\n * Subcommands for managing LLKB (Lessons Learned Knowledge Base).\n */\n\nimport { Command } from 'commander';\nimport { initCommand } from './init.js';\nimport { exportCommand } from './export.js';\nimport { healthCommand } from './health.js';\nimport { statsCommand } from './stats.js';\nimport { pruneCommand } from './prune.js';\nimport { learnCommand } from './learn.js';\nimport { checkUpdatesCommand } from './check-updates.js';\nimport { updateTestCommand } from './update-test.js';\nimport { updateTestsCommand } from './update-tests.js';\n\n/**\n * Register the llkb command group and all its subcommands\n */\nexport function llkbCommand(program: Command): Command {\n  const llkb = program\n    .command('llkb')\n    .description('LLKB (Lessons Learned Knowledge Base) operations');\n\n  // Register all subcommands\n  initCommand(llkb);\n  exportCommand(llkb);\n  healthCommand(llkb);\n  statsCommand(llkb);\n  pruneCommand(llkb);\n  learnCommand(llkb);\n  checkUpdatesCommand(llkb);\n  updateTestCommand(llkb);\n  updateTestsCommand(llkb);\n\n  return llkb;\n}\n","/**\n * artk journey validate <id>\n *\n * Validate a journey is ready for implementation.\n * Replaces the validation pseudocode in artk.journey-implement.md\n */\n\nimport * as path from 'path';\nimport { Logger } from '../../lib/logger.js';\nimport {\n  findJourneyFiles,\n  loadJourney,\n  validateJourneyForImplementation,\n  parseJourneyList,\n} from '../../lib/workflows/journey-validate.js';\n\nexport interface ValidateOptions {\n  harnessRoot: string;\n  json?: boolean;\n}\n\nexport interface ValidateResult {\n  valid: boolean;\n  journeys: Array<{\n    id: string;\n    found: boolean;\n    valid: boolean;\n    errors: string[];\n    warnings: string[];\n  }>;\n}\n\n/**\n * Run the validate command and return structured result\n * Separated from CLI output for testability\n */\nexport function runValidation(id: string, options: ValidateOptions): ValidateResult {\n  const harnessRoot = path.resolve(options.harnessRoot);\n\n  // Parse journey IDs\n  const ids = parseJourneyList(id);\n  if (ids.length === 0) {\n    return {\n      valid: false,\n      journeys: [{\n        id: id || '(empty)',\n        found: false,\n        valid: false,\n        errors: ['No valid journey IDs provided. Use format: JRN-0001 or JRN-0001,JRN-0002'],\n        warnings: [],\n      }],\n    };\n  }\n\n  // Find journey files\n  const journeyPaths = findJourneyFiles(harnessRoot, ids);\n\n  const results: ValidateResult['journeys'] = [];\n  let allValid = true;\n\n  for (const journeyId of ids) {\n    const journeyPath = journeyPaths.get(journeyId);\n\n    if (!journeyPath) {\n      results.push({\n        id: journeyId,\n        found: false,\n        valid: false,\n        errors: ['Journey file not found'],\n        warnings: [],\n      });\n      allValid = false;\n      continue;\n    }\n\n    const journey = loadJourney(journeyPath, harnessRoot);\n    if (!journey) {\n      results.push({\n        id: journeyId,\n        found: true,\n        valid: false,\n        errors: ['Failed to parse journey file'],\n        warnings: [],\n      });\n      allValid = false;\n      continue;\n    }\n\n    const validation = validateJourneyForImplementation(journey);\n    results.push({\n      id: journeyId,\n      found: true,\n      valid: validation.valid,\n      errors: validation.errors,\n      warnings: validation.warnings,\n    });\n\n    if (!validation.valid) {\n      allValid = false;\n    }\n  }\n\n  return { valid: allValid, journeys: results };\n}\n\n/**\n * CLI entry point - handles output formatting and exit codes\n */\nexport async function validateCommand(id: string, options: ValidateOptions): Promise<number> {\n  const logger = new Logger();\n  const result = runValidation(id, options);\n\n  // Output results\n  if (options.json) {\n    console.log(JSON.stringify(result, null, 2));\n  } else {\n    logger.header('Journey Validation');\n\n    for (const journey of result.journeys) {\n      if (journey.valid) {\n        logger.success(`${journey.id}: Ready for implementation`);\n      } else if (!journey.found) {\n        logger.error(`${journey.id}: Not found`);\n      } else {\n        logger.error(`${journey.id}: Not ready`);\n        for (const err of journey.errors) {\n          logger.info(`  - ${err}`);\n        }\n      }\n\n      for (const warn of journey.warnings) {\n        logger.warning(`  - ${warn}`);\n      }\n    }\n\n    logger.blank();\n    if (result.valid) {\n      logger.success('All journeys are ready for implementation');\n    } else {\n      logger.error('Some journeys are not ready');\n    }\n  }\n\n  return result.valid ? 0 : 1;\n}\n","/**\n * artk journey implement <ids>\n *\n * Generate Playwright tests for journey(s).\n * Replaces the implementation pseudocode in artk.journey-implement.md\n *\n * With --dry-run, shows what would be done without executing.\n */\n\nimport * as path from 'path';\nimport { Logger } from '../../lib/logger.js';\nimport { WorkflowContext } from '../../lib/workflows/types.js';\nimport {\n  buildImplementPlan,\n  formatImplementPlan,\n  executeImplementation,\n  ImplementOptions,\n  ImplementPlan,\n} from '../../lib/workflows/journey-implement.js';\n\nexport interface ImplementCommandOptions {\n  harnessRoot: string;\n  batchMode?: string;\n  learningMode?: string;\n  dryRun?: boolean;\n  verbose?: boolean;\n}\n\nexport interface ImplementCommandResult {\n  success: boolean;\n  plan?: ImplementPlan;\n  testsGenerated?: string[];\n  error?: string;\n}\n\n/**\n * Run the implement command and return structured result\n * Separated from CLI output for testability\n */\nexport function buildPlan(ids: string, options: ImplementCommandOptions): ImplementCommandResult {\n  const harnessRoot = path.resolve(options.harnessRoot);\n  const projectRoot = process.cwd();\n  const llkbRoot = path.join(harnessRoot, '.artk', 'llkb');\n\n  const ctx: WorkflowContext = {\n    projectRoot,\n    harnessRoot,\n    llkbRoot,\n    dryRun: options.dryRun || false,\n    environment: 'unknown', // Will be detected in buildImplementPlan\n  };\n\n  const implementOptions: ImplementOptions = {\n    journeyIds: ids,\n    batchMode: options.batchMode,\n    learningMode: options.learningMode,\n    dryRun: options.dryRun,\n    verbose: options.verbose,\n  };\n\n  // Build the plan\n  const planResult = buildImplementPlan(ctx, implementOptions);\n\n  if (!planResult.success) {\n    return {\n      success: false,\n      error: planResult.error || 'Unknown error',\n    };\n  }\n\n  return {\n    success: true,\n    plan: planResult.data!,\n  };\n}\n\n/**\n * CLI entry point - handles output formatting and exit codes\n */\nexport async function implementCommand(ids: string, options: ImplementCommandOptions): Promise<number> {\n  const logger = new Logger();\n  const harnessRoot = path.resolve(options.harnessRoot);\n  const projectRoot = process.cwd();\n  const llkbRoot = path.join(harnessRoot, '.artk', 'llkb');\n\n  const ctx: WorkflowContext = {\n    projectRoot,\n    harnessRoot,\n    llkbRoot,\n    dryRun: options.dryRun || false,\n    environment: 'unknown',\n  };\n\n  const implementOptions: ImplementOptions = {\n    journeyIds: ids,\n    batchMode: options.batchMode,\n    learningMode: options.learningMode,\n    dryRun: options.dryRun,\n    verbose: options.verbose,\n  };\n\n  // Build the plan\n  const planResult = buildImplementPlan(ctx, implementOptions);\n\n  if (!planResult.success) {\n    logger.error('Failed to build implementation plan:');\n    logger.error(planResult.error || 'Unknown error');\n    return 1;\n  }\n\n  const plan = planResult.data!;\n\n  // If dry-run, just show the plan\n  if (options.dryRun) {\n    console.log(formatImplementPlan(plan));\n    console.log('\\nThis is a dry run. No changes were made.');\n    console.log('Remove --dry-run to execute the implementation.');\n    return 0;\n  }\n\n  // Execute the implementation\n  logger.header('Journey Implementation');\n  logger.info(`Implementing ${plan.journeys.length} journey(s)...`);\n  logger.info(`Environment: ${plan.environment}`);\n  logger.info(`Batch Mode: ${plan.batchMode}`);\n  logger.info(`Learning Mode: ${plan.learningMode}`);\n  logger.blank();\n\n  // Show warnings\n  for (const warn of plan.warnings) {\n    logger.warning(warn);\n  }\n\n  const result = await executeImplementation(ctx, plan, { verbose: options.verbose });\n\n  if (!result.success) {\n    logger.error('Implementation failed:');\n    logger.error(result.error || 'Unknown error');\n\n    // Show partial results if available\n    if (result.data?.sessionState) {\n      const state = result.data.sessionState;\n      logger.blank();\n      logger.info(`Completed: ${state.journeysCompleted.length}/${state.totalJourneys}`);\n      logger.info(`Failed at: ${state.currentJourneyId || 'unknown'}`);\n    }\n\n    return 1;\n  }\n\n  logger.blank();\n  logger.success('Implementation complete!');\n  logger.info('Tests generated:');\n  for (const test of result.data!.testsGenerated) {\n    logger.info(`  - ${test}`);\n  }\n\n  // Show session summary\n  const state = result.data!.sessionState;\n  logger.blank();\n  logger.info(`Session summary:`);\n  logger.info(`  - LLKB exports: ${state.llkbExportCount}`);\n  logger.info(`  - Duration: ${((state.endTime! - state.startTime) / 1000).toFixed(1)}s`);\n\n  logger.blank();\n  logger.info('Next steps:');\n  logger.info('  1. Run: artk journey validate ' + ids);\n  logger.info('  2. Run: npx playwright test --grep \"' + ids.split(',')[0] + '\"');\n\n  return 0;\n}\n","/**\n * Journey command group\n *\n * CLI commands for journey operations, replacing pseudocode in prompts.\n */\n\nimport { Command } from 'commander';\nimport { validateCommand } from './validate.js';\nimport { implementCommand } from './implement.js';\n\nexport function journeyCommand(program: Command): void {\n  const journey = program\n    .command('journey')\n    .description('Journey operations (validate, implement, etc.)');\n\n  journey\n    .command('validate <id>')\n    .description('Validate a journey is ready for implementation')\n    .option('--harness-root <path>', 'Path to artk-e2e directory', 'artk-e2e')\n    .option('--json', 'Output as JSON')\n    .action(async (id: string, options) => {\n      const exitCode = await validateCommand(id, options);\n      process.exitCode = exitCode;\n    });\n\n  journey\n    .command('implement <ids>')\n    .description('Generate tests for journey(s)')\n    .option('--harness-root <path>', 'Path to artk-e2e directory', 'artk-e2e')\n    .option('--batch-mode <mode>', 'Execution mode: serial or parallel', 'serial')\n    .option('--learning-mode <mode>', 'LLKB learning: strict, batch, or none', 'strict')\n    .option('--dry-run', 'Show what would be done without executing')\n    .option('--verbose', 'Show detailed output')\n    .action(async (ids: string, options) => {\n      const exitCode = await implementCommand(ids, options);\n      process.exitCode = exitCode;\n    });\n\n  journey\n    .command('check-llkb')\n    .description('Check if LLKB is configured and ready')\n    .option('--harness-root <path>', 'Path to artk-e2e directory', 'artk-e2e')\n    .option('--json', 'Output as JSON')\n    .action(async (options) => {\n      const { checkLlkbCommand } = await import('./check-llkb.js');\n      const exitCode = await checkLlkbCommand(options);\n      process.exitCode = exitCode;\n    });\n}\n","/**\n * ARTK CLI - Main entry point\n *\n * Bootstrap Playwright test suites with AI-assisted workflows\n */\n\nimport { program } from 'commander';\nimport { initCommand } from './commands/init.js';\nimport { checkCommand } from './commands/check.js';\nimport { upgradeCommand } from './commands/upgrade.js';\nimport { doctorCommand } from './commands/doctor.js';\nimport { uninstallCommand } from './commands/uninstall.js';\nimport { llkbCommand } from './commands/llkb/index.js';\nimport { journeyCommand } from './commands/journey/index.js';\nimport { getVersion } from './lib/version.js';\n\nconst version = getVersion();\n\nprogram\n  .name('artk')\n  .description('ARTK - Automatic Regression Testing Kit\\n\\nBootstrap Playwright test suites with AI-assisted workflows')\n  .version(version, '-v, --version', 'Output the current version');\n\nprogram\n  .command('init <path>')\n  .description('Initialize ARTK in a project')\n  .option('--skip-npm', 'Skip npm install')\n  .option('--skip-browsers', 'Skip browser installation')\n  .option('-f, --force', 'Overwrite existing installation')\n  .option('--variant <type>', 'Variant: modern-esm, modern-cjs, legacy-16, legacy-14, or auto (default: auto)', 'auto')\n  .option('--no-prompts', 'Skip installing AI prompts')\n  .option('--verbose', 'Show detailed output')\n  .action(async (targetPath: string, options) => {\n    await initCommand(targetPath, options);\n  });\n\nprogram\n  .command('upgrade [path]')\n  .description('Upgrade @artk/core in an existing installation')\n  .option('--check', 'Check for updates without applying')\n  .option('-f, --force', 'Force upgrade even if versions match')\n  .action(async (targetPath: string | undefined, options) => {\n    await upgradeCommand(targetPath || '.', options);\n  });\n\nprogram\n  .command('check')\n  .description('Verify prerequisites (Node.js, npm, browsers)')\n  .option('--fix', 'Attempt to fix issues automatically')\n  .action(async (options) => {\n    await checkCommand(options);\n  });\n\nprogram\n  .command('doctor [path]')\n  .description('Diagnose and fix common issues in an ARTK installation')\n  .option('--fix', 'Attempt to fix issues automatically')\n  .option('--verbose', 'Show detailed diagnostic output')\n  .action(async (targetPath: string | undefined, options) => {\n    await doctorCommand(targetPath || '.', options);\n  });\n\nprogram\n  .command('uninstall <path>')\n  .description('Remove ARTK from a project')\n  .option('--keep-tests', 'Keep test files in artk-e2e/')\n  .option('--keep-prompts', 'Keep AI prompts in .github/prompts/')\n  .option('-f, --force', 'Skip confirmation prompt')\n  .action(async (targetPath: string, options) => {\n    await uninstallCommand(targetPath, options);\n  });\n\n// Register LLKB command group\nllkbCommand(program);\n\n// Register Journey command group\njourneyCommand(program);\n\n// Error handling\nprogram.showHelpAfterError('(add --help for additional information)');\n\n// Parse arguments\nprogram.parse();\n"]}