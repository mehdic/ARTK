{"version":3,"sources":["../../schemas/environment-context.schema.ts","../../schemas/validation-result.schema.ts"],"names":["z"],"mappings":"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","file":"index.js","sourcesContent":["/**\n * Zod Schemas for Environment Context\n *\n * Runtime validation schemas matching the JSON schema at\n * specs/001-foundation-compatibility/contracts/environment-context.schema.json\n *\n * @module @artk/core/schemas\n */\n\nimport { z } from 'zod';\n\n/**\n * Module system schema - either CommonJS or ESM\n */\nexport const ModuleSystemSchema = z.enum(['commonjs', 'esm']);\n\n/**\n * Template source schema - where templates came from\n */\nexport const TemplateSourceSchema = z.enum(['bundled', 'local-override']);\n\n/**\n * Detection confidence schema\n */\nexport const DetectionConfidenceSchema = z.enum(['high', 'medium', 'low']);\n\n/**\n * Detection method schema\n */\nexport const DetectionMethodSchema = z.enum(['package.json', 'tsconfig.json', 'fallback']);\n\n/**\n * Parsed Node.js version schema\n */\nexport const NodeVersionParsedSchema = z.object({\n  /** Major version number (must be >= 18) */\n  major: z.number().int().min(18, 'Node.js version must be >= 18.0.0'),\n  /** Minor version number */\n  minor: z.number().int().min(0),\n  /** Patch version number */\n  patch: z.number().int().min(0),\n});\n\n/**\n * Semver string pattern for Node version\n */\nconst semverPattern = /^\\d+\\.\\d+\\.\\d+$/;\n\n/**\n * Environment Context schema\n *\n * Validates the structure of .artk/context.json\n */\nexport const EnvironmentContextSchema = z.object({\n  /** Detected module system from package.json or tsconfig.json */\n  moduleSystem: ModuleSystemSchema,\n\n  /** Semantic version of Node.js (e.g., \"18.12.1\") */\n  nodeVersion: z.string().regex(semverPattern, 'Invalid semver format'),\n\n  /** Parsed Node.js version components */\n  nodeVersionParsed: NodeVersionParsedSchema,\n\n  /** TypeScript module setting from tsconfig.json, or null if not present */\n  tsModule: z.string().nullable(),\n\n  /** true if Node 18+ and ESM environment */\n  supportsImportMeta: z.boolean(),\n\n  /** true if Node 20.11.0+ (has import.meta.dirname built-in) */\n  supportsBuiltinDirname: z.boolean(),\n\n  /** Which template set was used for generation */\n  templateVariant: ModuleSystemSchema,\n\n  /** Where templates came from */\n  templateSource: TemplateSourceSchema,\n\n  /** ISO 8601 timestamp when detection ran */\n  detectionTimestamp: z.string().datetime({ message: 'Invalid ISO 8601 timestamp' }),\n\n  /** Confidence level based on signal consistency */\n  detectionConfidence: DetectionConfidenceSchema,\n\n  /** Primary method that determined module system */\n  detectionMethod: DetectionMethodSchema,\n\n  /** List of warnings encountered during detection */\n  warnings: z.array(z.string()),\n});\n\n/**\n * Detection options schema\n */\nexport const DetectionOptionsSchema = z.object({\n  /** Project root directory */\n  projectRoot: z.string().min(1, 'Project root is required'),\n\n  /** Force re-detection */\n  forceDetect: z.boolean().optional().default(false),\n\n  /** Timeout in milliseconds */\n  timeout: z.number().int().min(100).max(30000).optional().default(5000),\n});\n\n/**\n * Detection result schema\n */\nexport const DetectionResultSchema = z.object({\n  /** The detected environment context */\n  context: EnvironmentContextSchema,\n\n  /** Whether results were loaded from cache */\n  fromCache: z.boolean(),\n\n  /** Time taken for detection in milliseconds */\n  detectionTime: z.number().int().min(0),\n});\n\n/**\n * Type inference helpers\n */\nexport type ModuleSystemType = z.infer<typeof ModuleSystemSchema>;\nexport type TemplateSourceType = z.infer<typeof TemplateSourceSchema>;\nexport type DetectionConfidenceType = z.infer<typeof DetectionConfidenceSchema>;\nexport type DetectionMethodType = z.infer<typeof DetectionMethodSchema>;\nexport type NodeVersionParsedType = z.infer<typeof NodeVersionParsedSchema>;\nexport type EnvironmentContextType = z.infer<typeof EnvironmentContextSchema>;\nexport type DetectionOptionsType = z.infer<typeof DetectionOptionsSchema>;\nexport type DetectionResultType = z.infer<typeof DetectionResultSchema>;\n\n/**\n * Validates an EnvironmentContext object\n *\n * @param data - Data to validate\n * @returns Validated EnvironmentContext or throws ZodError\n *\n * @example\n * ```typescript\n * import { validateEnvironmentContext } from '@artk/core/schemas';\n *\n * const context = validateEnvironmentContext({\n *   moduleSystem: 'commonjs',\n *   nodeVersion: '18.12.1',\n *   // ... other fields\n * });\n * ```\n */\nexport function validateEnvironmentContext(data: unknown): EnvironmentContextType {\n  return EnvironmentContextSchema.parse(data);\n}\n\n/**\n * Safely validates an EnvironmentContext object\n *\n * @param data - Data to validate\n * @returns Result object with success status and data or error\n */\nexport function safeValidateEnvironmentContext(\n  data: unknown\n): z.SafeParseReturnType<unknown, EnvironmentContextType> {\n  return EnvironmentContextSchema.safeParse(data);\n}\n","/**\n * Zod Schemas for Validation Result\n *\n * Runtime validation schemas matching the JSON schema at\n * specs/001-foundation-compatibility/contracts/validation-result.schema.json\n *\n * @module @artk/core/schemas\n */\n\nimport { z } from 'zod';\n\n/**\n * Validation severity schema\n */\nexport const ValidationSeveritySchema = z.enum(['error', 'warning']);\n\n/**\n * Validation status schema\n */\nexport const ValidationStatusSchema = z.enum(['passed', 'failed', 'warnings']);\n\n/**\n * Strictness level schema\n */\nexport const StrictnessLevelSchema = z.enum(['error', 'warning', 'ignore']);\n\n/**\n * Known validation rule IDs\n */\nexport const ValidationRuleIdSchema = z.enum([\n  'import-meta-usage',\n  'dirname-usage',\n  'import-paths',\n  'dependency-compat',\n  'typescript-compat',\n]);\n\n/**\n * Validation issue schema\n */\nexport const ValidationIssueSchema = z.object({\n  /** Absolute path to file with issue */\n  file: z.string(),\n\n  /** Line number (null if not applicable) */\n  line: z.number().int().min(1).nullable(),\n\n  /** Column number (null if not available) */\n  column: z.number().int().min(1).nullable(),\n\n  /** Issue severity level */\n  severity: ValidationSeveritySchema,\n\n  /** Rule that detected this issue */\n  ruleId: z.string(),\n\n  /** Human-readable description of the issue */\n  message: z.string(),\n\n  /** Suggestion for how to fix the issue */\n  suggestedFix: z.string().nullable(),\n});\n\n/**\n * Validation rule result schema\n */\nexport const ValidationRuleResultSchema = z.object({\n  /** Unique identifier for the rule */\n  ruleId: z.string(),\n\n  /** true if rule passed */\n  pass: z.boolean(),\n\n  /** Files with violations */\n  affectedFiles: z.array(z.string()),\n\n  /** Human-readable summary */\n  message: z.string(),\n});\n\n/**\n * Validation result schema\n *\n * Validates the structure of .artk/validation-results.json entries\n */\nexport const ValidationResultSchema = z.object({\n  /** ISO 8601 timestamp when validation ran */\n  timestamp: z.string().datetime({ message: 'Invalid ISO 8601 timestamp' }),\n\n  /** Hash or reference to EnvironmentContext used */\n  environmentContext: z.string(),\n\n  /** Milliseconds taken to validate (max 10 seconds per FR-029) */\n  executionTime: z.number().int().min(0).max(10000),\n\n  /** Overall validation status */\n  status: ValidationStatusSchema,\n\n  /** Individual rule execution results */\n  rules: z.array(ValidationRuleResultSchema),\n\n  /** Critical issues that must be fixed */\n  errors: z.array(ValidationIssueSchema),\n\n  /** Non-critical issues for developer awareness */\n  warnings: z.array(ValidationIssueSchema),\n\n  /** List of file paths that were validated */\n  validatedFiles: z.array(z.string()),\n\n  /** true if automatic rollback was triggered */\n  rollbackPerformed: z.boolean(),\n\n  /** null if no rollback, true if successful, false if failed */\n  rollbackSuccess: z.boolean().nullable(),\n});\n\n/**\n * Validation options schema\n */\nexport const ValidationOptionsSchema = z.object({\n  /** Files to validate */\n  files: z.array(z.string()).min(1, 'At least one file is required'),\n\n  /** Environment context for validation rules */\n  environmentContext: z.string(),\n\n  /** Skip validation entirely */\n  skipValidation: z.boolean().optional().default(false),\n\n  /** Validation timeout in milliseconds */\n  timeout: z.number().int().min(100).max(60000).optional().default(10000),\n\n  /** Strictness levels for each rule type */\n  strictness: z\n    .record(ValidationRuleIdSchema, StrictnessLevelSchema)\n    .optional()\n    .default({}),\n});\n\n/**\n * Validation rule config schema\n */\nexport const ValidationRuleConfigSchema = z.object({\n  /** Unique identifier for the rule */\n  id: z.string(),\n\n  /** Human-readable name */\n  name: z.string(),\n\n  /** Description of what the rule checks */\n  description: z.string(),\n\n  /** Default strictness level */\n  defaultStrictness: StrictnessLevelSchema,\n});\n\n/**\n * Rollback result schema\n */\nexport const RollbackResultSchema = z.object({\n  /** Whether rollback was successful */\n  success: z.boolean(),\n\n  /** Files that were removed during rollback */\n  removedFiles: z.array(z.string()),\n\n  /** Files that were restored from backup */\n  restoredFiles: z.array(z.string()),\n\n  /** Files that failed to be rolled back */\n  failedFiles: z.array(\n    z.object({\n      file: z.string(),\n      error: z.string(),\n    })\n  ),\n});\n\n/**\n * Type inference helpers\n */\nexport type ValidationSeverityType = z.infer<typeof ValidationSeveritySchema>;\nexport type ValidationStatusType = z.infer<typeof ValidationStatusSchema>;\nexport type StrictnessLevelType = z.infer<typeof StrictnessLevelSchema>;\nexport type ValidationRuleIdType = z.infer<typeof ValidationRuleIdSchema>;\nexport type ValidationIssueType = z.infer<typeof ValidationIssueSchema>;\nexport type ValidationRuleResultType = z.infer<typeof ValidationRuleResultSchema>;\nexport type ValidationResultType = z.infer<typeof ValidationResultSchema>;\nexport type ValidationOptionsType = z.infer<typeof ValidationOptionsSchema>;\nexport type ValidationRuleConfigType = z.infer<typeof ValidationRuleConfigSchema>;\nexport type RollbackResultType = z.infer<typeof RollbackResultSchema>;\n\n/**\n * Validates a ValidationResult object\n *\n * @param data - Data to validate\n * @returns Validated ValidationResult or throws ZodError\n *\n * @example\n * ```typescript\n * import { validateValidationResult } from '@artk/core/schemas';\n *\n * const result = validateValidationResult({\n *   timestamp: '2026-01-13T15:35:00.000Z',\n *   status: 'passed',\n *   // ... other fields\n * });\n * ```\n */\nexport function validateValidationResult(data: unknown): ValidationResultType {\n  return ValidationResultSchema.parse(data);\n}\n\n/**\n * Safely validates a ValidationResult object\n *\n * @param data - Data to validate\n * @returns Result object with success status and data or error\n */\nexport function safeValidateValidationResult(\n  data: unknown\n): z.SafeParseReturnType<unknown, ValidationResultType> {\n  return ValidationResultSchema.safeParse(data);\n}\n\n/**\n * Validates a ValidationIssue object\n *\n * @param data - Data to validate\n * @returns Validated ValidationIssue or throws ZodError\n */\nexport function validateValidationIssue(data: unknown): ValidationIssueType {\n  return ValidationIssueSchema.parse(data);\n}\n\n/**\n * Validates a RollbackResult object\n *\n * @param data - Data to validate\n * @returns Validated RollbackResult or throws ZodError\n */\nexport function validateRollbackResult(data: unknown): RollbackResultType {\n  return RollbackResultSchema.parse(data);\n}\n"]}