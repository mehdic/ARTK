# Variant Utilities

**AUTO-SYNCED FROM:** `cli/src/utils/variant-*.ts`

## Sync Mechanism

This directory contains variant detection and selection utilities that are **automatically synced** from the development source of truth in `cli/src/utils/`.

### How It Works

1. **Source of Truth:** All variant-related files are authored and maintained in `cli/src/utils/`
2. **Sync Script:** `scripts/sync-cli-variants.sh` copies files to `packages/cli/src/lib/variants/`
3. **Auto-Sync:** Git pre-commit hook automatically runs sync before each commit
4. **Exports:** `index.ts` provides a barrel export of all variant utilities

### Files Synced

- `variant-types.ts` - TypeScript type definitions and guards
- `variant-definitions.ts` - Variant metadata and configuration
- `variant-detector.ts` - Environment detection and variant selection
- `variant-files.ts` - File path resolution for variant-specific builds
- `variant-schemas.ts` - Zod schemas for validation
- `index.ts` - Barrel export (generated by sync script)

### DO NOT EDIT

**‚ùå DO NOT edit files in this directory directly!**

All changes must be made in `cli/src/utils/variant-*.ts` and will be automatically synced on the next commit.

### Manual Sync

If you need to sync manually (not required in normal workflow):

```bash
./scripts/sync-cli-variants.sh
```

### Testing

Tests are located in `__tests__/` and are **manually copied** (not auto-synced):

```bash
# Run variant tests
npm test src/lib/variants/__tests__/
```

## Architecture

### Why Two CLIs?

**`cli/`** - Development source of truth
- Where all CLI code is authored
- Contains variant utilities used by both CLIs
- More flexible structure for development

**`packages/cli/`** - NPM-publishable package
- Auto-synced from `cli/`
- Follows strict NPM package conventions
- Published to NPM as `@artk/cli`

### Variant System

The variant system supports multiple build targets:

| Variant | Node.js | Module | Playwright | ES Target |
|---------|---------|--------|------------|-----------|
| `modern-esm` | 18+ | ESM | 1.57.x | ES2022 |
| `modern-cjs` | 18+ | CJS | 1.57.x | ES2022 |
| `legacy-16` | 16+ | CJS | 1.49.x | ES2021 |
| `legacy-14` | 14+ | CJS | 1.33.x | ES2020 |

### Auto-Detection

When `--variant auto` is used (or variant not specified), the CLI:

1. Detects Node.js version
2. Checks `package.json` for `"type": "module"`
3. Selects appropriate variant based on compatibility
4. Validates against existing installation (if any)

See `variant-detector.ts` for full detection logic.
