{"version":3,"sources":["../../validation/rules/import-meta-usage.ts","../../validation/rules/dirname-usage.ts","../../validation/rules/import-paths.ts","../../validation/rules/dependency-compat.ts","../../validation/rules/index.ts","../../validation/rollback.ts","../../validation/runner.ts"],"names":["config","isInCommentOrString","getLineNumber","parts","path","fs","os","path2","fs2","fs3","path3"],"mappings":"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","file":"index.cjs","sourcesContent":["/**\n * Import Meta Usage Validation Rule\n * T053: Implement import-meta-usage rule (FR-022)\n *\n * Detects usage of import.meta in CommonJS environments where it would cause runtime errors.\n *\n * @module @artk/core/validation/rules/import-meta-usage\n */\n\nimport type {\n  ValidationRule,\n  ValidationRuleConfig,\n  ValidationIssue,\n} from '../types.js';\n\n/**\n * Regex patterns to detect import.meta usage\n */\nconst IMPORT_META_PATTERNS = [\n  /import\\.meta\\.url/g,\n  /import\\.meta\\.dirname/g,\n  /import\\.meta\\.filename/g,\n  /import\\.meta\\.resolve/g,\n  /import\\.meta(?!\\.)/g, // Just import.meta without property\n];\n\n/**\n * Rule configuration\n */\nconst config: ValidationRuleConfig = {\n  id: 'import-meta-usage',\n  name: 'Import Meta Usage',\n  description:\n    'Detects usage of import.meta in CommonJS environments where it is not available',\n  defaultStrictness: 'error',\n};\n\n/**\n * Check if a position is inside a comment or string literal\n */\nfunction isInCommentOrString(content: string, position: number): boolean {\n  const before = content.substring(0, position);\n\n  // Check if in single-line comment\n  const lastNewline = before.lastIndexOf('\\n');\n  const lineStart = lastNewline === -1 ? 0 : lastNewline + 1;\n  const lineBefore = before.substring(lineStart);\n  if (lineBefore.includes('//')) {\n    return true;\n  }\n\n  // Check if in block comment\n  const lastBlockStart = before.lastIndexOf('/*');\n  const lastBlockEnd = before.lastIndexOf('*/');\n  if (lastBlockStart > lastBlockEnd) {\n    return true;\n  }\n\n  // Check if in string literal (simple heuristic)\n  let inString = false;\n  let stringChar = '';\n  let escaped = false;\n\n  for (let i = 0; i < position; i++) {\n    const char = content[i];\n\n    if (escaped) {\n      escaped = false;\n      continue;\n    }\n\n    if (char === '\\\\') {\n      escaped = true;\n      continue;\n    }\n\n    if (char === '\"' || char === \"'\" || char === '`') {\n      if (!inString) {\n        inString = true;\n        stringChar = char;\n      } else if (char === stringChar) {\n        inString = false;\n        stringChar = '';\n      }\n    }\n  }\n\n  return inString;\n}\n\n/**\n * Get line number for a position in content\n */\nfunction getLineNumber(content: string, position: number): number {\n  const before = content.substring(0, position);\n  return before.split('\\n').length;\n}\n\n/**\n * Import Meta Usage Rule\n *\n * Detects import.meta usage in CommonJS environments\n */\nexport class ImportMetaUsageRule implements ValidationRule {\n  config = config;\n\n  /**\n   * Validate a file for import.meta usage\n   */\n  validate(\n    filePath: string,\n    content: string,\n    moduleSystem: 'commonjs' | 'esm'\n  ): ValidationIssue[] {\n    // import.meta is valid in ESM\n    if (moduleSystem === 'esm') {\n      return [];\n    }\n\n    const issues: ValidationIssue[] = [];\n    const processedPositions = new Set<number>();\n\n    for (const pattern of IMPORT_META_PATTERNS) {\n      // Reset lastIndex for global patterns\n      pattern.lastIndex = 0;\n\n      let match;\n      while ((match = pattern.exec(content)) !== null) {\n        const position = match.index;\n\n        // Skip if we've already processed this position\n        if (processedPositions.has(position)) {\n          continue;\n        }\n        processedPositions.add(position);\n\n        // Skip if in comment or string literal\n        if (isInCommentOrString(content, position)) {\n          continue;\n        }\n\n        const lineNumber = getLineNumber(content, position);\n        const matchedText = match[0];\n\n        issues.push({\n          file: filePath,\n          line: lineNumber,\n          column: null,\n          severity: 'error',\n          ruleId: this.config.id,\n          message: `import.meta is not available in CommonJS modules. Found: ${matchedText}`,\n          suggestedFix:\n            \"Use getDirname() from '@artk/core/compat' instead of import.meta.url, or switch to ESM by adding \\\"type\\\": \\\"module\\\" to package.json\",\n        });\n      }\n    }\n\n    return issues;\n  }\n}\n\n/**\n * Create a new ImportMetaUsageRule instance\n */\nexport function createImportMetaUsageRule(): ImportMetaUsageRule {\n  return new ImportMetaUsageRule();\n}\n","/**\n * Dirname Usage Validation Rule\n * T054: Implement dirname-usage rule (FR-022)\n *\n * Detects usage of __dirname and __filename in ESM environments where they are not available.\n *\n * @module @artk/core/validation/rules/dirname-usage\n */\n\nimport type {\n  ValidationRule,\n  ValidationRuleConfig,\n  ValidationIssue,\n} from '../types.js';\n\n/**\n * Rule configuration\n */\nconst config: ValidationRuleConfig = {\n  id: 'dirname-usage',\n  name: 'Dirname Usage',\n  description:\n    'Detects usage of __dirname and __filename in ESM environments where they are not available',\n  defaultStrictness: 'error',\n};\n\n/**\n * Check if a position is inside a comment or string literal\n */\nfunction isInCommentOrString(content: string, position: number): boolean {\n  const before = content.substring(0, position);\n\n  // Check if in single-line comment\n  const lastNewline = before.lastIndexOf('\\n');\n  const lineStart = lastNewline === -1 ? 0 : lastNewline + 1;\n  const lineBefore = before.substring(lineStart);\n  if (lineBefore.includes('//')) {\n    return true;\n  }\n\n  // Check if in block comment\n  const lastBlockStart = before.lastIndexOf('/*');\n  const lastBlockEnd = before.lastIndexOf('*/');\n  if (lastBlockStart > lastBlockEnd) {\n    return true;\n  }\n\n  // Check if in string literal (simple heuristic)\n  let inString = false;\n  let stringChar = '';\n  let escaped = false;\n\n  for (let i = 0; i < position; i++) {\n    const char = content[i];\n\n    if (escaped) {\n      escaped = false;\n      continue;\n    }\n\n    if (char === '\\\\') {\n      escaped = true;\n      continue;\n    }\n\n    if (char === '\"' || char === \"'\" || char === '`') {\n      if (!inString) {\n        inString = true;\n        stringChar = char;\n      } else if (char === stringChar) {\n        inString = false;\n        stringChar = '';\n      }\n    }\n  }\n\n  return inString;\n}\n\n/**\n * Check if a match is a standalone global variable reference\n * (not part of a variable declaration like \"const __dirname = ...\")\n */\nfunction isGlobalReference(\n  content: string,\n  match: RegExpExecArray,\n  varName: string\n): boolean {\n  const position = match.index;\n\n  // Get the line containing this match\n  const lineStart = content.lastIndexOf('\\n', position - 1) + 1;\n  const lineEnd = content.indexOf('\\n', position);\n  const line = content.substring(\n    lineStart,\n    lineEnd === -1 ? content.length : lineEnd\n  );\n\n  // Check if this is a declaration (const __dirname = ..., let __dirname = ..., var __dirname = ...)\n  const declarationPattern = new RegExp(\n    `(?:const|let|var)\\\\s+${varName}\\\\s*=`\n  );\n  if (declarationPattern.test(line)) {\n    return false;\n  }\n\n  // Check if this is part of a longer variable name\n  const beforeChar = position > 0 ? (content[position - 1] ?? ' ') : ' ';\n  const afterChar = content[position + varName.length] ?? ' ';\n\n  // Valid identifier chars\n  const identifierChar = /[a-zA-Z0-9_$]/;\n\n  if (identifierChar.test(beforeChar as string) || identifierChar.test(afterChar as string)) {\n    return false;\n  }\n\n  return true;\n}\n\n/**\n * Get line number for a position in content\n */\nfunction getLineNumber(content: string, position: number): number {\n  const before = content.substring(0, position);\n  return before.split('\\n').length;\n}\n\n/**\n * Dirname Usage Rule\n *\n * Detects __dirname and __filename usage in ESM environments\n */\nexport class DirnameUsageRule implements ValidationRule {\n  config = config;\n\n  /**\n   * Validate a file for __dirname/__filename usage\n   */\n  validate(\n    filePath: string,\n    content: string,\n    moduleSystem: 'commonjs' | 'esm'\n  ): ValidationIssue[] {\n    // __dirname and __filename are valid in CommonJS\n    if (moduleSystem === 'commonjs') {\n      return [];\n    }\n\n    const issues: ValidationIssue[] = [];\n\n    // Patterns for __dirname and __filename as standalone identifiers\n    const patterns: Array<{ regex: RegExp; name: string }> = [\n      { regex: /__dirname/g, name: '__dirname' },\n      { regex: /__filename/g, name: '__filename' },\n    ];\n\n    for (const { regex, name } of patterns) {\n      regex.lastIndex = 0;\n\n      let match;\n      while ((match = regex.exec(content)) !== null) {\n        const position = match.index;\n\n        // Skip if in comment or string literal\n        if (isInCommentOrString(content, position)) {\n          continue;\n        }\n\n        // Skip if not a global reference (e.g., variable declaration)\n        if (!isGlobalReference(content, match, name)) {\n          continue;\n        }\n\n        const lineNumber = getLineNumber(content, position);\n\n        issues.push({\n          file: filePath,\n          line: lineNumber,\n          column: null,\n          severity: 'error',\n          ruleId: this.config.id,\n          message: `${name} is not available in ESM modules`,\n          suggestedFix: `Use getDirname(import.meta.url) from '@artk/core/compat' instead of ${name}`,\n        });\n      }\n    }\n\n    return issues;\n  }\n}\n\n/**\n * Create a new DirnameUsageRule instance\n */\nexport function createDirnameUsageRule(): DirnameUsageRule {\n  return new DirnameUsageRule();\n}\n","/**\n * Import Paths Validation Rule\n * T055: Implement import-paths rule (FR-023)\n *\n * Validates import paths have correct extensions for the module system.\n * ESM requires explicit .js extensions for relative imports.\n *\n * @module @artk/core/validation/rules/import-paths\n */\n\nimport type {\n  ValidationRule,\n  ValidationRuleConfig,\n  ValidationIssue,\n} from '../types.js';\n\n/**\n * Rule configuration\n */\nconst config: ValidationRuleConfig = {\n  id: 'import-paths',\n  name: 'Import Paths',\n  description:\n    'Validates import paths have correct extensions for the module system',\n  defaultStrictness: 'warning',\n};\n\n/**\n * Check if an import path is a relative import\n */\nfunction isRelativeImport(importPath: string): boolean {\n  return importPath.startsWith('./') || importPath.startsWith('../');\n}\n\n/**\n * Check if an import path has a file extension\n */\nfunction hasExtension(importPath: string): boolean {\n  const parts = importPath.split('/');\n  const lastPart = parts[parts.length - 1] ?? '';\n  return lastPart.includes('.');\n}\n\n/**\n * Check if a position is inside a comment or string literal\n */\nfunction isInCommentOrString(content: string, position: number): boolean {\n  const before = content.substring(0, position);\n\n  // Check if in single-line comment\n  const lastNewline = before.lastIndexOf('\\n');\n  const lineStart = lastNewline === -1 ? 0 : lastNewline + 1;\n  const lineBefore = before.substring(lineStart);\n\n  // Simple heuristic: if we see a // before any string starts on this line\n  const commentIndex = lineBefore.indexOf('//');\n  if (commentIndex !== -1) {\n    // Make sure the // is not inside a string\n    const quotesBefore = lineBefore.substring(0, commentIndex);\n    const singleQuotes = (quotesBefore.match(/'/g) || []).length;\n    const doubleQuotes = (quotesBefore.match(/\"/g) || []).length;\n    const backticks = (quotesBefore.match(/`/g) || []).length;\n\n    // If odd number of quotes, the // might be in a string, otherwise comment\n    if (singleQuotes % 2 === 0 && doubleQuotes % 2 === 0 && backticks % 2 === 0) {\n      return true;\n    }\n  }\n\n  // Check if in block comment\n  const lastBlockStart = before.lastIndexOf('/*');\n  const lastBlockEnd = before.lastIndexOf('*/');\n  if (lastBlockStart > lastBlockEnd) {\n    return true;\n  }\n\n  // Check if inside a string literal\n  // This is a simple check: count unescaped quotes before position\n  let inString = false;\n  let stringChar = '';\n  let escaped = false;\n\n  for (let i = 0; i < position; i++) {\n    const char = content[i];\n\n    if (escaped) {\n      escaped = false;\n      continue;\n    }\n\n    if (char === '\\\\') {\n      escaped = true;\n      continue;\n    }\n\n    if (char === '\"' || char === \"'\" || char === '`') {\n      if (!inString) {\n        inString = true;\n        stringChar = char;\n      } else if (char === stringChar) {\n        inString = false;\n        stringChar = '';\n      }\n    }\n  }\n\n  return inString;\n}\n\n/**\n * Get line number for a position in content\n */\nfunction getLineNumber(content: string, position: number): number {\n  const before = content.substring(0, position);\n  return before.split('\\n').length;\n}\n\n/**\n * Extract import paths from content using regex\n */\nfunction extractImportPaths(\n  content: string\n): Array<{ path: string; position: number; isTypeOnly: boolean }> {\n  const imports: Array<{\n    path: string;\n    position: number;\n    isTypeOnly: boolean;\n  }> = [];\n\n  // Match various import patterns\n  const patterns = [\n    // import ... from 'path'\n    /import\\s+(?:type\\s+)?(?:[^'\"]*\\s+from\\s+)?['\"]([^'\"]+)['\"]/g,\n    // export ... from 'path'\n    /export\\s+(?:\\*|\\{[^}]*\\})\\s+from\\s+['\"]([^'\"]+)['\"]/g,\n    // await import('path') or import('path')\n    /(?:await\\s+)?import\\s*\\(\\s*['\"]([^'\"]+)['\"]\\s*\\)/g,\n  ];\n\n  for (const pattern of patterns) {\n    pattern.lastIndex = 0;\n    let match;\n\n    while ((match = pattern.exec(content)) !== null) {\n      const position = match.index;\n\n      // Skip if in comment or string literal\n      if (isInCommentOrString(content, position)) {\n        continue;\n      }\n\n      // Check if this is a type-only import\n      const isTypeOnly = match[0].includes('import type');\n      const importPath = match[1];\n\n      // Skip if no import path captured\n      if (!importPath) {\n        continue;\n      }\n\n      imports.push({\n        path: importPath,\n        position,\n        isTypeOnly,\n      });\n    }\n  }\n\n  return imports;\n}\n\n/**\n * Import Paths Rule\n *\n * Validates import paths have correct extensions for the module system\n */\nexport class ImportPathsRule implements ValidationRule {\n  config = config;\n\n  /**\n   * Validate a file for import path issues\n   */\n  validate(\n    filePath: string,\n    content: string,\n    moduleSystem: 'commonjs' | 'esm'\n  ): ValidationIssue[] {\n    // CommonJS doesn't require extensions\n    if (moduleSystem === 'commonjs') {\n      return [];\n    }\n\n    const issues: ValidationIssue[] = [];\n    const imports = extractImportPaths(content);\n\n    for (const { path: importPath, position, isTypeOnly } of imports) {\n      // Only check relative imports\n      if (!isRelativeImport(importPath)) {\n        continue;\n      }\n\n      // Check if missing extension\n      if (!hasExtension(importPath)) {\n        const lineNumber = getLineNumber(content, position);\n\n        // Type-only imports are stripped at compile time, so lower severity\n        const severity = isTypeOnly ? 'warning' : 'warning';\n\n        issues.push({\n          file: filePath,\n          line: lineNumber,\n          column: null,\n          severity,\n          ruleId: this.config.id,\n          message: `ESM imports require explicit file extensions. Missing extension in: '${importPath}'`,\n          suggestedFix: `Add .js extension: '${importPath}.js' (ESM requires explicit extensions for relative imports)`,\n        });\n      }\n    }\n\n    return issues;\n  }\n}\n\n/**\n * Create a new ImportPathsRule instance\n */\nexport function createImportPathsRule(): ImportPathsRule {\n  return new ImportPathsRule();\n}\n","/**\n * Dependency Compatibility Validation Rule\n * T056: Implement dependency-compat rule (FR-024, FR-025)\n *\n * Checks that project dependencies are compatible with the detected module system.\n * Detects ESM-only packages (like nanoid v5+) in CommonJS environments.\n *\n * @module @artk/core/validation/rules/dependency-compat\n */\n\nimport * as fs from 'fs';\nimport * as path from 'path';\nimport type {\n  ValidationRule,\n  ValidationRuleConfig,\n  ValidationIssue,\n} from '../types.js';\n\n/**\n * Rule configuration\n */\nconst config: ValidationRuleConfig = {\n  id: 'dependency-compat',\n  name: 'Dependency Compatibility',\n  description:\n    'Checks that project dependencies are compatible with the detected module system',\n  defaultStrictness: 'warning',\n};\n\n/**\n * Known ESM-only packages and their version constraints\n */\nconst ESM_ONLY_PACKAGES: Record<string, string> = {\n  nanoid: '>=5.0.0', // v5+ is ESM-only\n  chalk: '>=5.0.0', // v5+ is ESM-only\n  execa: '>=6.0.0', // v6+ is ESM-only\n  got: '>=12.0.0', // v12+ is ESM-only\n  'p-limit': '>=4.0.0', // v4+ is ESM-only\n  'p-queue': '>=7.0.0', // v7+ is ESM-only\n  'globby': '>=13.0.0', // v13+ is ESM-only\n  'find-up': '>=6.0.0', // v6+ is ESM-only\n  'pkg-dir': '>=6.0.0', // v6+ is ESM-only\n  'read-pkg': '>=7.0.0', // v7+ is ESM-only\n  'read-pkg-up': '>=9.0.0', // v9+ is ESM-only\n  'ora': '>=6.0.0', // v6+ is ESM-only\n  'cli-spinners': '>=3.0.0', // v3+ is ESM-only\n  'log-symbols': '>=5.0.0', // v5+ is ESM-only\n  'figures': '>=5.0.0', // v5+ is ESM-only\n  'boxen': '>=6.0.0', // v6+ is ESM-only\n  'wrap-ansi': '>=8.0.0', // v8+ is ESM-only\n  'string-width': '>=5.0.0', // v5+ is ESM-only\n  'strip-ansi': '>=7.0.0', // v7+ is ESM-only\n};\n\n/**\n * Suggested alternatives or compatible versions\n */\nconst ALTERNATIVES: Record<string, string> = {\n  nanoid: \"Use nanoid@^4.0.0 for CommonJS or 'uuid' package as alternative\",\n  chalk: \"Use chalk@^4.0.0 for CommonJS or 'kleur' as alternative\",\n  execa: \"Use execa@^5.0.0 for CommonJS or 'cross-spawn' as alternative\",\n  got: \"Use got@^11.0.0 for CommonJS or 'node-fetch' as alternative\",\n  'p-limit': 'Use p-limit@^3.0.0 for CommonJS',\n};\n\n/**\n * Parse a semver range and check if a version satisfies it\n */\nfunction versionSatisfiesRange(version: string, range: string): boolean {\n  // Simple parser for common semver patterns\n  const versionMatch = version.match(/\\^?~?(\\d+)\\.(\\d+)\\.(\\d+)/);\n  const rangeMatch = range.match(/>?=?(\\d+)\\.(\\d+)\\.(\\d+)/);\n\n  if (!versionMatch || !rangeMatch) {\n    return false;\n  }\n\n  const vMajor = Number(versionMatch[1] ?? 0);\n  const vMinor = Number(versionMatch[2] ?? 0);\n  const vPatch = Number(versionMatch[3] ?? 0);\n  const rMajor = Number(rangeMatch[1] ?? 0);\n  const rMinor = Number(rangeMatch[2] ?? 0);\n  const rPatch = Number(rangeMatch[3] ?? 0);\n\n  // For >= range (most common case)\n  if (range.startsWith('>=')) {\n    if (vMajor! > rMajor!) return true;\n    if (vMajor! < rMajor!) return false;\n    if (vMinor! > rMinor!) return true;\n    if (vMinor! < rMinor!) return false;\n    return vPatch! >= rPatch!;\n  }\n\n  // For ^ range (semver compatible)\n  if (version.startsWith('^')) {\n    return vMajor! >= rMajor!;\n  }\n\n  return vMajor! >= rMajor!;\n}\n\n/**\n * Extract package name from import statement\n */\nfunction extractPackageName(importPath: string): string | null {\n  // Skip relative imports\n  if (importPath.startsWith('./') || importPath.startsWith('../')) {\n    return null;\n  }\n\n  // Skip node: protocol\n  if (importPath.startsWith('node:')) {\n    return null;\n  }\n\n  // Handle scoped packages (@scope/package)\n  if (importPath.startsWith('@')) {\n    const parts = importPath.split('/');\n    if (parts.length >= 2 && parts[0] && parts[1]) {\n      return `${parts[0]}/${parts[1]}`;\n    }\n    return null;\n  }\n\n  // Regular packages\n  const parts = importPath.split('/');\n  return parts[0] ?? null;\n}\n\n/**\n * Dependency Compatibility Rule\n *\n * Detects ESM-only packages in CommonJS environments\n */\nexport class DependencyCompatRule implements ValidationRule {\n  config = config;\n\n  /**\n   * Get list of known ESM-only packages\n   */\n  getEsmOnlyPackages(): string[] {\n    return Object.keys(ESM_ONLY_PACKAGES);\n  }\n\n  /**\n   * Get version constraints for ESM-only packages\n   */\n  getEsmOnlyConstraints(): Record<string, string> {\n    return { ...ESM_ONLY_PACKAGES };\n  }\n\n  /**\n   * Validate a file for ESM-only package imports\n   */\n  validate(\n    filePath: string,\n    content: string,\n    moduleSystem: 'commonjs' | 'esm'\n  ): ValidationIssue[] {\n    // ESM-only packages are fine in ESM environments\n    if (moduleSystem === 'esm') {\n      return [];\n    }\n\n    const issues: ValidationIssue[] = [];\n    const importedPackages = new Set<string>();\n\n    // Extract import/require statements\n    const patterns = [\n      /import\\s+(?:[^'\"]*\\s+from\\s+)?['\"]([^'\"]+)['\"]/g,\n      /require\\s*\\(\\s*['\"]([^'\"]+)['\"]\\s*\\)/g,\n      /(?:await\\s+)?import\\s*\\(\\s*['\"]([^'\"]+)['\"]\\s*\\)/g,\n    ];\n\n    for (const pattern of patterns) {\n      pattern.lastIndex = 0;\n      let match;\n\n      while ((match = pattern.exec(content)) !== null) {\n        const importPath = match[1];\n        if (!importPath) continue;\n\n        const packageName = extractPackageName(importPath);\n\n        if (packageName && ESM_ONLY_PACKAGES[packageName]) {\n          // Skip if we've already reported this package\n          if (importedPackages.has(packageName)) {\n            continue;\n          }\n          importedPackages.add(packageName);\n\n          const lineNumber = this.getLineNumber(content, match.index);\n\n          issues.push({\n            file: filePath,\n            line: lineNumber,\n            column: null,\n            severity: 'warning',\n            ruleId: this.config.id,\n            message: `'${packageName}' is ESM-only in newer versions and may not work in CommonJS`,\n            suggestedFix:\n              ALTERNATIVES[packageName] ||\n              `Check if your version of '${packageName}' is CommonJS-compatible`,\n          });\n        }\n      }\n    }\n\n    return issues;\n  }\n\n  /**\n   * Validate dependencies in package.json\n   */\n  validateDependencies(\n    projectDir: string,\n    moduleSystem: 'commonjs' | 'esm'\n  ): ValidationIssue[] {\n    // ESM-only packages are fine in ESM environments\n    if (moduleSystem === 'esm') {\n      return [];\n    }\n\n    const packageJsonPath = path.join(projectDir, 'package.json');\n\n    if (!fs.existsSync(packageJsonPath)) {\n      return [];\n    }\n\n    let packageJson: Record<string, unknown>;\n    try {\n      const content = fs.readFileSync(packageJsonPath, 'utf8');\n      packageJson = JSON.parse(content);\n    } catch {\n      return [];\n    }\n\n    const issues: ValidationIssue[] = [];\n    const allDeps = {\n      ...(packageJson.dependencies as Record<string, string> || {}),\n      ...(packageJson.devDependencies as Record<string, string> || {}),\n    };\n\n    for (const [packageName, versionRange] of Object.entries(allDeps)) {\n      const esmOnlyRange = ESM_ONLY_PACKAGES[packageName];\n\n      if (esmOnlyRange && versionSatisfiesRange(versionRange, esmOnlyRange)) {\n        issues.push({\n          file: packageJsonPath,\n          line: null,\n          column: null,\n          severity: 'warning',\n          ruleId: this.config.id,\n          message: `'${packageName}@${versionRange}' is ESM-only and incompatible with CommonJS`,\n          suggestedFix:\n            ALTERNATIVES[packageName] ||\n            `Downgrade '${packageName}' to a CommonJS-compatible version`,\n        });\n      }\n    }\n\n    return issues;\n  }\n\n  /**\n   * Get line number for a position in content\n   */\n  private getLineNumber(content: string, position: number): number {\n    const before = content.substring(0, position);\n    return before.split('\\n').length;\n  }\n}\n\n/**\n * Create a new DependencyCompatRule instance\n */\nexport function createDependencyCompatRule(): DependencyCompatRule {\n  return new DependencyCompatRule();\n}\n","/**\n * Validation Rules Index\n *\n * Exports all validation rules for the foundation validation gate.\n *\n * @module @artk/core/validation/rules\n */\n\nimport { ImportMetaUsageRule, createImportMetaUsageRule } from './import-meta-usage.js';\nimport { DirnameUsageRule, createDirnameUsageRule } from './dirname-usage.js';\nimport { ImportPathsRule, createImportPathsRule } from './import-paths.js';\nimport { DependencyCompatRule, createDependencyCompatRule } from './dependency-compat.js';\n\n// Re-export everything\nexport {\n  ImportMetaUsageRule,\n  createImportMetaUsageRule,\n};\n\nexport { DirnameUsageRule, createDirnameUsageRule };\n\nexport { ImportPathsRule, createImportPathsRule };\n\nexport {\n  DependencyCompatRule,\n  createDependencyCompatRule,\n};\n\n/**\n * Get all built-in validation rules\n */\nexport function getAllRules() {\n  return [\n    createImportMetaUsageRule(),\n    createDirnameUsageRule(),\n    createImportPathsRule(),\n    createDependencyCompatRule(),\n  ];\n}\n","/**\n * Rollback Transaction Logic\n * T060: Implement rollback transaction logic (FR-033)\n *\n * Provides write-to-temp-then-rename pattern and rollback functionality\n * for atomic file generation with automatic cleanup on validation failure.\n *\n * @module @artk/core/validation/rollback\n */\n\nimport * as fs from 'fs';\nimport * as path from 'path';\nimport * as os from 'os';\nimport type {\n  GenerationTransaction,\n  RollbackResult,\n} from '../types/validation-result.js';\n\n/**\n * Create a backup directory for this transaction\n */\nfunction createBackupDir(): string {\n  const tempDir = os.tmpdir();\n  const backupDir = path.join(tempDir, '.artk-backup-' + Date.now());\n  fs.mkdirSync(backupDir, { recursive: true });\n  return backupDir;\n}\n\n/**\n * Start a new generation transaction\n *\n * @returns A new transaction object for tracking generated files\n *\n * @example\n * ```typescript\n * const tx = startTransaction();\n * trackGeneratedFile(tx, '/path/to/new/file.ts');\n * // ... generate files ...\n * if (validationFailed) {\n *   rollbackTransaction(tx);\n * } else {\n *   commitTransaction(tx);\n * }\n * ```\n */\nexport function startTransaction(): GenerationTransaction {\n  return {\n    generatedFiles: [],\n    originalFiles: new Map(),\n    startTime: Date.now(),\n  };\n}\n\n/**\n * Track a newly generated file\n *\n * Call this for each file created during generation.\n * On rollback, these files will be deleted.\n *\n * @param tx - The current transaction\n * @param filePath - Absolute path to the generated file\n */\nexport function trackGeneratedFile(\n  tx: GenerationTransaction,\n  filePath: string\n): void {\n  // Avoid duplicates\n  if (!tx.generatedFiles.includes(filePath)) {\n    tx.generatedFiles.push(filePath);\n  }\n}\n\n/**\n * Track an existing file before modification\n *\n * Call this before modifying an existing file.\n * Creates a backup that will be restored on rollback.\n *\n * @param tx - The current transaction\n * @param filePath - Absolute path to the existing file\n * @returns Path to the backup file, or null if file doesn't exist\n */\nexport function trackOriginalFile(\n  tx: GenerationTransaction,\n  filePath: string\n): string | null {\n  // Don't track the same file twice\n  if (tx.originalFiles.has(filePath)) {\n    return tx.originalFiles.get(filePath) || null;\n  }\n\n  // Only backup if file exists\n  if (!fs.existsSync(filePath)) {\n    return null;\n  }\n\n  // Create backup\n  const backupDir = createBackupDir();\n  const fileName = path.basename(filePath);\n  const backupPath = path.join(backupDir, fileName + '.' + Date.now() + '.bak');\n\n  try {\n    fs.copyFileSync(filePath, backupPath);\n    tx.originalFiles.set(filePath, backupPath);\n    return backupPath;\n  } catch (error) {\n    // If backup fails, don't track it\n    console.warn(`Failed to backup ${filePath}: ${error}`);\n    return null;\n  }\n}\n\n/**\n * Commit the transaction\n *\n * Call this when validation passes. Cleans up backup files\n * and clears the transaction state.\n *\n * @param tx - The transaction to commit\n */\nexport function commitTransaction(tx: GenerationTransaction): void {\n  // Clean up backup files\n  for (const [, backupPath] of tx.originalFiles) {\n    try {\n      if (fs.existsSync(backupPath)) {\n        fs.unlinkSync(backupPath);\n      }\n      // Try to remove backup directory if empty\n      const backupDir = path.dirname(backupPath);\n      if (fs.existsSync(backupDir)) {\n        const files = fs.readdirSync(backupDir);\n        if (files.length === 0) {\n          fs.rmdirSync(backupDir);\n        }\n      }\n    } catch {\n      // Ignore cleanup errors\n    }\n  }\n\n  // Clear transaction state\n  tx.generatedFiles.length = 0;\n  tx.originalFiles.clear();\n}\n\n/**\n * Rollback the transaction\n *\n * Call this when validation fails. Removes generated files\n * and restores original files from backups.\n *\n * @param tx - The transaction to rollback\n * @returns Result object with lists of removed, restored, and failed files\n *\n * @example\n * ```typescript\n * const result = rollbackTransaction(tx);\n * if (result.success) {\n *   console.log('Rollback complete');\n *   console.log('Removed:', result.removedFiles);\n *   console.log('Restored:', result.restoredFiles);\n * } else {\n *   console.error('Some files could not be rolled back:', result.failedFiles);\n * }\n * ```\n */\nexport function rollbackTransaction(tx: GenerationTransaction): RollbackResult {\n  const result: RollbackResult = {\n    success: true,\n    removedFiles: [],\n    restoredFiles: [],\n    failedFiles: [],\n  };\n\n  // Remove generated files\n  for (const filePath of tx.generatedFiles) {\n    try {\n      if (fs.existsSync(filePath)) {\n        fs.unlinkSync(filePath);\n        result.removedFiles.push(filePath);\n      }\n    } catch (error) {\n      result.success = false;\n      result.failedFiles.push({\n        file: filePath,\n        error: error instanceof Error ? error.message : 'Unknown error',\n      });\n    }\n  }\n\n  // Restore original files from backups\n  for (const [originalPath, backupPath] of tx.originalFiles) {\n    try {\n      if (fs.existsSync(backupPath)) {\n        // Ensure directory exists\n        const dir = path.dirname(originalPath);\n        if (!fs.existsSync(dir)) {\n          fs.mkdirSync(dir, { recursive: true });\n        }\n\n        // Restore the backup\n        fs.copyFileSync(backupPath, originalPath);\n        result.restoredFiles.push(originalPath);\n\n        // Clean up backup\n        fs.unlinkSync(backupPath);\n\n        // Try to remove backup directory if empty\n        const backupDir = path.dirname(backupPath);\n        if (fs.existsSync(backupDir)) {\n          const files = fs.readdirSync(backupDir);\n          if (files.length === 0) {\n            fs.rmdirSync(backupDir);\n          }\n        }\n      }\n    } catch (error) {\n      result.success = false;\n      result.failedFiles.push({\n        file: originalPath,\n        error: error instanceof Error ? error.message : 'Unknown error',\n      });\n    }\n  }\n\n  // Clear transaction state\n  tx.generatedFiles.length = 0;\n  tx.originalFiles.clear();\n\n  return result;\n}\n\n/**\n * Generate a rollback confirmation message\n *\n * @param result - The rollback result\n * @returns Human-readable message describing the rollback\n */\nexport function generateRollbackMessage(result: RollbackResult): string {\n  const lines: string[] = [];\n\n  if (result.success) {\n    lines.push('Rollback completed successfully.');\n  } else {\n    lines.push('Rollback completed with some failures.');\n  }\n\n  if (result.removedFiles.length > 0) {\n    lines.push(`\\nRemoved ${result.removedFiles.length} generated file(s):`);\n    for (const file of result.removedFiles) {\n      lines.push(`  - ${file}`);\n    }\n  }\n\n  if (result.restoredFiles.length > 0) {\n    lines.push(`\\nRestored ${result.restoredFiles.length} original file(s):`);\n    for (const file of result.restoredFiles) {\n      lines.push(`  - ${file}`);\n    }\n  }\n\n  if (result.failedFiles.length > 0) {\n    lines.push(`\\nFailed to rollback ${result.failedFiles.length} file(s):`);\n    for (const { file, error } of result.failedFiles) {\n      lines.push(`  - ${file}: ${error}`);\n    }\n    lines.push('\\nManual cleanup may be required for the above files.');\n  }\n\n  return lines.join('\\n');\n}\n\n// Re-export types for convenience\nexport type { GenerationTransaction, RollbackResult };\n","/**\n * Validation Runner\n * T057-T066: Implement ValidationRunner with timeout, file tracking, rollback, persistence\n *\n * Orchestrates all validation rules and manages the validation lifecycle including\n * automatic rollback on failure and result persistence.\n *\n * @module @artk/core/validation/runner\n */\n\nimport * as fs from 'fs';\nimport * as path from 'path';\nimport { getAllRules } from './rules/index.js';\nimport {\n  startTransaction,\n  trackGeneratedFile as trackGenerated,\n  trackOriginalFile as trackOriginal,\n  commitTransaction,\n  rollbackTransaction,\n  generateRollbackMessage,\n} from './rollback.js';\nimport type {\n  ValidationResult,\n  ValidationOptions,\n  ValidationIssue,\n  ValidationRuleResult,\n  ValidationRule,\n  StrictnessLevel,\n  ValidationRuleId,\n  GenerationTransaction,\n} from '../types/validation-result.js';\n\n/**\n * Runner options\n */\nexport interface RunnerOptions {\n  /**\n   * Validation timeout in milliseconds\n   * @default 10000 (10 seconds)\n   */\n  timeout?: number;\n\n  /**\n   * Output directory for validation results\n   * @default process.cwd()\n   */\n  outputDir?: string;\n}\n\n/**\n * Default timeout for validation (10 seconds per FR-029)\n */\nconst DEFAULT_TIMEOUT = 10000;\n\n/**\n * Validation Runner\n *\n * Orchestrates validation rules and manages the validation lifecycle.\n *\n * @example\n * ```typescript\n * const runner = new ValidationRunner();\n *\n * // Track files being generated\n * runner.trackGeneratedFile('/path/to/new/file.ts');\n *\n * // Run validation\n * const result = await runner.validate({\n *   files: ['/path/to/new/file.ts'],\n *   environmentContext: 'commonjs'\n * });\n *\n * if (result.status === 'failed') {\n *   // Files have been automatically rolled back\n *   console.error('Validation failed:', result.errors);\n * }\n * ```\n */\nexport class ValidationRunner {\n  private timeout: number;\n  private outputDir: string;\n  private transaction: GenerationTransaction;\n  private rules: ValidationRule[];\n\n  /**\n   * Create a new ValidationRunner\n   */\n  constructor(options: RunnerOptions = {}) {\n    this.timeout = options.timeout ?? DEFAULT_TIMEOUT;\n    this.outputDir = options.outputDir ?? process.cwd();\n    this.transaction = startTransaction();\n    this.rules = getAllRules();\n  }\n\n  /**\n   * Get the configured timeout\n   */\n  getTimeout(): number {\n    return this.timeout;\n  }\n\n  /**\n   * Track a newly generated file\n   */\n  trackGeneratedFile(filePath: string): void {\n    trackGenerated(this.transaction, filePath);\n  }\n\n  /**\n   * Track an existing file before modification\n   */\n  trackOriginalFile(filePath: string): string | null {\n    return trackOriginal(this.transaction, filePath);\n  }\n\n  /**\n   * Run validation on the specified files\n   */\n  async validate(options: ValidationOptions): Promise<ValidationResult> {\n    const startTime = Date.now();\n    const timestamp = new Date().toISOString();\n\n    // Handle skip validation\n    if (options.skipValidation) {\n      return {\n        timestamp,\n        environmentContext: options.environmentContext,\n        executionTime: Date.now() - startTime,\n        status: 'passed',\n        rules: [],\n        errors: [],\n        warnings: [],\n        validatedFiles: options.files,\n        rollbackPerformed: false,\n        rollbackSuccess: null,\n      };\n    }\n\n    const errors: ValidationIssue[] = [];\n    const warnings: ValidationIssue[] = [];\n    const ruleResults: ValidationRuleResult[] = [];\n    const validatedFiles: string[] = [];\n\n    // Get strictness settings\n    const strictness = options.strictness || {};\n\n    // Validate each file with timeout\n    const validationPromise = this.validateFiles(\n      options.files,\n      options.environmentContext,\n      strictness,\n      errors,\n      warnings,\n      ruleResults,\n      validatedFiles\n    );\n\n    // Apply timeout\n    const timeoutPromise = new Promise<void>((_, reject) => {\n      setTimeout(() => reject(new Error('Validation timeout')), this.timeout);\n    });\n\n    try {\n      await Promise.race([validationPromise, timeoutPromise]);\n    } catch (error) {\n      if (error instanceof Error && error.message === 'Validation timeout') {\n        warnings.push({\n          file: '',\n          line: null,\n          column: null,\n          severity: 'warning',\n          ruleId: 'timeout',\n          message: `Validation timed out after ${this.timeout}ms`,\n          suggestedFix: 'Consider increasing timeout or validating fewer files',\n        });\n      }\n    }\n\n    // Determine status\n    let status: 'passed' | 'failed' | 'warnings' = 'passed';\n    if (errors.length > 0) {\n      status = 'failed';\n    } else if (warnings.length > 0) {\n      status = 'warnings';\n    }\n\n    // Handle rollback on failure\n    let rollbackPerformed = false;\n    let rollbackSuccess: boolean | null = null;\n\n    if (\n      status === 'failed' &&\n      (this.transaction.generatedFiles.length > 0 ||\n        this.transaction.originalFiles.size > 0)\n    ) {\n      const rollbackResult = rollbackTransaction(this.transaction);\n      rollbackPerformed = true;\n      rollbackSuccess = rollbackResult.success;\n\n      // Log rollback message\n      const message = generateRollbackMessage(rollbackResult);\n      console.log(message);\n    } else if (status === 'passed' || status === 'warnings') {\n      // Commit transaction on success\n      commitTransaction(this.transaction);\n    }\n\n    // Reset transaction for next use\n    this.transaction = startTransaction();\n\n    const result: ValidationResult = {\n      timestamp,\n      environmentContext: options.environmentContext,\n      executionTime: Date.now() - startTime,\n      status,\n      rules: ruleResults,\n      errors,\n      warnings,\n      validatedFiles,\n      rollbackPerformed,\n      rollbackSuccess,\n    };\n\n    // Persist results\n    await this.persistResult(result);\n\n    return result;\n  }\n\n  /**\n   * Validate files using all rules\n   */\n  private async validateFiles(\n    files: string[],\n    moduleSystem: string,\n    strictness: Partial<Record<ValidationRuleId, StrictnessLevel>>,\n    errors: ValidationIssue[],\n    warnings: ValidationIssue[],\n    ruleResults: ValidationRuleResult[],\n    validatedFiles: string[]\n  ): Promise<void> {\n    const affectedFilesByRule = new Map<string, Set<string>>();\n\n    for (const rule of this.rules) {\n      affectedFilesByRule.set(rule.config.id, new Set());\n    }\n\n    for (const filePath of files) {\n      // Skip non-existent files\n      if (!fs.existsSync(filePath)) {\n        continue;\n      }\n\n      validatedFiles.push(filePath);\n\n      let content: string;\n      try {\n        content = fs.readFileSync(filePath, 'utf8');\n      } catch {\n        continue;\n      }\n\n      // Run each rule\n      for (const rule of this.rules) {\n        const ruleStrictness =\n          strictness[rule.config.id as ValidationRuleId] ||\n          rule.config.defaultStrictness;\n\n        // Skip ignored rules\n        if (ruleStrictness === 'ignore') {\n          continue;\n        }\n\n        const issues = rule.validate(\n          filePath,\n          content,\n          moduleSystem as 'commonjs' | 'esm'\n        );\n\n        for (const issue of issues) {\n          // Track affected files\n          affectedFilesByRule.get(rule.config.id)?.add(filePath);\n\n          // Apply strictness\n          if (ruleStrictness === 'warning') {\n            warnings.push({ ...issue, severity: 'warning' });\n          } else {\n            if (issue.severity === 'error') {\n              errors.push(issue);\n            } else {\n              warnings.push(issue);\n            }\n          }\n        }\n      }\n    }\n\n    // Generate rule results\n    for (const rule of this.rules) {\n      const affectedFiles = Array.from(\n        affectedFilesByRule.get(rule.config.id) || []\n      );\n      const pass = affectedFiles.length === 0;\n\n      ruleResults.push({\n        ruleId: rule.config.id,\n        pass,\n        affectedFiles,\n        message: pass\n          ? `${rule.config.name}: No issues found`\n          : `${rule.config.name}: Found issues in ${affectedFiles.length} file(s)`,\n      });\n    }\n  }\n\n  /**\n   * Persist validation result to .artk/validation-results.json\n   */\n  private async persistResult(result: ValidationResult): Promise<void> {\n    const artkDir = path.join(this.outputDir, '.artk');\n    const resultsPath = path.join(artkDir, 'validation-results.json');\n\n    // Ensure .artk directory exists\n    if (!fs.existsSync(artkDir)) {\n      fs.mkdirSync(artkDir, { recursive: true });\n    }\n\n    // Load existing results or start fresh\n    let results: ValidationResult[] = [];\n    if (fs.existsSync(resultsPath)) {\n      try {\n        const content = fs.readFileSync(resultsPath, 'utf8');\n        results = JSON.parse(content);\n        if (!Array.isArray(results)) {\n          results = [];\n        }\n      } catch {\n        results = [];\n      }\n    }\n\n    // Append new result\n    results.push(result);\n\n    // Write back\n    fs.writeFileSync(resultsPath, JSON.stringify(results, null, 2));\n  }\n}\n\n/**\n * Validate foundation modules\n *\n * Convenience function for one-off validation without creating a runner instance.\n *\n * @param options - Validation options\n * @returns Validation result\n *\n * @example\n * ```typescript\n * import { validateFoundation } from '@artk/core/validation';\n *\n * const result = await validateFoundation({\n *   files: ['auth/login.ts', 'config/env.ts'],\n *   environmentContext: 'commonjs'\n * });\n *\n * if (result.status === 'failed') {\n *   console.error('Validation failed:', result.errors);\n * }\n * ```\n */\nexport async function validateFoundation(\n  options: ValidationOptions\n): Promise<ValidationResult> {\n  const runner = new ValidationRunner();\n  return runner.validate(options);\n}\n"]}