<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AG Grid Test Fixture - Selectable Grid</title>
  <style>
    .ag-root-wrapper {
      width: 100%;
      height: 400px;
      border: 1px solid #ccc;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 14px;
    }
    .ag-header {
      background-color: #f5f5f5;
      border-bottom: 1px solid #ccc;
    }
    .ag-header-row {
      display: flex;
    }
    .ag-header-cell {
      padding: 8px;
      border-right: 1px solid #ddd;
      font-weight: 600;
      display: flex;
      align-items: center;
      min-width: 100px;
    }
    .ag-header-select-all {
      min-width: 40px;
      justify-content: center;
    }
    .ag-body-viewport {
      overflow: auto;
      height: calc(100% - 40px);
    }
    .ag-row {
      display: flex;
      border-bottom: 1px solid #eee;
    }
    .ag-row:hover {
      background-color: #f9f9f9;
    }
    .ag-row-selected {
      background-color: #e6f2ff !important;
    }
    .ag-cell {
      padding: 8px;
      border-right: 1px solid #eee;
      min-width: 100px;
    }
    .ag-selection-checkbox {
      min-width: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
  </style>
</head>
<body>
  <div class="ag-root-wrapper" data-testid="selectable-grid" role="grid">
    <!-- Header with select-all -->
    <div class="ag-header" role="rowgroup">
      <div class="ag-header-row" role="row">
        <div class="ag-header-cell ag-header-select-all" role="columnheader">
          <input type="checkbox" />
        </div>
        <div class="ag-header-cell" role="columnheader" col-id="id" aria-colindex="1">ID</div>
        <div class="ag-header-cell" role="columnheader" col-id="name" aria-colindex="2">Name</div>
        <div class="ag-header-cell" role="columnheader" col-id="email" aria-colindex="3">Email</div>
      </div>
    </div>

    <!-- Body -->
    <div class="ag-body-viewport" role="rowgroup">
      <div class="ag-center-cols-container">
        <div class="ag-row" role="row" row-index="0" row-id="user-1" aria-rowindex="1">
          <div class="ag-cell ag-selection-checkbox"><input type="checkbox" /></div>
          <div class="ag-cell" role="gridcell" col-id="id" aria-colindex="1">1</div>
          <div class="ag-cell" role="gridcell" col-id="name" aria-colindex="2">John Doe</div>
          <div class="ag-cell" role="gridcell" col-id="email" aria-colindex="3">john@example.com</div>
        </div>
        <div class="ag-row" role="row" row-index="1" row-id="user-2" aria-rowindex="2">
          <div class="ag-cell ag-selection-checkbox"><input type="checkbox" /></div>
          <div class="ag-cell" role="gridcell" col-id="id" aria-colindex="1">2</div>
          <div class="ag-cell" role="gridcell" col-id="name" aria-colindex="2">Jane Smith</div>
          <div class="ag-cell" role="gridcell" col-id="email" aria-colindex="3">jane@example.com</div>
        </div>
        <div class="ag-row" role="row" row-index="2" row-id="user-3" aria-rowindex="3">
          <div class="ag-cell ag-selection-checkbox"><input type="checkbox" /></div>
          <div class="ag-cell" role="gridcell" col-id="id" aria-colindex="1">3</div>
          <div class="ag-cell" role="gridcell" col-id="name" aria-colindex="2">Bob Wilson</div>
          <div class="ag-cell" role="gridcell" col-id="email" aria-colindex="3">bob@example.com</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Selection logic
    const selectAllCheckbox = document.querySelector('.ag-header-select-all input');
    const rowCheckboxes = document.querySelectorAll('.ag-selection-checkbox input');

    // Handle select all
    selectAllCheckbox.addEventListener('change', (e) => {
      const checked = e.target.checked;
      rowCheckboxes.forEach(cb => {
        cb.checked = checked;
        updateRowSelection(cb);
      });
    });

    // Handle individual row selection
    rowCheckboxes.forEach(cb => {
      cb.addEventListener('change', () => {
        updateRowSelection(cb);
        updateSelectAllState();
      });
    });

    function updateRowSelection(checkbox) {
      const row = checkbox.closest('.ag-row');
      if (checkbox.checked) {
        row.classList.add('ag-row-selected');
        row.setAttribute('aria-selected', 'true');
      } else {
        row.classList.remove('ag-row-selected');
        row.setAttribute('aria-selected', 'false');
      }
    }

    function updateSelectAllState() {
      const allChecked = Array.from(rowCheckboxes).every(cb => cb.checked);
      const someChecked = Array.from(rowCheckboxes).some(cb => cb.checked);
      selectAllCheckbox.checked = allChecked;
      selectAllCheckbox.indeterminate = someChecked && !allChecked;
    }
  </script>
</body>
</html>
