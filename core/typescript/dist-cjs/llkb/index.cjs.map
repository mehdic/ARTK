{"version":3,"sources":["../../llkb/normalize.ts","../../llkb/similarity.ts","../../llkb/inference.ts","../../llkb/confidence.ts","../../llkb/file-utils.ts","../../llkb/history.ts","../../llkb/analytics.ts","../../llkb/cli.ts","../../llkb/loaders.ts","../../llkb/context.ts","../../llkb/matching.ts","../../llkb/detection.ts","../../llkb/registry.ts","../../llkb/migration.ts","../../llkb/search.ts"],"names":["path","fs","path2","fs2","DEFAULT_LLKB_ROOT","path3","fs3","path4","join","existsSync","readFileSync","top","path5","basename","fs4","path6","fs5","fs6","path7","fs7"],"mappings":"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","file":"index.cjs","sourcesContent":["/**\n * Code Normalization for LLKB Pattern Matching\n *\n * Normalizes code strings for comparison by:\n * - Replacing string literals with placeholders\n * - Replacing numbers with placeholders\n * - Replacing variable names with placeholders\n * - Normalizing whitespace\n *\n * @module llkb/normalize\n */\n\n/**\n * Normalize code for pattern comparison\n *\n * This function transforms code into a canonical form that allows\n * comparing the structure of code rather than specific values.\n *\n * @param code - The source code to normalize\n * @returns Normalized code string\n *\n * @example\n * ```typescript\n * const code1 = `const user = \"john\"; const count = 5;`;\n * const code2 = `const admin = \"jane\"; const total = 10;`;\n *\n * normalizeCode(code1) === normalizeCode(code2) // true\n * // Both become: \"const <VAR> = <STRING>; const <VAR> = <NUMBER>;\"\n * ```\n */\nexport function normalizeCode(code: string): string {\n  let normalized = code;\n\n  // Remove single-quoted string literals (replace with <STRING>)\n  normalized = normalized.replace(/'[^']*'/g, '<STRING>');\n\n  // Remove double-quoted string literals (replace with <STRING>)\n  normalized = normalized.replace(/\"[^\"]*\"/g, '<STRING>');\n\n  // Remove template literals (replace with <STRING>)\n  normalized = normalized.replace(/`[^`]*`/g, '<STRING>');\n\n  // Remove numbers (replace with <NUMBER>)\n  // Match integers and decimals, but not numbers in identifiers\n  normalized = normalized.replace(/\\b\\d+(?:\\.\\d+)?\\b/g, '<NUMBER>');\n\n  // Remove variable names in const declarations\n  normalized = normalized.replace(/\\bconst\\s+(\\w+)/g, 'const <VAR>');\n\n  // Remove variable names in let declarations\n  normalized = normalized.replace(/\\blet\\s+(\\w+)/g, 'let <VAR>');\n\n  // Remove variable names in var declarations\n  normalized = normalized.replace(/\\bvar\\s+(\\w+)/g, 'var <VAR>');\n\n  // Normalize whitespace (collapse multiple spaces to single)\n  normalized = normalized.replace(/\\s+/g, ' ');\n\n  // Trim leading/trailing whitespace\n  normalized = normalized.trim();\n\n  return normalized;\n}\n\n/**\n * Generate a simple hash code from a string\n *\n * Uses a variant of the djb2 algorithm for fast hashing.\n * Not cryptographically secure, but good for deduplication.\n *\n * @param str - The string to hash\n * @returns A hash code as a hex string\n *\n * @example\n * ```typescript\n * hashCode(\"hello world\") // \"5e01db3e\"\n * ```\n */\nexport function hashCode(str: string): string {\n  let hash = 5381;\n\n  for (let i = 0; i < str.length; i++) {\n    // hash * 33 + char\n    hash = ((hash << 5) + hash + str.charCodeAt(i)) >>> 0;\n  }\n\n  return hash.toString(16);\n}\n\n/**\n * Tokenize code for Jaccard similarity calculation\n *\n * Splits code into meaningful tokens for comparison.\n *\n * @param code - The code to tokenize\n * @returns Set of tokens\n */\nexport function tokenize(code: string): Set<string> {\n  // Split on whitespace and punctuation, keep meaningful tokens\n  const tokens = code\n    .split(/[\\s.,;:(){}[\\]<>]+/)\n    .filter((token) => token.length > 0);\n\n  return new Set(tokens);\n}\n\n/**\n * Count lines in a code string\n *\n * @param code - The code to count lines in\n * @returns Number of lines\n */\nexport function countLines(code: string): number {\n  if (!code || code.length === 0) {\n    return 0;\n  }\n\n  return code.split('\\n').length;\n}\n","/**\n * Code Similarity Calculation for LLKB\n *\n * Provides functions to calculate similarity between code patterns\n * using a combination of Jaccard similarity and structural analysis.\n *\n * @module llkb/similarity\n */\n\nimport { normalizeCode, tokenize, countLines } from './normalize.js';\n\n/**\n * Calculate similarity between two code strings\n *\n * Uses a weighted combination of:\n * - Jaccard similarity on tokens (80%)\n * - Line count similarity (20%)\n *\n * @param codeA - First code string\n * @param codeB - Second code string\n * @returns Similarity score between 0.0 and 1.0\n *\n * @example\n * ```typescript\n * const similar = calculateSimilarity(\n *   `await page.click('#submit');`,\n *   `await page.click('#cancel');`\n * );\n * // Returns ~0.9 (very similar structure, different selector)\n * ```\n */\nexport function calculateSimilarity(codeA: string, codeB: string): number {\n  // Normalize both code strings\n  const normA = normalizeCode(codeA);\n  const normB = normalizeCode(codeB);\n\n  // Exact match after normalization\n  if (normA === normB) {\n    return 1.0;\n  }\n\n  // Calculate Jaccard similarity on tokens\n  const tokensA = tokenize(normA);\n  const tokensB = tokenize(normB);\n\n  const jaccardScore = jaccardSimilarity(tokensA, tokensB);\n\n  // Calculate line count similarity\n  const linesA = countLines(codeA);\n  const linesB = countLines(codeB);\n  const lineSimilarity = lineCountSimilarity(linesA, linesB);\n\n  // Weighted combination: 80% Jaccard, 20% line similarity\n  const similarity = jaccardScore * 0.8 + lineSimilarity * 0.2;\n\n  return Math.round(similarity * 100) / 100;\n}\n\n/**\n * Calculate Jaccard similarity between two sets\n *\n * Jaccard index = |A  B| / |A  B|\n *\n * @param setA - First set\n * @param setB - Second set\n * @returns Jaccard similarity (0.0 - 1.0)\n */\nexport function jaccardSimilarity(setA: Set<string>, setB: Set<string>): number {\n  if (setA.size === 0 && setB.size === 0) {\n    return 1.0; // Both empty = identical\n  }\n\n  if (setA.size === 0 || setB.size === 0) {\n    return 0.0; // One empty, one not = no similarity\n  }\n\n  // Calculate intersection\n  const intersection = new Set<string>();\n  for (const item of setA) {\n    if (setB.has(item)) {\n      intersection.add(item);\n    }\n  }\n\n  // Calculate union\n  const union = new Set<string>([...setA, ...setB]);\n\n  return intersection.size / union.size;\n}\n\n/**\n * Calculate similarity based on line counts\n *\n * Uses the formula: 1 - |diff| / max(a, b)\n *\n * @param linesA - Line count of first code\n * @param linesB - Line count of second code\n * @returns Line similarity (0.0 - 1.0)\n */\nexport function lineCountSimilarity(linesA: number, linesB: number): number {\n  if (linesA === 0 && linesB === 0) {\n    return 1.0;\n  }\n\n  const maxLines = Math.max(linesA, linesB);\n  const diff = Math.abs(linesA - linesB);\n\n  return 1 - diff / maxLines;\n}\n\n/**\n * Check if two code strings are near-duplicates\n *\n * Uses the configured similarity threshold (default 0.8)\n *\n * @param codeA - First code string\n * @param codeB - Second code string\n * @param threshold - Similarity threshold (default 0.8)\n * @returns true if similarity >= threshold\n */\nexport function isNearDuplicate(\n  codeA: string,\n  codeB: string,\n  threshold: number = 0.8\n): boolean {\n  return calculateSimilarity(codeA, codeB) >= threshold;\n}\n\n/**\n * Find all near-duplicates of a pattern in a collection\n *\n * @param pattern - The pattern to find duplicates of\n * @param candidates - Array of candidate code strings\n * @param threshold - Similarity threshold (default 0.8)\n * @returns Array of indices of near-duplicate candidates\n */\nexport function findNearDuplicates(\n  pattern: string,\n  candidates: string[],\n  threshold: number = 0.8\n): number[] {\n  const duplicates: number[] = [];\n\n  for (let i = 0; i < candidates.length; i++) {\n    const candidate = candidates[i];\n    if (candidate !== undefined && isNearDuplicate(pattern, candidate, threshold)) {\n      duplicates.push(i);\n    }\n  }\n\n  return duplicates;\n}\n\n/**\n * Result of a pattern similarity search\n */\nexport interface SimilarPatternResult {\n  /** The matched pattern */\n  pattern: string;\n  /** Similarity score (0.0 - 1.0) */\n  similarity: number;\n  /** Index in the original patterns array */\n  index: number;\n}\n\n/**\n * Find similar patterns in a collection with similarity scores\n *\n * Returns all patterns that meet the threshold, sorted by similarity (highest first).\n *\n * @param target - The target code to find similar patterns for\n * @param patterns - Array of patterns to search\n * @param threshold - Minimum similarity threshold (default 0.8)\n * @returns Array of similar patterns with scores, sorted by similarity descending\n *\n * @example\n * ```typescript\n * const results = findSimilarPatterns(\n *   `await page.click('.submit')`,\n *   [`await page.click('.button')`, `await page.goto('/home')`],\n *   0.7\n * );\n * // Returns: [{ pattern: \"await page.click('.button')\", similarity: 0.95, index: 0 }]\n * ```\n */\nexport function findSimilarPatterns(\n  target: string,\n  patterns: string[],\n  threshold: number = 0.8\n): SimilarPatternResult[] {\n  const results: SimilarPatternResult[] = [];\n\n  for (let i = 0; i < patterns.length; i++) {\n    const pattern = patterns[i];\n    if (pattern !== undefined) {\n      const similarity = calculateSimilarity(target, pattern);\n      if (similarity >= threshold) {\n        results.push({ pattern, similarity, index: i });\n      }\n    }\n  }\n\n  // Sort by similarity descending\n  results.sort((a, b) => b.similarity - a.similarity);\n\n  return results;\n}\n","/**\n * Category Inference for LLKB\n *\n * Infers the category of code patterns based on keywords and patterns.\n *\n * @module llkb/inference\n */\n\nimport type { LLKBCategory, ComponentCategory } from './types.js';\n\n/**\n * Keyword patterns for each category\n */\nconst CATEGORY_PATTERNS: Record<ComponentCategory, string[]> = {\n  navigation: [\n    'goto',\n    'navigate',\n    'route',\n    'url',\n    'path',\n    'sidebar',\n    'menu',\n    'breadcrumb',\n    'nav',\n    'link',\n    'href',\n    'router',\n  ],\n  auth: [\n    'login',\n    'logout',\n    'auth',\n    'password',\n    'credential',\n    'session',\n    'token',\n    'user',\n    'signin',\n    'signout',\n    'authenticate',\n    'authorization',\n  ],\n  assertion: [\n    'expect',\n    'assert',\n    'verify',\n    'should',\n    'tobevisible',\n    'tohavetext',\n    'tobehidden',\n    'tocontain',\n    'tohaveattribute',\n    'tobeenabled',\n    'tobedisabled',\n    'tohavevalue',\n  ],\n  data: [\n    'api',\n    'fetch',\n    'response',\n    'request',\n    'json',\n    'payload',\n    'data',\n    'post',\n    'get',\n    'put',\n    'delete',\n    'endpoint',\n    'graphql',\n    'rest',\n  ],\n  selector: [\n    'locator',\n    'getby',\n    'selector',\n    'testid',\n    'data-testid',\n    'queryselector',\n    'findby',\n    'getbyrole',\n    'getbylabel',\n    'getbytext',\n    'getbyplaceholder',\n  ],\n  timing: [\n    'wait',\n    'timeout',\n    'delay',\n    'sleep',\n    'settimeout',\n    'poll',\n    'retry',\n    'interval',\n    'waitfor',\n    'waituntil',\n  ],\n  'ui-interaction': [\n    'click',\n    'fill',\n    'type',\n    'select',\n    'check',\n    'uncheck',\n    'upload',\n    'drag',\n    'drop',\n    'hover',\n    'focus',\n    'blur',\n    'press',\n    'scroll',\n    'dblclick',\n  ],\n};\n\n/**\n * Priority order for category matching\n * Higher priority categories are checked first\n */\nconst CATEGORY_PRIORITY: ComponentCategory[] = [\n  'auth', // Auth patterns are distinctive\n  'navigation', // Navigation patterns are common\n  'assertion', // Assertions are easy to identify\n  'data', // Data/API patterns\n  'timing', // Wait patterns\n  'selector', // Selector patterns\n  'ui-interaction', // Default fallback for UI ops\n];\n\n/**\n * Infer the category of a code pattern\n *\n * Analyzes the code for keywords associated with each category\n * and returns the best matching category.\n *\n * @param code - The code to analyze\n * @returns The inferred category\n *\n * @example\n * ```typescript\n * inferCategory(`await page.goto('/login')`); // 'navigation'\n * inferCategory(`expect(toast).toBeVisible()`); // 'assertion'\n * inferCategory(`await page.click('#submit')`); // 'ui-interaction'\n * ```\n */\nexport function inferCategory(code: string): ComponentCategory {\n  const codeLower = code.toLowerCase();\n\n  // Check each category in priority order\n  for (const category of CATEGORY_PRIORITY) {\n    const patterns = CATEGORY_PATTERNS[category];\n\n    if (patterns !== undefined) {\n      for (const pattern of patterns) {\n        if (codeLower.includes(pattern)) {\n          return category;\n        }\n      }\n    }\n  }\n\n  // Default to ui-interaction for unclassified patterns\n  return 'ui-interaction';\n}\n\n/**\n * Infer category with confidence score\n *\n * Returns both the category and a confidence score based on\n * how many matching keywords were found.\n *\n * @param code - The code to analyze\n * @returns Object with category and confidence\n *\n * @example\n * ```typescript\n * inferCategoryWithConfidence(`await page.goto('/login'); await expect(page).toHaveURL('/login');`);\n * // { category: 'navigation', confidence: 0.8, matchCount: 2 }\n * ```\n */\nexport function inferCategoryWithConfidence(code: string): {\n  category: ComponentCategory;\n  confidence: number;\n  matchCount: number;\n} {\n  const codeLower = code.toLowerCase();\n  const categoryMatches: Map<ComponentCategory, number> = new Map();\n\n  // Count matches for each category\n  for (const [category, patterns] of Object.entries(CATEGORY_PATTERNS)) {\n    let matchCount = 0;\n    for (const pattern of patterns) {\n      if (codeLower.includes(pattern)) {\n        matchCount++;\n      }\n    }\n    if (matchCount > 0) {\n      categoryMatches.set(category as ComponentCategory, matchCount);\n    }\n  }\n\n  // Find the category with most matches\n  let bestCategory: ComponentCategory = 'ui-interaction';\n  let maxMatches = 0;\n\n  for (const [category, count] of categoryMatches) {\n    if (count > maxMatches) {\n      maxMatches = count;\n      bestCategory = category;\n    }\n  }\n\n  // Calculate confidence based on match density\n  // More matches = higher confidence, capped at 1.0\n  const totalPatterns = CATEGORY_PATTERNS[bestCategory]?.length ?? 1;\n  const confidence = Math.min(maxMatches / Math.min(totalPatterns, 5), 1.0);\n\n  return {\n    category: bestCategory,\n    confidence: Math.round(confidence * 100) / 100,\n    matchCount: maxMatches,\n  };\n}\n\n/**\n * Check if a category is valid for components\n *\n * 'quirk' is a lesson-only category and cannot be used for components.\n *\n * @param category - The category to check\n * @returns true if valid for components\n */\nexport function isComponentCategory(category: LLKBCategory): category is ComponentCategory {\n  return category !== 'quirk';\n}\n\n/**\n * Get all valid categories\n *\n * @returns Array of all valid category names\n */\nexport function getAllCategories(): LLKBCategory[] {\n  return [\n    'selector',\n    'timing',\n    'quirk',\n    'auth',\n    'data',\n    'assertion',\n    'navigation',\n    'ui-interaction',\n  ];\n}\n\n/**\n * Get all valid component categories\n *\n * @returns Array of valid component category names\n */\nexport function getComponentCategories(): ComponentCategory[] {\n  return [\n    'selector',\n    'timing',\n    'auth',\n    'data',\n    'assertion',\n    'navigation',\n    'ui-interaction',\n  ];\n}\n","/**\n * Confidence Calculation for LLKB Lessons\n *\n * Provides functions to calculate and track lesson confidence scores.\n *\n * @module llkb/confidence\n */\n\nimport type { Lesson, ConfidenceHistoryEntry } from './types.js';\n\n/**\n * Maximum entries to keep in confidence history\n * Prevents unbounded growth while preserving useful trend data\n */\nexport const MAX_CONFIDENCE_HISTORY_ENTRIES = 100;\n\n/**\n * Number of days to retain in confidence history\n */\nexport const CONFIDENCE_HISTORY_RETENTION_DAYS = 90;\n\n/**\n * Calculate the confidence score for a lesson\n *\n * The confidence formula combines:\n * - Base score from occurrence count (more uses = higher confidence)\n * - Recency factor (recent success = higher confidence)\n * - Success factor (higher success rate = higher confidence)\n * - Validation boost (human-reviewed lessons get a boost)\n *\n * @param lesson - The lesson to calculate confidence for\n * @returns Confidence score between 0.0 and 1.0\n *\n * @example\n * ```typescript\n * const confidence = calculateConfidence(lesson);\n * if (confidence >= 0.7) {\n *   // Auto-apply this lesson\n * }\n * ```\n */\nexport function calculateConfidence(lesson: Lesson): number {\n  const metrics = lesson.metrics;\n\n  // STEP 1: Calculate base score (occurrence-based)\n  // More occurrences = higher base confidence\n  // Caps at 1.0 after 10 occurrences\n  const occurrences = metrics.occurrences;\n  const baseScore = Math.min(occurrences / 10.0, 1.0);\n\n  // STEP 2: Calculate recency factor (time decay)\n  // Lessons not used recently lose confidence\n  // Decays by 30% over 90 days, floors at 0.7\n  let recencyFactor: number;\n\n  if (metrics.lastSuccess) {\n    const daysSinceLastSuccess = daysBetween(new Date(), new Date(metrics.lastSuccess));\n    recencyFactor = Math.max(1.0 - (daysSinceLastSuccess / 90.0) * 0.3, 0.7);\n  } else {\n    // Never succeeded yet - use creation date\n    const daysSinceCreation = daysBetween(new Date(), new Date(metrics.firstSeen));\n    recencyFactor = Math.max(1.0 - (daysSinceCreation / 30.0) * 0.5, 0.5);\n  }\n\n  // STEP 3: Calculate success factor (effectiveness)\n  // Square root dampens the impact of low success rates\n  // e.g., 0.64 success rate  0.8 factor\n  const successRate = metrics.successRate;\n  const successFactor = Math.sqrt(successRate);\n\n  // STEP 4: Apply validation boost (human review)\n  // Human-reviewed lessons get 20% confidence boost\n  const validationBoost = lesson.validation.humanReviewed ? 1.2 : 1.0;\n\n  // STEP 5: Calculate final confidence\n  const rawConfidence = baseScore * recencyFactor * successFactor * validationBoost;\n\n  // Clamp to valid range [0.0, 1.0]\n  const confidence = Math.min(Math.max(rawConfidence, 0.0), 1.0);\n\n  return Math.round(confidence * 100) / 100;\n}\n\n/**\n * Detect if a lesson has declining confidence\n *\n * Compares current confidence to the 30-day rolling average.\n * A decline of 20% or more triggers this detection.\n *\n * @param lesson - The lesson to check\n * @returns true if confidence is declining significantly\n *\n * @example\n * ```typescript\n * if (detectDecliningConfidence(lesson)) {\n *   // Flag for review\n *   analytics.needsReview.decliningSuccessRate.push(lesson.id);\n * }\n * ```\n */\nexport function detectDecliningConfidence(lesson: Lesson): boolean {\n  const history = lesson.metrics.confidenceHistory;\n\n  if (!history || history.length < 2) {\n    return false; // Not enough data to detect trend\n  }\n\n  const currentConfidence = lesson.metrics.confidence;\n\n  // Get last 30 entries (or all if fewer)\n  const recentHistory = history.slice(-30);\n\n  // Calculate historical average\n  const sum = recentHistory.reduce((acc, entry) => acc + entry.value, 0);\n  const historicalAverage = sum / recentHistory.length;\n\n  // Check for 20% decline\n  return currentConfidence < historicalAverage * 0.8;\n}\n\n/**\n * Update the confidence history for a lesson\n *\n * Adds the current confidence to the history and prunes old entries.\n *\n * @param lesson - The lesson to update\n * @returns Updated confidence history array\n */\nexport function updateConfidenceHistory(lesson: Lesson): ConfidenceHistoryEntry[] {\n  const history = lesson.metrics.confidenceHistory ?? [];\n  const now = new Date();\n\n  // Add current confidence to history\n  const newEntry: ConfidenceHistoryEntry = {\n    date: now.toISOString(),\n    value: lesson.metrics.confidence,\n  };\n\n  history.push(newEntry);\n\n  // Keep only entries within retention period\n  const cutoffDate = new Date();\n  cutoffDate.setDate(cutoffDate.getDate() - CONFIDENCE_HISTORY_RETENTION_DAYS);\n\n  const filtered = history.filter((entry) => new Date(entry.date) >= cutoffDate);\n\n  // Cap at MAX_CONFIDENCE_HISTORY_ENTRIES\n  return filtered.slice(-MAX_CONFIDENCE_HISTORY_ENTRIES);\n}\n\n/**\n * Get the confidence trend direction\n *\n * @param history - Confidence history entries\n * @returns 'increasing', 'decreasing', 'stable', or 'unknown'\n */\nexport function getConfidenceTrend(\n  history: ConfidenceHistoryEntry[]\n): 'increasing' | 'decreasing' | 'stable' | 'unknown' {\n  if (!history || history.length < 3) {\n    return 'unknown';\n  }\n\n  // Compare first third average to last third average\n  const third = Math.floor(history.length / 3);\n  const firstThird = history.slice(0, third);\n  const lastThird = history.slice(-third);\n\n  const firstAvg = firstThird.reduce((acc, e) => acc + e.value, 0) / firstThird.length;\n  const lastAvg = lastThird.reduce((acc, e) => acc + e.value, 0) / lastThird.length;\n\n  const change = (lastAvg - firstAvg) / firstAvg;\n\n  if (change > 0.1) {\n    return 'increasing';\n  } else if (change < -0.1) {\n    return 'decreasing';\n  } else {\n    return 'stable';\n  }\n}\n\n/**\n * Calculate the number of days between two dates\n *\n * @param date1 - First date\n * @param date2 - Second date\n * @returns Number of days (can be fractional)\n */\nexport function daysBetween(date1: Date, date2: Date): number {\n  const msPerDay = 24 * 60 * 60 * 1000;\n  return Math.abs(date1.getTime() - date2.getTime()) / msPerDay;\n}\n\n/**\n * Check if a lesson should be flagged for review based on confidence\n *\n * @param lesson - The lesson to check\n * @param threshold - Low confidence threshold (default 0.4)\n * @returns true if lesson needs review\n */\nexport function needsConfidenceReview(lesson: Lesson, threshold: number = 0.4): boolean {\n  return lesson.metrics.confidence < threshold;\n}\n","/**\n * File Utilities for LLKB\n *\n * Provides safe file operations including atomic writes and file locking\n * to prevent data corruption from concurrent access.\n *\n * @module llkb/file-utils\n */\n\nimport * as fs from 'fs';\nimport * as path from 'path';\nimport type { SaveResult, UpdateResult } from './types.js';\n\n/**\n * Maximum wait time for acquiring a lock (in milliseconds)\n */\nexport const LOCK_MAX_WAIT_MS = 5000;\n\n/**\n * Stale lock threshold (in milliseconds)\n * Locks older than this are considered abandoned\n */\nexport const STALE_LOCK_THRESHOLD_MS = 30000;\n\n/**\n * Retry interval when waiting for a lock (in milliseconds)\n */\nexport const LOCK_RETRY_INTERVAL_MS = 50;\n\n/**\n * Generate a random ID for temporary files\n */\nfunction generateRandomId(): string {\n  return Math.random().toString(36).substring(2, 15);\n}\n\n/**\n * Save JSON data atomically\n *\n * Writes to a temporary file first, then renames to the target path.\n * This ensures the file is either fully written or not written at all.\n *\n * @param filePath - Target file path\n * @param data - Data to write\n * @returns SaveResult indicating success or failure\n *\n * @example\n * ```typescript\n * const result = await saveJSONAtomic('.artk/llkb/lessons.json', lessons);\n * if (!result.success) {\n *   console.error('Failed to save:', result.error);\n * }\n * ```\n */\nexport async function saveJSONAtomic(filePath: string, data: unknown): Promise<SaveResult> {\n  const tempPath = `${filePath}.tmp.${generateRandomId()}`;\n\n  try {\n    // Ensure directory exists\n    const dir = path.dirname(filePath);\n    if (!fs.existsSync(dir)) {\n      fs.mkdirSync(dir, { recursive: true });\n    }\n\n    // Write to temp file\n    const content = JSON.stringify(data, null, 2);\n    fs.writeFileSync(tempPath, content, 'utf-8');\n\n    // Atomic rename\n    fs.renameSync(tempPath, filePath);\n\n    return { success: true };\n  } catch (error) {\n    // Clean up temp file if it exists\n    try {\n      if (fs.existsSync(tempPath)) {\n        fs.unlinkSync(tempPath);\n      }\n    } catch {\n      // Ignore cleanup errors\n    }\n\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : String(error),\n    };\n  }\n}\n\n/**\n * Synchronous version of saveJSONAtomic\n *\n * @param filePath - Target file path\n * @param data - Data to write\n * @returns SaveResult indicating success or failure\n */\nexport function saveJSONAtomicSync(filePath: string, data: unknown): SaveResult {\n  const tempPath = `${filePath}.tmp.${generateRandomId()}`;\n\n  try {\n    // Ensure directory exists\n    const dir = path.dirname(filePath);\n    if (!fs.existsSync(dir)) {\n      fs.mkdirSync(dir, { recursive: true });\n    }\n\n    // Write to temp file\n    const content = JSON.stringify(data, null, 2);\n    fs.writeFileSync(tempPath, content, 'utf-8');\n\n    // Atomic rename\n    fs.renameSync(tempPath, filePath);\n\n    return { success: true };\n  } catch (error) {\n    // Clean up temp file if it exists\n    try {\n      if (fs.existsSync(tempPath)) {\n        fs.unlinkSync(tempPath);\n      }\n    } catch {\n      // Ignore cleanup errors\n    }\n\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : String(error),\n    };\n  }\n}\n\n/**\n * Acquire a file lock\n *\n * Creates a .lock file to prevent concurrent access.\n * Handles stale locks from crashed processes.\n *\n * @param filePath - Path of the file to lock\n * @returns true if lock was acquired, false otherwise\n */\nfunction acquireLock(filePath: string): boolean {\n  const lockPath = `${filePath}.lock`;\n  const now = Date.now();\n\n  try {\n    // Check if lock exists\n    if (fs.existsSync(lockPath)) {\n      const lockStat = fs.statSync(lockPath);\n      const lockAge = now - lockStat.mtimeMs;\n\n      // Check if lock is stale\n      if (lockAge > STALE_LOCK_THRESHOLD_MS) {\n        // Remove stale lock\n        fs.unlinkSync(lockPath);\n      } else {\n        // Lock is active\n        return false;\n      }\n    }\n\n    // Create lock file with exclusive flag\n    fs.writeFileSync(lockPath, String(now), { flag: 'wx' });\n    return true;\n  } catch (error) {\n    // EEXIST means another process created the lock\n    if ((error as NodeJS.ErrnoException).code === 'EEXIST') {\n      return false;\n    }\n    throw error;\n  }\n}\n\n/**\n * Release a file lock\n *\n * @param filePath - Path of the file to unlock\n */\nfunction releaseLock(filePath: string): void {\n  const lockPath = `${filePath}.lock`;\n  try {\n    if (fs.existsSync(lockPath)) {\n      fs.unlinkSync(lockPath);\n    }\n  } catch {\n    // Ignore errors - lock may have been removed by another process\n  }\n}\n\n/**\n * Update a JSON file with locking\n *\n * Reads the file, applies an update function, and saves atomically.\n * Uses file locking to prevent concurrent modifications.\n *\n * @param filePath - Path to the JSON file\n * @param updateFn - Function that receives current data and returns updated data\n * @returns UpdateResult indicating success or failure\n *\n * @example\n * ```typescript\n * const result = await updateJSONWithLock(\n *   '.artk/llkb/lessons.json',\n *   (lessons) => {\n *     lessons.lessons.push(newLesson);\n *     return lessons;\n *   }\n * );\n * ```\n */\nexport async function updateJSONWithLock<T>(\n  filePath: string,\n  updateFn: (data: T) => T\n): Promise<UpdateResult> {\n  const startTime = Date.now();\n  let retriesNeeded = 0;\n\n  // Try to acquire lock with timeout\n  while (Date.now() - startTime < LOCK_MAX_WAIT_MS) {\n    if (acquireLock(filePath)) {\n      try {\n        // Read current data\n        let data: T;\n        if (fs.existsSync(filePath)) {\n          const content = fs.readFileSync(filePath, 'utf-8');\n          data = JSON.parse(content) as T;\n        } else {\n          // File doesn't exist - updateFn must handle this\n          data = {} as T;\n        }\n\n        // Apply update\n        const updated = updateFn(data);\n\n        // Save atomically\n        const saveResult = await saveJSONAtomic(filePath, updated);\n\n        if (!saveResult.success) {\n          return {\n            success: false,\n            error: saveResult.error,\n            retriesNeeded,\n          };\n        }\n\n        return { success: true, retriesNeeded };\n      } finally {\n        releaseLock(filePath);\n      }\n    }\n\n    // Wait before retry\n    retriesNeeded++;\n    await sleep(LOCK_RETRY_INTERVAL_MS);\n  }\n\n  return {\n    success: false,\n    error: `Could not acquire lock within ${LOCK_MAX_WAIT_MS}ms`,\n    retriesNeeded,\n  };\n}\n\n/**\n * Synchronous version of updateJSONWithLock\n *\n * @param filePath - Path to the JSON file\n * @param updateFn - Function that receives current data and returns updated data\n * @returns UpdateResult indicating success or failure\n */\nexport function updateJSONWithLockSync<T>(\n  filePath: string,\n  updateFn: (data: T) => T\n): UpdateResult {\n  const startTime = Date.now();\n  let retriesNeeded = 0;\n\n  // Try to acquire lock with timeout\n  while (Date.now() - startTime < LOCK_MAX_WAIT_MS) {\n    if (acquireLock(filePath)) {\n      try {\n        // Read current data\n        let data: T;\n        if (fs.existsSync(filePath)) {\n          const content = fs.readFileSync(filePath, 'utf-8');\n          data = JSON.parse(content) as T;\n        } else {\n          data = {} as T;\n        }\n\n        // Apply update\n        const updated = updateFn(data);\n\n        // Save atomically\n        const saveResult = saveJSONAtomicSync(filePath, updated);\n\n        if (!saveResult.success) {\n          return {\n            success: false,\n            error: saveResult.error,\n            retriesNeeded,\n          };\n        }\n\n        return { success: true, retriesNeeded };\n      } finally {\n        releaseLock(filePath);\n      }\n    }\n\n    // Wait before retry (synchronous)\n    retriesNeeded++;\n    sleepSync(LOCK_RETRY_INTERVAL_MS);\n  }\n\n  return {\n    success: false,\n    error: `Could not acquire lock within ${LOCK_MAX_WAIT_MS}ms`,\n    retriesNeeded,\n  };\n}\n\n/**\n * Load JSON file with error handling\n *\n * @param filePath - Path to the JSON file\n * @returns Parsed JSON data or null if file doesn't exist\n * @throws Error if file exists but is invalid JSON\n */\nexport function loadJSON<T>(filePath: string): T | null {\n  try {\n    if (!fs.existsSync(filePath)) {\n      return null;\n    }\n    const content = fs.readFileSync(filePath, 'utf-8');\n    return JSON.parse(content) as T;\n  } catch (error) {\n    throw new Error(\n      `Failed to load JSON from ${filePath}: ${error instanceof Error ? error.message : String(error)}`\n    );\n  }\n}\n\n/**\n * Ensure a directory exists\n *\n * @param dirPath - Directory path to ensure\n */\nexport function ensureDir(dirPath: string): void {\n  if (!fs.existsSync(dirPath)) {\n    fs.mkdirSync(dirPath, { recursive: true });\n  }\n}\n\n/**\n * Sleep for a given number of milliseconds (async)\n *\n * @param ms - Milliseconds to sleep\n */\nfunction sleep(ms: number): Promise<void> {\n  return new Promise((resolve) => setTimeout(resolve, ms));\n}\n\n/**\n * Sleep synchronously\n *\n * Note: This blocks the event loop. Use sparingly.\n *\n * @param ms - Milliseconds to sleep\n */\nfunction sleepSync(ms: number): void {\n  const end = Date.now() + ms;\n  while (Date.now() < end) {\n    // Busy wait\n  }\n}\n","/**\n * History Logging for LLKB\n *\n * Provides functions for logging LLKB events to history files.\n * History files are append-only JSONL (JSON Lines) format.\n *\n * @module llkb/history\n */\n\nimport * as fs from 'fs';\nimport * as path from 'path';\nimport type { HistoryEvent, LLKBConfig } from './types.js';\nimport { ensureDir } from './file-utils.js';\n\n/**\n * Default LLKB root directory\n */\nexport const DEFAULT_LLKB_ROOT = '.artk/llkb';\n\n/**\n * Get the history directory path\n *\n * @param llkbRoot - Root LLKB directory (default: .artk/llkb)\n * @returns Path to the history directory\n */\nexport function getHistoryDir(llkbRoot: string = DEFAULT_LLKB_ROOT): string {\n  return path.join(llkbRoot, 'history');\n}\n\n/**\n * Get the history file path for a specific date\n *\n * @param date - The date for the history file\n * @param llkbRoot - Root LLKB directory\n * @returns Path to the history file (YYYY-MM-DD.jsonl)\n */\nexport function getHistoryFilePath(\n  date: Date = new Date(),\n  llkbRoot: string = DEFAULT_LLKB_ROOT\n): string {\n  const dateStr = formatDate(date);\n  return path.join(getHistoryDir(llkbRoot), `${dateStr}.jsonl`);\n}\n\n/**\n * Format a date as YYYY-MM-DD\n *\n * @param date - The date to format\n * @returns Formatted date string\n */\nexport function formatDate(date: Date): string {\n  const year = date.getFullYear();\n  const month = String(date.getMonth() + 1).padStart(2, '0');\n  const day = String(date.getDate()).padStart(2, '0');\n  return `${year}-${month}-${day}`;\n}\n\n/**\n * Append an event to the history file\n *\n * Creates the history directory and file if they don't exist.\n * Uses graceful degradation - logs warning but doesn't throw on failure.\n *\n * @param event - The event to log\n * @param llkbRoot - Root LLKB directory\n * @returns true if successful, false otherwise\n *\n * @example\n * ```typescript\n * appendToHistory({\n *   event: 'lesson_applied',\n *   timestamp: new Date().toISOString(),\n *   lessonId: 'L001',\n *   success: true,\n *   prompt: 'journey-implement'\n * });\n * ```\n */\nexport function appendToHistory(\n  event: HistoryEvent,\n  llkbRoot: string = DEFAULT_LLKB_ROOT\n): boolean {\n  try {\n    const historyDir = getHistoryDir(llkbRoot);\n    ensureDir(historyDir);\n\n    const filePath = getHistoryFilePath(new Date(), llkbRoot);\n    const line = JSON.stringify(event) + '\\n';\n\n    fs.appendFileSync(filePath, line, 'utf-8');\n    return true;\n  } catch (error) {\n    // Graceful degradation - log warning but don't crash\n    console.warn(\n      `[LLKB] Failed to append to history: ${error instanceof Error ? error.message : String(error)}`\n    );\n    return false;\n  }\n}\n\n/**\n * Read events from a history file\n *\n * @param filePath - Path to the history file\n * @returns Array of events, or empty array if file doesn't exist\n */\nexport function readHistoryFile(filePath: string): HistoryEvent[] {\n  if (!fs.existsSync(filePath)) {\n    return [];\n  }\n\n  const content = fs.readFileSync(filePath, 'utf-8');\n  const lines = content.split('\\n').filter((line) => line.trim().length > 0);\n\n  return lines.map((line) => JSON.parse(line) as HistoryEvent);\n}\n\n/**\n * Read today's history events\n *\n * @param llkbRoot - Root LLKB directory\n * @returns Array of today's events\n */\nexport function readTodayHistory(llkbRoot: string = DEFAULT_LLKB_ROOT): HistoryEvent[] {\n  const filePath = getHistoryFilePath(new Date(), llkbRoot);\n  return readHistoryFile(filePath);\n}\n\n/**\n * Count events of a specific type from today's history\n *\n * @param eventType - The event type to count\n * @param filter - Optional additional filter function\n * @param llkbRoot - Root LLKB directory\n * @returns Count of matching events\n */\nexport function countTodayEvents(\n  eventType: HistoryEvent['event'],\n  filter?: (event: HistoryEvent) => boolean,\n  llkbRoot: string = DEFAULT_LLKB_ROOT\n): number {\n  const events = readTodayHistory(llkbRoot);\n\n  return events.filter((e) => {\n    if (e.event !== eventType) {\n      return false;\n    }\n    return filter ? filter(e) : true;\n  }).length;\n}\n\n/**\n * Count predictive extractions for today\n *\n * Used for rate limiting in journey-implement.\n *\n * @param llkbRoot - Root LLKB directory\n * @returns Number of predictive extractions today\n *\n * @example\n * ```typescript\n * const count = countPredictiveExtractionsToday();\n * if (count >= config.extraction.maxPredictivePerDay) {\n *   // Rate limit reached\n * }\n * ```\n */\nexport function countPredictiveExtractionsToday(\n  llkbRoot: string = DEFAULT_LLKB_ROOT\n): number {\n  return countTodayEvents(\n    'component_extracted',\n    (e) => e.event === 'component_extracted' && e.prompt === 'journey-implement',\n    llkbRoot\n  );\n}\n\n/**\n * Count predictive extractions for a specific journey today\n *\n * @param journeyId - The journey ID to check\n * @param llkbRoot - Root LLKB directory\n * @returns Number of extractions for this journey today\n */\nexport function countJourneyExtractionsToday(\n  journeyId: string,\n  llkbRoot: string = DEFAULT_LLKB_ROOT\n): number {\n  return countTodayEvents(\n    'component_extracted',\n    (e) =>\n      e.event === 'component_extracted' &&\n      e.prompt === 'journey-implement' &&\n      e.journeyId === journeyId,\n    llkbRoot\n  );\n}\n\n/**\n * Check if daily extraction rate limit is reached\n *\n * @param config - LLKB configuration\n * @param llkbRoot - Root LLKB directory\n * @returns true if rate limit is reached\n */\nexport function isDailyRateLimitReached(\n  config: LLKBConfig,\n  llkbRoot: string = DEFAULT_LLKB_ROOT\n): boolean {\n  const count = countPredictiveExtractionsToday(llkbRoot);\n  return count >= config.extraction.maxPredictivePerDay;\n}\n\n/**\n * Check if journey extraction rate limit is reached\n *\n * @param journeyId - The journey ID to check\n * @param config - LLKB configuration\n * @param llkbRoot - Root LLKB directory\n * @returns true if rate limit is reached\n */\nexport function isJourneyRateLimitReached(\n  journeyId: string,\n  config: LLKBConfig,\n  llkbRoot: string = DEFAULT_LLKB_ROOT\n): boolean {\n  const count = countJourneyExtractionsToday(journeyId, llkbRoot);\n  return count >= config.extraction.maxPredictivePerJourney;\n}\n\n/**\n * Get all history files in date range\n *\n * @param startDate - Start date (inclusive)\n * @param endDate - End date (inclusive)\n * @param llkbRoot - Root LLKB directory\n * @returns Array of history file paths\n */\nexport function getHistoryFilesInRange(\n  startDate: Date,\n  endDate: Date,\n  llkbRoot: string = DEFAULT_LLKB_ROOT\n): string[] {\n  const historyDir = getHistoryDir(llkbRoot);\n\n  if (!fs.existsSync(historyDir)) {\n    return [];\n  }\n\n  const files = fs.readdirSync(historyDir).filter((f) => f.endsWith('.jsonl'));\n  const results: string[] = [];\n\n  for (const file of files) {\n    const match = file.match(/^(\\d{4}-\\d{2}-\\d{2})\\.jsonl$/);\n    if (match?.[1]) {\n      const fileDate = new Date(match[1]);\n      if (fileDate >= startDate && fileDate <= endDate) {\n        results.push(path.join(historyDir, file));\n      }\n    }\n  }\n\n  return results.sort();\n}\n\n/**\n * Clean up old history files\n *\n * Deletes history files older than the retention period.\n *\n * @param retentionDays - Number of days to retain (default: 365)\n * @param llkbRoot - Root LLKB directory\n * @returns Array of deleted file paths\n */\nexport function cleanupOldHistoryFiles(\n  retentionDays: number = 365,\n  llkbRoot: string = DEFAULT_LLKB_ROOT\n): string[] {\n  const historyDir = getHistoryDir(llkbRoot);\n\n  if (!fs.existsSync(historyDir)) {\n    return [];\n  }\n\n  const files = fs.readdirSync(historyDir).filter((f) => f.endsWith('.jsonl'));\n  const now = new Date();\n  const cutoffDate = new Date();\n  cutoffDate.setDate(now.getDate() - retentionDays);\n\n  const deleted: string[] = [];\n\n  for (const file of files) {\n    const match = file.match(/^(\\d{4}-\\d{2}-\\d{2})\\.jsonl$/);\n    if (match?.[1]) {\n      const fileDate = new Date(match[1]);\n      if (fileDate < cutoffDate) {\n        const filePath = path.join(historyDir, file);\n        fs.unlinkSync(filePath);\n        deleted.push(filePath);\n      }\n    }\n  }\n\n  return deleted;\n}\n","/**\n * Analytics Update for LLKB\n *\n * Provides functions to calculate and update LLKB analytics.\n *\n * @module llkb/analytics\n */\n\nimport * as path from 'path';\nimport type {\n  LessonsFile,\n  ComponentsFile,\n  AnalyticsFile,\n  AnalyticsOverview,\n  LessonStats,\n  ComponentStats,\n  TopPerformerLesson,\n  TopPerformerComponent,\n  LLKBCategory,\n  ComponentCategory,\n  LLKBScope,\n} from './types.js';\nimport { loadJSON, saveJSONAtomicSync } from './file-utils.js';\nimport { detectDecliningConfidence, daysBetween } from './confidence.js';\n\n/**\n * Default LLKB root directory\n */\nconst DEFAULT_LLKB_ROOT = '.artk/llkb';\n\n/**\n * All valid lesson categories\n */\nconst ALL_CATEGORIES: LLKBCategory[] = [\n  'selector',\n  'timing',\n  'quirk',\n  'auth',\n  'data',\n  'assertion',\n  'navigation',\n  'ui-interaction',\n];\n\n/**\n * All valid component categories (excludes 'quirk')\n */\nconst COMPONENT_CATEGORIES: ComponentCategory[] = [\n  'selector',\n  'timing',\n  'auth',\n  'data',\n  'assertion',\n  'navigation',\n  'ui-interaction',\n];\n\n/**\n * All valid scopes\n */\nconst ALL_SCOPES: LLKBScope[] = [\n  'universal',\n  'framework:angular',\n  'framework:react',\n  'framework:vue',\n  'framework:ag-grid',\n  'app-specific',\n];\n\n/**\n * Update analytics.json based on current lessons and components\n *\n * This function recalculates all statistics and saves the updated analytics.\n *\n * @param llkbRoot - Root LLKB directory\n * @returns true if successful, false otherwise\n *\n * @example\n * ```typescript\n * // Call after modifying lessons or components\n * updateAnalytics();\n * ```\n */\nexport function updateAnalytics(llkbRoot: string = DEFAULT_LLKB_ROOT): boolean {\n  try {\n    // Load current data\n    const lessonsPath = path.join(llkbRoot, 'lessons.json');\n    const componentsPath = path.join(llkbRoot, 'components.json');\n    const analyticsPath = path.join(llkbRoot, 'analytics.json');\n\n    const lessons = loadJSON<LessonsFile>(lessonsPath);\n    const components = loadJSON<ComponentsFile>(componentsPath);\n    let analytics = loadJSON<AnalyticsFile>(analyticsPath);\n\n    if (!lessons || !components) {\n      console.warn('[LLKB] Cannot update analytics: lessons or components not found');\n      return false;\n    }\n\n    // Initialize analytics if not exists\n    if (!analytics) {\n      analytics = createEmptyAnalytics();\n    }\n\n    // Update all sections\n    analytics.overview = calculateOverview(lessons, components);\n    analytics.lessonStats = calculateLessonStats(lessons);\n    analytics.componentStats = calculateComponentStats(components);\n    analytics.topPerformers = calculateTopPerformers(lessons, components);\n    analytics.needsReview = calculateNeedsReview(lessons, components);\n    analytics.lastUpdated = new Date().toISOString();\n\n    // Save updated analytics\n    const result = saveJSONAtomicSync(analyticsPath, analytics);\n    return result.success;\n  } catch (error) {\n    console.error(\n      `[LLKB] Failed to update analytics: ${error instanceof Error ? error.message : String(error)}`\n    );\n    return false;\n  }\n}\n\n/**\n * Update analytics with provided data (for testing or when data is already loaded)\n *\n * @param lessons - Lessons data\n * @param components - Components data\n * @param analyticsPath - Path to save analytics\n * @returns true if successful\n */\nexport function updateAnalyticsWithData(\n  lessons: LessonsFile,\n  components: ComponentsFile,\n  analyticsPath: string\n): boolean {\n  try {\n    let analytics = loadJSON<AnalyticsFile>(analyticsPath) ?? createEmptyAnalytics();\n\n    analytics.overview = calculateOverview(lessons, components);\n    analytics.lessonStats = calculateLessonStats(lessons);\n    analytics.componentStats = calculateComponentStats(components);\n    analytics.topPerformers = calculateTopPerformers(lessons, components);\n    analytics.needsReview = calculateNeedsReview(lessons, components);\n    analytics.lastUpdated = new Date().toISOString();\n\n    const result = saveJSONAtomicSync(analyticsPath, analytics);\n    return result.success;\n  } catch (error) {\n    console.error(`[LLKB] Failed to update analytics: ${error}`);\n    return false;\n  }\n}\n\n/**\n * Create an empty analytics structure\n */\nexport function createEmptyAnalytics(): AnalyticsFile {\n  return {\n    version: '1.0.0',\n    lastUpdated: new Date().toISOString(),\n    overview: {\n      totalLessons: 0,\n      activeLessons: 0,\n      archivedLessons: 0,\n      totalComponents: 0,\n      activeComponents: 0,\n      archivedComponents: 0,\n    },\n    lessonStats: {\n      byCategory: Object.fromEntries(ALL_CATEGORIES.map((c) => [c, 0])) as Record<\n        LLKBCategory,\n        number\n      >,\n      avgConfidence: 0,\n      avgSuccessRate: 0,\n    },\n    componentStats: {\n      byCategory: Object.fromEntries(COMPONENT_CATEGORIES.map((c) => [c, 0])) as Record<\n        ComponentCategory,\n        number\n      >,\n      byScope: Object.fromEntries(ALL_SCOPES.map((s) => [s, 0])) as Record<LLKBScope, number>,\n      totalReuses: 0,\n      avgReusesPerComponent: 0,\n    },\n    impact: {\n      verifyIterationsSaved: 0,\n      avgIterationsBeforeLLKB: 0,\n      avgIterationsAfterLLKB: 0,\n      codeDeduplicationRate: 0,\n      estimatedHoursSaved: 0,\n    },\n    topPerformers: {\n      lessons: [],\n      components: [],\n    },\n    needsReview: {\n      lowConfidenceLessons: [],\n      lowUsageComponents: [],\n      decliningSuccessRate: [],\n    },\n  };\n}\n\n/**\n * Calculate overview statistics\n */\nfunction calculateOverview(\n  lessons: LessonsFile,\n  components: ComponentsFile\n): AnalyticsOverview {\n  const activeLessons = lessons.lessons.filter((l) => !l.archived);\n  const activeComponents = components.components.filter((c) => !c.archived);\n  const archivedComponents = components.components.filter((c) => c.archived);\n\n  return {\n    totalLessons: lessons.lessons.length,\n    activeLessons: activeLessons.length,\n    archivedLessons: (lessons.archived ?? []).length,\n    totalComponents: components.components.length,\n    activeComponents: activeComponents.length,\n    archivedComponents: archivedComponents.length,\n  };\n}\n\n/**\n * Calculate lesson statistics\n */\nfunction calculateLessonStats(lessons: LessonsFile): LessonStats {\n  const activeLessons = lessons.lessons.filter((l) => !l.archived);\n\n  // Count by category\n  const byCategory = Object.fromEntries(ALL_CATEGORIES.map((c) => [c, 0])) as Record<\n    LLKBCategory,\n    number\n  >;\n\n  for (const lesson of activeLessons) {\n    const category = lesson.category;\n    if (category in byCategory) {\n      byCategory[category]++;\n    }\n  }\n\n  // Calculate averages\n  let avgConfidence = 0;\n  let avgSuccessRate = 0;\n\n  if (activeLessons.length > 0) {\n    const confidenceSum = activeLessons.reduce((acc, l) => acc + l.metrics.confidence, 0);\n    const successRateSum = activeLessons.reduce((acc, l) => acc + l.metrics.successRate, 0);\n\n    avgConfidence = Math.round((confidenceSum / activeLessons.length) * 100) / 100;\n    avgSuccessRate = Math.round((successRateSum / activeLessons.length) * 100) / 100;\n  }\n\n  return {\n    byCategory,\n    avgConfidence,\n    avgSuccessRate,\n  };\n}\n\n/**\n * Calculate component statistics\n */\nfunction calculateComponentStats(components: ComponentsFile): ComponentStats {\n  const activeComponents = components.components.filter((c) => !c.archived);\n\n  // Count by category\n  const byCategory = Object.fromEntries(COMPONENT_CATEGORIES.map((c) => [c, 0])) as Record<\n    ComponentCategory,\n    number\n  >;\n\n  for (const comp of activeComponents) {\n    const category = comp.category;\n    if (category in byCategory) {\n      byCategory[category]++;\n    }\n  }\n\n  // Count by scope\n  const byScope = Object.fromEntries(ALL_SCOPES.map((s) => [s, 0])) as Record<\n    LLKBScope,\n    number\n  >;\n\n  for (const comp of activeComponents) {\n    const scope = comp.scope;\n    if (scope in byScope) {\n      byScope[scope]++;\n    }\n  }\n\n  // Calculate reuse metrics\n  let totalReuses = 0;\n  let avgReusesPerComponent = 0;\n\n  if (activeComponents.length > 0) {\n    totalReuses = activeComponents.reduce((acc, c) => acc + (c.metrics.totalUses ?? 0), 0);\n    avgReusesPerComponent = Math.round((totalReuses / activeComponents.length) * 100) / 100;\n  }\n\n  return {\n    byCategory,\n    byScope,\n    totalReuses,\n    avgReusesPerComponent,\n  };\n}\n\n/**\n * Calculate top performers\n */\nfunction calculateTopPerformers(\n  lessons: LessonsFile,\n  components: ComponentsFile\n): { lessons: TopPerformerLesson[]; components: TopPerformerComponent[] } {\n  const activeLessons = lessons.lessons.filter((l) => !l.archived);\n  const activeComponents = components.components.filter((c) => !c.archived);\n\n  // Top lessons by (successRate * occurrences)\n  const topLessons: TopPerformerLesson[] = activeLessons\n    .map((l) => ({\n      id: l.id,\n      title: l.title,\n      score: Math.round(l.metrics.successRate * l.metrics.occurrences * 100) / 100,\n    }))\n    .sort((a, b) => b.score - a.score)\n    .slice(0, 5);\n\n  // Top components by totalUses\n  const topComponents: TopPerformerComponent[] = activeComponents\n    .map((c) => ({\n      id: c.id,\n      name: c.name,\n      uses: c.metrics.totalUses ?? 0,\n    }))\n    .sort((a, b) => b.uses - a.uses)\n    .slice(0, 5);\n\n  return {\n    lessons: topLessons,\n    components: topComponents,\n  };\n}\n\n/**\n * Calculate items needing review\n */\nfunction calculateNeedsReview(\n  lessons: LessonsFile,\n  components: ComponentsFile\n): {\n  lowConfidenceLessons: string[];\n  lowUsageComponents: string[];\n  decliningSuccessRate: string[];\n} {\n  const activeLessons = lessons.lessons.filter((l) => !l.archived);\n  const activeComponents = components.components.filter((c) => !c.archived);\n  const now = new Date();\n\n  // Low confidence lessons (< 0.4)\n  const lowConfidenceLessons = activeLessons\n    .filter((l) => l.metrics.confidence < 0.4)\n    .map((l) => l.id);\n\n  // Lessons with declining success rate\n  const decliningSuccessRate = activeLessons\n    .filter((l) => detectDecliningConfidence(l))\n    .map((l) => l.id);\n\n  // Low usage components (< 2 uses and age > 30 days)\n  const lowUsageComponents = activeComponents\n    .filter((c) => {\n      const uses = c.metrics.totalUses ?? 0;\n      const extractedAt = new Date(c.source.extractedAt);\n      const age = daysBetween(now, extractedAt);\n      return uses < 2 && age > 30;\n    })\n    .map((c) => c.id);\n\n  return {\n    lowConfidenceLessons,\n    lowUsageComponents,\n    decliningSuccessRate,\n  };\n}\n\n/**\n * Get analytics summary as a formatted string\n *\n * @param llkbRoot - Root LLKB directory\n * @returns Formatted summary string\n */\nexport function getAnalyticsSummary(llkbRoot: string = DEFAULT_LLKB_ROOT): string {\n  const analyticsPath = path.join(llkbRoot, 'analytics.json');\n  const analytics = loadJSON<AnalyticsFile>(analyticsPath);\n\n  if (!analytics) {\n    return 'Analytics not available';\n  }\n\n  const o = analytics.overview;\n  const l = analytics.lessonStats;\n  const c = analytics.componentStats;\n\n  return [\n    `LLKB Analytics (${analytics.lastUpdated})`,\n    ''.repeat(50),\n    `Lessons: ${o.activeLessons} active, ${o.archivedLessons} archived`,\n    `  Avg Confidence: ${l.avgConfidence}`,\n    `  Avg Success Rate: ${l.avgSuccessRate}`,\n    `Components: ${o.activeComponents} active, ${o.archivedComponents} archived`,\n    `  Total Reuses: ${c.totalReuses}`,\n    `  Avg Reuses/Component: ${c.avgReusesPerComponent}`,\n    `Items Needing Review: ${analytics.needsReview.lowConfidenceLessons.length + analytics.needsReview.lowUsageComponents.length + analytics.needsReview.decliningSuccessRate.length}`,\n  ].join('\\n');\n}\n","/**\n * CLI Commands for LLKB\n *\n * Provides command-line interface functions for LLKB management.\n *\n * @module llkb/cli\n */\n\nimport * as fs from 'fs';\nimport * as path from 'path';\nimport type { LessonsFile, ComponentsFile, AnalyticsFile } from './types.js';\nimport { loadJSON } from './file-utils.js';\nimport { updateAnalytics } from './analytics.js';\nimport { cleanupOldHistoryFiles, readTodayHistory, getHistoryDir } from './history.js';\nimport { detectDecliningConfidence, needsConfidenceReview } from './confidence.js';\n\n/**\n * Default LLKB root directory\n */\nconst DEFAULT_LLKB_ROOT = '.artk/llkb';\n\n/**\n * Health check result\n */\nexport interface HealthCheckResult {\n  status: 'healthy' | 'warning' | 'error';\n  checks: HealthCheck[];\n  summary: string;\n}\n\n/**\n * Individual health check\n */\nexport interface HealthCheck {\n  name: string;\n  status: 'pass' | 'warn' | 'fail';\n  message: string;\n  details?: string;\n}\n\n/**\n * Stats result\n */\nexport interface StatsResult {\n  lessons: {\n    total: number;\n    active: number;\n    archived: number;\n    avgConfidence: number;\n    avgSuccessRate: number;\n    needsReview: number;\n  };\n  components: {\n    total: number;\n    active: number;\n    archived: number;\n    totalReuses: number;\n    avgReusesPerComponent: number;\n  };\n  history: {\n    todayEvents: number;\n    historyFiles: number;\n    oldestFile: string | null;\n    newestFile: string | null;\n  };\n}\n\n/**\n * Prune result\n */\nexport interface PruneResult {\n  historyFilesDeleted: number;\n  deletedFiles: string[];\n  archivedLessons: number;\n  archivedComponents: number;\n  errors: string[];\n}\n\n/**\n * Run health check on LLKB\n *\n * Verifies that:\n * - All required files exist\n * - JSON files are valid\n * - No data corruption detected\n * - Configuration is valid\n *\n * @param llkbRoot - Root LLKB directory\n * @returns Health check result\n *\n * @example\n * ```typescript\n * const result = runHealthCheck();\n * if (result.status === 'error') {\n *   console.error('LLKB needs attention:', result.summary);\n * }\n * ```\n */\nexport function runHealthCheck(llkbRoot: string = DEFAULT_LLKB_ROOT): HealthCheckResult {\n  const checks: HealthCheck[] = [];\n  let hasError = false;\n  let hasWarning = false;\n\n  // Check 1: Directory exists\n  if (fs.existsSync(llkbRoot)) {\n    checks.push({\n      name: 'Directory exists',\n      status: 'pass',\n      message: `LLKB directory found at ${llkbRoot}`,\n    });\n  } else {\n    checks.push({\n      name: 'Directory exists',\n      status: 'fail',\n      message: `LLKB directory not found at ${llkbRoot}`,\n    });\n    hasError = true;\n  }\n\n  // Check 2: Config file\n  const configPath = path.join(llkbRoot, 'config.yml');\n  if (fs.existsSync(configPath)) {\n    checks.push({\n      name: 'Config file',\n      status: 'pass',\n      message: 'config.yml found',\n    });\n  } else {\n    checks.push({\n      name: 'Config file',\n      status: 'warn',\n      message: 'config.yml not found - using defaults',\n    });\n    hasWarning = true;\n  }\n\n  // Check 3: Lessons file\n  const lessonsPath = path.join(llkbRoot, 'lessons.json');\n  const lessonsCheck = checkJSONFile<LessonsFile>(lessonsPath, 'lessons.json');\n  checks.push(lessonsCheck);\n  if (lessonsCheck.status === 'fail') hasError = true;\n  if (lessonsCheck.status === 'warn') hasWarning = true;\n\n  // Check 4: Components file\n  const componentsPath = path.join(llkbRoot, 'components.json');\n  const componentsCheck = checkJSONFile<ComponentsFile>(componentsPath, 'components.json');\n  checks.push(componentsCheck);\n  if (componentsCheck.status === 'fail') hasError = true;\n  if (componentsCheck.status === 'warn') hasWarning = true;\n\n  // Check 5: Analytics file\n  const analyticsPath = path.join(llkbRoot, 'analytics.json');\n  const analyticsCheck = checkJSONFile<AnalyticsFile>(analyticsPath, 'analytics.json');\n  checks.push(analyticsCheck);\n  if (analyticsCheck.status === 'fail') hasError = true;\n  if (analyticsCheck.status === 'warn') hasWarning = true;\n\n  // Check 6: History directory\n  const historyDir = getHistoryDir(llkbRoot);\n  if (fs.existsSync(historyDir)) {\n    const historyFiles = fs.readdirSync(historyDir).filter((f) => f.endsWith('.jsonl'));\n    checks.push({\n      name: 'History directory',\n      status: 'pass',\n      message: `History directory found with ${historyFiles.length} files`,\n    });\n  } else {\n    checks.push({\n      name: 'History directory',\n      status: 'warn',\n      message: 'History directory not found - will be created on first event',\n    });\n    hasWarning = true;\n  }\n\n  // Check 7: Low confidence lessons\n  // Only check if lessons.json was valid (checkJSONFile passed)\n  if (lessonsCheck.status === 'pass') {\n    try {\n      const lessons = loadJSON<LessonsFile>(lessonsPath);\n      if (lessons) {\n        const lowConfidence = lessons.lessons.filter(\n          (l) => !l.archived && needsConfidenceReview(l)\n        );\n        const declining = lessons.lessons.filter(\n          (l) => !l.archived && detectDecliningConfidence(l)\n        );\n\n        if (lowConfidence.length > 0 || declining.length > 0) {\n          checks.push({\n            name: 'Lesson health',\n            status: 'warn',\n            message: `${lowConfidence.length} low confidence, ${declining.length} declining`,\n            details: [\n              ...lowConfidence.map((l) => `Low confidence: ${l.id} (${l.metrics.confidence})`),\n              ...declining.map((l) => `Declining: ${l.id}`),\n            ].join(', '),\n          });\n          hasWarning = true;\n        } else {\n          checks.push({\n            name: 'Lesson health',\n            status: 'pass',\n            message: 'All lessons healthy',\n          });\n        }\n      }\n    } catch {\n      // Skip lesson health check if JSON is invalid (already flagged by checkJSONFile)\n    }\n  }\n\n  // Determine overall status\n  let status: 'healthy' | 'warning' | 'error';\n  let summary: string;\n\n  if (hasError) {\n    status = 'error';\n    summary = `LLKB has errors: ${checks.filter((c) => c.status === 'fail').length} failed checks`;\n  } else if (hasWarning) {\n    status = 'warning';\n    summary = `LLKB has warnings: ${checks.filter((c) => c.status === 'warn').length} warnings`;\n  } else {\n    status = 'healthy';\n    summary = 'LLKB is healthy';\n  }\n\n  return { status, checks, summary };\n}\n\n/**\n * Check a JSON file for validity\n */\nfunction checkJSONFile<T>(filePath: string, fileName: string): HealthCheck {\n  if (!fs.existsSync(filePath)) {\n    return {\n      name: fileName,\n      status: 'warn',\n      message: `${fileName} not found`,\n    };\n  }\n\n  try {\n    const content = fs.readFileSync(filePath, 'utf-8');\n    JSON.parse(content) as T;\n    return {\n      name: fileName,\n      status: 'pass',\n      message: `${fileName} is valid JSON`,\n    };\n  } catch (error) {\n    return {\n      name: fileName,\n      status: 'fail',\n      message: `${fileName} is invalid JSON`,\n      details: error instanceof Error ? error.message : String(error),\n    };\n  }\n}\n\n/**\n * Get LLKB statistics\n *\n * @param llkbRoot - Root LLKB directory\n * @returns Statistics about LLKB contents\n *\n * @example\n * ```typescript\n * const stats = getStats();\n * console.log(`Total lessons: ${stats.lessons.total}`);\n * console.log(`Total reuses: ${stats.components.totalReuses}`);\n * ```\n */\nexport function getStats(llkbRoot: string = DEFAULT_LLKB_ROOT): StatsResult {\n  const lessonsPath = path.join(llkbRoot, 'lessons.json');\n  const componentsPath = path.join(llkbRoot, 'components.json');\n  const historyDir = getHistoryDir(llkbRoot);\n\n  // Lessons stats\n  const lessons = loadJSON<LessonsFile>(lessonsPath);\n  const activeLessons = lessons?.lessons.filter((l) => !l.archived) ?? [];\n  const archivedLessons = lessons?.archived ?? [];\n\n  let avgConfidence = 0;\n  let avgSuccessRate = 0;\n  let needsReview = 0;\n\n  if (activeLessons.length > 0) {\n    avgConfidence =\n      Math.round(\n        (activeLessons.reduce((acc, l) => acc + l.metrics.confidence, 0) /\n          activeLessons.length) *\n          100\n      ) / 100;\n    avgSuccessRate =\n      Math.round(\n        (activeLessons.reduce((acc, l) => acc + l.metrics.successRate, 0) /\n          activeLessons.length) *\n          100\n      ) / 100;\n    needsReview = activeLessons.filter(\n      (l) => needsConfidenceReview(l) || detectDecliningConfidence(l)\n    ).length;\n  }\n\n  // Components stats\n  const components = loadJSON<ComponentsFile>(componentsPath);\n  const activeComponents = components?.components.filter((c) => !c.archived) ?? [];\n  const archivedComponents = components?.components.filter((c) => c.archived) ?? [];\n\n  let totalReuses = 0;\n  let avgReusesPerComponent = 0;\n\n  if (activeComponents.length > 0) {\n    totalReuses = activeComponents.reduce((acc, c) => acc + (c.metrics.totalUses ?? 0), 0);\n    avgReusesPerComponent =\n      Math.round((totalReuses / activeComponents.length) * 100) / 100;\n  }\n\n  // History stats\n  let todayEvents = 0;\n  let historyFiles = 0;\n  let oldestFile: string | null = null;\n  let newestFile: string | null = null;\n\n  if (fs.existsSync(historyDir)) {\n    const files = fs\n      .readdirSync(historyDir)\n      .filter((f) => f.endsWith('.jsonl'))\n      .sort();\n\n    historyFiles = files.length;\n    if (files.length > 0) {\n      oldestFile = files[0] ?? null;\n      newestFile = files[files.length - 1] ?? null;\n    }\n\n    todayEvents = readTodayHistory(llkbRoot).length;\n  }\n\n  return {\n    lessons: {\n      total: (lessons?.lessons.length ?? 0) + archivedLessons.length,\n      active: activeLessons.length,\n      archived: archivedLessons.length,\n      avgConfidence,\n      avgSuccessRate,\n      needsReview,\n    },\n    components: {\n      total: components?.components.length ?? 0,\n      active: activeComponents.length,\n      archived: archivedComponents.length,\n      totalReuses,\n      avgReusesPerComponent,\n    },\n    history: {\n      todayEvents,\n      historyFiles,\n      oldestFile,\n      newestFile,\n    },\n  };\n}\n\n/**\n * Prune old history files and optionally archive stale items\n *\n * @param options - Prune options\n * @returns Prune result with counts of deleted/archived items\n *\n * @example\n * ```typescript\n * const result = prune({ historyRetentionDays: 90 });\n * console.log(`Deleted ${result.historyFilesDeleted} old history files`);\n * ```\n */\nexport function prune(\n  options: {\n    llkbRoot?: string;\n    historyRetentionDays?: number;\n    archiveInactiveLessons?: boolean;\n    archiveInactiveComponents?: boolean;\n    inactiveDays?: number;\n  } = {}\n): PruneResult {\n  const {\n    llkbRoot = DEFAULT_LLKB_ROOT,\n    historyRetentionDays = 365,\n    archiveInactiveLessons = false,\n    archiveInactiveComponents = false,\n    inactiveDays = 180,\n  } = options;\n\n  const result: PruneResult = {\n    historyFilesDeleted: 0,\n    deletedFiles: [],\n    archivedLessons: 0,\n    archivedComponents: 0,\n    errors: [],\n  };\n\n  // Clean up old history files\n  try {\n    const deletedFiles = cleanupOldHistoryFiles(historyRetentionDays, llkbRoot);\n    result.historyFilesDeleted = deletedFiles.length;\n    result.deletedFiles = deletedFiles;\n  } catch (error) {\n    result.errors.push(\n      `Failed to clean history files: ${error instanceof Error ? error.message : String(error)}`\n    );\n  }\n\n  // Archive inactive lessons\n  if (archiveInactiveLessons) {\n    try {\n      const archivedCount = archiveInactiveItems(\n        path.join(llkbRoot, 'lessons.json'),\n        'lessons',\n        inactiveDays\n      );\n      result.archivedLessons = archivedCount;\n    } catch (error) {\n      result.errors.push(\n        `Failed to archive lessons: ${error instanceof Error ? error.message : String(error)}`\n      );\n    }\n  }\n\n  // Archive inactive components\n  if (archiveInactiveComponents) {\n    try {\n      const archivedCount = archiveInactiveItems(\n        path.join(llkbRoot, 'components.json'),\n        'components',\n        inactiveDays\n      );\n      result.archivedComponents = archivedCount;\n    } catch (error) {\n      result.errors.push(\n        `Failed to archive components: ${error instanceof Error ? error.message : String(error)}`\n      );\n    }\n  }\n\n  // Update analytics after pruning\n  try {\n    updateAnalytics(llkbRoot);\n  } catch (error) {\n    result.errors.push(\n      `Failed to update analytics: ${error instanceof Error ? error.message : String(error)}`\n    );\n  }\n\n  return result;\n}\n\n/**\n * Archive items that haven't been used in a specified number of days\n */\nfunction archiveInactiveItems(\n  filePath: string,\n  itemsKey: 'lessons' | 'components',\n  inactiveDays: number\n): number {\n  if (!fs.existsSync(filePath)) {\n    return 0;\n  }\n\n  const content = fs.readFileSync(filePath, 'utf-8');\n  const data = JSON.parse(content) as Record<string, unknown>;\n  const items = data[itemsKey] as Array<{\n    archived?: boolean;\n    metrics: { lastSuccess?: string; lastUsed?: string };\n  }>;\n\n  if (!Array.isArray(items)) {\n    return 0;\n  }\n\n  const now = new Date();\n  const cutoffDate = new Date();\n  cutoffDate.setDate(now.getDate() - inactiveDays);\n\n  let archivedCount = 0;\n\n  for (const item of items) {\n    if (item.archived) continue;\n\n    const lastUsedStr = item.metrics.lastSuccess ?? item.metrics.lastUsed;\n    if (!lastUsedStr) continue;\n\n    const lastUsed = new Date(lastUsedStr);\n    if (lastUsed < cutoffDate) {\n      item.archived = true;\n      archivedCount++;\n    }\n  }\n\n  if (archivedCount > 0) {\n    fs.writeFileSync(filePath, JSON.stringify(data, null, 2), 'utf-8');\n  }\n\n  return archivedCount;\n}\n\n/**\n * Format health check result for console output\n *\n * @param result - Health check result\n * @returns Formatted string for console\n */\nexport function formatHealthCheck(result: HealthCheckResult): string {\n  const lines: string[] = [];\n  const statusIcon = result.status === 'healthy' ? '' : result.status === 'warning' ? '' : '';\n\n  lines.push(`${statusIcon} LLKB Health Check: ${result.status.toUpperCase()}`);\n  lines.push(''.repeat(50));\n\n  for (const check of result.checks) {\n    const icon = check.status === 'pass' ? '' : check.status === 'warn' ? '' : '';\n    lines.push(`${icon} ${check.name}: ${check.message}`);\n    if (check.details) {\n      lines.push(`  ${check.details}`);\n    }\n  }\n\n  lines.push(''.repeat(50));\n  lines.push(result.summary);\n\n  return lines.join('\\n');\n}\n\n/**\n * Format stats result for console output\n *\n * @param stats - Stats result\n * @returns Formatted string for console\n */\nexport function formatStats(stats: StatsResult): string {\n  const lines: string[] = [];\n\n  lines.push('LLKB Statistics');\n  lines.push(''.repeat(50));\n\n  lines.push('');\n  lines.push('Lessons:');\n  lines.push(`  Total: ${stats.lessons.total} (${stats.lessons.active} active, ${stats.lessons.archived} archived)`);\n  lines.push(`  Avg Confidence: ${stats.lessons.avgConfidence}`);\n  lines.push(`  Avg Success Rate: ${stats.lessons.avgSuccessRate}`);\n  lines.push(`  Needs Review: ${stats.lessons.needsReview}`);\n\n  lines.push('');\n  lines.push('Components:');\n  lines.push(`  Total: ${stats.components.total} (${stats.components.active} active, ${stats.components.archived} archived)`);\n  lines.push(`  Total Reuses: ${stats.components.totalReuses}`);\n  lines.push(`  Avg Reuses/Component: ${stats.components.avgReusesPerComponent}`);\n\n  lines.push('');\n  lines.push('History:');\n  lines.push(`  Today's Events: ${stats.history.todayEvents}`);\n  lines.push(`  History Files: ${stats.history.historyFiles}`);\n  if (stats.history.oldestFile) {\n    lines.push(`  Date Range: ${stats.history.oldestFile} to ${stats.history.newestFile}`);\n  }\n\n  return lines.join('\\n');\n}\n\n/**\n * Format prune result for console output\n *\n * @param result - Prune result\n * @returns Formatted string for console\n */\nexport function formatPruneResult(result: PruneResult): string {\n  const lines: string[] = [];\n\n  lines.push('LLKB Prune Results');\n  lines.push(''.repeat(50));\n\n  lines.push(`History files deleted: ${result.historyFilesDeleted}`);\n  if (result.archivedLessons > 0) {\n    lines.push(`Lessons archived: ${result.archivedLessons}`);\n  }\n  if (result.archivedComponents > 0) {\n    lines.push(`Components archived: ${result.archivedComponents}`);\n  }\n\n  if (result.errors.length > 0) {\n    lines.push('');\n    lines.push('Errors:');\n    for (const error of result.errors) {\n      lines.push(`   ${error}`);\n    }\n  }\n\n  return lines.join('\\n');\n}\n","/**\n * LLKB Data Loaders\n *\n * Functions for loading and validating LLKB configuration and data files.\n *\n * @module @artk/llkb/loaders\n */\n\nimport { existsSync, readFileSync, readdirSync } from 'node:fs';\nimport { join } from 'node:path';\nimport { loadJSON } from './file-utils.js';\nimport type {\n  LLKBConfig,\n  LessonsFile,\n  ComponentsFile,\n  Lesson,\n  Component,\n  LLKBCategory,\n  LLKBScope,\n} from './types.js';\n\n// =============================================================================\n// Types\n// =============================================================================\n\n/**\n * App profile structure from app-profile.json\n */\nexport interface AppProfile {\n  version: string;\n  createdBy: string;\n  lastUpdated: string;\n  application: {\n    name: string;\n    framework: 'angular' | 'react' | 'vue' | 'nextjs' | 'other';\n    uiLibrary: 'material' | 'antd' | 'primeng' | 'bootstrap' | 'custom' | 'none';\n    dataGrid: 'ag-grid' | 'tanstack-table' | 'custom' | 'none';\n    authProvider: 'azure-ad' | 'okta' | 'auth0' | 'cognito' | 'custom' | 'none';\n    stateManagement: 'ngrx' | 'redux' | 'zustand' | 'none';\n  };\n  testability: {\n    testIdAttribute: string;\n    testIdCoverage: 'high' | 'medium' | 'low';\n    ariaCoverage: 'high' | 'medium' | 'low';\n    asyncComplexity: 'high' | 'medium' | 'low';\n  };\n  environment: {\n    baseUrls: Record<string, string>;\n    authBypass: {\n      available: boolean;\n      method: 'storage-state' | 'api-token' | 'mock-user' | 'none';\n    };\n  };\n}\n\n/**\n * Pattern file structure\n */\nexport interface PatternFile {\n  version: string;\n  [key: string]: unknown;\n}\n\n/**\n * Selector patterns file\n */\nexport interface SelectorPatterns extends PatternFile {\n  selectorPriority: {\n    order: Array<{\n      type: string;\n      reliability: number;\n      note?: string;\n    }>;\n  };\n  selectorPatterns: Array<{\n    id: string;\n    name: string;\n    context: string;\n    problem: string;\n    solution: string;\n    template: string;\n    applicableTo: string[];\n    confidence: number;\n  }>;\n  avoidSelectors: Array<{\n    pattern: string;\n    reason: string;\n  }>;\n  preferredSelectors: Array<{\n    pattern: string;\n    priority: number;\n    reason: string;\n  }>;\n}\n\n/**\n * Timing patterns file\n */\nexport interface TimingPatterns extends PatternFile {\n  asyncPatterns: Array<{\n    id: string;\n    name: string;\n    context: string;\n    pattern: string;\n    observedDelays: {\n      min: number;\n      avg: number;\n      max: number;\n      p95: number;\n    };\n    recommendation: string;\n  }>;\n  loadingIndicators: Array<{\n    component: string;\n    indicator: string;\n    avgLoadTime: number;\n    maxObservedTime: number;\n    waitStrategy: string;\n  }>;\n  networkPatterns: Array<{\n    endpoint: string;\n    avgResponseTime: number;\n    p95ResponseTime: number;\n    retryRecommended: boolean;\n    maxRetries: number;\n  }>;\n  forbiddenPatterns: Array<{\n    pattern: string;\n    severity: 'error' | 'warning';\n    alternative: string;\n  }>;\n}\n\n/**\n * Assertion patterns file\n */\nexport interface AssertionPatterns extends PatternFile {\n  commonAssertions: Array<{\n    id: string;\n    name: string;\n    pattern: string;\n    usageContext: string;\n    componentRef?: string;\n  }>;\n  assertionHelpers: Array<{\n    name: string;\n    module: string;\n    signature: string;\n    scope: LLKBScope;\n  }>;\n}\n\n/**\n * All patterns combined\n */\nexport interface LLKBPatterns {\n  selectors?: SelectorPatterns;\n  timing?: TimingPatterns;\n  assertions?: AssertionPatterns;\n  data?: PatternFile;\n  auth?: PatternFile;\n}\n\n/**\n * Filter options for loading lessons\n */\nexport interface LessonFilterOptions {\n  category?: LLKBCategory | LLKBCategory[];\n  scope?: LLKBScope | LLKBScope[];\n  minConfidence?: number;\n  tags?: string[];\n  includeArchived?: boolean;\n}\n\n/**\n * Filter options for loading components\n */\nexport interface ComponentFilterOptions {\n  category?: LLKBCategory | LLKBCategory[];\n  scope?: LLKBScope | LLKBScope[];\n  minConfidence?: number;\n  includeArchived?: boolean;\n}\n\n/**\n * Loaded LLKB data bundle\n */\nexport interface LLKBData {\n  config: LLKBConfig;\n  appProfile: AppProfile | null;\n  lessons: LessonsFile;\n  components: ComponentsFile;\n  patterns: LLKBPatterns;\n}\n\n// =============================================================================\n// Default Configuration\n// =============================================================================\n\n/**\n * Default LLKB configuration when config.yml doesn't exist\n */\nexport const DEFAULT_LLKB_CONFIG: LLKBConfig = {\n  version: '1.0.0',\n  enabled: true,\n  extraction: {\n    minOccurrences: 2,\n    predictiveExtraction: true,\n    confidenceThreshold: 0.7,\n    maxPredictivePerDay: 5,\n    maxPredictivePerJourney: 2,\n    minLinesForExtraction: 3,\n    similarityThreshold: 0.8,\n  },\n  retention: {\n    maxLessonAge: 90,\n    minSuccessRate: 0.6,\n    archiveUnused: 30,\n  },\n  injection: {\n    prioritizeByConfidence: true,\n  },\n  scopes: {\n    universal: true,\n    frameworkSpecific: true,\n    appSpecific: true,\n  },\n  history: {\n    retentionDays: 365,\n  },\n  overrides: {\n    allowUserOverride: true,\n    logOverrides: true,\n    flagAfterOverrides: 3,\n  },\n};\n\n// =============================================================================\n// Config Loader\n// =============================================================================\n\n/**\n * Load LLKB configuration from config.yml\n *\n * @param llkbRoot - Root directory of LLKB (default: .artk/llkb)\n * @returns Loaded config or default if not found\n */\nexport function loadLLKBConfig(llkbRoot: string = '.artk/llkb'): LLKBConfig {\n  const configPath = join(llkbRoot, 'config.yml');\n\n  if (!existsSync(configPath)) {\n    return { ...DEFAULT_LLKB_CONFIG };\n  }\n\n  try {\n    const content = readFileSync(configPath, 'utf-8');\n\n    // Simple YAML parsing for the config structure\n    // For production, consider using a proper YAML parser\n    const config = parseSimpleYAML(content);\n\n    // Merge with defaults to ensure all fields exist\n    return mergeConfig(DEFAULT_LLKB_CONFIG, config);\n  } catch {\n    return { ...DEFAULT_LLKB_CONFIG };\n  }\n}\n\n/**\n * Simple YAML parser for config files\n * Handles basic key: value and nested structures\n */\nfunction parseSimpleYAML(content: string): Partial<LLKBConfig> {\n  const result: Record<string, unknown> = {};\n  const lines = content.split('\\n');\n  const stack: Array<{ obj: Record<string, unknown>; indent: number }> = [{ obj: result, indent: -1 }];\n\n  for (const line of lines) {\n    // Skip empty lines and comments\n    if (!line.trim() || line.trim().startsWith('#')) {\n      continue;\n    }\n\n    const indent = line.search(/\\S/);\n    const trimmed = line.trim();\n\n    // Check if it's a key: value pair\n    const colonIndex = trimmed.indexOf(':');\n    if (colonIndex === -1) continue;\n\n    const key = trimmed.substring(0, colonIndex).trim();\n    const valueStr = trimmed.substring(colonIndex + 1).trim();\n\n    // Pop stack until we find the right parent\n    while (stack.length > 1) {\n      const top = stack[stack.length - 1];\n      if (!top || top.indent < indent) break;\n      stack.pop();\n    }\n\n    const top = stack[stack.length - 1];\n    if (!top) continue;\n    const parent = top.obj;\n\n    if (valueStr === '' || valueStr === '|' || valueStr === '>') {\n      // Nested object\n      const newObj: Record<string, unknown> = {};\n      parent[key] = newObj;\n      stack.push({ obj: newObj, indent });\n    } else {\n      // Parse value\n      parent[key] = parseYAMLValue(valueStr);\n    }\n  }\n\n  return result as Partial<LLKBConfig>;\n}\n\n/**\n * Parse a YAML value string\n */\nfunction parseYAMLValue(value: string): unknown {\n  // Remove quotes\n  if ((value.startsWith('\"') && value.endsWith('\"')) || (value.startsWith(\"'\") && value.endsWith(\"'\"))) {\n    return value.slice(1, -1);\n  }\n\n  // Boolean\n  if (value === 'true') return true;\n  if (value === 'false') return false;\n\n  // Number\n  const num = Number(value);\n  if (!isNaN(num)) return num;\n\n  // String\n  return value;\n}\n\n/**\n * Deep merge config with defaults\n */\nfunction mergeConfig(defaults: LLKBConfig, overrides: Partial<LLKBConfig>): LLKBConfig {\n  const result = { ...defaults } as Record<string, unknown>;\n\n  for (const key of Object.keys(overrides) as (keyof LLKBConfig)[]) {\n    const override = overrides[key];\n    if (override !== undefined) {\n      if (typeof override === 'object' && override !== null && !Array.isArray(override)) {\n        // Deep merge nested objects\n        const defaultValue = defaults[key];\n        result[key] = {\n          ...(typeof defaultValue === 'object' && defaultValue !== null ? defaultValue : {}),\n          ...(override as object),\n        };\n      } else {\n        result[key] = override;\n      }\n    }\n  }\n\n  return result as unknown as LLKBConfig;\n}\n\n/**\n * Check if LLKB is enabled\n */\nexport function isLLKBEnabled(llkbRoot: string = '.artk/llkb'): boolean {\n  if (!existsSync(llkbRoot)) {\n    return false;\n  }\n\n  const config = loadLLKBConfig(llkbRoot);\n  return config.enabled;\n}\n\n// =============================================================================\n// App Profile Loader\n// =============================================================================\n\n/**\n * Load app profile from app-profile.json\n *\n * @param llkbRoot - Root directory of LLKB\n * @returns App profile or null if not found\n */\nexport function loadAppProfile(llkbRoot: string = '.artk/llkb'): AppProfile | null {\n  const profilePath = join(llkbRoot, 'app-profile.json');\n  return loadJSON<AppProfile>(profilePath);\n}\n\n// =============================================================================\n// Lessons Loader\n// =============================================================================\n\n/**\n * Load lessons file\n *\n * @param llkbRoot - Root directory of LLKB\n * @returns Lessons file or empty structure\n */\nexport function loadLessonsFile(llkbRoot: string = '.artk/llkb'): LessonsFile {\n  const lessonsPath = join(llkbRoot, 'lessons.json');\n  const data = loadJSON<LessonsFile>(lessonsPath);\n\n  if (!data) {\n    return {\n      version: '1.0.0',\n      lastUpdated: new Date().toISOString(),\n      lessons: [],\n      archived: [],\n      globalRules: [],\n      appQuirks: [],\n    };\n  }\n\n  return data;\n}\n\n/**\n * Load lessons with optional filtering\n *\n * @param llkbRoot - Root directory of LLKB\n * @param options - Filter options\n * @returns Filtered lessons array\n */\nexport function loadLessons(\n  llkbRoot: string = '.artk/llkb',\n  options: LessonFilterOptions = {}\n): Lesson[] {\n  const lessonsFile = loadLessonsFile(llkbRoot);\n  let lessons = lessonsFile.lessons;\n\n  // Filter archived\n  if (!options.includeArchived) {\n    lessons = lessons.filter((l) => !l.archived);\n  }\n\n  // Filter by category\n  if (options.category) {\n    const categories = Array.isArray(options.category) ? options.category : [options.category];\n    lessons = lessons.filter((l) => categories.includes(l.category));\n  }\n\n  // Filter by scope\n  if (options.scope) {\n    const scopes = Array.isArray(options.scope) ? options.scope : [options.scope];\n    lessons = lessons.filter((l) => scopes.includes(l.scope));\n  }\n\n  // Filter by minimum confidence\n  if (options.minConfidence !== undefined) {\n    lessons = lessons.filter((l) => l.metrics.confidence >= options.minConfidence!);\n  }\n\n  // Filter by tags\n  if (options.tags && options.tags.length > 0) {\n    lessons = lessons.filter((l) => l.tags && options.tags!.some((tag) => l.tags!.includes(tag)));\n  }\n\n  return lessons;\n}\n\n// =============================================================================\n// Components Loader\n// =============================================================================\n\n/**\n * Load components file\n *\n * @param llkbRoot - Root directory of LLKB\n * @returns Components file or empty structure\n */\nexport function loadComponentsFile(llkbRoot: string = '.artk/llkb'): ComponentsFile {\n  const componentsPath = join(llkbRoot, 'components.json');\n  const data = loadJSON<ComponentsFile>(componentsPath);\n\n  if (!data) {\n    return {\n      version: '1.0.0',\n      lastUpdated: new Date().toISOString(),\n      components: [],\n      componentsByCategory: {\n        selector: [],\n        timing: [],\n        auth: [],\n        data: [],\n        assertion: [],\n        navigation: [],\n        'ui-interaction': [],\n      },\n      componentsByScope: {\n        universal: [],\n        'framework:angular': [],\n        'framework:react': [],\n        'framework:vue': [],\n        'framework:ag-grid': [],\n        'app-specific': [],\n      },\n    };\n  }\n\n  return data;\n}\n\n/**\n * Load components with optional filtering\n *\n * @param llkbRoot - Root directory of LLKB\n * @param options - Filter options\n * @returns Filtered components array\n */\nexport function loadComponents(\n  llkbRoot: string = '.artk/llkb',\n  options: ComponentFilterOptions = {}\n): Component[] {\n  const componentsFile = loadComponentsFile(llkbRoot);\n  let components = componentsFile.components;\n\n  // Filter archived\n  if (!options.includeArchived) {\n    components = components.filter((c) => !c.archived);\n  }\n\n  // Filter by category\n  if (options.category) {\n    const categories = Array.isArray(options.category) ? options.category : [options.category];\n    components = components.filter((c) => categories.includes(c.category));\n  }\n\n  // Filter by scope\n  if (options.scope) {\n    const scopes = Array.isArray(options.scope) ? options.scope : [options.scope];\n    components = components.filter((c) => scopes.includes(c.scope));\n  }\n\n  // Filter by minimum confidence (uses successRate as proxy for confidence)\n  if (options.minConfidence !== undefined) {\n    components = components.filter((c) => c.metrics.successRate >= options.minConfidence!);\n  }\n\n  return components;\n}\n\n// =============================================================================\n// Pattern Loaders\n// =============================================================================\n\n/**\n * Load all pattern files\n *\n * @param llkbRoot - Root directory of LLKB\n * @returns All loaded patterns\n */\nexport function loadPatterns(llkbRoot: string = '.artk/llkb'): LLKBPatterns {\n  const patternsDir = join(llkbRoot, 'patterns');\n\n  if (!existsSync(patternsDir)) {\n    return {};\n  }\n\n  const patterns: LLKBPatterns = {};\n\n  // Load each pattern file if it exists\n  const selectorPatterns = loadJSON<SelectorPatterns>(join(patternsDir, 'selectors.json'));\n  if (selectorPatterns) {\n    patterns.selectors = selectorPatterns;\n  }\n\n  const timingPatterns = loadJSON<TimingPatterns>(join(patternsDir, 'timing.json'));\n  if (timingPatterns) {\n    patterns.timing = timingPatterns;\n  }\n\n  const assertionPatterns = loadJSON<AssertionPatterns>(join(patternsDir, 'assertions.json'));\n  if (assertionPatterns) {\n    patterns.assertions = assertionPatterns;\n  }\n\n  const dataPatterns = loadJSON<PatternFile>(join(patternsDir, 'data.json'));\n  if (dataPatterns) {\n    patterns.data = dataPatterns;\n  }\n\n  const authPatterns = loadJSON<PatternFile>(join(patternsDir, 'auth.json'));\n  if (authPatterns) {\n    patterns.auth = authPatterns;\n  }\n\n  return patterns;\n}\n\n/**\n * Load a specific pattern file\n *\n * @param llkbRoot - Root directory of LLKB\n * @param patternName - Name of the pattern file (without .json)\n * @returns Pattern file or null\n */\nexport function loadPatternFile<T extends PatternFile>(\n  llkbRoot: string,\n  patternName: string\n): T | null {\n  const patternPath = join(llkbRoot, 'patterns', `${patternName}.json`);\n  return loadJSON<T>(patternPath);\n}\n\n// =============================================================================\n// Full LLKB Loader\n// =============================================================================\n\n/**\n * Load all LLKB data in one call\n *\n * @param llkbRoot - Root directory of LLKB\n * @returns Complete LLKB data bundle\n */\nexport function loadLLKBData(llkbRoot: string = '.artk/llkb'): LLKBData {\n  return {\n    config: loadLLKBConfig(llkbRoot),\n    appProfile: loadAppProfile(llkbRoot),\n    lessons: loadLessonsFile(llkbRoot),\n    components: loadComponentsFile(llkbRoot),\n    patterns: loadPatterns(llkbRoot),\n  };\n}\n\n/**\n * Check if LLKB exists at the given path\n *\n * @param llkbRoot - Root directory to check\n * @returns True if LLKB structure exists\n */\nexport function llkbExists(llkbRoot: string = '.artk/llkb'): boolean {\n  return existsSync(llkbRoot) && existsSync(join(llkbRoot, 'config.yml'));\n}\n\n/**\n * Get list of all pattern file names in the patterns directory\n *\n * @param llkbRoot - Root directory of LLKB\n * @returns Array of pattern file names (without .json extension)\n */\nexport function getPatternFileNames(llkbRoot: string = '.artk/llkb'): string[] {\n  const patternsDir = join(llkbRoot, 'patterns');\n\n  if (!existsSync(patternsDir)) {\n    return [];\n  }\n\n  try {\n    return readdirSync(patternsDir)\n      .filter((f) => f.endsWith('.json'))\n      .map((f) => f.replace('.json', ''));\n  } catch {\n    return [];\n  }\n}\n","/**\n * LLKB Context Injection\n *\n * Functions for filtering and prioritizing LLKB data based on journey context.\n * Used to inject relevant lessons, components, and patterns into prompts.\n *\n * @module @artk/llkb/context\n */\n\nimport type {\n  Lesson,\n  Component,\n  LLKBConfig,\n  LLKBScope,\n  LLKBCategory,\n} from './types.js';\nimport type { AppProfile, LLKBPatterns, SelectorPatterns, TimingPatterns } from './loaders.js';\nimport { tokenize } from './normalize.js';\n\n// =============================================================================\n// Types\n// =============================================================================\n\n/**\n * Journey context for filtering LLKB data\n */\nexport interface JourneyContext {\n  /** Journey ID (e.g., JRN-0001) */\n  id: string;\n  /** Journey scope (e.g., \"orders\", \"catalog\") */\n  scope: string;\n  /** Journey title */\n  title: string;\n  /** Inferred routes from journey */\n  routes?: string[];\n  /** Keywords extracted from journey steps */\n  keywords?: string[];\n  /** Categories of actions in the journey */\n  categories?: LLKBCategory[];\n}\n\n/**\n * Filtered and prioritized LLKB context\n */\nexport interface RelevantContext {\n  /** Filtered lessons sorted by relevance */\n  lessons: ScoredLesson[];\n  /** Filtered components sorted by relevance */\n  components: ScoredComponent[];\n  /** Relevant app quirks */\n  quirks: AppQuirkInfo[];\n  /** Relevant selector patterns */\n  selectorPatterns: SelectorPatternInfo[];\n  /** Relevant timing patterns */\n  timingPatterns: TimingPatternInfo[];\n  /** Summary statistics */\n  summary: ContextSummary;\n}\n\n/**\n * Lesson with relevance score\n */\nexport interface ScoredLesson extends Lesson {\n  relevanceScore: number;\n  matchReasons: string[];\n}\n\n/**\n * Component with relevance score\n */\nexport interface ScoredComponent extends Component {\n  relevanceScore: number;\n  matchReasons: string[];\n}\n\n/**\n * App quirk info for context\n */\nexport interface AppQuirkInfo {\n  id: string;\n  component: string;\n  location: string;\n  quirk: string;\n  impact: string;\n  workaround: string;\n}\n\n/**\n * Selector pattern info for context\n */\nexport interface SelectorPatternInfo {\n  id: string;\n  name: string;\n  template: string;\n  confidence: number;\n}\n\n/**\n * Timing pattern info for context\n */\nexport interface TimingPatternInfo {\n  id: string;\n  name: string;\n  pattern: string;\n  recommendation: string;\n}\n\n/**\n * Summary of injected context\n */\nexport interface ContextSummary {\n  totalLessons: number;\n  totalComponents: number;\n  totalQuirks: number;\n  avgLessonConfidence: number;\n  avgComponentSuccessRate: number;\n  topCategories: string[];\n}\n\n// =============================================================================\n// Constants\n// =============================================================================\n\n/** Default maximum lessons to include in context */\nconst DEFAULT_MAX_LESSONS = 10;\n\n/** Default maximum components to include in context */\nconst DEFAULT_MAX_COMPONENTS = 10;\n\n// =============================================================================\n// Relevance Calculation\n// =============================================================================\n\n/**\n * Calculate relevance score for a lesson\n */\nfunction calculateLessonRelevance(\n  lesson: Lesson,\n  journey: JourneyContext,\n  appProfile: AppProfile | null\n): { score: number; reasons: string[] } {\n  let score = 0;\n  const reasons: string[] = [];\n\n  // Base confidence contributes to score\n  score += lesson.metrics.confidence * 0.3;\n\n  // Scope matching\n  if (lesson.scope === 'universal') {\n    score += 0.2;\n    reasons.push('universal scope');\n  } else if (appProfile && lesson.scope === `framework:${appProfile.application.framework}`) {\n    score += 0.25;\n    reasons.push(`framework match: ${appProfile.application.framework}`);\n  } else if (lesson.scope === 'app-specific') {\n    score += 0.15;\n    reasons.push('app-specific');\n  }\n\n  // Tag matching\n  const journeyKeywords = journey.keywords || extractKeywords(journey);\n  if (lesson.tags && lesson.tags.length > 0) {\n    const matchingTags = lesson.tags.filter((tag) =>\n      journeyKeywords.some((kw) => tag.toLowerCase().includes(kw.toLowerCase()))\n    );\n    if (matchingTags.length > 0) {\n      score += Math.min(matchingTags.length * 0.1, 0.3);\n      reasons.push(`tags: ${matchingTags.join(', ')}`);\n    }\n  }\n\n  // Journey ID matching\n  if (lesson.journeyIds && lesson.journeyIds.length > 0) {\n    if (lesson.journeyIds.includes(journey.id)) {\n      score += 0.25;\n      reasons.push('same journey');\n    } else {\n      // Check if lesson was used in similar scopes\n      const journeyScopePattern = journey.scope.toLowerCase();\n      const matchingJourneys = lesson.journeyIds.filter((jid) =>\n        jid.toLowerCase().includes(journeyScopePattern)\n      );\n      if (matchingJourneys.length > 0) {\n        score += 0.15;\n        reasons.push(`similar journeys: ${matchingJourneys.length}`);\n      }\n    }\n  }\n\n  // Category matching\n  if (journey.categories && journey.categories.includes(lesson.category)) {\n    score += 0.15;\n    reasons.push(`category: ${lesson.category}`);\n  }\n\n  // Trigger keyword matching\n  const triggerTokens = tokenize(lesson.trigger);\n  const triggerMatches = journeyKeywords.filter((kw) =>\n    [...triggerTokens].some((t) => t.toLowerCase().includes(kw.toLowerCase()))\n  );\n  if (triggerMatches.length > 0) {\n    score += Math.min(triggerMatches.length * 0.05, 0.15);\n    reasons.push(`trigger match: ${triggerMatches.slice(0, 2).join(', ')}`);\n  }\n\n  // Recency bonus\n  if (lesson.metrics.lastSuccess) {\n    const daysSinceSuccess = daysSince(lesson.metrics.lastSuccess);\n    if (daysSinceSuccess < 7) {\n      score += 0.1;\n      reasons.push('recently successful');\n    } else if (daysSinceSuccess < 30) {\n      score += 0.05;\n    }\n  }\n\n  // Success rate bonus\n  if (lesson.metrics.successRate >= 0.9) {\n    score += 0.1;\n    reasons.push('high success rate');\n  }\n\n  return { score: Math.min(score, 1.0), reasons };\n}\n\n/**\n * Calculate relevance score for a component\n */\nfunction calculateComponentRelevance(\n  component: Component,\n  journey: JourneyContext,\n  appProfile: AppProfile | null\n): { score: number; reasons: string[] } {\n  let score = 0;\n  const reasons: string[] = [];\n\n  // Base success rate contributes to score\n  score += component.metrics.successRate * 0.3;\n\n  // Scope matching\n  if (component.scope === 'universal') {\n    score += 0.2;\n    reasons.push('universal scope');\n  } else if (appProfile && component.scope === `framework:${appProfile.application.framework}`) {\n    score += 0.25;\n    reasons.push(`framework match: ${appProfile.application.framework}`);\n  } else if (\n    appProfile &&\n    component.scope === `framework:${appProfile.application.dataGrid}` &&\n    appProfile.application.dataGrid !== 'none'\n  ) {\n    score += 0.25;\n    reasons.push(`data grid match: ${appProfile.application.dataGrid}`);\n  }\n\n  // Category matching\n  if (journey.categories && journey.categories.includes(component.category)) {\n    score += 0.2;\n    reasons.push(`category: ${component.category}`);\n  }\n\n  // Description similarity\n  const journeyKeywords = journey.keywords || extractKeywords(journey);\n  const descTokens = tokenize(component.description);\n  const contextMatches = journeyKeywords.filter((kw) =>\n    [...descTokens].some((t) => t.toLowerCase().includes(kw.toLowerCase()))\n  );\n  if (contextMatches.length > 0) {\n    score += Math.min(contextMatches.length * 0.05, 0.2);\n    reasons.push(`context match: ${contextMatches.slice(0, 3).join(', ')}`);\n  }\n\n  // Usage frequency bonus\n  if (component.metrics.totalUses > 10) {\n    score += 0.15;\n    reasons.push('widely used');\n  } else if (component.metrics.totalUses > 3) {\n    score += 0.1;\n    reasons.push('commonly used');\n  }\n\n  // Success rate\n  if (component.metrics.successRate >= 0.95) {\n    score += 0.1;\n    reasons.push('high reliability');\n  }\n\n  return { score: Math.min(score, 1.0), reasons };\n}\n\n// =============================================================================\n// Context Filtering\n// =============================================================================\n\n/**\n * Get relevant LLKB context for a journey\n *\n * @param journey - Journey context for filtering\n * @param lessons - All available lessons\n * @param components - All available components\n * @param config - LLKB configuration\n * @param appProfile - Application profile\n * @param patterns - Pattern files\n * @returns Filtered and prioritized context\n */\nexport function getRelevantContext(\n  journey: JourneyContext,\n  lessons: Lesson[],\n  components: Component[],\n  config: LLKBConfig,\n  appProfile: AppProfile | null = null,\n  patterns: LLKBPatterns = {}\n): RelevantContext {\n  const maxLessons = DEFAULT_MAX_LESSONS;\n  const maxComponents = DEFAULT_MAX_COMPONENTS;\n\n  // Extract keywords from journey if not provided\n  const journeyWithKeywords = {\n    ...journey,\n    keywords: journey.keywords || extractKeywords(journey),\n  };\n\n  // Score and filter lessons\n  const scoredLessons = lessons\n    .filter((l) => !l.archived)\n    .map((lesson) => {\n      const { score, reasons } = calculateLessonRelevance(lesson, journeyWithKeywords, appProfile);\n      return { ...lesson, relevanceScore: score, matchReasons: reasons } as ScoredLesson;\n    })\n    .filter((l) => l.relevanceScore > 0.2)\n    .sort((a, b) => {\n      if (config.injection.prioritizeByConfidence) {\n        // Sort by confidence first, then relevance\n        return b.metrics.confidence - a.metrics.confidence || b.relevanceScore - a.relevanceScore;\n      }\n      return b.relevanceScore - a.relevanceScore;\n    })\n    .slice(0, maxLessons);\n\n  // Score and filter components\n  const scoredComponents = components\n    .filter((c) => !c.archived)\n    .map((component) => {\n      const { score, reasons } = calculateComponentRelevance(\n        component,\n        journeyWithKeywords,\n        appProfile\n      );\n      return { ...component, relevanceScore: score, matchReasons: reasons } as ScoredComponent;\n    })\n    .filter((c) => c.relevanceScore > 0.2)\n    .sort((a, b) => {\n      if (config.injection.prioritizeByConfidence) {\n        return b.metrics.successRate - a.metrics.successRate || b.relevanceScore - a.relevanceScore;\n      }\n      return b.relevanceScore - a.relevanceScore;\n    })\n    .slice(0, maxComponents);\n\n  // Extract relevant quirks from lessons\n  const quirks = extractRelevantQuirks(lessons, journeyWithKeywords);\n\n  // Extract relevant selector patterns\n  const selectorPatterns = extractRelevantSelectorPatterns(\n    patterns.selectors,\n    journeyWithKeywords,\n    appProfile\n  );\n\n  // Extract relevant timing patterns\n  const timingPatterns = extractRelevantTimingPatterns(patterns.timing, journeyWithKeywords);\n\n  // Calculate summary\n  const summary = calculateSummary(scoredLessons, scoredComponents, quirks);\n\n  return {\n    lessons: scoredLessons,\n    components: scoredComponents,\n    quirks,\n    selectorPatterns,\n    timingPatterns,\n    summary,\n  };\n}\n\n/**\n * Extract relevant app quirks from quirk-category lessons\n */\nfunction extractRelevantQuirks(lessons: Lesson[], journey: JourneyContext): AppQuirkInfo[] {\n  const quirks: AppQuirkInfo[] = [];\n\n  for (const lesson of lessons) {\n    // Check if lesson is a quirk category\n    if (lesson.category === 'quirk') {\n      // Check if it matches the journey scope, routes, or keywords\n      const journeyKeywords = journey.keywords || extractKeywords(journey);\n      const triggerTokens = tokenize(lesson.trigger);\n      const patternTokens = tokenize(lesson.pattern);\n\n      const matchesScope =\n        lesson.journeyIds.some(\n          (jid) =>\n            journey.scope.toLowerCase().includes(jid.toLowerCase()) ||\n            jid.toLowerCase().includes(journey.scope.toLowerCase())\n        ) ||\n        journeyKeywords.some(\n          (kw) =>\n            [...triggerTokens].some((t) => t.toLowerCase().includes(kw.toLowerCase())) ||\n            [...patternTokens].some((t) => t.toLowerCase().includes(kw.toLowerCase()))\n        ) ||\n        (journey.routes &&\n          journey.routes.some((route) =>\n            lesson.journeyIds.some((jid) => route.toLowerCase().includes(jid.toLowerCase()))\n          ));\n\n      if (matchesScope) {\n        quirks.push({\n          id: lesson.id,\n          component: lesson.title,\n          location: lesson.journeyIds.join(', ') || lesson.scope,\n          quirk: lesson.trigger,\n          impact: `Confidence: ${Math.round(lesson.metrics.confidence * 100)}%`,\n          workaround: lesson.pattern,\n        });\n      }\n    }\n  }\n\n  return quirks.slice(0, 5); // Limit to 5 quirks\n}\n\n/**\n * Extract relevant selector patterns\n */\nfunction extractRelevantSelectorPatterns(\n  selectorPatterns: SelectorPatterns | undefined,\n  journey: JourneyContext,\n  appProfile: AppProfile | null\n): SelectorPatternInfo[] {\n  if (!selectorPatterns) return [];\n\n  const relevant: SelectorPatternInfo[] = [];\n\n  for (const pattern of selectorPatterns.selectorPatterns || []) {\n    // Check if pattern applies to journey or app profile\n    const matchesApp =\n      appProfile &&\n      pattern.applicableTo.some(\n        (app) =>\n          app === appProfile.application.framework ||\n          app === appProfile.application.dataGrid ||\n          app === appProfile.application.uiLibrary\n      );\n\n    const matchesKeywords =\n      journey.keywords &&\n      pattern.applicableTo.some((app) =>\n        journey.keywords!.some((kw) => app.toLowerCase().includes(kw.toLowerCase()))\n      );\n\n    if (matchesApp || matchesKeywords || pattern.confidence >= 0.9) {\n      relevant.push({\n        id: pattern.id,\n        name: pattern.name,\n        template: pattern.template,\n        confidence: pattern.confidence,\n      });\n    }\n  }\n\n  return relevant.slice(0, 5);\n}\n\n/**\n * Extract relevant timing patterns\n */\nfunction extractRelevantTimingPatterns(\n  timingPatterns: TimingPatterns | undefined,\n  journey: JourneyContext\n): TimingPatternInfo[] {\n  if (!timingPatterns) return [];\n\n  const relevant: TimingPatternInfo[] = [];\n\n  for (const pattern of timingPatterns.asyncPatterns || []) {\n    // Check if pattern context matches journey keywords\n    const contextTokens = tokenize(pattern.context);\n    const journeyKeywords = journey.keywords || [];\n    const matches = journeyKeywords.some((kw) =>\n      [...contextTokens].some((t) => t.toLowerCase().includes(kw.toLowerCase()))\n    );\n\n    if (matches) {\n      relevant.push({\n        id: pattern.id,\n        name: pattern.name,\n        pattern: pattern.pattern,\n        recommendation: pattern.recommendation,\n      });\n    }\n  }\n\n  return relevant.slice(0, 5);\n}\n\n/**\n * Calculate context summary\n */\nfunction calculateSummary(\n  lessons: ScoredLesson[],\n  components: ScoredComponent[],\n  quirks: AppQuirkInfo[]\n): ContextSummary {\n  const avgLessonConfidence =\n    lessons.length > 0\n      ? lessons.reduce((sum, l) => sum + l.metrics.confidence, 0) / lessons.length\n      : 0;\n\n  const avgComponentSuccessRate =\n    components.length > 0\n      ? components.reduce((sum, c) => sum + c.metrics.successRate, 0) / components.length\n      : 0;\n\n  // Count categories\n  const categoryCounts: Record<string, number> = {};\n  for (const lesson of lessons) {\n    categoryCounts[lesson.category] = (categoryCounts[lesson.category] || 0) + 1;\n  }\n  for (const component of components) {\n    categoryCounts[component.category] = (categoryCounts[component.category] || 0) + 1;\n  }\n\n  const topCategories = Object.entries(categoryCounts)\n    .sort((a, b) => b[1] - a[1])\n    .slice(0, 3)\n    .map(([cat]) => cat);\n\n  return {\n    totalLessons: lessons.length,\n    totalComponents: components.length,\n    totalQuirks: quirks.length,\n    avgLessonConfidence,\n    avgComponentSuccessRate,\n    topCategories,\n  };\n}\n\n// =============================================================================\n// Helper Functions\n// =============================================================================\n\n/**\n * Extract keywords from journey context\n */\nexport function extractKeywords(journey: JourneyContext): string[] {\n  const keywords: string[] = [];\n\n  // Extract from title\n  const titleTokens = journey.title\n    .toLowerCase()\n    .split(/\\s+/)\n    .filter((w) => w.length > 3);\n  keywords.push(...titleTokens);\n\n  // Extract from scope\n  keywords.push(journey.scope.toLowerCase());\n\n  // Extract from routes\n  if (journey.routes) {\n    for (const route of journey.routes) {\n      const routeParts = route\n        .split('/')\n        .filter((p) => p && p.length > 2)\n        .map((p) => p.toLowerCase());\n      keywords.push(...routeParts);\n    }\n  }\n\n  // Deduplicate\n  return [...new Set(keywords)];\n}\n\n/**\n * Calculate days since a date\n */\nfunction daysSince(dateStr: string): number {\n  const date = new Date(dateStr);\n  const now = new Date();\n  return Math.floor((now.getTime() - date.getTime()) / (1000 * 60 * 60 * 24));\n}\n\n/**\n * Format context for prompt injection\n *\n * @param context - Relevant context to format\n * @param journey - Journey context\n * @returns Markdown-formatted context string\n */\nexport function formatContextForPrompt(context: RelevantContext, journey: JourneyContext): string {\n  const lines: string[] = [];\n\n  lines.push(`## LLKB Context (Auto-Injected for ${journey.id})`);\n  lines.push('');\n\n  // Components section\n  if (context.components.length > 0) {\n    lines.push(`### Available Components (Top ${context.components.length} for this scope)`);\n    lines.push('');\n    lines.push('| Component | File | Success Rate | Description |');\n    lines.push('|-----------|------|--------------|-------------|');\n\n    for (const comp of context.components) {\n      const successRate = Math.round(comp.metrics.successRate * 100);\n      const description = comp.description.slice(0, 50) + (comp.description.length > 50 ? '...' : '');\n      lines.push(`| ${comp.name} | ${comp.filePath} | ${successRate}% | ${description} |`);\n    }\n\n    lines.push('');\n    lines.push('**Import Example:**');\n    lines.push('```typescript');\n\n    // Group by file path directory\n    const byPath: Record<string, string[]> = {};\n    for (const comp of context.components) {\n      const importPath = comp.filePath.replace(/\\.ts$/, '').replace(/^\\.\\//, '');\n      if (!byPath[importPath]) byPath[importPath] = [];\n      byPath[importPath].push(comp.name);\n    }\n\n    for (const [path, names] of Object.entries(byPath)) {\n      lines.push(`import { ${names.join(', ')} } from './${path}';`);\n    }\n    lines.push('```');\n    lines.push('');\n  }\n\n  // Lessons section\n  if (context.lessons.length > 0) {\n    lines.push(`### Relevant Lessons (Top ${context.lessons.length})`);\n    lines.push('');\n\n    for (let i = 0; i < context.lessons.length; i++) {\n      const lesson = context.lessons[i];\n      if (!lesson) continue;\n\n      const confidence =\n        lesson.metrics.confidence >= 0.8\n          ? 'HIGH'\n          : lesson.metrics.confidence >= 0.5\n            ? 'MEDIUM'\n            : 'LOW';\n      lines.push(`${i + 1}. **[${confidence}] ${lesson.id}: ${lesson.title}**`);\n      lines.push(`   - Trigger: ${lesson.trigger}`);\n      lines.push(`   - Pattern: \\`${lesson.pattern.slice(0, 100)}${lesson.pattern.length > 100 ? '...' : ''}\\``);\n      lines.push('');\n    }\n  }\n\n  // Quirks section\n  if (context.quirks.length > 0) {\n    lines.push('### Known Quirks for This Scope');\n    lines.push('');\n\n    for (const quirk of context.quirks) {\n      lines.push(`- **${quirk.id} (${quirk.component})**: ${quirk.quirk}`);\n      if (quirk.workaround) {\n        lines.push(`  - Workaround: ${quirk.workaround}`);\n      }\n    }\n    lines.push('');\n  }\n\n  lines.push('---');\n\n  return lines.join('\\n');\n}\n\n/**\n * Get scopes relevant to the app profile\n */\nexport function getRelevantScopes(appProfile: AppProfile | null): LLKBScope[] {\n  const scopes: LLKBScope[] = ['universal', 'app-specific'];\n\n  if (appProfile) {\n    if (appProfile.application.framework !== 'other') {\n      scopes.push(`framework:${appProfile.application.framework}` as LLKBScope);\n    }\n    if (appProfile.application.dataGrid !== 'none') {\n      scopes.push(`framework:${appProfile.application.dataGrid}` as LLKBScope);\n    }\n    if (appProfile.application.uiLibrary !== 'custom' && appProfile.application.uiLibrary !== 'none') {\n      scopes.push(`framework:${appProfile.application.uiLibrary}` as LLKBScope);\n    }\n  }\n\n  return scopes;\n}\n","/**\n * LLKB Component Matching Module\n *\n * This module provides functions to match journey steps to existing components\n * and determine whether code should be extracted as a reusable component.\n *\n * @module llkb/matching\n */\n\nimport type {\n  Component,\n  ComponentCategory,\n  LLKBScope,\n  LLKBConfig,\n  ExtractionCandidate,\n} from './types.js';\nimport { normalizeCode, hashCode, countLines } from './normalize.js';\nimport { calculateSimilarity } from './similarity.js';\nimport { inferCategory } from './inference.js';\n\n// =============================================================================\n// Types\n// =============================================================================\n\n/**\n * A journey step to match against components\n */\nexport interface JourneyStep {\n  /** Step name or description */\n  name: string;\n\n  /** Step description (if separate from name) */\n  description?: string;\n\n  /** Action keywords (verify, navigate, click, etc.) */\n  keywords?: string[];\n\n  /** The journey scope */\n  scope?: string;\n\n  /** Inline code if available */\n  code?: string;\n}\n\n/**\n * Result of matching a step to a component\n */\nexport interface StepMatchResult {\n  /** The step that was matched */\n  step: JourneyStep;\n\n  /** Matched component (if any) */\n  component: Component | null;\n\n  /** Match score (0.0 - 1.0) */\n  score: number;\n\n  /** Match recommendation */\n  recommendation: 'USE' | 'SUGGEST' | 'NONE';\n\n  /** Reason for the recommendation */\n  reason: string;\n}\n\n/**\n * Options for step matching\n */\nexport interface MatchOptions {\n  /** Minimum score to use component (default: 0.7) */\n  useThreshold?: number;\n\n  /** Minimum score to suggest component (default: 0.4) */\n  suggestThreshold?: number;\n\n  /** App framework for scope filtering */\n  appFramework?: string;\n\n  /** Filter by categories */\n  categories?: ComponentCategory[];\n}\n\n/**\n * Result of extraction check\n */\nexport interface ExtractionCheckResult {\n  /** Whether the code should be extracted */\n  shouldExtract: boolean;\n\n  /** Confidence score (0.0 - 1.0) */\n  confidence: number;\n\n  /** Reason for the decision */\n  reason: string;\n\n  /** Suggested component category */\n  suggestedCategory?: ComponentCategory;\n\n  /** Suggested module path */\n  suggestedPath?: string;\n}\n\n/**\n * Pattern occurrence info for extraction analysis\n */\nexport interface PatternOccurrence {\n  /** File path */\n  file: string;\n\n  /** Journey ID */\n  journeyId: string;\n\n  /** Step name */\n  stepName: string;\n\n  /** Line start */\n  lineStart: number;\n\n  /** Line end */\n  lineEnd: number;\n}\n\n// =============================================================================\n// Constants\n// =============================================================================\n\n/** Common action keywords for step analysis */\nconst ACTION_KEYWORDS = [\n  'verify',\n  'check',\n  'assert',\n  'expect',\n  'navigate',\n  'goto',\n  'click',\n  'fill',\n  'type',\n  'select',\n  'wait',\n  'load',\n  'submit',\n  'upload',\n  'download',\n  'hover',\n  'drag',\n  'drop',\n  'scroll',\n  'resize',\n  'close',\n  'open',\n  'toggle',\n  'expand',\n  'collapse',\n  'search',\n  'filter',\n  'sort',\n  'create',\n  'delete',\n  'update',\n  'edit',\n  'save',\n  'cancel',\n  'confirm',\n  'login',\n  'logout',\n  'authenticate',\n];\n\n/** Common UI patterns that indicate reusable components */\nconst REUSABLE_PATTERNS = [\n  { pattern: /navigation|sidebar|menu|breadcrumb/i, category: 'navigation' as ComponentCategory },\n  { pattern: /form|input|submit|validation/i, category: 'ui-interaction' as ComponentCategory },\n  { pattern: /table|grid|row|cell|column/i, category: 'data' as ComponentCategory },\n  { pattern: /modal|dialog|popup|overlay/i, category: 'ui-interaction' as ComponentCategory },\n  { pattern: /toast|alert|notification|message/i, category: 'assertion' as ComponentCategory },\n  { pattern: /login|auth|logout|session/i, category: 'auth' as ComponentCategory },\n  { pattern: /loading|spinner|skeleton|progress/i, category: 'timing' as ComponentCategory },\n  { pattern: /select|dropdown|picker|autocomplete/i, category: 'ui-interaction' as ComponentCategory },\n  { pattern: /tab|accordion|panel|collapse/i, category: 'ui-interaction' as ComponentCategory },\n  { pattern: /search|filter|sort|pagination/i, category: 'data' as ComponentCategory },\n];\n\n// =============================================================================\n// Step Matching Functions\n// =============================================================================\n\n/**\n * Extract keywords from a journey step\n */\nexport function extractStepKeywords(step: JourneyStep): string[] {\n  const text = `${step.name} ${step.description || ''}`.toLowerCase();\n  const keywords: string[] = [];\n\n  // Extract action keywords\n  for (const keyword of ACTION_KEYWORDS) {\n    if (text.includes(keyword)) {\n      keywords.push(keyword);\n    }\n  }\n\n  // Add explicit keywords\n  if (step.keywords) {\n    keywords.push(...step.keywords.map((k) => k.toLowerCase()));\n  }\n\n  // Extract potential UI element keywords\n  const elementMatches = text.match(/\\b(button|link|input|field|table|grid|form|modal|dialog|toast|sidebar|menu|dropdown|checkbox|radio)\\b/gi);\n  if (elementMatches) {\n    keywords.push(...elementMatches.map((m) => m.toLowerCase()));\n  }\n\n  return [...new Set(keywords)];\n}\n\n/**\n * Calculate similarity between step and component\n */\nfunction calculateStepComponentSimilarity(\n  step: JourneyStep,\n  component: Component,\n  stepKeywords: string[]\n): number {\n  let score = 0;\n  let factors = 0;\n\n  // 1. Category match (if step has code, infer category)\n  if (step.code) {\n    const stepCategory = inferCategory(step.code);\n    if (stepCategory === component.category) {\n      score += 0.3;\n    }\n  }\n  factors += 0.3;\n\n  // 2. Keyword overlap\n  const componentKeywords = [\n    component.category,\n    ...(component.description?.toLowerCase().split(/\\s+/) || []),\n    component.name.toLowerCase(),\n  ];\n\n  const keywordOverlap = stepKeywords.filter((k) =>\n    componentKeywords.some((ck) => ck.includes(k) || k.includes(ck))\n  ).length;\n\n  const keywordScore = Math.min(keywordOverlap / Math.max(stepKeywords.length, 1), 1);\n  score += keywordScore * 0.4;\n  factors += 0.4;\n\n  // 3. Name similarity\n  const stepText = `${step.name} ${step.description || ''}`.toLowerCase();\n  const componentText = `${component.name} ${component.description}`.toLowerCase();\n\n  // Simple word overlap\n  const stepWords = new Set(stepText.split(/\\s+/).filter((w) => w.length > 2));\n  const componentWords = new Set(componentText.split(/\\s+/).filter((w) => w.length > 2));\n\n  let overlap = 0;\n  for (const word of stepWords) {\n    if (componentWords.has(word)) {\n      overlap++;\n    }\n  }\n\n  const nameScore = overlap / Math.max(stepWords.size, 1);\n  score += nameScore * 0.3;\n  factors += 0.3;\n\n  return score / factors;\n}\n\n/**\n * Check if component scope matches journey scope\n */\nfunction scopeMatches(\n  componentScope: LLKBScope,\n  _journeyScope: string | undefined,\n  appFramework?: string\n): boolean {\n  // Universal scope matches everything\n  if (componentScope === 'universal') {\n    return true;\n  }\n\n  // Framework-specific scope\n  if (componentScope.startsWith('framework:')) {\n    const framework = componentScope.replace('framework:', '');\n    return appFramework === framework;\n  }\n\n  // App-specific scope always matches within the same app\n  if (componentScope === 'app-specific') {\n    return true;\n  }\n\n  return false;\n}\n\n/**\n * Match journey steps to existing components\n *\n * For each step, finds the best matching component and provides\n * a recommendation on whether to use it, suggest it, or skip.\n *\n * @param steps - Array of journey steps to match\n * @param components - Available components to match against\n * @param options - Matching options\n * @returns Array of match results for each step\n *\n * @example\n * ```typescript\n * const results = matchStepsToComponents(\n *   [{ name: 'Verify sidebar is ready', scope: 'orders' }],\n *   components,\n *   { appFramework: 'angular', useThreshold: 0.7 }\n * );\n * ```\n */\nexport function matchStepsToComponents(\n  steps: JourneyStep[],\n  components: Component[],\n  options: MatchOptions = {}\n): StepMatchResult[] {\n  const { useThreshold = 0.7, suggestThreshold = 0.4, appFramework, categories } = options;\n\n  // Filter components by scope and category\n  const filteredComponents = components.filter((c) => {\n    // Skip archived components\n    if (c.archived) {\n      return false;\n    }\n\n    // Filter by category if specified\n    if (categories && categories.length > 0 && !categories.includes(c.category)) {\n      return false;\n    }\n\n    return true;\n  });\n\n  return steps.map((step) => {\n    const stepKeywords = extractStepKeywords(step);\n\n    // Find best matching component\n    let bestMatch: Component | null = null;\n    let bestScore = 0;\n\n    for (const component of filteredComponents) {\n      // Check scope compatibility\n      if (!scopeMatches(component.scope, step.scope, appFramework)) {\n        continue;\n      }\n\n      const score = calculateStepComponentSimilarity(step, component, stepKeywords);\n\n      if (score > bestScore) {\n        bestScore = score;\n        bestMatch = component;\n      }\n    }\n\n    // Determine recommendation\n    let recommendation: 'USE' | 'SUGGEST' | 'NONE';\n    let reason: string;\n\n    if (bestScore >= useThreshold) {\n      recommendation = 'USE';\n      reason = `High confidence match (${(bestScore * 100).toFixed(0)}%) - use ${bestMatch!.name} component`;\n    } else if (bestScore >= suggestThreshold) {\n      recommendation = 'SUGGEST';\n      reason = `Moderate match (${(bestScore * 100).toFixed(0)}%) - consider ${bestMatch!.name} component`;\n    } else {\n      recommendation = 'NONE';\n      reason = bestMatch\n        ? `Low match score (${(bestScore * 100).toFixed(0)}%) - write inline code`\n        : 'No matching components found';\n      bestMatch = null;\n    }\n\n    return {\n      step,\n      component: bestMatch,\n      score: bestScore,\n      recommendation,\n      reason,\n    };\n  });\n}\n\n// =============================================================================\n// Extraction Detection Functions\n// =============================================================================\n\n/**\n * Determine if code pattern matches a reusable pattern\n */\nfunction matchesReusablePattern(code: string): {\n  matches: boolean;\n  category?: ComponentCategory;\n} {\n  for (const { pattern, category } of REUSABLE_PATTERNS) {\n    if (pattern.test(code)) {\n      return { matches: true, category };\n    }\n  }\n  return { matches: false };\n}\n\n/**\n * Suggest module path for component based on category and scope\n */\nfunction suggestModulePath(category: ComponentCategory, scope: LLKBScope): string {\n  if (scope === 'universal') {\n    return `@artk/core/${category}`;\n  }\n\n  if (scope.startsWith('framework:')) {\n    const framework = scope.replace('framework:', '');\n    return `@artk/core/${framework}/${category}`;\n  }\n\n  // App-specific\n  return `modules/foundation/${category}`;\n}\n\n/**\n * Determine if code should be extracted as a reusable component\n *\n * Analyzes code patterns, occurrences, and configuration to decide\n * whether to extract the code into a reusable module.\n *\n * @param code - The code to analyze\n * @param occurrences - Where this pattern appears\n * @param config - LLKB configuration\n * @param existingComponents - Existing components to check for duplicates\n * @returns Extraction check result with recommendation\n *\n * @example\n * ```typescript\n * const result = shouldExtractAsComponent(\n *   'await page.waitForSelector(\".sidebar\");',\n *   [{ file: 'test1.spec.ts', journeyId: 'JRN-001', stepName: 'Verify sidebar', lineStart: 10, lineEnd: 15 }],\n *   config,\n *   existingComponents\n * );\n * if (result.shouldExtract) {\n *   // Extract as component\n * }\n * ```\n */\nexport function shouldExtractAsComponent(\n  code: string,\n  occurrences: PatternOccurrence[],\n  config: LLKBConfig,\n  existingComponents: Component[] = []\n): ExtractionCheckResult {\n  const {\n    minOccurrences = 2,\n    predictiveExtraction = true,\n    minLinesForExtraction = 3,\n    similarityThreshold = 0.8,\n  } = config.extraction;\n\n  // 1. Check minimum lines\n  const lineCount = countLines(code);\n  if (lineCount < minLinesForExtraction) {\n    return {\n      shouldExtract: false,\n      confidence: 0,\n      reason: `Code too short (${lineCount} lines < ${minLinesForExtraction} minimum)`,\n    };\n  }\n\n  // 2. Check for existing similar component\n  const normalizedCode = normalizeCode(code);\n\n  for (const component of existingComponents) {\n    if (component.archived) continue;\n\n    // Check source code similarity\n    const sourceNormalized = normalizeCode(component.source.originalCode);\n    const similarity = calculateSimilarity(normalizedCode, sourceNormalized);\n\n    if (similarity >= similarityThreshold) {\n      return {\n        shouldExtract: false,\n        confidence: 1.0,\n        reason: `Similar component already exists: ${component.name} (${(similarity * 100).toFixed(0)}% similar)`,\n      };\n    }\n  }\n\n  // 3. Infer category and check reusable patterns\n  const category = inferCategory(code);\n  const patternMatch = matchesReusablePattern(code);\n\n  // 4. Check occurrence threshold\n  const uniqueJourneys = new Set(occurrences.map((o) => o.journeyId)).size;\n\n  if (occurrences.length >= minOccurrences) {\n    return {\n      shouldExtract: true,\n      confidence: Math.min(0.7 + uniqueJourneys * 0.1, 0.95),\n      reason: `Pattern appears ${occurrences.length} times across ${uniqueJourneys} journey(s) (>= ${minOccurrences} threshold)`,\n      suggestedCategory: patternMatch.category || category,\n      suggestedPath: suggestModulePath(patternMatch.category || category, 'app-specific'),\n    };\n  }\n\n  // 5. Check predictive extraction\n  if (predictiveExtraction && patternMatch.matches) {\n    return {\n      shouldExtract: true,\n      confidence: 0.6,\n      reason: `Predictive extraction: matches common ${patternMatch.category} pattern`,\n      suggestedCategory: patternMatch.category,\n      suggestedPath: suggestModulePath(patternMatch.category!, 'app-specific'),\n    };\n  }\n\n  // 6. Single occurrence, not a common pattern\n  if (occurrences.length === 1 && !patternMatch.matches) {\n    return {\n      shouldExtract: false,\n      confidence: 0.3,\n      reason: 'Single occurrence, not a common pattern - keep inline',\n      suggestedCategory: category,\n    };\n  }\n\n  // 7. Default: not enough evidence\n  return {\n    shouldExtract: false,\n    confidence: 0.4,\n    reason: `Not enough occurrences (${occurrences.length} < ${minOccurrences}) and no common pattern match`,\n    suggestedCategory: category,\n  };\n}\n\n/**\n * Analyze multiple code snippets and identify extraction candidates\n *\n * Groups similar code patterns and recommends which ones to extract.\n *\n * @param codeSnippets - Array of code snippets with metadata\n * @param config - LLKB configuration\n * @param existingComponents - Existing components\n * @returns Array of extraction candidates sorted by score\n */\nexport function findExtractionCandidates(\n  codeSnippets: Array<{\n    code: string;\n    file: string;\n    journeyId: string;\n    stepName: string;\n    lineStart: number;\n    lineEnd: number;\n  }>,\n  config: LLKBConfig,\n  existingComponents: Component[] = []\n): ExtractionCandidate[] {\n  const { similarityThreshold = 0.8 } = config.extraction;\n\n  // Group similar patterns\n  const groups: Map<string, PatternOccurrence[]> = new Map();\n  const codeByHash: Map<string, string> = new Map();\n\n  for (const snippet of codeSnippets) {\n    const normalized = normalizeCode(snippet.code);\n    const hash = hashCode(normalized);\n\n    // Check if this is similar to an existing group\n    let matchedHash: string | null = null;\n\n    for (const [existingHash, existingCode] of codeByHash.entries()) {\n      const similarity = calculateSimilarity(normalized, existingCode);\n      if (similarity >= similarityThreshold) {\n        matchedHash = existingHash;\n        break;\n      }\n    }\n\n    const groupHash = matchedHash || hash;\n\n    if (!groups.has(groupHash)) {\n      groups.set(groupHash, []);\n      codeByHash.set(groupHash, normalized);\n    }\n\n    groups.get(groupHash)!.push({\n      file: snippet.file,\n      journeyId: snippet.journeyId,\n      stepName: snippet.stepName,\n      lineStart: snippet.lineStart,\n      lineEnd: snippet.lineEnd,\n    });\n  }\n\n  // Analyze each group\n  const candidates: ExtractionCandidate[] = [];\n\n  for (const [hash, occurrences] of groups.entries()) {\n    const code = codeByHash.get(hash)!;\n    const firstOccurrence = occurrences[0];\n\n    // Skip if no occurrences (should not happen, but TypeScript requires check)\n    if (!firstOccurrence) continue;\n\n    // Get original code from first occurrence\n    const originalSnippet = codeSnippets.find(\n      (s) =>\n        s.file === firstOccurrence.file &&\n        s.lineStart === firstOccurrence.lineStart\n    );\n\n    const checkResult = shouldExtractAsComponent(\n      originalSnippet?.code || code,\n      occurrences,\n      config,\n      existingComponents\n    );\n\n    // Calculate extraction score\n    const uniqueJourneys = new Set(occurrences.map((o) => o.journeyId)).size;\n    const score = occurrences.length * 0.3 + uniqueJourneys * 0.4 + checkResult.confidence * 0.3;\n\n    let recommendation: 'EXTRACT_NOW' | 'CONSIDER' | 'SKIP';\n    if (checkResult.shouldExtract && score >= 0.7) {\n      recommendation = 'EXTRACT_NOW';\n    } else if (checkResult.shouldExtract || score >= 0.5) {\n      recommendation = 'CONSIDER';\n    } else {\n      recommendation = 'SKIP';\n    }\n\n    candidates.push({\n      pattern: code,\n      originalCode: originalSnippet?.code || code,\n      occurrences: occurrences.length,\n      journeys: [...new Set(occurrences.map((o) => o.journeyId))],\n      files: [...new Set(occurrences.map((o) => o.file))],\n      category: checkResult.suggestedCategory || inferCategory(code),\n      score,\n      recommendation,\n    });\n  }\n\n  // Sort by score descending\n  return candidates.sort((a, b) => b.score - a.score);\n}\n","/**\n * LLKB Cross-Journey Detection Module\n *\n * This module provides functions to detect duplicate patterns across\n * multiple journey test files and identify extraction opportunities.\n *\n * @module llkb/detection\n */\n\nimport * as fs from 'fs';\nimport * as path from 'path';\nimport type { TestStep, ExtractionCandidate, Component } from './types.js';\nimport { normalizeCode, hashCode, countLines } from './normalize.js';\nimport { calculateSimilarity } from './similarity.js';\nimport { inferCategory } from './inference.js';\n\n// =============================================================================\n// Types\n// =============================================================================\n\n/**\n * Result of duplicate detection across files\n */\nexport interface DuplicateDetectionResult {\n  /** All test steps extracted from files */\n  totalSteps: number;\n\n  /** Number of unique patterns found */\n  uniquePatterns: number;\n\n  /** Number of duplicate patterns found */\n  duplicatePatterns: number;\n\n  /** Duplicate groups with their occurrences */\n  duplicateGroups: DuplicateGroup[];\n\n  /** Extraction candidates (sorted by priority) */\n  extractionCandidates: ExtractionCandidate[];\n\n  /** Files analyzed */\n  filesAnalyzed: string[];\n}\n\n/**\n * A group of duplicate patterns\n */\nexport interface DuplicateGroup {\n  /** Hash of the normalized pattern */\n  patternHash: string;\n\n  /** Normalized pattern code */\n  normalizedCode: string;\n\n  /** Original code samples */\n  originalSamples: string[];\n\n  /** All occurrences */\n  occurrences: TestStep[];\n\n  /** Number of unique journeys */\n  uniqueJourneys: number;\n\n  /** Number of unique files */\n  uniqueFiles: number;\n\n  /** Inferred category */\n  category: string;\n\n  /** Similarity score between occurrences */\n  internalSimilarity: number;\n}\n\n/**\n * Options for duplicate detection\n */\nexport interface DetectionOptions {\n  /** Minimum similarity threshold (default: 0.8) */\n  similarityThreshold?: number;\n\n  /** Minimum occurrences to report (default: 2) */\n  minOccurrences?: number;\n\n  /** Minimum lines for a pattern (default: 3) */\n  minLines?: number;\n\n  /** Include archived patterns */\n  includeArchived?: boolean;\n\n  /** File extensions to scan (default: ['.ts', '.js']) */\n  extensions?: string[];\n\n  /** Directories to exclude */\n  excludeDirs?: string[];\n}\n\n/**\n * Parsed test step from file analysis\n */\ninterface ParsedStep {\n  file: string;\n  journeyId: string;\n  stepName: string;\n  code: string;\n  lineStart: number;\n  lineEnd: number;\n}\n\n// =============================================================================\n// Constants\n// =============================================================================\n\n/** Default file extensions to scan */\nconst DEFAULT_EXTENSIONS = ['.ts', '.js'];\n\n/** Default directories to exclude */\nconst DEFAULT_EXCLUDE_DIRS = ['node_modules', 'dist', 'build', '.git', 'coverage'];\n\n/** Regex to extract test.step blocks */\nconst TEST_STEP_REGEX = /(?:await\\s+)?test\\.step\\s*\\(\\s*(['\"`])(.+?)\\1\\s*,\\s*async\\s*\\([^)]*\\)\\s*=>\\s*\\{([\\s\\S]*?)\\}\\s*\\)/g;\n\n/** Regex to extract journey ID from file */\nconst JOURNEY_ID_REGEX = /(?:JRN|jrn)[-_]?(\\d+)/i;\n\n// =============================================================================\n// File Parsing Functions\n// =============================================================================\n\n/**\n * Extract journey ID from file path or content\n */\nfunction extractJourneyId(filePath: string, content: string): string {\n  // Try filename first\n  const fileMatch = path.basename(filePath).match(JOURNEY_ID_REGEX);\n  if (fileMatch && fileMatch[1]) {\n    return `JRN-${fileMatch[1].padStart(4, '0')}`;\n  }\n\n  // Try content\n  const contentMatch = content.match(JOURNEY_ID_REGEX);\n  if (contentMatch && contentMatch[1]) {\n    return `JRN-${contentMatch[1].padStart(4, '0')}`;\n  }\n\n  // Generate from filename\n  const basename = path.basename(filePath, path.extname(filePath));\n  return `JRN-${basename.toUpperCase().replace(/[^A-Z0-9]/g, '-').slice(0, 20)}`;\n}\n\n/**\n * Parse test.step blocks from file content\n */\nfunction parseTestSteps(filePath: string, content: string): ParsedStep[] {\n  const steps: ParsedStep[] = [];\n  const journeyId = extractJourneyId(filePath, content);\n\n  // Reset regex\n  TEST_STEP_REGEX.lastIndex = 0;\n\n  let match: RegExpExecArray | null;\n  while ((match = TEST_STEP_REGEX.exec(content)) !== null) {\n    const stepName = match[2];\n    const stepCode = match[3];\n\n    // Skip if we didn't capture properly\n    if (!stepName || !stepCode) continue;\n\n    const trimmedCode = stepCode.trim();\n\n    // Calculate line numbers\n    const beforeMatch = content.slice(0, match.index);\n    const lineStart = beforeMatch.split('\\n').length;\n    const lineEnd = lineStart + match[0].split('\\n').length - 1;\n\n    // Only include steps with actual code (not just comments)\n    const codeWithoutComments = trimmedCode.replace(/\\/\\/.*$/gm, '').replace(/\\/\\*[\\s\\S]*?\\*\\//g, '').trim();\n    if (codeWithoutComments.length > 0) {\n      steps.push({\n        file: filePath,\n        journeyId,\n        stepName,\n        code: trimmedCode,\n        lineStart,\n        lineEnd,\n      });\n    }\n  }\n\n  return steps;\n}\n\n/**\n * Recursively find test files in directory\n */\nfunction findTestFiles(\n  dir: string,\n  extensions: string[],\n  excludeDirs: string[]\n): string[] {\n  const files: string[] = [];\n\n  if (!fs.existsSync(dir)) {\n    return files;\n  }\n\n  const entries = fs.readdirSync(dir, { withFileTypes: true });\n\n  for (const entry of entries) {\n    const fullPath = path.join(dir, entry.name);\n\n    if (entry.isDirectory()) {\n      if (!excludeDirs.includes(entry.name)) {\n        files.push(...findTestFiles(fullPath, extensions, excludeDirs));\n      }\n    } else if (entry.isFile()) {\n      const ext = path.extname(entry.name);\n      if (extensions.includes(ext)) {\n        // Look for test files specifically\n        if (\n          entry.name.includes('.spec.') ||\n          entry.name.includes('.test.') ||\n          entry.name.includes('.e2e.')\n        ) {\n          files.push(fullPath);\n        }\n      }\n    }\n  }\n\n  return files;\n}\n\n// =============================================================================\n// Duplicate Detection Functions\n// =============================================================================\n\n/**\n * Group similar patterns together\n */\nfunction groupSimilarPatterns(\n  steps: ParsedStep[],\n  similarityThreshold: number,\n  minLines: number\n): Map<string, ParsedStep[]> {\n  const groups: Map<string, ParsedStep[]> = new Map();\n  const normalizedByStep: Map<ParsedStep, string> = new Map();\n\n  // Normalize all steps\n  for (const step of steps) {\n    const normalized = normalizeCode(step.code);\n    const lineCount = countLines(step.code);\n\n    // Skip steps that are too short\n    if (lineCount < minLines) {\n      continue;\n    }\n\n    normalizedByStep.set(step, normalized);\n  }\n\n  // Group by similarity\n  const processed = new Set<ParsedStep>();\n\n  for (const [step, normalized] of normalizedByStep) {\n    if (processed.has(step)) continue;\n\n    const hash = hashCode(normalized);\n    let foundGroup = false;\n\n    // Check if this is similar to an existing group\n    for (const [groupHash, groupSteps] of groups) {\n      const firstGroupStep = groupSteps[0];\n      if (!firstGroupStep) continue;\n\n      const groupNormalized = normalizedByStep.get(firstGroupStep);\n      if (!groupNormalized) continue;\n\n      const similarity = calculateSimilarity(normalized, groupNormalized);\n\n      if (similarity >= similarityThreshold) {\n        const existingGroup = groups.get(groupHash);\n        if (existingGroup) {\n          existingGroup.push(step);\n        }\n        processed.add(step);\n        foundGroup = true;\n        break;\n      }\n    }\n\n    // Create new group if no match found\n    if (!foundGroup) {\n      groups.set(hash, [step]);\n      processed.add(step);\n    }\n  }\n\n  return groups;\n}\n\n/**\n * Convert step groups to duplicate groups with metadata\n */\nfunction buildDuplicateGroups(\n  stepGroups: Map<string, ParsedStep[]>,\n  minOccurrences: number\n): DuplicateGroup[] {\n  const duplicateGroups: DuplicateGroup[] = [];\n\n  for (const [hash, steps] of stepGroups) {\n    // Only include groups with multiple occurrences\n    if (steps.length < minOccurrences) {\n      continue;\n    }\n\n    const uniqueJourneys = new Set(steps.map((s) => s.journeyId)).size;\n    const uniqueFiles = new Set(steps.map((s) => s.file)).size;\n\n    // Calculate internal similarity (average pairwise similarity)\n    let totalSimilarity = 0;\n    let pairs = 0;\n\n    for (let i = 0; i < steps.length; i++) {\n      for (let j = i + 1; j < steps.length; j++) {\n        const stepI = steps[i];\n        const stepJ = steps[j];\n        if (!stepI || !stepJ) continue;\n\n        const sim = calculateSimilarity(\n          normalizeCode(stepI.code),\n          normalizeCode(stepJ.code)\n        );\n        totalSimilarity += sim;\n        pairs++;\n      }\n    }\n\n    const internalSimilarity = pairs > 0 ? totalSimilarity / pairs : 1.0;\n\n    // Collect original samples (up to 3)\n    const originalSamples = steps.slice(0, 3).map((s) => s.code);\n\n    // Infer category from first step\n    const firstStep = steps[0];\n    if (!firstStep) continue;\n\n    const category = inferCategory(firstStep.code);\n\n    // Convert to TestStep format\n    const occurrences: TestStep[] = steps.map((s) => ({\n      file: s.file,\n      journey: s.journeyId,\n      stepName: s.stepName,\n      code: s.code,\n      normalizedCode: normalizeCode(s.code),\n      hash: hashCode(normalizeCode(s.code)),\n      lineStart: s.lineStart,\n      lineEnd: s.lineEnd,\n    }));\n\n    duplicateGroups.push({\n      patternHash: hash,\n      normalizedCode: normalizeCode(firstStep.code),\n      originalSamples,\n      occurrences,\n      uniqueJourneys,\n      uniqueFiles,\n      category,\n      internalSimilarity,\n    });\n  }\n\n  // Sort by number of occurrences (descending)\n  return duplicateGroups.sort((a, b) => b.occurrences.length - a.occurrences.length);\n}\n\n/**\n * Detect duplicate patterns across multiple test files\n *\n * Scans test files for test.step blocks, normalizes the code,\n * and groups similar patterns to identify extraction opportunities.\n *\n * @param testDir - Directory containing test files\n * @param options - Detection options\n * @returns Duplicate detection result with groups and candidates\n *\n * @example\n * ```typescript\n * const result = detectDuplicatesAcrossFiles(\n *   'artk-e2e/tests',\n *   { similarityThreshold: 0.8, minOccurrences: 2 }\n * );\n * console.log(`Found ${result.duplicatePatterns} duplicate patterns`);\n * ```\n */\nexport function detectDuplicatesAcrossFiles(\n  testDir: string,\n  options: DetectionOptions = {}\n): DuplicateDetectionResult {\n  const {\n    similarityThreshold = 0.8,\n    minOccurrences = 2,\n    minLines = 3,\n    extensions = DEFAULT_EXTENSIONS,\n    excludeDirs = DEFAULT_EXCLUDE_DIRS,\n  } = options;\n\n  // Find all test files\n  const testFiles = findTestFiles(testDir, extensions, excludeDirs);\n\n  // Parse all test steps\n  const allSteps: ParsedStep[] = [];\n\n  for (const file of testFiles) {\n    try {\n      const content = fs.readFileSync(file, 'utf-8');\n      const steps = parseTestSteps(file, content);\n      allSteps.push(...steps);\n    } catch (error) {\n      // Skip files that can't be read\n      console.warn(`Warning: Could not read file ${file}`);\n    }\n  }\n\n  // Group similar patterns\n  const stepGroups = groupSimilarPatterns(allSteps, similarityThreshold, minLines);\n\n  // Build duplicate groups\n  const duplicateGroups = buildDuplicateGroups(stepGroups, minOccurrences);\n\n  // Count unique patterns (groups with 1 occurrence)\n  const uniquePatterns = Array.from(stepGroups.values()).filter(\n    (g) => g.length === 1\n  ).length;\n\n  // Convert to extraction candidates format\n  const extractionCandidates: ExtractionCandidate[] = duplicateGroups.map((group) => ({\n    pattern: group.normalizedCode,\n    originalCode: group.originalSamples[0] || group.normalizedCode,\n    occurrences: group.occurrences.length,\n    journeys: [...new Set(group.occurrences.map((o) => o.journey))],\n    files: [...new Set(group.occurrences.map((o) => o.file))],\n    category: group.category as ExtractionCandidate['category'],\n    score: (group.occurrences.length * 0.3 + group.uniqueJourneys * 0.4 + group.internalSimilarity * 0.3),\n    recommendation:\n      group.occurrences.length >= 3 ? 'EXTRACT_NOW' :\n      group.occurrences.length >= 2 ? 'CONSIDER' : 'SKIP',\n  }));\n\n  return {\n    totalSteps: allSteps.length,\n    uniquePatterns,\n    duplicatePatterns: duplicateGroups.length,\n    duplicateGroups,\n    extractionCandidates: extractionCandidates.sort((a, b) => b.score - a.score),\n    filesAnalyzed: testFiles,\n  };\n}\n\n/**\n * Detect duplicates within a single file\n *\n * @param filePath - Path to the test file\n * @param options - Detection options\n * @returns Duplicate detection result\n */\nexport function detectDuplicatesInFile(\n  filePath: string,\n  options: DetectionOptions = {}\n): DuplicateDetectionResult {\n  const {\n    similarityThreshold = 0.8,\n    minOccurrences = 2,\n    minLines = 2, // Lower threshold for single file\n  } = options;\n\n  if (!fs.existsSync(filePath)) {\n    return {\n      totalSteps: 0,\n      uniquePatterns: 0,\n      duplicatePatterns: 0,\n      duplicateGroups: [],\n      extractionCandidates: [],\n      filesAnalyzed: [],\n    };\n  }\n\n  const content = fs.readFileSync(filePath, 'utf-8');\n  const steps = parseTestSteps(filePath, content);\n\n  // Group similar patterns\n  const stepGroups = groupSimilarPatterns(steps, similarityThreshold, minLines);\n\n  // Build duplicate groups\n  const duplicateGroups = buildDuplicateGroups(stepGroups, minOccurrences);\n\n  // Count unique patterns\n  const uniquePatterns = Array.from(stepGroups.values()).filter(\n    (g) => g.length === 1\n  ).length;\n\n  // Convert to extraction candidates\n  const extractionCandidates: ExtractionCandidate[] = duplicateGroups.map((group) => {\n    const firstOccurrence = group.occurrences[0];\n    return {\n      pattern: group.normalizedCode,\n      originalCode: group.originalSamples[0] || group.normalizedCode,\n      occurrences: group.occurrences.length,\n      journeys: firstOccurrence ? [firstOccurrence.journey] : [],\n      files: [filePath],\n      category: group.category as ExtractionCandidate['category'],\n      score: group.occurrences.length * 0.5 + group.internalSimilarity * 0.5,\n      recommendation: group.occurrences.length >= 2 ? 'CONSIDER' : 'SKIP',\n    };\n  });\n\n  return {\n    totalSteps: steps.length,\n    uniquePatterns,\n    duplicatePatterns: duplicateGroups.length,\n    duplicateGroups,\n    extractionCandidates: extractionCandidates.sort((a, b) => b.score - a.score),\n    filesAnalyzed: [filePath],\n  };\n}\n\n/**\n * Find patterns in test files that match existing components\n *\n * Useful for identifying code that should be refactored to use components.\n *\n * @param testDir - Directory containing test files\n * @param components - Existing components to match against\n * @param options - Detection options\n * @returns Array of matches with component and location\n */\nexport function findUnusedComponentOpportunities(\n  testDir: string,\n  components: Component[],\n  options: DetectionOptions = {}\n): Array<{\n  component: Component;\n  matches: Array<{\n    file: string;\n    stepName: string;\n    similarity: number;\n    lineStart: number;\n    lineEnd: number;\n  }>;\n}> {\n  const {\n    similarityThreshold = 0.6, // Lower threshold for opportunities\n    extensions = DEFAULT_EXTENSIONS,\n    excludeDirs = DEFAULT_EXCLUDE_DIRS,\n  } = options;\n\n  const testFiles = findTestFiles(testDir, extensions, excludeDirs);\n  const opportunities: Map<string, Array<{\n    file: string;\n    stepName: string;\n    similarity: number;\n    lineStart: number;\n    lineEnd: number;\n  }>> = new Map();\n\n  // Initialize map for each component\n  for (const component of components) {\n    if (!component.archived) {\n      opportunities.set(component.id, []);\n    }\n  }\n\n  // Scan all test files\n  for (const file of testFiles) {\n    try {\n      const content = fs.readFileSync(file, 'utf-8');\n      const steps = parseTestSteps(file, content);\n\n      for (const step of steps) {\n        const normalizedStep = normalizeCode(step.code);\n\n        // Compare against each component\n        for (const component of components) {\n          if (component.archived) continue;\n\n          const normalizedComponent = normalizeCode(component.source.originalCode);\n          const similarity = calculateSimilarity(normalizedStep, normalizedComponent);\n\n          if (similarity >= similarityThreshold) {\n            const componentOpportunities = opportunities.get(component.id);\n            if (componentOpportunities) {\n              componentOpportunities.push({\n                file: step.file,\n                stepName: step.stepName,\n                similarity,\n                lineStart: step.lineStart,\n                lineEnd: step.lineEnd,\n              });\n            }\n          }\n        }\n      }\n    } catch {\n      // Skip unreadable files\n    }\n  }\n\n  // Convert to result format\n  return components\n    .filter((c) => {\n      if (c.archived) return false;\n      const ops = opportunities.get(c.id);\n      return ops && ops.length > 0;\n    })\n    .map((component) => ({\n      component,\n      matches: (opportunities.get(component.id) || []).sort((a, b) => b.similarity - a.similarity),\n    }))\n    .sort((a, b) => b.matches.length - a.matches.length);\n}\n","/**\n * LLKB Module Registry Module\n *\n * This module provides functions to manage the module registry,\n * which tracks all exported components and their metadata.\n *\n * @module llkb/registry\n */\n\nimport * as fs from 'fs';\nimport * as path from 'path';\nimport type { Component, ComponentCategory, SaveResult } from './types.js';\nimport { saveJSONAtomic, loadJSON } from './file-utils.js';\n\n// =============================================================================\n// Types\n// =============================================================================\n\n/**\n * An export entry in the module registry\n */\nexport interface ModuleExport {\n  /** Export name */\n  name: string;\n\n  /** Export type (async function, function, class, const) */\n  type: 'async function' | 'function' | 'class' | 'const' | 'type';\n\n  /** Component ID (if registered in components.json) */\n  componentId?: string;\n\n  /** TypeScript signature */\n  signature: string;\n\n  /** Description */\n  description: string;\n}\n\n/**\n * A module entry in the registry\n */\nexport interface ModuleEntry {\n  /** Module name */\n  name: string;\n\n  /** Module path (relative to modules directory) */\n  path: string;\n\n  /** Module description */\n  description: string;\n\n  /** Exports from this module */\n  exports: ModuleExport[];\n\n  /** Dependencies on other modules */\n  dependencies: string[];\n\n  /** Peer dependencies (external packages) */\n  peerDependencies: string[];\n\n  /** Module version */\n  version?: string;\n\n  /** Last updated timestamp */\n  lastUpdated?: string;\n}\n\n/**\n * The modules registry.json file structure\n */\nexport interface ModuleRegistry {\n  /** Schema version */\n  version: string;\n\n  /** Last updated timestamp */\n  lastUpdated: string;\n\n  /** All modules in the registry */\n  modules: ModuleEntry[];\n\n  /** Quick lookup: component ID to module path */\n  componentToModule: Record<string, string>;\n\n  /** Quick lookup: export name to module path */\n  exportToModule: Record<string, string>;\n}\n\n/**\n * Options for adding a component to the registry\n */\nexport interface AddToRegistryOptions {\n  /** Module name (e.g., 'navigation') */\n  moduleName: string;\n\n  /** Module path (e.g., 'foundation/navigation') */\n  modulePath: string;\n\n  /** Module description */\n  moduleDescription?: string;\n\n  /** Export details */\n  exportDetails: {\n    name: string;\n    type: ModuleExport['type'];\n    signature: string;\n    description: string;\n  };\n\n  /** Dependencies */\n  dependencies?: string[];\n\n  /** Peer dependencies */\n  peerDependencies?: string[];\n}\n\n// =============================================================================\n// Constants\n// =============================================================================\n\n/** Default registry file name */\nconst REGISTRY_FILENAME = 'registry.json';\n\n/** Default modules directory */\nconst DEFAULT_MODULES_DIR = 'src/modules';\n\n// =============================================================================\n// Registry Management Functions\n// =============================================================================\n\n/**\n * Get the registry file path\n */\nfunction getRegistryPath(harnessRoot: string): string {\n  return path.join(harnessRoot, DEFAULT_MODULES_DIR, REGISTRY_FILENAME);\n}\n\n/**\n * Create an empty registry\n */\nexport function createEmptyRegistry(): ModuleRegistry {\n  return {\n    version: '1.0.0',\n    lastUpdated: new Date().toISOString(),\n    modules: [],\n    componentToModule: {},\n    exportToModule: {},\n  };\n}\n\n/**\n * Load the module registry\n *\n * @param harnessRoot - Root directory of the test harness\n * @returns The module registry or null if not found\n */\nexport function loadRegistry(harnessRoot: string): ModuleRegistry | null {\n  const registryPath = getRegistryPath(harnessRoot);\n\n  try {\n    const data = loadJSON<ModuleRegistry>(registryPath);\n    return data || createEmptyRegistry();\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Save the module registry\n *\n * @param harnessRoot - Root directory of the test harness\n * @param registry - Registry to save\n * @returns Save result\n */\nexport async function saveRegistry(\n  harnessRoot: string,\n  registry: ModuleRegistry\n): Promise<SaveResult> {\n  const registryPath = getRegistryPath(harnessRoot);\n\n  // Update timestamp\n  registry.lastUpdated = new Date().toISOString();\n\n  // Ensure directory exists\n  const dir = path.dirname(registryPath);\n  if (!fs.existsSync(dir)) {\n    fs.mkdirSync(dir, { recursive: true });\n  }\n\n  return saveJSONAtomic(registryPath, registry);\n}\n\n/**\n * Rebuild lookup indexes in registry\n */\nfunction rebuildIndexes(registry: ModuleRegistry): void {\n  registry.componentToModule = {};\n  registry.exportToModule = {};\n\n  for (const module of registry.modules) {\n    for (const exp of module.exports) {\n      if (exp.componentId) {\n        registry.componentToModule[exp.componentId] = module.path;\n      }\n      registry.exportToModule[exp.name] = module.path;\n    }\n  }\n}\n\n/**\n * Add a component to the module registry\n *\n * If the module exists, adds the export to it. If not, creates a new module entry.\n *\n * @param harnessRoot - Root directory of the test harness\n * @param component - The component to register\n * @param options - Registration options\n * @returns Save result\n *\n * @example\n * ```typescript\n * await addComponentToRegistry(\n *   'artk-e2e',\n *   component,\n *   {\n *     moduleName: 'navigation',\n *     modulePath: 'foundation/navigation',\n *     moduleDescription: 'Navigation utilities',\n *     exportDetails: {\n *       name: 'verifySidebarReady',\n *       type: 'async function',\n *       signature: 'verifySidebarReady(page: Page, options?: Options): Promise<void>',\n *       description: 'Verify sidebar is loaded and interactive',\n *     },\n *   }\n * );\n * ```\n */\nexport async function addComponentToRegistry(\n  harnessRoot: string,\n  component: Component,\n  options: AddToRegistryOptions\n): Promise<SaveResult> {\n  // Load existing registry\n  let registry = loadRegistry(harnessRoot);\n  if (!registry) {\n    registry = createEmptyRegistry();\n  }\n\n  // Find or create module entry\n  let moduleEntry = registry.modules.find((m) => m.path === options.modulePath);\n\n  if (!moduleEntry) {\n    moduleEntry = {\n      name: options.moduleName,\n      path: options.modulePath,\n      description: options.moduleDescription || `${options.moduleName} utilities`,\n      exports: [],\n      dependencies: options.dependencies || [],\n      peerDependencies: options.peerDependencies || ['@playwright/test'],\n      lastUpdated: new Date().toISOString(),\n    };\n    registry.modules.push(moduleEntry);\n  }\n\n  // Check if export already exists\n  const existingExport = moduleEntry.exports.find((e) => e.name === options.exportDetails.name);\n\n  if (existingExport) {\n    // Update existing export\n    existingExport.componentId = component.id;\n    existingExport.signature = options.exportDetails.signature;\n    existingExport.description = options.exportDetails.description;\n  } else {\n    // Add new export\n    moduleEntry.exports.push({\n      name: options.exportDetails.name,\n      type: options.exportDetails.type,\n      componentId: component.id,\n      signature: options.exportDetails.signature,\n      description: options.exportDetails.description,\n    });\n  }\n\n  // Update module timestamp\n  moduleEntry.lastUpdated = new Date().toISOString();\n\n  // Rebuild indexes\n  rebuildIndexes(registry);\n\n  // Save registry\n  return saveRegistry(harnessRoot, registry);\n}\n\n/**\n * Remove a component from the registry\n *\n * @param harnessRoot - Root directory of the test harness\n * @param componentId - ID of the component to remove\n * @returns Save result\n */\nexport async function removeComponentFromRegistry(\n  harnessRoot: string,\n  componentId: string\n): Promise<SaveResult> {\n  const registry = loadRegistry(harnessRoot);\n  if (!registry) {\n    return { success: false, error: 'Registry not found' };\n  }\n\n  // Find and remove the export\n  let found = false;\n  for (const module of registry.modules) {\n    const exportIndex = module.exports.findIndex((e) => e.componentId === componentId);\n    if (exportIndex !== -1) {\n      module.exports.splice(exportIndex, 1);\n      module.lastUpdated = new Date().toISOString();\n      found = true;\n      break;\n    }\n  }\n\n  if (!found) {\n    return { success: false, error: `Component ${componentId} not found in registry` };\n  }\n\n  // Rebuild indexes\n  rebuildIndexes(registry);\n\n  // Save registry\n  return saveRegistry(harnessRoot, registry);\n}\n\n/**\n * Update component details in the registry\n *\n * @param harnessRoot - Root directory of the test harness\n * @param componentId - ID of the component to update\n * @param updates - Fields to update\n * @returns Save result\n */\nexport async function updateComponentInRegistry(\n  harnessRoot: string,\n  componentId: string,\n  updates: Partial<{\n    signature: string;\n    description: string;\n    type: ModuleExport['type'];\n  }>\n): Promise<SaveResult> {\n  const registry = loadRegistry(harnessRoot);\n  if (!registry) {\n    return { success: false, error: 'Registry not found' };\n  }\n\n  // Find the export\n  let found = false;\n  for (const module of registry.modules) {\n    const exportEntry = module.exports.find((e) => e.componentId === componentId);\n    if (exportEntry) {\n      if (updates.signature !== undefined) {\n        exportEntry.signature = updates.signature;\n      }\n      if (updates.description !== undefined) {\n        exportEntry.description = updates.description;\n      }\n      if (updates.type !== undefined) {\n        exportEntry.type = updates.type;\n      }\n      module.lastUpdated = new Date().toISOString();\n      found = true;\n      break;\n    }\n  }\n\n  if (!found) {\n    return { success: false, error: `Component ${componentId} not found in registry` };\n  }\n\n  // Save registry\n  return saveRegistry(harnessRoot, registry);\n}\n\n/**\n * Get module info for a component\n *\n * @param harnessRoot - Root directory of the test harness\n * @param componentId - Component ID\n * @returns Module entry and export info, or null if not found\n */\nexport function getModuleForComponent(\n  harnessRoot: string,\n  componentId: string\n): { module: ModuleEntry; export: ModuleExport } | null {\n  const registry = loadRegistry(harnessRoot);\n  if (!registry) {\n    return null;\n  }\n\n  const modulePath = registry.componentToModule[componentId];\n  if (!modulePath) {\n    return null;\n  }\n\n  const module = registry.modules.find((m) => m.path === modulePath);\n  if (!module) {\n    return null;\n  }\n\n  const exportEntry = module.exports.find((e) => e.componentId === componentId);\n  if (!exportEntry) {\n    return null;\n  }\n\n  return { module, export: exportEntry };\n}\n\n/**\n * Get the import path for a component\n *\n * @param harnessRoot - Root directory of the test harness\n * @param componentId - Component ID\n * @returns Import statement or null if not found\n *\n * @example\n * ```typescript\n * const importPath = getImportPath('artk-e2e', 'COMP001');\n * // Returns: \"import { verifySidebarReady } from '@modules/foundation/navigation';\"\n * ```\n */\nexport function getImportPath(harnessRoot: string, componentId: string): string | null {\n  const info = getModuleForComponent(harnessRoot, componentId);\n  if (!info) {\n    return null;\n  }\n\n  return `import { ${info.export.name} } from '@modules/${info.module.path}';`;\n}\n\n/**\n * List all modules in the registry\n *\n * @param harnessRoot - Root directory of the test harness\n * @returns Array of module entries\n */\nexport function listModules(harnessRoot: string): ModuleEntry[] {\n  const registry = loadRegistry(harnessRoot);\n  return registry?.modules || [];\n}\n\n/**\n * Find modules by category\n *\n * @param harnessRoot - Root directory of the test harness\n * @param category - Category to filter by\n * @returns Array of modules that have components in the given category\n */\nexport function findModulesByCategory(\n  harnessRoot: string,\n  category: ComponentCategory\n): ModuleEntry[] {\n  const registry = loadRegistry(harnessRoot);\n  if (!registry) {\n    return [];\n  }\n\n  // Category is typically in the module path (e.g., 'foundation/navigation')\n  return registry.modules.filter(\n    (m) => m.path.includes(category) || m.name.includes(category)\n  );\n}\n\n/**\n * Validate registry consistency with components.json\n *\n * @param harnessRoot - Root directory of the test harness\n * @param components - Components from components.json\n * @returns Validation result with inconsistencies\n */\nexport function validateRegistryConsistency(\n  harnessRoot: string,\n  components: Component[]\n): {\n  valid: boolean;\n  missingInRegistry: string[];\n  missingInComponents: string[];\n  pathMismatches: Array<{ componentId: string; registryPath: string; componentPath: string }>;\n} {\n  const registry = loadRegistry(harnessRoot);\n\n  const result = {\n    valid: true,\n    missingInRegistry: [] as string[],\n    missingInComponents: [] as string[],\n    pathMismatches: [] as Array<{ componentId: string; registryPath: string; componentPath: string }>,\n  };\n\n  if (!registry) {\n    result.valid = false;\n    result.missingInRegistry = components.filter((c) => !c.archived).map((c) => c.id);\n    return result;\n  }\n\n  // Get all component IDs in registry\n  const registryComponentIds = new Set<string>();\n  for (const module of registry.modules) {\n    for (const exp of module.exports) {\n      if (exp.componentId) {\n        registryComponentIds.add(exp.componentId);\n      }\n    }\n  }\n\n  // Check each active component is in registry\n  for (const component of components) {\n    if (component.archived) continue;\n\n    if (!registryComponentIds.has(component.id)) {\n      result.missingInRegistry.push(component.id);\n      result.valid = false;\n    } else {\n      // Check path matches\n      const modulePath = registry.componentToModule[component.id];\n      if (modulePath && !component.filePath.includes(modulePath)) {\n        result.pathMismatches.push({\n          componentId: component.id,\n          registryPath: modulePath,\n          componentPath: component.filePath,\n        });\n        result.valid = false;\n      }\n    }\n  }\n\n  // Check each registry component exists in components.json\n  const componentIds = new Set(components.map((c) => c.id));\n  for (const componentId of registryComponentIds) {\n    if (!componentIds.has(componentId)) {\n      result.missingInComponents.push(componentId);\n      result.valid = false;\n    }\n  }\n\n  return result;\n}\n\n/**\n * Synchronize registry with components.json\n *\n * Adds missing components and removes stale entries.\n *\n * @param harnessRoot - Root directory of the test harness\n * @param components - Components from components.json\n * @returns Save result\n */\nexport async function syncRegistryWithComponents(\n  harnessRoot: string,\n  components: Component[]\n): Promise<SaveResult & { added: number; removed: number }> {\n  const validation = validateRegistryConsistency(harnessRoot, components);\n\n  let registry = loadRegistry(harnessRoot);\n  if (!registry) {\n    registry = createEmptyRegistry();\n  }\n\n  let added = 0;\n  let removed = 0;\n\n  // Remove stale entries\n  for (const staleId of validation.missingInComponents) {\n    for (const module of registry.modules) {\n      const index = module.exports.findIndex((e) => e.componentId === staleId);\n      if (index !== -1) {\n        module.exports.splice(index, 1);\n        removed++;\n      }\n    }\n  }\n\n  // Remove empty modules\n  registry.modules = registry.modules.filter((m) => m.exports.length > 0);\n\n  // Note: We don't auto-add missing components because we need the module path info\n  // which comes from the extraction process. Just count them for reporting.\n  added = validation.missingInRegistry.length;\n\n  // Rebuild indexes\n  rebuildIndexes(registry);\n\n  // Save\n  const saveResult = await saveRegistry(harnessRoot, registry);\n\n  return {\n    ...saveResult,\n    added,\n    removed,\n  };\n}\n","/**\n * LLKB Migration Module\n *\n * This module provides utilities for migrating LLKB data between versions,\n * upgrading schemas, and handling backward compatibility.\n *\n * @module llkb/migration\n */\n\nimport * as fs from 'fs';\nimport * as path from 'path';\nimport type {\n  LessonsFile,\n  ComponentsFile,\n  SaveResult,\n} from './types.js';\nimport { saveJSONAtomic, loadJSON, ensureDir } from './file-utils.js';\nimport { createEmptyAnalytics } from './analytics.js';\n\n// =============================================================================\n// Types\n// =============================================================================\n\n/**\n * Migration result\n */\nexport interface MigrationResult {\n  /** Whether migration succeeded */\n  success: boolean;\n\n  /** Files that were migrated */\n  migratedFiles: string[];\n\n  /** Errors encountered */\n  errors: string[];\n\n  /** Warnings */\n  warnings: string[];\n\n  /** Version before migration */\n  fromVersion: string;\n\n  /** Version after migration */\n  toVersion: string;\n}\n\n/**\n * Schema version info\n */\nexport interface VersionInfo {\n  /** Major version */\n  major: number;\n\n  /** Minor version */\n  minor: number;\n\n  /** Patch version */\n  patch: number;\n\n  /** Full version string */\n  full: string;\n}\n\n/**\n * Migration function signature\n */\ntype MigrationFn = (data: any, llkbRoot: string) => Promise<{ data: any; warnings: string[] }>;\n\n// =============================================================================\n// Constants\n// =============================================================================\n\n/** Current schema version */\nexport const CURRENT_VERSION = '1.0.0';\n\n/** Minimum supported version */\nexport const MIN_SUPPORTED_VERSION = '0.1.0';\n\n// =============================================================================\n// Version Parsing\n// =============================================================================\n\n/**\n * Parse a version string into components\n */\nexport function parseVersion(version: string): VersionInfo {\n  const match = version.match(/^(\\d+)\\.(\\d+)\\.(\\d+)/);\n  if (!match) {\n    return { major: 0, minor: 0, patch: 0, full: '0.0.0' };\n  }\n\n  const major = match[1] || '0';\n  const minor = match[2] || '0';\n  const patch = match[3] || '0';\n\n  return {\n    major: parseInt(major, 10),\n    minor: parseInt(minor, 10),\n    patch: parseInt(patch, 10),\n    full: `${major}.${minor}.${patch}`,\n  };\n}\n\n/**\n * Compare two versions\n * @returns -1 if a < b, 0 if equal, 1 if a > b\n */\nexport function compareVersions(a: string, b: string): number {\n  const va = parseVersion(a);\n  const vb = parseVersion(b);\n\n  if (va.major !== vb.major) return va.major < vb.major ? -1 : 1;\n  if (va.minor !== vb.minor) return va.minor < vb.minor ? -1 : 1;\n  if (va.patch !== vb.patch) return va.patch < vb.patch ? -1 : 1;\n  return 0;\n}\n\n/**\n * Check if a version is supported\n */\nexport function isVersionSupported(version: string): boolean {\n  return compareVersions(version, MIN_SUPPORTED_VERSION) >= 0;\n}\n\n/**\n * Check if migration is needed\n */\nexport function needsMigration(version: string): boolean {\n  return compareVersions(version, CURRENT_VERSION) < 0;\n}\n\n// =============================================================================\n// Migration Functions by Version\n// =============================================================================\n\n/**\n * Registry of migrations from version to version\n */\nconst migrations: Map<string, MigrationFn> = new Map();\n\n// Migration from 0.x to 1.0.0\nmigrations.set('0.x->1.0.0', async (data: any, _llkbRoot: string) => {\n  const warnings: string[] = [];\n\n  // Handle lessons migration\n  if (data.lessons && Array.isArray(data.lessons)) {\n    data.lessons = data.lessons.map((lesson: any) => {\n      // Ensure required fields exist\n      if (!lesson.metrics) {\n        lesson.metrics = {\n          occurrences: lesson.occurrences || 0,\n          successRate: lesson.successRate || 0.5,\n          confidence: lesson.confidence || 0.5,\n          firstSeen: lesson.createdAt || new Date().toISOString(),\n          lastSuccess: null,\n          lastApplied: null,\n        };\n        warnings.push(`Added missing metrics to lesson ${lesson.id}`);\n      }\n\n      if (!lesson.validation) {\n        lesson.validation = {\n          humanReviewed: false,\n        };\n      }\n\n      // Migrate old field names\n      if (lesson.created && !lesson.metrics.firstSeen) {\n        lesson.metrics.firstSeen = lesson.created;\n        delete lesson.created;\n      }\n\n      return lesson;\n    });\n  }\n\n  // Handle components migration\n  if (data.components && Array.isArray(data.components)) {\n    data.components = data.components.map((component: any) => {\n      // Ensure required fields exist\n      if (!component.metrics) {\n        component.metrics = {\n          totalUses: component.uses || 0,\n          successRate: 1.0,\n          lastUsed: null,\n        };\n        delete component.uses;\n        warnings.push(`Added missing metrics to component ${component.id}`);\n      }\n\n      if (!component.source) {\n        component.source = {\n          originalCode: component.code || '',\n          extractedFrom: component.journeyId || 'unknown',\n          extractedBy: 'journey-verify',\n          extractedAt: component.createdAt || new Date().toISOString(),\n        };\n        delete component.code;\n        delete component.journeyId;\n        warnings.push(`Added missing source info to component ${component.id}`);\n      }\n\n      return component;\n    });\n  }\n\n  // Update version\n  data.version = '1.0.0';\n  data.lastUpdated = new Date().toISOString();\n\n  return { data, warnings };\n});\n\n// =============================================================================\n// Core Migration Functions\n// =============================================================================\n\n/**\n * Get the appropriate migration path\n */\nfunction getMigrationPath(fromVersion: string, toVersion: string): string[] {\n  const from = parseVersion(fromVersion);\n  const to = parseVersion(toVersion);\n  const path: string[] = [];\n\n  // For now, we have a simple migration path\n  // Future versions can add more granular migrations\n  if (from.major === 0 && to.major >= 1) {\n    path.push('0.x->1.0.0');\n  }\n\n  return path;\n}\n\n/**\n * Apply a single migration\n */\nasync function applyMigration(\n  data: any,\n  migrationKey: string,\n  llkbRoot: string\n): Promise<{ data: any; warnings: string[] }> {\n  const migrationFn = migrations.get(migrationKey);\n  if (!migrationFn) {\n    return { data, warnings: [`No migration found for ${migrationKey}`] };\n  }\n\n  return migrationFn(data, llkbRoot);\n}\n\n/**\n * Migrate a single file\n */\nasync function migrateFile(\n  filePath: string,\n  llkbRoot: string\n): Promise<{ success: boolean; warnings: string[]; error?: string }> {\n  try {\n    // Read current file\n    const data = loadJSON<any>(filePath);\n    if (!data) {\n      return { success: false, warnings: [], error: `Could not read ${filePath}` };\n    }\n\n    const currentVersion = data.version || '0.0.0';\n\n    // Check if migration is needed\n    if (!needsMigration(currentVersion)) {\n      return { success: true, warnings: ['Already at current version'] };\n    }\n\n    // Check if version is supported\n    if (!isVersionSupported(currentVersion)) {\n      return {\n        success: false,\n        warnings: [],\n        error: `Version ${currentVersion} is not supported (min: ${MIN_SUPPORTED_VERSION})`,\n      };\n    }\n\n    // Get migration path\n    const migrationPath = getMigrationPath(currentVersion, CURRENT_VERSION);\n\n    let migratedData = data;\n    const allWarnings: string[] = [];\n\n    // Apply each migration in sequence\n    for (const migrationKey of migrationPath) {\n      const result = await applyMigration(migratedData, migrationKey, llkbRoot);\n      migratedData = result.data;\n      allWarnings.push(...result.warnings);\n    }\n\n    // Create backup\n    const backupPath = `${filePath}.backup.${Date.now()}`;\n    fs.copyFileSync(filePath, backupPath);\n\n    // Save migrated data\n    const saveResult = await saveJSONAtomic(filePath, migratedData);\n    if (!saveResult.success) {\n      // Restore backup\n      fs.copyFileSync(backupPath, filePath);\n      return { success: false, warnings: allWarnings, error: saveResult.error };\n    }\n\n    // Remove backup on success (optional - could keep for safety)\n    fs.unlinkSync(backupPath);\n\n    return { success: true, warnings: allWarnings };\n  } catch (error) {\n    return {\n      success: false,\n      warnings: [],\n      error: error instanceof Error ? error.message : 'Unknown error',\n    };\n  }\n}\n\n/**\n * Migrate all LLKB files to the current version\n *\n * @param llkbRoot - Root directory of LLKB\n * @returns Migration result\n *\n * @example\n * ```typescript\n * const result = await migrateLLKB('.artk/llkb');\n * if (result.success) {\n *   console.log(`Migrated ${result.migratedFiles.length} files`);\n * }\n * ```\n */\nexport async function migrateLLKB(llkbRoot: string): Promise<MigrationResult> {\n  const result: MigrationResult = {\n    success: true,\n    migratedFiles: [],\n    errors: [],\n    warnings: [],\n    fromVersion: '0.0.0',\n    toVersion: CURRENT_VERSION,\n  };\n\n  // Files to migrate\n  const files = [\n    path.join(llkbRoot, 'lessons.json'),\n    path.join(llkbRoot, 'components.json'),\n    path.join(llkbRoot, 'analytics.json'),\n  ];\n\n  // Get initial version from lessons.json\n  const lessonsPath = path.join(llkbRoot, 'lessons.json');\n  if (fs.existsSync(lessonsPath)) {\n    const lessonsData = loadJSON<any>(lessonsPath);\n    result.fromVersion = lessonsData?.version || '0.0.0';\n  }\n\n  // Migrate each file\n  for (const file of files) {\n    if (!fs.existsSync(file)) {\n      result.warnings.push(`File not found: ${file}`);\n      continue;\n    }\n\n    const migrationResult = await migrateFile(file, llkbRoot);\n\n    if (migrationResult.success) {\n      result.migratedFiles.push(file);\n    } else {\n      result.success = false;\n      if (migrationResult.error) {\n        result.errors.push(`${file}: ${migrationResult.error}`);\n      }\n    }\n\n    result.warnings.push(...migrationResult.warnings.map((w) => `${path.basename(file)}: ${w}`));\n  }\n\n  return result;\n}\n\n/**\n * Check if LLKB needs migration\n *\n * @param llkbRoot - Root directory of LLKB\n * @returns Version check result\n */\nexport function checkMigrationNeeded(llkbRoot: string): {\n  needsMigration: boolean;\n  currentVersion: string;\n  targetVersion: string;\n  supported: boolean;\n} {\n  const lessonsPath = path.join(llkbRoot, 'lessons.json');\n\n  if (!fs.existsSync(lessonsPath)) {\n    return {\n      needsMigration: false,\n      currentVersion: CURRENT_VERSION,\n      targetVersion: CURRENT_VERSION,\n      supported: true,\n    };\n  }\n\n  const lessonsData = loadJSON<any>(lessonsPath);\n  const currentVersion = lessonsData?.version || '0.0.0';\n\n  return {\n    needsMigration: needsMigration(currentVersion),\n    currentVersion,\n    targetVersion: CURRENT_VERSION,\n    supported: isVersionSupported(currentVersion),\n  };\n}\n\n// =============================================================================\n// Initialization Functions\n// =============================================================================\n\n/**\n * Initialize LLKB directory structure with default files\n *\n * @param llkbRoot - Root directory for LLKB\n * @returns Save result\n *\n * @example\n * ```typescript\n * const result = await initializeLLKB('.artk/llkb');\n * ```\n */\nexport async function initializeLLKB(llkbRoot: string): Promise<SaveResult> {\n  try {\n    // Create directories\n    ensureDir(llkbRoot);\n    ensureDir(path.join(llkbRoot, 'patterns'));\n    ensureDir(path.join(llkbRoot, 'history'));\n\n    // Create default config.yml if not exists\n    const configPath = path.join(llkbRoot, 'config.yml');\n    if (!fs.existsSync(configPath)) {\n      const defaultConfig = `# LLKB Configuration\nversion: \"1.0.0\"\nenabled: true\n\nextraction:\n  minOccurrences: 2\n  predictiveExtraction: true\n  confidenceThreshold: 0.7\n  maxPredictivePerJourney: 3\n  maxPredictivePerDay: 10\n  minLinesForExtraction: 3\n  similarityThreshold: 0.8\n\nretention:\n  maxLessonAge: 90\n  minSuccessRate: 0.6\n  archiveUnused: 30\n\nhistory:\n  retentionDays: 365\n\ninjection:\n  prioritizeByConfidence: true\n\nscopes:\n  universal: true\n  frameworkSpecific: true\n  appSpecific: true\n\noverrides:\n  allowUserOverride: true\n  logOverrides: true\n  flagAfterOverrides: 3\n`;\n      fs.writeFileSync(configPath, defaultConfig, 'utf-8');\n    }\n\n    // Create default lessons.json if not exists\n    const lessonsPath = path.join(llkbRoot, 'lessons.json');\n    if (!fs.existsSync(lessonsPath)) {\n      const defaultLessons: LessonsFile = {\n        version: CURRENT_VERSION,\n        lastUpdated: new Date().toISOString(),\n        lessons: [],\n        archived: [],\n        globalRules: [],\n        appQuirks: [],\n      };\n      await saveJSONAtomic(lessonsPath, defaultLessons);\n    }\n\n    // Create default components.json if not exists\n    const componentsPath = path.join(llkbRoot, 'components.json');\n    if (!fs.existsSync(componentsPath)) {\n      const defaultComponents: ComponentsFile = {\n        version: CURRENT_VERSION,\n        lastUpdated: new Date().toISOString(),\n        components: [],\n        componentsByCategory: {\n          selector: [],\n          timing: [],\n          auth: [],\n          data: [],\n          assertion: [],\n          navigation: [],\n          'ui-interaction': [],\n        },\n        componentsByScope: {\n          universal: [],\n          'framework:angular': [],\n          'framework:react': [],\n          'framework:vue': [],\n          'framework:ag-grid': [],\n          'app-specific': [],\n        },\n      };\n      await saveJSONAtomic(componentsPath, defaultComponents);\n    }\n\n    // Create default analytics.json if not exists\n    const analyticsPath = path.join(llkbRoot, 'analytics.json');\n    if (!fs.existsSync(analyticsPath)) {\n      const defaultAnalytics = createEmptyAnalytics();\n      await saveJSONAtomic(analyticsPath, defaultAnalytics);\n    }\n\n    // Create default pattern files if not exist\n    const patternFiles = ['selectors.json', 'timing.json', 'assertions.json', 'auth.json', 'data.json'];\n    for (const patternFile of patternFiles) {\n      const patternPath = path.join(llkbRoot, 'patterns', patternFile);\n      if (!fs.existsSync(patternPath)) {\n        await saveJSONAtomic(patternPath, {\n          version: CURRENT_VERSION,\n          patterns: [],\n        });\n      }\n    }\n\n    return { success: true };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Unknown error',\n    };\n  }\n}\n\n/**\n * Validate LLKB installation\n *\n * @param llkbRoot - Root directory of LLKB\n * @returns Validation result\n */\nexport function validateLLKBInstallation(llkbRoot: string): {\n  valid: boolean;\n  missingFiles: string[];\n  invalidFiles: string[];\n  version: string;\n} {\n  const result = {\n    valid: true,\n    missingFiles: [] as string[],\n    invalidFiles: [] as string[],\n    version: CURRENT_VERSION,\n  };\n\n  // Required files\n  const requiredFiles = [\n    'config.yml',\n    'lessons.json',\n    'components.json',\n    'analytics.json',\n  ];\n\n  for (const file of requiredFiles) {\n    const filePath = path.join(llkbRoot, file);\n    if (!fs.existsSync(filePath)) {\n      result.missingFiles.push(file);\n      result.valid = false;\n    } else if (file.endsWith('.json')) {\n      // Validate JSON\n      try {\n        const data = loadJSON<any>(filePath);\n        if (!data || !data.version) {\n          result.invalidFiles.push(file);\n          result.valid = false;\n        } else if (file === 'lessons.json') {\n          result.version = data.version;\n        }\n      } catch {\n        result.invalidFiles.push(file);\n        result.valid = false;\n      }\n    }\n  }\n\n  // Check patterns directory\n  const patternsDir = path.join(llkbRoot, 'patterns');\n  if (!fs.existsSync(patternsDir)) {\n    result.missingFiles.push('patterns/');\n    result.valid = false;\n  }\n\n  return result;\n}\n","/**\n * LLKB Search and Export Module\n *\n * This module provides search functionality across LLKB data\n * and export capabilities for reports and sharing.\n *\n * @module llkb/search\n */\n\nimport * as fs from 'fs';\nimport type {\n  Lesson,\n  Component,\n  LLKBCategory,\n  ComponentCategory,\n  LLKBScope,\n  AppQuirk,\n  GlobalRule,\n} from './types.js';\nimport { loadLessons, loadComponents, loadAppProfile, loadLLKBConfig } from './loaders.js';\n\n// =============================================================================\n// Types\n// =============================================================================\n\n/**\n * Search query options\n */\nexport interface SearchQuery {\n  /** Text to search for (searches titles, descriptions, patterns) */\n  text?: string;\n\n  /** Filter by category */\n  category?: LLKBCategory | ComponentCategory;\n\n  /** Filter by scope */\n  scope?: LLKBScope;\n\n  /** Filter by tags */\n  tags?: string[];\n\n  /** Filter by minimum confidence */\n  minConfidence?: number;\n\n  /** Filter by journey ID */\n  journeyId?: string;\n\n  /** Include archived items */\n  includeArchived?: boolean;\n\n  /** Maximum results */\n  limit?: number;\n}\n\n/**\n * Unified search result\n */\nexport interface SearchResult {\n  /** Result type */\n  type: 'lesson' | 'component' | 'quirk' | 'rule';\n\n  /** Item ID */\n  id: string;\n\n  /** Title or name */\n  title: string;\n\n  /** Description or pattern */\n  description: string;\n\n  /** Category */\n  category: string;\n\n  /** Scope */\n  scope: LLKBScope;\n\n  /** Relevance score (0.0 - 1.0) */\n  relevance: number;\n\n  /** The original item */\n  item: Lesson | Component | AppQuirk | GlobalRule;\n}\n\n/**\n * Export format\n */\nexport type ExportFormat = 'json' | 'markdown' | 'csv';\n\n/**\n * Export options\n */\nexport interface ExportOptions {\n  /** Export format */\n  format: ExportFormat;\n\n  /** Include archived items */\n  includeArchived?: boolean;\n\n  /** Include metrics */\n  includeMetrics?: boolean;\n\n  /** Include source code */\n  includeSource?: boolean;\n\n  /** Filter by categories */\n  categories?: (LLKBCategory | ComponentCategory)[];\n\n  /** Filter by scopes */\n  scopes?: LLKBScope[];\n}\n\n/**\n * Report section\n */\nexport interface ReportSection {\n  title: string;\n  content: string;\n}\n\n// =============================================================================\n// Search Functions\n// =============================================================================\n\n/**\n * Calculate text relevance score\n */\nfunction calculateTextRelevance(text: string, query: string): number {\n  if (!query) return 1.0;\n\n  const lowerText = text.toLowerCase();\n  const lowerQuery = query.toLowerCase();\n  const queryWords = lowerQuery.split(/\\s+/).filter((w) => w.length > 1);\n\n  if (queryWords.length === 0) return 1.0;\n\n  // Exact match\n  if (lowerText.includes(lowerQuery)) {\n    return 1.0;\n  }\n\n  // Word matches\n  let matchedWords = 0;\n  for (const word of queryWords) {\n    if (lowerText.includes(word)) {\n      matchedWords++;\n    }\n  }\n\n  return matchedWords / queryWords.length;\n}\n\n/**\n * Search lessons\n */\nfunction searchLessons(\n  lessons: Lesson[],\n  query: SearchQuery\n): SearchResult[] {\n  return lessons\n    .filter((lesson) => {\n      // Filter archived\n      if (!query.includeArchived && lesson.archived) {\n        return false;\n      }\n\n      // Filter by category\n      if (query.category && lesson.category !== query.category) {\n        return false;\n      }\n\n      // Filter by scope\n      if (query.scope && lesson.scope !== query.scope) {\n        return false;\n      }\n\n      // Filter by tags\n      if (query.tags && query.tags.length > 0) {\n        const lessonTags = lesson.tags || [];\n        if (!query.tags.some((t) => lessonTags.includes(t))) {\n          return false;\n        }\n      }\n\n      // Filter by confidence\n      if (query.minConfidence !== undefined) {\n        if (lesson.metrics.confidence < query.minConfidence) {\n          return false;\n        }\n      }\n\n      // Filter by journey\n      if (query.journeyId && !lesson.journeyIds.includes(query.journeyId)) {\n        return false;\n      }\n\n      return true;\n    })\n    .map((lesson) => {\n      const searchText = `${lesson.title} ${lesson.pattern} ${lesson.trigger}`;\n      const relevance = calculateTextRelevance(searchText, query.text || '');\n\n      return {\n        type: 'lesson' as const,\n        id: lesson.id,\n        title: lesson.title,\n        description: lesson.pattern,\n        category: lesson.category,\n        scope: lesson.scope,\n        relevance,\n        item: lesson,\n      };\n    })\n    .filter((result) => result.relevance > 0.1);\n}\n\n/**\n * Search components\n */\nfunction searchComponents(\n  components: Component[],\n  query: SearchQuery\n): SearchResult[] {\n  return components\n    .filter((component) => {\n      // Filter archived\n      if (!query.includeArchived && component.archived) {\n        return false;\n      }\n\n      // Filter by category\n      if (query.category && component.category !== query.category) {\n        return false;\n      }\n\n      // Filter by scope\n      if (query.scope && component.scope !== query.scope) {\n        return false;\n      }\n\n      return true;\n    })\n    .map((component) => {\n      const searchText = `${component.name} ${component.description}`;\n      const relevance = calculateTextRelevance(searchText, query.text || '');\n\n      return {\n        type: 'component' as const,\n        id: component.id,\n        title: component.name,\n        description: component.description,\n        category: component.category,\n        scope: component.scope,\n        relevance,\n        item: component,\n      };\n    })\n    .filter((result) => result.relevance > 0.1);\n}\n\n/**\n * Search LLKB data\n *\n * Searches across lessons, components, quirks, and rules.\n *\n * @param llkbRoot - Root directory of LLKB\n * @param query - Search query\n * @returns Array of search results sorted by relevance\n *\n * @example\n * ```typescript\n * const results = search('.artk/llkb', {\n *   text: 'sidebar navigation',\n *   category: 'navigation',\n *   minConfidence: 0.7,\n * });\n * ```\n */\nexport function search(llkbRoot: string, query: SearchQuery): SearchResult[] {\n  const lessons = loadLessons(llkbRoot, { includeArchived: query.includeArchived });\n  const components = loadComponents(llkbRoot, { includeArchived: query.includeArchived });\n\n  // Search all types\n  const lessonResults = searchLessons(lessons, query);\n  const componentResults = searchComponents(components, query);\n\n  // Combine and sort by relevance\n  const allResults = [...lessonResults, ...componentResults];\n  allResults.sort((a, b) => b.relevance - a.relevance);\n\n  // Apply limit\n  if (query.limit && query.limit > 0) {\n    return allResults.slice(0, query.limit);\n  }\n\n  return allResults;\n}\n\n/**\n * Find lessons by pattern\n *\n * Searches for lessons that match a specific code pattern.\n *\n * @param llkbRoot - Root directory of LLKB\n * @param pattern - Pattern to search for\n * @returns Matching lessons\n */\nexport function findLessonsByPattern(llkbRoot: string, pattern: string): Lesson[] {\n  const lessons = loadLessons(llkbRoot);\n\n  return lessons.filter((lesson) => {\n    const lowerPattern = pattern.toLowerCase();\n    const lowerLessonPattern = lesson.pattern.toLowerCase();\n    const lowerTrigger = lesson.trigger.toLowerCase();\n\n    return (\n      lowerLessonPattern.includes(lowerPattern) ||\n      lowerTrigger.includes(lowerPattern)\n    );\n  });\n}\n\n/**\n * Find components by name or description\n *\n * @param llkbRoot - Root directory of LLKB\n * @param searchTerm - Term to search for\n * @returns Matching components\n */\nexport function findComponents(llkbRoot: string, searchTerm: string): Component[] {\n  const components = loadComponents(llkbRoot);\n  const lowerSearch = searchTerm.toLowerCase();\n\n  return components.filter((component) => {\n    return (\n      component.name.toLowerCase().includes(lowerSearch) ||\n      component.description.toLowerCase().includes(lowerSearch)\n    );\n  });\n}\n\n/**\n * Get lessons for a specific journey\n *\n * @param llkbRoot - Root directory of LLKB\n * @param journeyId - Journey ID\n * @returns Lessons associated with the journey\n */\nexport function getLessonsForJourney(llkbRoot: string, journeyId: string): Lesson[] {\n  const lessons = loadLessons(llkbRoot);\n  return lessons.filter((lesson) => lesson.journeyIds.includes(journeyId));\n}\n\n/**\n * Get components for a specific journey\n *\n * @param llkbRoot - Root directory of LLKB\n * @param journeyId - Journey ID\n * @returns Components used in or extracted from the journey\n */\nexport function getComponentsForJourney(llkbRoot: string, journeyId: string): Component[] {\n  const components = loadComponents(llkbRoot);\n  return components.filter(\n    (component) => component.source.extractedFrom === journeyId\n  );\n}\n\n// =============================================================================\n// Export Functions\n// =============================================================================\n\n/**\n * Export lessons to specified format\n */\nfunction exportLessonsToMarkdown(lessons: Lesson[], includeMetrics: boolean): string {\n  let md = '# Lessons\\n\\n';\n\n  const byCategory = new Map<string, Lesson[]>();\n  for (const lesson of lessons) {\n    const category = lesson.category;\n    if (!byCategory.has(category)) {\n      byCategory.set(category, []);\n    }\n    byCategory.get(category)!.push(lesson);\n  }\n\n  for (const [category, categoryLessons] of byCategory) {\n    md += `## ${category.charAt(0).toUpperCase() + category.slice(1)}\\n\\n`;\n\n    for (const lesson of categoryLessons) {\n      md += `### ${lesson.id}: ${lesson.title}\\n\\n`;\n      md += `**Trigger:** ${lesson.trigger}\\n\\n`;\n      md += `**Pattern:** ${lesson.pattern}\\n\\n`;\n      md += `**Scope:** ${lesson.scope}\\n\\n`;\n\n      if (includeMetrics) {\n        md += `**Metrics:**\\n`;\n        md += `- Occurrences: ${lesson.metrics.occurrences}\\n`;\n        md += `- Success Rate: ${(lesson.metrics.successRate * 100).toFixed(1)}%\\n`;\n        md += `- Confidence: ${(lesson.metrics.confidence * 100).toFixed(1)}%\\n`;\n        md += '\\n';\n      }\n\n      md += '---\\n\\n';\n    }\n  }\n\n  return md;\n}\n\n/**\n * Export components to specified format\n */\nfunction exportComponentsToMarkdown(\n  components: Component[],\n  includeMetrics: boolean,\n  includeSource: boolean\n): string {\n  let md = '# Components\\n\\n';\n\n  const byCategory = new Map<string, Component[]>();\n  for (const component of components) {\n    const category = component.category;\n    if (!byCategory.has(category)) {\n      byCategory.set(category, []);\n    }\n    byCategory.get(category)!.push(component);\n  }\n\n  for (const [category, categoryComponents] of byCategory) {\n    md += `## ${category.charAt(0).toUpperCase() + category.slice(1)}\\n\\n`;\n\n    for (const component of categoryComponents) {\n      md += `### ${component.id}: ${component.name}\\n\\n`;\n      md += `${component.description}\\n\\n`;\n      md += `**File:** \\`${component.filePath}\\`\\n\\n`;\n      md += `**Scope:** ${component.scope}\\n\\n`;\n\n      if (includeMetrics) {\n        md += `**Metrics:**\\n`;\n        md += `- Total Uses: ${component.metrics.totalUses}\\n`;\n        md += `- Success Rate: ${(component.metrics.successRate * 100).toFixed(1)}%\\n`;\n        md += '\\n';\n      }\n\n      if (includeSource && component.source.originalCode) {\n        md += '**Original Code:**\\n\\n';\n        md += '```typescript\\n';\n        md += component.source.originalCode;\n        md += '\\n```\\n\\n';\n      }\n\n      md += '---\\n\\n';\n    }\n  }\n\n  return md;\n}\n\n/**\n * Export lessons to CSV\n */\nfunction exportLessonsToCSV(lessons: Lesson[]): string {\n  const headers = [\n    'ID',\n    'Title',\n    'Category',\n    'Scope',\n    'Trigger',\n    'Pattern',\n    'Occurrences',\n    'Success Rate',\n    'Confidence',\n  ];\n\n  const rows = lessons.map((lesson) => [\n    lesson.id,\n    `\"${lesson.title.replace(/\"/g, '\"\"')}\"`,\n    lesson.category,\n    lesson.scope,\n    `\"${lesson.trigger.replace(/\"/g, '\"\"')}\"`,\n    `\"${lesson.pattern.replace(/\"/g, '\"\"')}\"`,\n    lesson.metrics.occurrences.toString(),\n    lesson.metrics.successRate.toFixed(3),\n    lesson.metrics.confidence.toFixed(3),\n  ]);\n\n  return [headers.join(','), ...rows.map((r) => r.join(','))].join('\\n');\n}\n\n/**\n * Export components to CSV\n */\nfunction exportComponentsToCSV(components: Component[]): string {\n  const headers = [\n    'ID',\n    'Name',\n    'Category',\n    'Scope',\n    'File Path',\n    'Description',\n    'Total Uses',\n    'Success Rate',\n    'Extracted From',\n  ];\n\n  const rows = components.map((component) => [\n    component.id,\n    component.name,\n    component.category,\n    component.scope,\n    `\"${component.filePath}\"`,\n    `\"${component.description.replace(/\"/g, '\"\"')}\"`,\n    component.metrics.totalUses.toString(),\n    component.metrics.successRate.toFixed(3),\n    component.source.extractedFrom,\n  ]);\n\n  return [headers.join(','), ...rows.map((r) => r.join(','))].join('\\n');\n}\n\n/**\n * Export LLKB data\n *\n * @param llkbRoot - Root directory of LLKB\n * @param options - Export options\n * @returns Export content as string\n *\n * @example\n * ```typescript\n * const markdown = exportLLKB('.artk/llkb', {\n *   format: 'markdown',\n *   includeMetrics: true,\n * });\n * fs.writeFileSync('llkb-export.md', markdown);\n * ```\n */\nexport function exportLLKB(llkbRoot: string, options: ExportOptions): string {\n  const lessons = loadLessons(llkbRoot, {\n    includeArchived: options.includeArchived,\n    category: options.categories as LLKBCategory[],\n    scope: options.scopes,\n  });\n\n  const components = loadComponents(llkbRoot, {\n    includeArchived: options.includeArchived,\n    category: options.categories as ComponentCategory[],\n    scope: options.scopes,\n  });\n\n  switch (options.format) {\n    case 'markdown':\n      return [\n        exportLessonsToMarkdown(lessons, options.includeMetrics || false),\n        exportComponentsToMarkdown(\n          components,\n          options.includeMetrics || false,\n          options.includeSource || false\n        ),\n      ].join('\\n\\n');\n\n    case 'csv':\n      return [\n        '# Lessons',\n        exportLessonsToCSV(lessons),\n        '',\n        '# Components',\n        exportComponentsToCSV(components),\n      ].join('\\n');\n\n    case 'json':\n    default:\n      return JSON.stringify(\n        {\n          exported: new Date().toISOString(),\n          lessons,\n          components,\n        },\n        null,\n        2\n      );\n  }\n}\n\n/**\n * Generate a summary report of LLKB\n *\n * @param llkbRoot - Root directory of LLKB\n * @returns Markdown report\n */\nexport function generateReport(llkbRoot: string): string {\n  // Load config to verify LLKB is properly configured\n  loadLLKBConfig(llkbRoot);\n  const lessons = loadLessons(llkbRoot);\n  const components = loadComponents(llkbRoot);\n  const appProfile = loadAppProfile(llkbRoot);\n\n  const archivedLessons = loadLessons(llkbRoot, { includeArchived: true }).filter(\n    (l) => l.archived\n  ).length;\n  const archivedComponents = loadComponents(llkbRoot, { includeArchived: true }).filter(\n    (c) => c.archived\n  ).length;\n\n  // Calculate stats\n  const avgConfidence =\n    lessons.length > 0\n      ? lessons.reduce((sum, l) => sum + l.metrics.confidence, 0) / lessons.length\n      : 0;\n\n  const avgSuccessRate =\n    lessons.length > 0\n      ? lessons.reduce((sum, l) => sum + l.metrics.successRate, 0) / lessons.length\n      : 0;\n\n  const totalComponentUses = components.reduce(\n    (sum, c) => sum + c.metrics.totalUses,\n    0\n  );\n\n  // Count by category\n  const lessonsByCategory = new Map<string, number>();\n  for (const lesson of lessons) {\n    const count = lessonsByCategory.get(lesson.category) || 0;\n    lessonsByCategory.set(lesson.category, count + 1);\n  }\n\n  const componentsByCategory = new Map<string, number>();\n  for (const component of components) {\n    const count = componentsByCategory.get(component.category) || 0;\n    componentsByCategory.set(component.category, count + 1);\n  }\n\n  // Generate report\n  let report = '# LLKB Status Report\\n\\n';\n  report += `**Generated:** ${new Date().toISOString()}\\n\\n`;\n\n  if (appProfile) {\n    report += '## Application Profile\\n\\n';\n    report += `- **Framework:** ${appProfile.application.framework}\\n`;\n    report += `- **UI Library:** ${appProfile.application.uiLibrary}\\n`;\n    report += `- **Data Grid:** ${appProfile.application.dataGrid}\\n`;\n    report += '\\n';\n  }\n\n  report += '## Overview\\n\\n';\n  report += `| Metric | Value |\\n`;\n  report += `|--------|-------|\\n`;\n  report += `| Active Lessons | ${lessons.length} |\\n`;\n  report += `| Archived Lessons | ${archivedLessons} |\\n`;\n  report += `| Active Components | ${components.length} |\\n`;\n  report += `| Archived Components | ${archivedComponents} |\\n`;\n  report += `| Avg. Lesson Confidence | ${(avgConfidence * 100).toFixed(1)}% |\\n`;\n  report += `| Avg. Lesson Success Rate | ${(avgSuccessRate * 100).toFixed(1)}% |\\n`;\n  report += `| Total Component Uses | ${totalComponentUses} |\\n`;\n  report += '\\n';\n\n  report += '## Lessons by Category\\n\\n';\n  report += `| Category | Count |\\n`;\n  report += `|----------|-------|\\n`;\n  for (const [category, count] of lessonsByCategory) {\n    report += `| ${category} | ${count} |\\n`;\n  }\n  report += '\\n';\n\n  report += '## Components by Category\\n\\n';\n  report += `| Category | Count |\\n`;\n  report += `|----------|-------|\\n`;\n  for (const [category, count] of componentsByCategory) {\n    report += `| ${category} | ${count} |\\n`;\n  }\n  report += '\\n';\n\n  // Top lessons\n  const topLessons = [...lessons]\n    .sort((a, b) => b.metrics.confidence - a.metrics.confidence)\n    .slice(0, 5);\n\n  if (topLessons.length > 0) {\n    report += '## Top Lessons (by Confidence)\\n\\n';\n    for (const lesson of topLessons) {\n      report += `- **${lesson.id}** - ${lesson.title} (${(lesson.metrics.confidence * 100).toFixed(0)}%)\\n`;\n    }\n    report += '\\n';\n  }\n\n  // Most used components\n  const topComponents = [...components]\n    .sort((a, b) => b.metrics.totalUses - a.metrics.totalUses)\n    .slice(0, 5);\n\n  if (topComponents.length > 0) {\n    report += '## Most Used Components\\n\\n';\n    for (const component of topComponents) {\n      report += `- **${component.id}** - ${component.name} (${component.metrics.totalUses} uses)\\n`;\n    }\n    report += '\\n';\n  }\n\n  // Low confidence lessons (needs review)\n  const lowConfidence = lessons.filter((l) => l.metrics.confidence < 0.4);\n  if (lowConfidence.length > 0) {\n    report += '## Needs Review (Low Confidence)\\n\\n';\n    for (const lesson of lowConfidence.slice(0, 5)) {\n      report += `- **${lesson.id}** - ${lesson.title} (${(lesson.metrics.confidence * 100).toFixed(0)}%)\\n`;\n    }\n    report += '\\n';\n  }\n\n  return report;\n}\n\n/**\n * Export to file\n *\n * @param llkbRoot - Root directory of LLKB\n * @param outputPath - Output file path\n * @param options - Export options\n */\nexport async function exportToFile(\n  llkbRoot: string,\n  outputPath: string,\n  options: ExportOptions\n): Promise<void> {\n  const content = exportLLKB(llkbRoot, options);\n  fs.writeFileSync(outputPath, content, 'utf-8');\n}\n"]}