{"version":3,"sources":["../../errors/auth-error.ts","../../utils/logger.ts","../../auth/credentials.ts","../../errors/storage-state-error.ts","../../auth/storage-state.ts","../../auth/oidc/flow.ts","../../auth/oidc/providers/keycloak.ts","../../auth/oidc/providers/azure-ad.ts","../../auth/oidc/providers/okta.ts","../../auth/oidc/providers/generic.ts","../../auth/providers/base.ts","../../auth/providers/oidc.ts","../../auth/providers/form.ts","../../auth/providers/token.ts","../../auth/providers/custom.ts","../../auth/setup-factory.ts"],"names":["path","logger","fs","authenticator","body","token","headerName","headerPrefix","getStorageStatePath","path2","getStorageStateDirectory"],"mappings":"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","file":"index.cjs","sourcesContent":["/**\n * Authentication failure error\n *\n * Thrown when authentication fails, providing detailed information about\n * the failure phase, role, IdP response, and remediation steps.\n *\n * @example\n * ```typescript\n * throw new ARTKAuthError(\n *   'Failed to authenticate user',\n *   'admin',\n *   'credentials',\n *   'Invalid username or password',\n *   'Verify ADMIN_USERNAME and ADMIN_PASSWORD environment variables are set correctly'\n * );\n * ```\n */\nexport class ARTKAuthError extends Error {\n  /**\n   * Role that failed to authenticate\n   */\n  public readonly role: string;\n\n  /**\n   * Phase where authentication failed\n   */\n  public readonly phase: 'navigation' | 'credentials' | 'mfa' | 'callback';\n\n  /**\n   * Optional IdP response or error message\n   */\n  public readonly idpResponse?: string;\n\n  /**\n   * Optional remediation steps to fix the error\n   */\n  public readonly remediation?: string;\n\n  constructor(\n    message: string,\n    role: string,\n    phase: 'navigation' | 'credentials' | 'mfa' | 'callback',\n    idpResponse?: string,\n    remediation?: string\n  ) {\n    super(message);\n    this.name = 'ARTKAuthError';\n    this.role = role;\n    this.phase = phase;\n    this.idpResponse = idpResponse;\n    this.remediation = remediation;\n\n    // Maintain proper stack trace for where error was thrown (V8 only)\n    if (Error.captureStackTrace) {\n      Error.captureStackTrace(this, ARTKAuthError);\n    }\n  }\n\n  /**\n   * Format error as a human-readable string with context\n   */\n  public override toString(): string {\n    let result = `${this.name}: ${this.message}\\n`;\n    result += `  Role: ${this.role}\\n`;\n    result += `  Phase: ${this.phase}`;\n\n    if (this.idpResponse) {\n      result += `\\n  IdP Response: ${this.idpResponse}`;\n    }\n\n    if (this.remediation) {\n      result += `\\n  Remediation: ${this.remediation}`;\n    }\n\n    return result;\n  }\n}\n","/**\n * Structured logger utility\n *\n * Provides structured JSON logging with verbosity levels (debug, info, warn, error)\n * as required by NFR-001, NFR-002, and NFR-003.\n *\n * All logs include module, operation, and timestamp for filtering and aggregation.\n *\n * @example\n * ```typescript\n * import { createLogger } from './logger.js';\n *\n * const logger = createLogger('config', 'loadConfig');\n * logger.info('Loading configuration', { path: 'artk.config.yml' });\n * logger.error('Validation failed', { errors: [...] });\n * ```\n */\n\n/**\n * Log levels in order of severity\n */\nexport type LogLevel = 'debug' | 'info' | 'warn' | 'error';\n\n/**\n * Log output format\n */\nexport type LogFormat = 'json' | 'pretty';\n\n/**\n * Structured log entry\n */\nexport interface LogEntry {\n  level: LogLevel;\n  module: string;\n  operation: string;\n  timestamp: string;\n  message: string;\n  context?: Record<string, unknown>;\n}\n\n/**\n * Logger configuration\n */\nexport interface LoggerConfig {\n  minLevel: LogLevel;\n  format: LogFormat;\n  output: (entry: LogEntry) => void;\n}\n\n/**\n * Log level numeric values for comparison\n */\nconst LOG_LEVELS: Record<LogLevel, number> = {\n  debug: 0,\n  info: 1,\n  warn: 2,\n  error: 3,\n};\n\n/**\n * Format log entry as pretty text\n *\n * @param entry - Log entry to format\n * @returns Formatted string\n */\nfunction formatPretty(entry: LogEntry): string {\n  // Extract time from ISO timestamp (HH:MM:SS)\n  const time = entry.timestamp.split('T')[1]?.split('.')[0] || '00:00:00';\n\n  // Format level (uppercase, padded to 5 chars for alignment)\n  const level = entry.level.toUpperCase().padEnd(5);\n\n  // Format context if present\n  const context = entry.context ? ` ${JSON.stringify(entry.context)}` : '';\n\n  return `[${time}] ${level} [${entry.module}] ${entry.message}${context}`;\n}\n\n/**\n * Global logger configuration\n */\nlet globalConfig: LoggerConfig = {\n  minLevel: 'info',\n  format: 'json',\n  output: (entry: LogEntry): void => {\n    // eslint-disable-next-line no-console\n    const target = entry.level === 'error' ? console.error : console.log;\n\n    if (globalConfig.format === 'pretty') {\n      target(formatPretty(entry));\n    } else {\n      target(JSON.stringify(entry));\n    }\n  },\n};\n\n/**\n * Configure global logger settings\n *\n * @param config - Logger configuration\n *\n * @example\n * ```typescript\n * // JSON format (default, for production)\n * configureLogger({\n *   minLevel: 'debug',\n *   format: 'json'\n * });\n *\n * // Pretty format (for local development)\n * configureLogger({\n *   minLevel: 'debug',\n *   format: 'pretty'\n * });\n *\n * // Custom output\n * configureLogger({\n *   output: (entry) => fs.appendFileSync('artk.log', JSON.stringify(entry) + '\\n')\n * });\n * ```\n */\nexport function configureLogger(config: Partial<LoggerConfig>): void {\n  globalConfig = { ...globalConfig, ...config };\n}\n\n/**\n * Get current logger configuration\n */\nexport function getLoggerConfig(): Readonly<LoggerConfig> {\n  return { ...globalConfig };\n}\n\n/**\n * Logger interface\n */\nexport interface Logger {\n  debug(message: string, context?: Record<string, unknown>): void;\n  info(message: string, context?: Record<string, unknown>): void;\n  warn(message: string, context?: Record<string, unknown>): void;\n  error(message: string, context?: Record<string, unknown>): void;\n}\n\n/**\n * Create a logger for a specific module and operation\n *\n * @param module - Module name (e.g., 'config', 'auth', 'fixtures')\n * @param operation - Operation name (e.g., 'loadConfig', 'saveStorageState')\n * @returns Logger instance\n *\n * @example\n * ```typescript\n * const logger = createLogger('auth', 'oidcLogin');\n * logger.info('Starting OIDC login flow', { role: 'admin' });\n * ```\n */\nexport function createLogger(module: string, operation: string): Logger {\n  const log = (level: LogLevel, message: string, context?: Record<string, unknown>): void => {\n    // Check if this log level should be output\n    if (LOG_LEVELS[level] < LOG_LEVELS[globalConfig.minLevel]) {\n      return;\n    }\n\n    const entry: LogEntry = {\n      level,\n      module,\n      operation,\n      timestamp: new Date().toISOString(),\n      message,\n      context,\n    };\n\n    globalConfig.output(entry);\n  };\n\n  return {\n    debug: (message: string, context?: Record<string, unknown>): void => log('debug', message, context),\n    info: (message: string, context?: Record<string, unknown>): void => log('info', message, context),\n    warn: (message: string, context?: Record<string, unknown>): void => log('warn', message, context),\n    error: (message: string, context?: Record<string, unknown>): void => log('error', message, context),\n  };\n}\n\n/**\n * Parse log level from string (case-insensitive)\n *\n * @param level - Log level string\n * @returns Parsed log level or undefined if invalid\n *\n * @example\n * ```typescript\n * const level = parseLogLevel(process.env.LOG_LEVEL);\n * if (level) {\n *   configureLogger({ minLevel: level });\n * }\n * ```\n */\nexport function parseLogLevel(level: string | undefined): LogLevel | undefined {\n  if (!level) {\n    return undefined;\n  }\n\n  const normalized = level.toLowerCase() as LogLevel;\n  if (normalized in LOG_LEVELS) {\n    return normalized;\n  }\n\n  return undefined;\n}\n","/**\n * Credential management for ARTK Auth\n *\n * Provides secure credential loading from environment variables.\n *\n * FR-011: System MUST read credentials from environment variables (never hardcoded)\n *\n * @module auth/credentials\n * @example\n * ```typescript\n * import { getCredentials } from './credentials.js';\n *\n * // Given config: roles.admin.credentialsEnv = { username: 'ADMIN_USER', password: 'ADMIN_PASS' }\n * const creds = getCredentials('admin', config);\n * // Returns: { username: process.env.ADMIN_USER, password: process.env.ADMIN_PASS }\n * ```\n */\n\nimport type { Credentials } from './types.js';\nimport type { AuthConfig, RoleConfig } from '../config/types.js';\nimport { ARTKAuthError } from '../errors/auth-error.js';\nimport { createLogger } from '../utils/logger.js';\n\nconst logger = createLogger('auth', 'credentials');\n\n// =============================================================================\n// Types\n// =============================================================================\n\n/**\n * Options for credential loading\n */\nexport interface GetCredentialsOptions {\n  /**\n   * Environment variables to read from\n   * @default process.env\n   */\n  readonly env?: Record<string, string | undefined>;\n\n  /**\n   * Whether to mask password in logs\n   * @default true\n   */\n  readonly maskPassword?: boolean;\n}\n\n// =============================================================================\n// Functions\n// =============================================================================\n\n/**\n * Get credentials for a role from environment variables\n *\n * Reads the environment variable names from the role configuration\n * and returns the actual credential values from the environment.\n *\n * @param role - Role name as defined in config (e.g., 'admin', 'standardUser')\n * @param authConfig - Authentication configuration containing role definitions\n * @param options - Optional configuration\n * @returns Credentials object with username and password\n * @throws ARTKAuthError if role is not found or env vars are not set\n *\n * @example\n * ```typescript\n * // Config defines:\n * // auth.roles.admin.credentialsEnv = { username: 'ADMIN_USER', password: 'ADMIN_PASS' }\n *\n * // Environment has:\n * // ADMIN_USER=admin@example.com\n * // ADMIN_PASS=secret123\n *\n * const creds = getCredentials('admin', authConfig);\n * // Returns: { username: 'admin@example.com', password: 'secret123' }\n * ```\n */\nexport function getCredentials(\n  role: string,\n  authConfig: AuthConfig,\n  options: GetCredentialsOptions = {}\n): Credentials {\n  const env = options.env ?? process.env;\n  const maskPassword = options.maskPassword ?? true;\n\n  logger.debug('Getting credentials for role', { role });\n\n  // Get role configuration\n  const roleConfig = authConfig.roles[role];\n  if (!roleConfig) {\n    const availableRoles = Object.keys(authConfig.roles).join(', ');\n    logger.error('Role not found in configuration', { role, availableRoles });\n    throw new ARTKAuthError(\n      `Role \"${role}\" not found in auth configuration. Available roles: ${availableRoles}`,\n      role,\n      'credentials',\n      undefined,\n      `Check that the role \"${role}\" is defined in auth.roles in your artk.config.yml`\n    );\n  }\n\n  // Get environment variable names\n  const { username: usernameEnvVar, password: passwordEnvVar } = roleConfig.credentialsEnv;\n\n  // Read username from environment\n  const username = env[usernameEnvVar];\n  if (!username) {\n    logger.error('Username environment variable not set', {\n      role,\n      envVar: usernameEnvVar,\n    });\n    throw new ARTKAuthError(\n      `Environment variable \"${usernameEnvVar}\" for role \"${role}\" username is not set`,\n      role,\n      'credentials',\n      undefined,\n      `Set the ${usernameEnvVar} environment variable with the username for the \"${role}\" role`\n    );\n  }\n\n  // Read password from environment\n  const password = env[passwordEnvVar];\n  if (!password) {\n    logger.error('Password environment variable not set', {\n      role,\n      envVar: passwordEnvVar,\n    });\n    throw new ARTKAuthError(\n      `Environment variable \"${passwordEnvVar}\" for role \"${role}\" password is not set`,\n      role,\n      'credentials',\n      undefined,\n      `Set the ${passwordEnvVar} environment variable with the password for the \"${role}\" role`\n    );\n  }\n\n  logger.info('Credentials loaded successfully', {\n    role,\n    username,\n    password: maskPassword ? '***' : password,\n  });\n\n  return { username, password };\n}\n\n/**\n * Get credentials for a role using role config directly\n *\n * Lower-level function that takes role config instead of full auth config.\n *\n * @param role - Role name for error messages\n * @param roleConfig - Role configuration with credentialsEnv\n * @param options - Optional configuration\n * @returns Credentials object\n * @throws ARTKAuthError if env vars are not set\n */\nexport function getCredentialsFromRoleConfig(\n  role: string,\n  roleConfig: RoleConfig,\n  options: GetCredentialsOptions = {}\n): Credentials {\n  const env = options.env ?? process.env;\n  const maskPassword = options.maskPassword ?? true;\n\n  const { username: usernameEnvVar, password: passwordEnvVar } = roleConfig.credentialsEnv;\n\n  const username = env[usernameEnvVar];\n  if (!username) {\n    throw new ARTKAuthError(\n      `Environment variable \"${usernameEnvVar}\" for role \"${role}\" username is not set`,\n      role,\n      'credentials',\n      undefined,\n      `Set the ${usernameEnvVar} environment variable`\n    );\n  }\n\n  const password = env[passwordEnvVar];\n  if (!password) {\n    throw new ARTKAuthError(\n      `Environment variable \"${passwordEnvVar}\" for role \"${role}\" password is not set`,\n      role,\n      'credentials',\n      undefined,\n      `Set the ${passwordEnvVar} environment variable`\n    );\n  }\n\n  logger.debug('Credentials loaded from role config', {\n    role,\n    username,\n    password: maskPassword ? '***' : password,\n  });\n\n  return { username, password };\n}\n\n/**\n * Validate that all required credentials are available for a set of roles\n *\n * Checks all roles without throwing, returns list of missing credentials.\n *\n * @param roles - Array of role names to validate\n * @param authConfig - Authentication configuration\n * @param env - Environment variables (defaults to process.env)\n * @returns Array of missing credential info (empty if all valid)\n *\n * @example\n * ```typescript\n * const missing = validateCredentials(['admin', 'user'], authConfig);\n * if (missing.length > 0) {\n *   console.error('Missing credentials:', missing);\n * }\n * ```\n */\nexport function validateCredentials(\n  roles: readonly string[],\n  authConfig: AuthConfig,\n  env: Record<string, string | undefined> = process.env\n): ReadonlyArray<MissingCredential> {\n  const missing: MissingCredential[] = [];\n\n  for (const role of roles) {\n    const roleConfig = authConfig.roles[role];\n    if (!roleConfig) {\n      missing.push({\n        role,\n        type: 'role',\n        message: `Role \"${role}\" not found in configuration`,\n      });\n      continue;\n    }\n\n    const { username: usernameEnvVar, password: passwordEnvVar } = roleConfig.credentialsEnv;\n\n    if (!env[usernameEnvVar]) {\n      missing.push({\n        role,\n        type: 'username',\n        envVar: usernameEnvVar,\n        message: `Environment variable \"${usernameEnvVar}\" not set`,\n      });\n    }\n\n    if (!env[passwordEnvVar]) {\n      missing.push({\n        role,\n        type: 'password',\n        envVar: passwordEnvVar,\n        message: `Environment variable \"${passwordEnvVar}\" not set`,\n      });\n    }\n  }\n\n  return missing;\n}\n\n/**\n * Information about missing credentials\n */\nexport interface MissingCredential {\n  /** Role name */\n  readonly role: string;\n\n  /** Type of missing item */\n  readonly type: 'role' | 'username' | 'password';\n\n  /** Environment variable name (if applicable) */\n  readonly envVar?: string;\n\n  /** Human-readable message */\n  readonly message: string;\n}\n\n/**\n * Create a formatted error message for missing credentials\n *\n * @param missing - Array of missing credentials from validateCredentials\n * @returns Formatted error message\n */\nexport function formatMissingCredentialsError(\n  missing: ReadonlyArray<MissingCredential>\n): string {\n  if (missing.length === 0) {\n    return '';\n  }\n\n  const lines: string[] = ['Missing credentials:'];\n\n  // Group by role\n  const byRole = new Map<string, MissingCredential[]>();\n  for (const m of missing) {\n    const existing = byRole.get(m.role) ?? [];\n    existing.push(m);\n    byRole.set(m.role, existing);\n  }\n\n  for (const [role, items] of byRole) {\n    lines.push(`  Role \"${role}\":`);\n    for (const item of items) {\n      if (item.type === 'role') {\n        lines.push(`    - ${item.message}`);\n      } else {\n        lines.push(`    - ${item.type}: ${item.envVar} (${item.message})`);\n      }\n    }\n  }\n\n  lines.push('');\n  lines.push('To fix, set the required environment variables:');\n\n  const envVars = missing\n    .filter((m) => m.envVar)\n    .map((m) => m.envVar);\n  const uniqueEnvVars = [...new Set(envVars)];\n\n  for (const envVar of uniqueEnvVars) {\n    lines.push(`  export ${envVar}=\"<value>\"`);\n  }\n\n  return lines.join('\\n');\n}\n\n/**\n * Check if credentials are available for a role (without throwing)\n *\n * @param role - Role name\n * @param authConfig - Auth configuration\n * @param env - Environment variables\n * @returns true if credentials are available\n */\nexport function hasCredentials(\n  role: string,\n  authConfig: AuthConfig,\n  env: Record<string, string | undefined> = process.env\n): boolean {\n  const roleConfig = authConfig.roles[role];\n  if (!roleConfig) {\n    return false;\n  }\n\n  const { username: usernameEnvVar, password: passwordEnvVar } = roleConfig.credentialsEnv;\n  return Boolean(env[usernameEnvVar]) && Boolean(env[passwordEnvVar]);\n}\n\n/**\n * Validate that credentials environment variables are set for all roles\n *\n * This function checks that all required environment variables for role credentials\n * are present at config load time, providing early failure with clear error messages.\n *\n * @param roles - Record of role configurations from auth config\n * @param env - Environment variables to check (defaults to process.env)\n * @throws ARTKAuthError if any required environment variables are missing\n *\n * @example\n * ```typescript\n * // Validate all roles from config\n * validateCredentialsConfig(config.auth.roles);\n *\n * // Skip validation (for dry-run scenarios)\n * // Don't call this function\n * ```\n */\nexport function validateCredentialsConfig(\n  roles: Record<string, RoleConfig>,\n  env: Record<string, string | undefined> = process.env\n): void {\n  const missingVars: string[] = [];\n\n  for (const [roleName, roleConfig] of Object.entries(roles)) {\n    const { username, password } = roleConfig.credentialsEnv;\n\n    if (!env[username]) {\n      missingVars.push(`${username} (for role '${roleName}')`);\n    }\n    if (!env[password]) {\n      missingVars.push(`${password} (for role '${roleName}')`);\n    }\n  }\n\n  if (missingVars.length > 0) {\n    throw new ARTKAuthError(\n      `Missing required environment variables:\\n` +\n      missingVars.map(v => `  - ${v}`).join('\\n') +\n      `\\n\\nSet these variables before running tests.`,\n      'credentials',\n      'credentials',\n      undefined,\n      'Export the missing environment variables or set them in your .env file'\n    );\n  }\n\n  logger.debug('All credential environment variables validated', {\n    roleCount: Object.keys(roles).length,\n  });\n}\n","/**\n * Storage state error\n *\n * Thrown when storage state operations fail (loading, validation, corruption).\n *\n * @example\n * ```typescript\n * throw new ARTKStorageStateError(\n *   'Storage state file is expired',\n *   'admin',\n *   '.auth-states/admin.json',\n *   'expired'\n * );\n * ```\n */\nexport class ARTKStorageStateError extends Error {\n  /**\n   * Role associated with the storage state\n   */\n  public readonly role: string;\n\n  /**\n   * Path to the storage state file\n   */\n  public readonly path: string;\n\n  /**\n   * Cause of the storage state error\n   */\n  public readonly cause: 'missing' | 'expired' | 'corrupted' | 'invalid';\n\n  constructor(\n    message: string,\n    role: string,\n    path: string,\n    cause: 'missing' | 'expired' | 'corrupted' | 'invalid'\n  ) {\n    super(message);\n    this.name = 'ARTKStorageStateError';\n    this.role = role;\n    this.path = path;\n    this.cause = cause;\n\n    // Maintain proper stack trace for where error was thrown (V8 only)\n    if (Error.captureStackTrace) {\n      Error.captureStackTrace(this, ARTKStorageStateError);\n    }\n  }\n\n  /**\n   * Format error as a human-readable string with context\n   */\n  public override toString(): string {\n    return `${this.name}: ${this.message}\\n  Role: ${this.role}\\n  Path: ${this.path}\\n  Cause: ${this.cause}`;\n  }\n}\n","/**\n * Storage state management for ARTK Auth\n *\n * Handles persistence and validation of browser storage state across test runs.\n *\n * FR-007: System MUST persist authentication state to files and reuse valid state across test runs\n * FR-008: System MUST invalidate storage state based on configurable maximum age\n * NFR-007: System MUST automatically delete storage state files older than 24 hours on test run start\n * NFR-008: Auto-cleanup MUST run before auth setup to prevent stale state accumulation\n *\n * @module auth/storage-state\n * @example\n * ```typescript\n * import { saveStorageState, loadStorageState, isStorageStateValid } from './storage-state.js';\n *\n * // Save storage state after authentication\n * await saveStorageState(browserContext, 'admin', { directory: '.auth-states' });\n *\n * // Load and validate storage state\n * const statePath = await loadStorageState('admin', { directory: '.auth-states' });\n * if (statePath) {\n *   // Use existing state\n * } else {\n *   // Need fresh authentication\n * }\n * ```\n */\n\nimport type { BrowserContext } from '@playwright/test';\nimport * as fs from 'node:fs/promises';\nimport * as path from 'node:path';\nimport type { CleanupError, CleanupResult, StorageState, StorageStateMetadata } from './types.js';\nimport type { StorageStateConfig } from '../config/types.js';\nimport { ARTKStorageStateError } from '../errors/storage-state-error.js';\nimport { createLogger } from '../utils/logger.js';\n\nconst logger = createLogger('auth', 'storage-state');\n\n// =============================================================================\n// Configuration\n// =============================================================================\n\n/**\n * Default storage state configuration\n */\nexport const DEFAULT_STORAGE_STATE_CONFIG: StorageStateConfig = {\n  directory: '.auth-states',\n  maxAgeMinutes: 60,\n  filePattern: '{role}.json',\n};\n\n/**\n * Maximum age in milliseconds for auto-cleanup (24 hours)\n * NFR-007: Delete storage state files older than 24 hours\n */\nexport const CLEANUP_MAX_AGE_MS = 24 * 60 * 60 * 1000;\n\n/**\n * Options for storage state operations\n */\nexport interface StorageStateOptions {\n  /** Directory to store state files (relative to project root) */\n  readonly directory?: string;\n\n  /** Maximum age in minutes before state is considered expired */\n  readonly maxAgeMinutes?: number;\n\n  /** File naming pattern */\n  readonly filePattern?: string;\n\n  /** Project root directory */\n  readonly projectRoot?: string;\n\n  /** Environment name for file pattern */\n  readonly environment?: string;\n}\n\n// =============================================================================\n// Core Functions\n// =============================================================================\n\n/**\n * Save browser context storage state for a role\n *\n * FR-007: Persist storage state to files\n *\n * @param context - Playwright BrowserContext\n * @param role - Role name (e.g., 'admin', 'standardUser')\n * @param options - Storage options\n * @returns Path to saved storage state file\n *\n * @example\n * ```typescript\n * const statePath = await saveStorageState(context, 'admin', {\n *   directory: '.auth-states',\n *   filePattern: '{role}-{env}.json',\n *   environment: 'staging'\n * });\n * console.log(`Saved to: ${statePath}`);\n * ```\n */\nexport async function saveStorageState(\n  context: BrowserContext,\n  role: string,\n  options: StorageStateOptions = {}\n): Promise<string> {\n  const config = resolveOptions(options);\n  const filePath = getStorageStatePath(role, config);\n\n  logger.info('Saving storage state', { role, path: filePath });\n\n  try {\n    // Ensure directory exists\n    const dir = path.dirname(filePath);\n    await fs.mkdir(dir, { recursive: true });\n\n    // Save storage state\n    await context.storageState({ path: filePath });\n\n    logger.info('Storage state saved successfully', { role, path: filePath });\n    return filePath;\n  } catch (error) {\n    const message = error instanceof Error ? error.message : String(error);\n    logger.error('Failed to save storage state', { role, path: filePath, error: message });\n    throw new ARTKStorageStateError(\n      `Failed to save storage state for role \"${role}\": ${message}`,\n      role,\n      filePath,\n      'invalid'\n    );\n  }\n}\n\n/**\n * Load storage state path for a role if valid\n *\n * FR-007: Reuse valid state across test runs\n * FR-008: Invalidate state based on maxAge\n *\n * @param role - Role name\n * @param options - Storage options\n * @returns Path to storage state file, or undefined if not valid\n *\n * @example\n * ```typescript\n * const statePath = await loadStorageState('admin');\n * if (statePath) {\n *   await context.addCookies(/* from file *\\/);\n * }\n * ```\n */\nexport async function loadStorageState(\n  role: string,\n  options: StorageStateOptions = {}\n): Promise<string | undefined> {\n  const config = resolveOptions(options);\n  const filePath = getStorageStatePath(role, config);\n\n  logger.debug('Loading storage state', { role, path: filePath });\n\n  // Check if file exists and is valid\n  const valid = await isStorageStateValid(role, config);\n  if (!valid) {\n    logger.debug('Storage state not valid or not found', { role, path: filePath });\n    return undefined;\n  }\n\n  logger.info('Storage state loaded successfully', { role, path: filePath });\n  return filePath;\n}\n\n/**\n * Check if storage state is valid for a role\n *\n * FR-008: Invalidate state based on configurable maximum age\n *\n * @param role - Role name\n * @param options - Storage options\n * @returns true if storage state exists and is not expired\n *\n * @example\n * ```typescript\n * if (await isStorageStateValid('admin', { maxAgeMinutes: 30 })) {\n *   // Reuse existing state\n * }\n * ```\n */\nexport async function isStorageStateValid(\n  role: string,\n  options: StorageStateOptions = {}\n): Promise<boolean> {\n  const config = resolveOptions(options);\n  const filePath = getStorageStatePath(role, config);\n  const maxAgeMs = config.maxAgeMinutes * 60 * 1000;\n\n  try {\n    const stats = await fs.stat(filePath);\n    const age = Date.now() - stats.mtimeMs;\n\n    if (age > maxAgeMs) {\n      logger.debug('Storage state expired', {\n        role,\n        path: filePath,\n        ageMinutes: Math.round(age / 60000),\n        maxAgeMinutes: config.maxAgeMinutes,\n      });\n      return false;\n    }\n\n    // Also verify file is valid JSON\n    const content = await fs.readFile(filePath, 'utf-8');\n    JSON.parse(content);\n\n    logger.debug('Storage state is valid', {\n      role,\n      path: filePath,\n      ageMinutes: Math.round(age / 60000),\n    });\n    return true;\n  } catch (error) {\n    // File doesn't exist or isn't valid JSON\n    logger.debug('Storage state not found or invalid', { role, path: filePath });\n    return false;\n  }\n}\n\n/**\n * Get metadata about a storage state file\n *\n * @param role - Role name\n * @param options - Storage options\n * @returns Storage state metadata, or undefined if file doesn't exist\n */\nexport async function getStorageStateMetadata(\n  role: string,\n  options: StorageStateOptions = {}\n): Promise<StorageStateMetadata | undefined> {\n  const config = resolveOptions(options);\n  const filePath = getStorageStatePath(role, config);\n  const maxAgeMs = config.maxAgeMinutes * 60 * 1000;\n\n  try {\n    const stats = await fs.stat(filePath);\n    const age = Date.now() - stats.mtimeMs;\n\n    return {\n      role,\n      createdAt: stats.mtime,\n      path: filePath,\n      isValid: age <= maxAgeMs,\n    };\n  } catch {\n    return undefined;\n  }\n}\n\n/**\n * Read and parse storage state from file\n *\n * @param role - Role name\n * @param options - Storage options\n * @returns Parsed storage state\n * @throws ARTKStorageStateError if file doesn't exist or is invalid\n */\nexport async function readStorageState(\n  role: string,\n  options: StorageStateOptions = {}\n): Promise<StorageState> {\n  const config = resolveOptions(options);\n  const filePath = getStorageStatePath(role, config);\n\n  try {\n    const content = await fs.readFile(filePath, 'utf-8');\n    const state = JSON.parse(content) as StorageState;\n\n    // Basic validation\n    if (!Array.isArray(state.cookies) || !Array.isArray(state.origins)) {\n      throw new Error('Invalid storage state structure');\n    }\n\n    return state;\n  } catch (error) {\n    if ((error as NodeJS.ErrnoException).code === 'ENOENT') {\n      throw new ARTKStorageStateError(\n        `Storage state file not found for role \"${role}\"`,\n        role,\n        filePath,\n        'missing'\n      );\n    }\n\n    const message = error instanceof Error ? error.message : String(error);\n    if (message.includes('JSON')) {\n      throw new ARTKStorageStateError(\n        `Storage state file corrupted for role \"${role}\": ${message}`,\n        role,\n        filePath,\n        'corrupted'\n      );\n    }\n\n    throw new ARTKStorageStateError(\n      `Failed to read storage state for role \"${role}\": ${message}`,\n      role,\n      filePath,\n      'invalid'\n    );\n  }\n}\n\n/**\n * Clear storage state files\n *\n * FR-009: Support multiple named roles with separate credentials and storage states\n *\n * @param role - Optional role to clear (clears all if not specified)\n * @param options - Storage options\n * @returns Number of files deleted\n *\n * @example\n * ```typescript\n * // Clear single role\n * await clearStorageState('admin');\n *\n * // Clear all storage states\n * await clearStorageState();\n * ```\n */\nexport async function clearStorageState(\n  role?: string,\n  options: StorageStateOptions = {}\n): Promise<number> {\n  const config = resolveOptions(options);\n  const directory = getStorageStateDirectory(config);\n\n  if (role) {\n    // Clear single role\n    const filePath = getStorageStatePath(role, config);\n    try {\n      await fs.unlink(filePath);\n      logger.info('Storage state cleared', { role, path: filePath });\n      return 1;\n    } catch (error) {\n      if ((error as NodeJS.ErrnoException).code !== 'ENOENT') {\n        logger.warn('Failed to clear storage state', { role, error: String(error) });\n      }\n      return 0;\n    }\n  }\n\n  // Clear all storage states\n  try {\n    const files = await fs.readdir(directory);\n    let deletedCount = 0;\n\n    for (const file of files) {\n      if (file.endsWith('.json')) {\n        try {\n          await fs.unlink(path.join(directory, file));\n          deletedCount++;\n        } catch {\n          // Ignore errors for individual files\n        }\n      }\n    }\n\n    logger.info('All storage states cleared', { count: deletedCount });\n    return deletedCount;\n  } catch (error) {\n    if ((error as NodeJS.ErrnoException).code !== 'ENOENT') {\n      logger.warn('Failed to clear storage states', { error: String(error) });\n    }\n    return 0;\n  }\n}\n\n// =============================================================================\n// Cleanup Functions (T032)\n// =============================================================================\n\n/**\n * Clean up expired storage states (older than 24 hours)\n *\n * NFR-007: System MUST automatically delete storage state files older than 24 hours on test run start\n * NFR-008: Auto-cleanup MUST run before auth setup to prevent stale state accumulation\n * NFR-009: System MUST log cleanup actions at info verbosity level\n *\n * @param options - Storage options\n * @returns Cleanup result with counts and errors\n *\n * @example\n * ```typescript\n * // Run at test suite start\n * const result = await cleanupExpiredStorageStates();\n * console.log(`Deleted ${result.deletedCount} expired storage states`);\n * ```\n */\nexport async function cleanupExpiredStorageStates(\n  options: StorageStateOptions = {}\n): Promise<CleanupResult> {\n  const config = resolveOptions(options);\n  const directory = getStorageStateDirectory(config);\n  const deletedFiles: string[] = [];\n  const errors: CleanupError[] = [];\n\n  logger.info('Starting storage state cleanup', { directory, maxAgeHours: 24 });\n\n  try {\n    // Check if directory exists\n    try {\n      await fs.access(directory);\n    } catch {\n      logger.debug('Storage state directory does not exist, nothing to clean up');\n      return { deletedCount: 0, deletedFiles: [], errors: [] };\n    }\n\n    const files = await fs.readdir(directory);\n    const now = Date.now();\n\n    for (const file of files) {\n      if (!file.endsWith('.json')) {\n        continue;\n      }\n\n      const filePath = path.join(directory, file);\n\n      try {\n        const stats = await fs.stat(filePath);\n        const age = now - stats.mtimeMs;\n\n        if (age > CLEANUP_MAX_AGE_MS) {\n          await fs.unlink(filePath);\n          deletedFiles.push(filePath);\n          logger.debug('Deleted expired storage state', {\n            path: filePath,\n            ageHours: Math.round(age / 3600000),\n          });\n        }\n      } catch (error) {\n        const message = error instanceof Error ? error.message : String(error);\n        errors.push({ path: filePath, message });\n        logger.warn('Failed to process file during cleanup', { path: filePath, error: message });\n      }\n    }\n\n    logger.info('Storage state cleanup complete', {\n      deletedCount: deletedFiles.length,\n      errorCount: errors.length,\n    });\n\n    return {\n      deletedCount: deletedFiles.length,\n      deletedFiles,\n      errors,\n    };\n  } catch (error) {\n    const message = error instanceof Error ? error.message : String(error);\n    logger.error('Storage state cleanup failed', { error: message });\n    return {\n      deletedCount: 0,\n      deletedFiles: [],\n      errors: [{ path: directory, message }],\n    };\n  }\n}\n\n/**\n * Clean up storage states older than a custom age\n *\n * @param maxAgeMs - Maximum age in milliseconds\n * @param options - Storage options\n * @returns Cleanup result\n */\nexport async function cleanupStorageStatesOlderThan(\n  maxAgeMs: number,\n  options: StorageStateOptions = {}\n): Promise<CleanupResult> {\n  const config = resolveOptions(options);\n  const directory = getStorageStateDirectory(config);\n  const deletedFiles: string[] = [];\n  const errors: CleanupError[] = [];\n\n  try {\n    try {\n      await fs.access(directory);\n    } catch {\n      return { deletedCount: 0, deletedFiles: [], errors: [] };\n    }\n\n    const files = await fs.readdir(directory);\n    const now = Date.now();\n\n    for (const file of files) {\n      if (!file.endsWith('.json')) {\n        continue;\n      }\n\n      const filePath = path.join(directory, file);\n\n      try {\n        const stats = await fs.stat(filePath);\n        const age = now - stats.mtimeMs;\n\n        if (age > maxAgeMs) {\n          await fs.unlink(filePath);\n          deletedFiles.push(filePath);\n        }\n      } catch (error) {\n        const message = error instanceof Error ? error.message : String(error);\n        errors.push({ path: filePath, message });\n      }\n    }\n\n    return { deletedCount: deletedFiles.length, deletedFiles, errors };\n  } catch (error) {\n    const message = error instanceof Error ? error.message : String(error);\n    return {\n      deletedCount: 0,\n      deletedFiles: [],\n      errors: [{ path: directory, message }],\n    };\n  }\n}\n\n// =============================================================================\n// Helper Functions\n// =============================================================================\n\n/**\n * Resolve storage state options with defaults\n */\nfunction resolveOptions(options: StorageStateOptions): Required<Omit<StorageStateOptions, 'environment'>> & { environment?: string } {\n  return {\n    directory: options.directory ?? DEFAULT_STORAGE_STATE_CONFIG.directory,\n    maxAgeMinutes: options.maxAgeMinutes ?? DEFAULT_STORAGE_STATE_CONFIG.maxAgeMinutes,\n    filePattern: options.filePattern ?? DEFAULT_STORAGE_STATE_CONFIG.filePattern,\n    projectRoot: options.projectRoot ?? process.cwd(),\n    environment: options.environment,\n  };\n}\n\n/**\n * Get the full path to storage state directory\n */\nfunction getStorageStateDirectory(\n  config: Required<Omit<StorageStateOptions, 'environment'>> & { environment?: string }\n): string {\n  return path.join(config.projectRoot, config.directory);\n}\n\n/**\n * Get the full path to a storage state file\n */\nfunction getStorageStatePath(\n  role: string,\n  config: Required<Omit<StorageStateOptions, 'environment'>> & { environment?: string }\n): string {\n  const directory = getStorageStateDirectory(config);\n  let filename = config.filePattern\n    .replace('{role}', role)\n    .replace('{env}', config.environment ?? 'default');\n\n  // Ensure .json extension\n  if (!filename.endsWith('.json')) {\n    filename += '.json';\n  }\n\n  return path.join(directory, filename);\n}\n\n/**\n * Get role name from a storage state file path\n *\n * @param filePath - Path to storage state file\n * @param pattern - File naming pattern\n * @returns Role name or undefined if can't parse\n */\nexport function getRoleFromPath(filePath: string, pattern: string = '{role}.json'): string | undefined {\n  const filename = path.basename(filePath);\n\n  // Escape special regex characters first, then replace placeholders\n  let patternRegex = pattern\n    .replace(/\\./g, '\\\\.') // Escape all dots first\n    .replace('\\\\{role\\\\}', '([\\\\w-]+)') // Role: word chars and hyphens\n    .replace('\\\\{env\\\\}', '[\\\\w-]+'); // Env: word chars and hyphens\n\n  // Handle unescaped placeholders (in case dots weren't before them)\n  patternRegex = patternRegex\n    .replace('{role}', '([\\\\w-]+)')\n    .replace('{env}', '[\\\\w-]+');\n\n  const match = filename.match(new RegExp(`^${patternRegex}$`));\n  return match?.[1];\n}\n\n/**\n * List all storage state files\n *\n * @param options - Storage options\n * @returns Array of storage state metadata\n */\nexport async function listStorageStates(\n  options: StorageStateOptions = {}\n): Promise<StorageStateMetadata[]> {\n  const config = resolveOptions(options);\n  const directory = getStorageStateDirectory(config);\n  const maxAgeMs = config.maxAgeMinutes * 60 * 1000;\n  const results: StorageStateMetadata[] = [];\n\n  try {\n    const files = await fs.readdir(directory);\n\n    for (const file of files) {\n      if (!file.endsWith('.json')) {\n        continue;\n      }\n\n      const filePath = path.join(directory, file);\n      const role = getRoleFromPath(filePath, config.filePattern);\n\n      if (!role) {\n        continue;\n      }\n\n      try {\n        const stats = await fs.stat(filePath);\n        const age = Date.now() - stats.mtimeMs;\n\n        results.push({\n          role,\n          createdAt: stats.mtime,\n          path: filePath,\n          isValid: age <= maxAgeMs,\n        });\n      } catch {\n        // Skip files we can't stat\n      }\n    }\n  } catch {\n    // Directory doesn't exist\n  }\n\n  return results;\n}\n","/**\n * Generic OIDC flow handler\n *\n * Orchestrates the complete OIDC authentication flow:\n * 1. Navigate to app login URL\n * 2. Handle IdP redirect\n * 3. Fill credentials on IdP page\n * 4. Handle MFA (if enabled)\n * 5. Handle callback redirect\n * 6. Verify successful authentication\n *\n * FR-006: System MUST support OIDC with configurable Identity Provider handlers\n * FR-010: System MUST handle TOTP-based MFA by generating codes from configured secret\n *\n * @module auth/oidc/flow\n */\n\nimport type { Page } from '@playwright/test';\nimport { authenticator } from 'otplib';\nimport type {\n  AuthPhase,\n  Credentials,\n  IdpHandler,\n  OIDCAuthProviderConfig,\n  OIDCMfaConfig,\n} from '../types.js';\nimport { ARTKAuthError } from '../../errors/auth-error.js';\nimport { createLogger } from '../../utils/logger.js';\n\nconst logger = createLogger('auth', 'oidc-flow');\n\n// =============================================================================\n// TOTP Generation (T038)\n// =============================================================================\n\n/**\n * Generate TOTP code from a secret stored in environment variable\n *\n * FR-010: Handle TOTP-based MFA by generating codes from configured secret\n *\n * @param secretEnvVar - Name of environment variable containing TOTP secret\n * @param env - Environment variables (defaults to process.env)\n * @returns 6-digit TOTP code\n * @throws ARTKAuthError if env var not set or secret invalid\n *\n * @example\n * ```typescript\n * // Given: MFA_SECRET_ADMIN=JBSWY3DPEHPK3PXP\n * const code = generateTOTPCode('MFA_SECRET_ADMIN');\n * // Returns: '123456' (time-based code)\n * ```\n */\nexport function generateTOTPCode(\n  secretEnvVar: string,\n  env: Record<string, string | undefined> = process.env\n): string {\n  const secret = env[secretEnvVar];\n\n  if (!secret) {\n    logger.error('TOTP secret environment variable not set', { envVar: secretEnvVar });\n    throw new ARTKAuthError(\n      `TOTP secret environment variable \"${secretEnvVar}\" is not set`,\n      'unknown',\n      'mfa',\n      undefined,\n      `Set the ${secretEnvVar} environment variable with your TOTP secret`\n    );\n  }\n\n  try {\n    // Clean the secret (remove spaces, normalize case)\n    const cleanSecret = secret.replace(/\\s+/g, '').toUpperCase();\n\n    // Generate TOTP code\n    const code = authenticator.generate(cleanSecret);\n\n    logger.debug('Generated TOTP code', {\n      envVar: secretEnvVar,\n      codeLength: code.length,\n    });\n\n    return code;\n  } catch (error) {\n    const message = error instanceof Error ? error.message : String(error);\n    logger.error('Failed to generate TOTP code', { envVar: secretEnvVar, error: message });\n    throw new ARTKAuthError(\n      `Failed to generate TOTP code: ${message}`,\n      'unknown',\n      'mfa',\n      undefined,\n      `Verify that ${secretEnvVar} contains a valid base32-encoded TOTP secret`\n    );\n  }\n}\n\n/**\n * Verify a TOTP code against a secret\n *\n * @param code - 6-digit TOTP code to verify\n * @param secretEnvVar - Environment variable containing TOTP secret\n * @param env - Environment variables\n * @returns true if code is valid\n */\nexport function verifyTOTPCode(\n  code: string,\n  secretEnvVar: string,\n  env: Record<string, string | undefined> = process.env\n): boolean {\n  const secret = env[secretEnvVar];\n\n  if (!secret) {\n    return false;\n  }\n\n  try {\n    const cleanSecret = secret.replace(/\\s+/g, '').toUpperCase();\n    return authenticator.verify({ token: code, secret: cleanSecret });\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Get time until next TOTP code window\n *\n * Useful for waiting if a code is about to expire.\n *\n * @returns Seconds until next TOTP window (0-30)\n */\nexport function getTimeUntilNextTOTPWindow(): number {\n  const step = authenticator.options.step ?? 30;\n  const now = Math.floor(Date.now() / 1000);\n  return step - (now % step);\n}\n\n/**\n * Wait for next TOTP window if current code is about to expire\n *\n * @param thresholdSeconds - If less than this many seconds remain, wait for next window\n * @returns Whether we waited\n */\nexport async function waitForFreshTOTPWindow(thresholdSeconds: number = 5): Promise<boolean> {\n  const remaining = getTimeUntilNextTOTPWindow();\n\n  if (remaining < thresholdSeconds) {\n    logger.debug('Waiting for fresh TOTP window', { remaining, threshold: thresholdSeconds });\n    await new Promise((resolve) => setTimeout(resolve, (remaining + 1) * 1000));\n    return true;\n  }\n\n  return false;\n}\n\n// =============================================================================\n// OIDC Flow Types\n// =============================================================================\n\n/**\n * Options for OIDC flow execution\n */\nexport interface OIDCFlowOptions {\n  /** IdP-specific handler */\n  readonly idpHandler: IdpHandler;\n\n  /** Whether to skip IdP redirect (for direct IdP login) */\n  readonly skipIdpRedirect?: boolean;\n\n  /** Custom role name for error messages */\n  readonly role?: string;\n}\n\n/**\n * Result of OIDC flow execution\n */\nexport interface OIDCFlowResult {\n  /** Whether authentication succeeded */\n  readonly success: boolean;\n\n  /** Final URL after authentication */\n  readonly finalUrl: string;\n\n  /** Duration of the flow in milliseconds */\n  readonly durationMs: number;\n\n  /** Phase where flow completed or failed */\n  readonly phase: AuthPhase;\n\n  /** Error if authentication failed */\n  readonly error?: ARTKAuthError;\n}\n\n// =============================================================================\n// OIDC Flow Implementation (T033)\n// =============================================================================\n\n/**\n * Execute complete OIDC authentication flow\n *\n * FR-006: Support OIDC with configurable Identity Provider handlers\n *\n * @param page - Playwright Page\n * @param config - OIDC provider configuration\n * @param credentials - User credentials\n * @param options - Flow options including IdP handler\n * @returns Flow result\n *\n * @example\n * ```typescript\n * const result = await executeOIDCFlow(\n *   page,\n *   oidcConfig,\n *   { username: 'admin', password: 'secret' },\n *   { idpHandler: keycloakHandler }\n * );\n *\n * if (!result.success) {\n *   throw result.error;\n * }\n * ```\n */\nexport async function executeOIDCFlow(\n  page: Page,\n  config: OIDCAuthProviderConfig,\n  credentials: Credentials,\n  options: OIDCFlowOptions\n): Promise<OIDCFlowResult> {\n  const startTime = Date.now();\n  const role = options.role ?? 'unknown';\n  const { idpHandler } = options;\n\n  logger.info('Starting OIDC flow', {\n    role,\n    idpType: config.idpType,\n    loginUrl: config.loginUrl,\n  });\n\n  try {\n    // Phase 1: Navigate to login URL\n    await navigateToLogin(page, config, role);\n\n    // Phase 2: Wait for IdP redirect (if not direct IdP login)\n    if (!options.skipIdpRedirect && config.loginUrl !== config.idpLoginUrl) {\n      await waitForIdPRedirect(page, config, role);\n    }\n\n    // Phase 3: Fill credentials on IdP page\n    await fillIdPCredentials(page, config, credentials, idpHandler, role);\n\n    // Phase 4: Submit login form\n    await submitIdPForm(page, config, idpHandler, role);\n\n    // Phase 5: Handle MFA (if enabled)\n    if (config.mfa?.enabled) {\n      await handleMFA(page, config.mfa, idpHandler, role);\n    }\n\n    // Phase 6: Handle post-login prompts (e.g., \"Stay signed in?\")\n    if (idpHandler.handlePostLoginPrompts) {\n      await idpHandler.handlePostLoginPrompts(page, config.idpSelectors);\n    }\n\n    // Phase 7: Wait for callback/success\n    await waitForSuccess(page, config, role);\n\n    const duration = Date.now() - startTime;\n    logger.info('OIDC flow completed successfully', {\n      role,\n      durationMs: duration,\n      finalUrl: page.url(),\n    });\n\n    return {\n      success: true,\n      finalUrl: page.url(),\n      durationMs: duration,\n      phase: 'callback',\n    };\n  } catch (error) {\n    const duration = Date.now() - startTime;\n    const authError = error instanceof ARTKAuthError\n      ? error\n      : new ARTKAuthError(\n          error instanceof Error ? error.message : String(error),\n          role,\n          'credentials'\n        );\n\n    logger.error('OIDC flow failed', {\n      role,\n      phase: authError.phase,\n      durationMs: duration,\n      error: authError.message,\n    });\n\n    return {\n      success: false,\n      finalUrl: page.url(),\n      durationMs: duration,\n      phase: authError.phase,\n      error: authError,\n    };\n  }\n}\n\n// =============================================================================\n// Flow Step Functions\n// =============================================================================\n\n/**\n * Navigate to the login initiation URL\n */\nasync function navigateToLogin(\n  page: Page,\n  config: OIDCAuthProviderConfig,\n  role: string\n): Promise<void> {\n  const timeout = config.timeouts?.loginFlowMs ?? 30000;\n\n  logger.debug('Navigating to login URL', { url: config.loginUrl });\n\n  try {\n    await page.goto(config.loginUrl, {\n      waitUntil: 'domcontentloaded',\n      timeout,\n    });\n  } catch (error) {\n    const message = error instanceof Error ? error.message : String(error);\n    throw new ARTKAuthError(\n      `Failed to navigate to login URL: ${message}`,\n      role,\n      'navigation',\n      undefined,\n      `Verify the login URL is correct and accessible: ${config.loginUrl}`\n    );\n  }\n}\n\n/**\n * Wait for redirect to IdP login page\n */\nasync function waitForIdPRedirect(\n  page: Page,\n  config: OIDCAuthProviderConfig,\n  role: string\n): Promise<void> {\n  const timeout = config.timeouts?.idpRedirectMs ?? 10000;\n\n  logger.debug('Waiting for IdP redirect');\n\n  // If we have an idpLoginUrl, wait for it specifically\n  if (config.idpLoginUrl) {\n    try {\n      await page.waitForURL((url) => url.toString().includes(new URL(config.idpLoginUrl!).host), {\n        timeout,\n      });\n    } catch (error) {\n      const message = error instanceof Error ? error.message : String(error);\n      throw new ARTKAuthError(\n        `Timeout waiting for IdP redirect: ${message}`,\n        role,\n        'navigation',\n        undefined,\n        'The application may not have redirected to the IdP login page'\n      );\n    }\n  } else {\n    // Wait for URL to change from the original login URL\n    const originalUrl = page.url();\n    try {\n      await page.waitForURL((url) => url.toString() !== originalUrl, { timeout });\n    } catch {\n      // URL may not change if it's a SPA, continue anyway\n      logger.debug('URL did not change, may be SPA behavior');\n    }\n  }\n}\n\n/**\n * Fill credentials on IdP login page\n */\nasync function fillIdPCredentials(\n  page: Page,\n  config: OIDCAuthProviderConfig,\n  credentials: Credentials,\n  idpHandler: IdpHandler,\n  role: string\n): Promise<void> {\n  logger.debug('Filling credentials on IdP page');\n\n  try {\n    await idpHandler.fillCredentials(page, credentials, config.idpSelectors);\n  } catch (error) {\n    const message = error instanceof Error ? error.message : String(error);\n    throw new ARTKAuthError(\n      `Failed to fill credentials on IdP page: ${message}`,\n      role,\n      'credentials',\n      undefined,\n      'Check if the IdP selectors are correct for username/password fields'\n    );\n  }\n}\n\n/**\n * Submit the IdP login form\n */\nasync function submitIdPForm(\n  page: Page,\n  config: OIDCAuthProviderConfig,\n  idpHandler: IdpHandler,\n  role: string\n): Promise<void> {\n  logger.debug('Submitting IdP login form');\n\n  try {\n    await idpHandler.submitForm(page, config.idpSelectors);\n  } catch (error) {\n    const message = error instanceof Error ? error.message : String(error);\n    throw new ARTKAuthError(\n      `Failed to submit login form: ${message}`,\n      role,\n      'credentials',\n      undefined,\n      'Check if the submit button selector is correct'\n    );\n  }\n}\n\n/**\n * Handle MFA challenge\n *\n * FR-010: Handle TOTP-based MFA by generating codes from configured secret\n */\nasync function handleMFA(\n  page: Page,\n  mfaConfig: OIDCMfaConfig,\n  idpHandler: IdpHandler,\n  role: string\n): Promise<void> {\n  logger.info('Handling MFA challenge', { type: mfaConfig.type });\n\n  switch (mfaConfig.type) {\n    case 'totp':\n      await handleTOTPMFA(page, mfaConfig, idpHandler, role);\n      break;\n\n    case 'push':\n      await handlePushMFA(page, mfaConfig, role);\n      break;\n\n    case 'sms':\n      throw new ARTKAuthError(\n        'SMS-based MFA is not supported for automated testing',\n        role,\n        'mfa',\n        undefined,\n        'Configure TOTP-based MFA for the test account instead'\n      );\n\n    case 'none':\n      logger.debug('MFA type is none, skipping');\n      break;\n\n    default:\n      // Use IdP handler if available\n      if (idpHandler.handleMFA) {\n        await idpHandler.handleMFA(page, mfaConfig);\n      }\n  }\n}\n\n/**\n * Handle TOTP MFA challenge\n */\nasync function handleTOTPMFA(\n  page: Page,\n  mfaConfig: OIDCMfaConfig,\n  idpHandler: IdpHandler,\n  role: string\n): Promise<void> {\n  if (!mfaConfig.totpSecretEnv) {\n    throw new ARTKAuthError(\n      'TOTP secret environment variable not configured',\n      role,\n      'mfa',\n      undefined,\n      'Configure mfa.totpSecretEnv in your artk.config.yml'\n    );\n  }\n\n  // Wait for fresh TOTP window if current code is about to expire\n  await waitForFreshTOTPWindow(5);\n\n  // Generate TOTP code\n  const code = generateTOTPCode(mfaConfig.totpSecretEnv);\n\n  // Find TOTP input and fill it\n  const totpSelector = mfaConfig.totpInputSelector ?? idpHandler.getDefaultSelectors().totpInput ?? 'input[name*=\"otp\"], input[name*=\"totp\"], input[name*=\"code\"]';\n  const submitSelector = mfaConfig.totpSubmitSelector ?? idpHandler.getDefaultSelectors().totpSubmit ?? 'button[type=\"submit\"]';\n\n  try {\n    // Wait for TOTP input to appear\n    await page.waitForSelector(totpSelector, { state: 'visible', timeout: 10000 });\n\n    // Fill the code\n    await page.fill(totpSelector, code);\n\n    // Submit\n    await page.click(submitSelector);\n\n    logger.debug('TOTP code submitted');\n  } catch (error) {\n    const message = error instanceof Error ? error.message : String(error);\n    throw new ARTKAuthError(\n      `Failed to complete TOTP MFA: ${message}`,\n      role,\n      'mfa',\n      undefined,\n      'Check TOTP input selector configuration and verify the secret is correct'\n    );\n  }\n}\n\n/**\n * Handle push notification MFA\n */\nasync function handlePushMFA(\n  page: Page,\n  mfaConfig: OIDCMfaConfig,\n  role: string\n): Promise<void> {\n  const timeout = mfaConfig.pushTimeoutMs ?? 30000;\n\n  logger.info('Waiting for push notification approval', { timeoutMs: timeout });\n\n  // Wait for either success URL or push approval indicator\n  // This is a best-effort approach - push MFA requires manual intervention\n  try {\n    await page.waitForURL((url) => {\n      // Check if we've moved past the MFA page\n      return !url.toString().includes('mfa') && !url.toString().includes('2fa');\n    }, { timeout });\n  } catch (error) {\n    throw new ARTKAuthError(\n      `Push MFA approval timeout after ${timeout}ms`,\n      role,\n      'mfa',\n      undefined,\n      'Approve the push notification on your device or configure TOTP instead'\n    );\n  }\n}\n\n/**\n * Wait for successful authentication callback\n */\nasync function waitForSuccess(\n  page: Page,\n  config: OIDCAuthProviderConfig,\n  role: string\n): Promise<void> {\n  const timeout = config.success.timeout ?? config.timeouts?.callbackMs ?? 10000;\n\n  logger.debug('Waiting for authentication success');\n\n  const { url, selector } = config.success;\n\n  if (!url && !selector) {\n    // No specific success criteria - wait for network idle\n    try {\n      await page.waitForLoadState('networkidle', { timeout });\n    } catch {\n      // Network may not go idle, that's okay\n    }\n    return;\n  }\n\n  try {\n    if (url && selector) {\n      // Wait for either condition\n      await Promise.race([\n        page.waitForURL(url, { timeout }),\n        page.waitForSelector(selector, { state: 'visible', timeout }),\n      ]);\n    } else if (url) {\n      await page.waitForURL(url, { timeout });\n    } else if (selector) {\n      await page.waitForSelector(selector, { state: 'visible', timeout });\n    }\n  } catch (error) {\n    // Check for common error indicators on page\n    const errorText = await detectAuthError(page);\n\n    throw new ARTKAuthError(\n      'Authentication callback failed',\n      role,\n      'callback',\n      errorText,\n      'Verify credentials are correct and the success URL/selector configuration'\n    );\n  }\n}\n\n/**\n * Attempt to detect authentication error messages on the page\n */\nasync function detectAuthError(page: Page): Promise<string | undefined> {\n  const errorSelectors = [\n    '.error-message',\n    '.alert-danger',\n    '.error',\n    '[role=\"alert\"]',\n    '.login-error',\n    '#error-message',\n  ];\n\n  for (const selector of errorSelectors) {\n    try {\n      const element = page.locator(selector).first();\n      if (await element.isVisible({ timeout: 500 })) {\n        return await element.textContent() ?? undefined;\n      }\n    } catch {\n      // Continue checking other selectors\n    }\n  }\n\n  return undefined;\n}\n\n// =============================================================================\n// Session Validation\n// =============================================================================\n\n/**\n * Check if current session is valid by looking for success indicators\n *\n * @param page - Playwright Page\n * @param config - OIDC configuration\n * @returns true if session appears valid\n */\nexport async function isOIDCSessionValid(\n  page: Page,\n  config: OIDCAuthProviderConfig\n): Promise<boolean> {\n  const { url, selector } = config.success;\n\n  // Check URL match\n  if (url) {\n    const currentUrl = page.url();\n    const urlMatches = typeof url === 'string'\n      ? currentUrl.includes(url)\n      : new RegExp(url).test(currentUrl);\n\n    if (!urlMatches) {\n      return false;\n    }\n  }\n\n  // Check selector presence\n  if (selector) {\n    try {\n      await page.waitForSelector(selector, { state: 'visible', timeout: 1000 });\n    } catch {\n      return false;\n    }\n  }\n\n  return true;\n}\n","/**\n * Keycloak IdP handler\n *\n * Handles Keycloak-specific login page interactions.\n * Keycloak is the primary IdP for ITSS and many enterprise applications.\n *\n * FR-006: Support OIDC with configurable Identity Provider handlers (Keycloak primary)\n *\n * @module auth/oidc/providers/keycloak\n */\n\nimport type { Page } from '@playwright/test';\nimport type {\n  Credentials,\n  IdpHandler,\n  OIDCIdpSelectors,\n  OIDCMfaConfig,\n} from '../../types.js';\nimport { generateTOTPCode } from '../flow.js';\nimport { createLogger } from '../../../utils/logger.js';\n\nconst logger = createLogger('auth', 'keycloak');\n\n// =============================================================================\n// Default Selectors\n// =============================================================================\n\n/**\n * Default Keycloak form selectors\n */\nconst DEFAULT_KEYCLOAK_SELECTORS: OIDCIdpSelectors = {\n  // Username can be on a separate page or same page as password\n  username: '#username, input[name=\"username\"], #kc-login input[name=\"username\"]',\n  password: '#password, input[name=\"password\"], #kc-login input[name=\"password\"]',\n  submit: '#kc-login, button[type=\"submit\"], input[type=\"submit\"]',\n  // TOTP/OTP selectors\n  totpInput: '#otp, input[name=\"otp\"], input[name=\"totp\"]',\n  totpSubmit: 'button[type=\"submit\"], input[type=\"submit\"]',\n};\n\n// =============================================================================\n// Keycloak Handler\n// =============================================================================\n\n/**\n * Keycloak Identity Provider handler\n *\n * Handles:\n * - Standard username/password login\n * - Two-step login (username then password)\n * - TOTP-based MFA\n * - Required actions (update password, verify email, etc.)\n */\nexport const keycloakHandler: IdpHandler = {\n  idpType: 'keycloak',\n\n  /**\n   * Fill credentials on Keycloak login page\n   *\n   * Handles both single-page and two-step login flows.\n   */\n  async fillCredentials(\n    page: Page,\n    credentials: Credentials,\n    selectors?: OIDCIdpSelectors\n  ): Promise<void> {\n    const { username: usernameSelector, password: passwordSelector } = {\n      ...DEFAULT_KEYCLOAK_SELECTORS,\n      ...selectors,\n    };\n\n    logger.debug('Filling Keycloak credentials');\n\n    // Wait for username field\n    await page.waitForSelector(usernameSelector!, { state: 'visible', timeout: 10000 });\n\n    // Check if password field is visible (single-page) or if we need to submit username first (two-step)\n    const isPasswordVisible = await page.locator(passwordSelector!).isVisible().catch(() => false);\n\n    if (isPasswordVisible) {\n      // Single-page login - fill both fields\n      await page.fill(usernameSelector!, credentials.username);\n      await page.fill(passwordSelector!, credentials.password);\n    } else {\n      // Two-step login - fill username, submit, then password\n      await page.fill(usernameSelector!, credentials.username);\n      logger.debug('Two-step login detected, submitting username first');\n    }\n  },\n\n  /**\n   * Submit the Keycloak login form\n   */\n  async submitForm(page: Page, selectors?: OIDCIdpSelectors): Promise<void> {\n    const { submit: submitSelector, password: passwordSelector } = {\n      ...DEFAULT_KEYCLOAK_SELECTORS,\n      ...selectors,\n    };\n\n    // Click submit button\n    await page.click(submitSelector!);\n\n    // Check if we need to handle two-step login (password page appears after username submit)\n    try {\n      // Wait a bit for potential page navigation\n      await page.waitForLoadState('domcontentloaded', { timeout: 3000 });\n\n      // Check if password field appeared (two-step flow)\n      const passwordField = page.locator(passwordSelector!);\n      const isPasswordVisible = await passwordField.isVisible({ timeout: 1000 });\n\n      if (isPasswordVisible) {\n        // Two-step flow - password page loaded, but we should have filled password already\n        // This handles the case where password was visible but we only filled username\n        logger.debug('Password field visible after submit, checking if needs input');\n\n        const passwordValue = await passwordField.inputValue();\n        if (!passwordValue) {\n          // This shouldn't happen in normal flow, but log it\n          logger.warn('Password field is empty after username submit - two-step flow may need handling');\n        }\n      }\n    } catch {\n      // Page may have navigated away or password field check timed out - that's fine\n    }\n\n    logger.debug('Keycloak form submitted');\n  },\n\n  /**\n   * Handle Keycloak MFA challenge\n   */\n  async handleMFA(page: Page, mfaConfig: OIDCMfaConfig): Promise<void> {\n    if (mfaConfig.type !== 'totp') {\n      logger.warn('Non-TOTP MFA type, attempting generic handling', { type: mfaConfig.type });\n      return;\n    }\n\n    const totpSelector = mfaConfig.totpInputSelector ?? DEFAULT_KEYCLOAK_SELECTORS.totpInput;\n    const submitSelector = mfaConfig.totpSubmitSelector ?? DEFAULT_KEYCLOAK_SELECTORS.totpSubmit;\n\n    logger.debug('Handling Keycloak TOTP MFA');\n\n    // Wait for OTP input\n    await page.waitForSelector(totpSelector!, { state: 'visible', timeout: 10000 });\n\n    // Generate and enter code\n    if (!mfaConfig.totpSecretEnv) {\n      throw new Error('TOTP secret environment variable not configured');\n    }\n\n    const code = generateTOTPCode(mfaConfig.totpSecretEnv);\n    await page.fill(totpSelector!, code);\n    await page.click(submitSelector!);\n\n    logger.debug('TOTP code submitted to Keycloak');\n  },\n\n  /**\n   * Handle Keycloak post-login prompts\n   *\n   * Keycloak may show required actions like:\n   * - Update password\n   * - Verify email\n   * - Configure OTP\n   */\n  async handlePostLoginPrompts(page: Page, _selectors?: OIDCIdpSelectors): Promise<void> {\n    // Check for required action pages\n    const requiredActionIndicators = [\n      '#kc-update-password',\n      '#kc-update-profile',\n      '#kc-verify-email',\n      '.required-action',\n    ];\n\n    for (const indicator of requiredActionIndicators) {\n      try {\n        const element = await page.waitForSelector(indicator, { timeout: 1000, state: 'visible' });\n        if (element) {\n          logger.warn('Keycloak required action detected', { indicator });\n          // We can't automatically handle required actions\n          throw new Error(`Keycloak required action page detected: ${indicator}. Please complete required actions manually first.`);\n        }\n      } catch (error) {\n        // Selector not found, continue checking\n        if (error instanceof Error && error.message.includes('required action')) {\n          throw error;\n        }\n      }\n    }\n  },\n\n  /**\n   * Get default Keycloak selectors\n   */\n  getDefaultSelectors(): OIDCIdpSelectors {\n    return { ...DEFAULT_KEYCLOAK_SELECTORS };\n  },\n};\n\n// =============================================================================\n// Utility Functions\n// =============================================================================\n\n/**\n * Check if current page is a Keycloak login page\n */\nexport function isKeycloakLoginPage(page: Page): boolean {\n  const url = page.url();\n  return (\n    url.includes('/auth/realms/') ||\n    url.includes('/realms/') ||\n    url.includes('/protocol/openid-connect/')\n  );\n}\n\n/**\n * Check if Keycloak shows an error message\n */\nexport async function getKeycloakErrorMessage(page: Page): Promise<string | undefined> {\n  const errorSelectors = [\n    '.alert-error',\n    '.kc-feedback-text',\n    '#input-error',\n    '.error-message',\n  ];\n\n  for (const selector of errorSelectors) {\n    try {\n      const element = page.locator(selector);\n      if (await element.isVisible({ timeout: 500 })) {\n        return await element.textContent() ?? undefined;\n      }\n    } catch {\n      // Continue\n    }\n  }\n\n  return undefined;\n}\n","/**\n * Azure AD / Entra ID handler\n *\n * Handles Microsoft Azure Active Directory (now Entra ID) login page interactions.\n *\n * FR-006: Support OIDC with configurable Identity Provider handlers (Azure AD)\n *\n * @module auth/oidc/providers/azure-ad\n */\n\nimport type { Page } from '@playwright/test';\nimport type {\n  Credentials,\n  IdpHandler,\n  OIDCIdpSelectors,\n  OIDCMfaConfig,\n} from '../../types.js';\nimport { generateTOTPCode } from '../flow.js';\nimport { createLogger } from '../../../utils/logger.js';\n\nconst logger = createLogger('auth', 'azure-ad');\n\n// =============================================================================\n// Default Selectors\n// =============================================================================\n\n/**\n * Default Azure AD form selectors\n *\n * Azure AD uses a multi-step login flow:\n * 1. Enter email/username\n * 2. Click Next\n * 3. Enter password\n * 4. Click Sign in\n * 5. (Optional) \"Stay signed in?\" prompt\n */\nconst DEFAULT_AZURE_AD_SELECTORS: OIDCIdpSelectors = {\n  // Username input (email field)\n  username: 'input[type=\"email\"], input[name=\"loginfmt\"], #i0116',\n  // Password input\n  password: 'input[type=\"password\"], input[name=\"passwd\"], #i0118, #passwordInput',\n  // Primary submit button (Next / Sign in)\n  submit: 'input[type=\"submit\"], #idSIButton9',\n  // \"No\" button on \"Stay signed in?\" prompt\n  staySignedInNo: '#idBtn_Back, input[value=\"No\"]',\n  // TOTP/OTP selectors\n  totpInput: 'input[name=\"otc\"], #idTxtBx_SAOTCC_OTC',\n  totpSubmit: 'input[type=\"submit\"], #idSubmit_SAOTCC_Continue',\n};\n\n// =============================================================================\n// Azure AD Handler\n// =============================================================================\n\n/**\n * Azure AD / Entra ID handler\n *\n * Handles:\n * - Multi-step username/password login\n * - \"Stay signed in?\" prompt\n * - TOTP-based MFA\n * - Conditional Access prompts\n */\nexport const azureAdHandler: IdpHandler = {\n  idpType: 'azure-ad',\n\n  /**\n   * Fill credentials on Azure AD login page\n   *\n   * Azure AD uses a two-step process:\n   * 1. Enter username, click Next\n   * 2. Enter password\n   */\n  async fillCredentials(\n    page: Page,\n    credentials: Credentials,\n    selectors?: OIDCIdpSelectors\n  ): Promise<void> {\n    const {\n      username: usernameSelector,\n      password: passwordSelector,\n      submit: submitSelector,\n    } = {\n      ...DEFAULT_AZURE_AD_SELECTORS,\n      ...selectors,\n    };\n\n    logger.debug('Filling Azure AD credentials (two-step flow)');\n\n    // Step 1: Enter username\n    await page.waitForSelector(usernameSelector!, { state: 'visible', timeout: 10000 });\n    await page.fill(usernameSelector!, credentials.username);\n\n    // Click Next to proceed to password page\n    await page.click(submitSelector!);\n\n    // Step 2: Wait for password page and enter password\n    await page.waitForSelector(passwordSelector!, { state: 'visible', timeout: 10000 });\n    await page.fill(passwordSelector!, credentials.password);\n  },\n\n  /**\n   * Submit the Azure AD login form (Sign in)\n   */\n  async submitForm(page: Page, selectors?: OIDCIdpSelectors): Promise<void> {\n    const { submit: submitSelector } = {\n      ...DEFAULT_AZURE_AD_SELECTORS,\n      ...selectors,\n    };\n\n    // Click Sign in\n    await page.click(submitSelector!);\n\n    // Wait for navigation or MFA page\n    await page.waitForLoadState('domcontentloaded', { timeout: 10000 });\n\n    logger.debug('Azure AD form submitted');\n  },\n\n  /**\n   * Handle \"Stay signed in?\" prompt\n   */\n  async handlePostLoginPrompts(page: Page, selectors?: OIDCIdpSelectors): Promise<void> {\n    const { staySignedInNo } = {\n      ...DEFAULT_AZURE_AD_SELECTORS,\n      ...selectors,\n    };\n\n    // Check for \"Stay signed in?\" prompt\n    try {\n      const noButton = page.locator(staySignedInNo!);\n      const isVisible = await noButton.isVisible({ timeout: 3000 });\n\n      if (isVisible) {\n        logger.debug('Handling \"Stay signed in?\" prompt');\n        await noButton.click();\n        await page.waitForLoadState('domcontentloaded', { timeout: 5000 });\n      }\n    } catch {\n      // Prompt not shown, continue\n      logger.debug('\"Stay signed in?\" prompt not shown');\n    }\n  },\n\n  /**\n   * Handle Azure AD MFA challenge\n   */\n  async handleMFA(page: Page, mfaConfig: OIDCMfaConfig): Promise<void> {\n    if (mfaConfig.type !== 'totp') {\n      logger.warn('Non-TOTP MFA type for Azure AD', { type: mfaConfig.type });\n      return;\n    }\n\n    const totpSelector = mfaConfig.totpInputSelector ?? DEFAULT_AZURE_AD_SELECTORS.totpInput;\n    const submitSelector = mfaConfig.totpSubmitSelector ?? DEFAULT_AZURE_AD_SELECTORS.totpSubmit;\n\n    logger.debug('Handling Azure AD TOTP MFA');\n\n    // Wait for OTP input\n    await page.waitForSelector(totpSelector!, { state: 'visible', timeout: 10000 });\n\n    // Generate and enter code\n    if (!mfaConfig.totpSecretEnv) {\n      throw new Error('TOTP secret environment variable not configured');\n    }\n\n    const code = generateTOTPCode(mfaConfig.totpSecretEnv);\n    await page.fill(totpSelector!, code);\n    await page.click(submitSelector!);\n\n    logger.debug('TOTP code submitted to Azure AD');\n  },\n\n  /**\n   * Get default Azure AD selectors\n   */\n  getDefaultSelectors(): OIDCIdpSelectors {\n    return { ...DEFAULT_AZURE_AD_SELECTORS };\n  },\n};\n\n// =============================================================================\n// Utility Functions\n// =============================================================================\n\n/**\n * Check if current page is an Azure AD login page\n */\nexport function isAzureAdLoginPage(page: Page): boolean {\n  const url = page.url();\n  return (\n    url.includes('login.microsoftonline.com') ||\n    url.includes('login.live.com') ||\n    url.includes('login.windows.net')\n  );\n}\n\n/**\n * Check if Azure AD shows an error message\n */\nexport async function getAzureAdErrorMessage(page: Page): Promise<string | undefined> {\n  const errorSelectors = [\n    '#usernameError',\n    '#passwordError',\n    '.error-text',\n    '#errorMessage',\n    '.alert-error',\n  ];\n\n  for (const selector of errorSelectors) {\n    try {\n      const element = page.locator(selector);\n      if (await element.isVisible({ timeout: 500 })) {\n        return await element.textContent() ?? undefined;\n      }\n    } catch {\n      // Continue\n    }\n  }\n\n  return undefined;\n}\n\n/**\n * Check if Azure AD requires MFA\n */\nexport async function isAzureAdMfaRequired(page: Page): Promise<boolean> {\n  const mfaIndicators = [\n    '#idTxtBx_SAOTCC_OTC', // TOTP input\n    '#idDiv_SAOTCC_Description', // MFA description\n    '.verifyInput', // Verification input\n  ];\n\n  for (const selector of mfaIndicators) {\n    try {\n      const element = page.locator(selector);\n      if (await element.isVisible({ timeout: 500 })) {\n        return true;\n      }\n    } catch {\n      // Continue\n    }\n  }\n\n  return false;\n}\n","/**\n * Okta IdP handler\n *\n * Handles Okta-specific login page interactions.\n *\n * FR-006: Support OIDC with configurable Identity Provider handlers (Okta)\n *\n * @module auth/oidc/providers/okta\n */\n\nimport type { Page } from '@playwright/test';\nimport type {\n  Credentials,\n  IdpHandler,\n  OIDCIdpSelectors,\n  OIDCMfaConfig,\n} from '../../types.js';\nimport { generateTOTPCode } from '../flow.js';\nimport { createLogger } from '../../../utils/logger.js';\n\nconst logger = createLogger('auth', 'okta');\n\n// =============================================================================\n// Default Selectors\n// =============================================================================\n\n/**\n * Default Okta form selectors\n *\n * Okta supports multiple login flows:\n * - Classic hosted login\n * - Okta Identity Engine (OIE)\n * - Custom login widgets\n */\nconst DEFAULT_OKTA_SELECTORS: OIDCIdpSelectors = {\n  // Username input\n  username: '#okta-signin-username, input[name=\"identifier\"], input[name=\"username\"]',\n  // Password input\n  password: '#okta-signin-password, input[name=\"credentials.passcode\"], input[name=\"password\"]',\n  // Submit button\n  submit: '#okta-signin-submit, input[type=\"submit\"], button[type=\"submit\"]',\n  // TOTP/OTP selectors\n  totpInput: 'input[name=\"credentials.passcode\"], input[name=\"answer\"], #input-container input',\n  totpSubmit: 'input[type=\"submit\"], button[type=\"submit\"]',\n};\n\n// =============================================================================\n// Okta Handler\n// =============================================================================\n\n/**\n * Okta Identity Provider handler\n *\n * Handles:\n * - Standard username/password login\n * - Okta Identity Engine flows\n * - TOTP-based MFA\n * - Push notification MFA (with timeout)\n */\nexport const oktaHandler: IdpHandler = {\n  idpType: 'okta',\n\n  /**\n   * Fill credentials on Okta login page\n   */\n  async fillCredentials(\n    page: Page,\n    credentials: Credentials,\n    selectors?: OIDCIdpSelectors\n  ): Promise<void> {\n    const { username: usernameSelector, password: passwordSelector } = {\n      ...DEFAULT_OKTA_SELECTORS,\n      ...selectors,\n    };\n\n    logger.debug('Filling Okta credentials');\n\n    // Wait for username field\n    await page.waitForSelector(usernameSelector!, { state: 'visible', timeout: 10000 });\n\n    // Check if this is OIE (two-step) or classic (single-page) flow\n    const passwordField = page.locator(passwordSelector!);\n    const isPasswordVisible = await passwordField.isVisible().catch(() => false);\n\n    if (isPasswordVisible) {\n      // Classic flow - both fields visible\n      await page.fill(usernameSelector!, credentials.username);\n      await page.fill(passwordSelector!, credentials.password);\n    } else {\n      // OIE flow - username first, then password\n      await page.fill(usernameSelector!, credentials.username);\n      // Submit will be called next, then password appears\n    }\n  },\n\n  /**\n   * Submit the Okta login form\n   */\n  async submitForm(page: Page, selectors?: OIDCIdpSelectors): Promise<void> {\n    const { submit: submitSelector, password: passwordSelector } = {\n      ...DEFAULT_OKTA_SELECTORS,\n      ...selectors,\n    };\n\n    // Click submit\n    await page.click(submitSelector!);\n\n    // Wait for potential page transition\n    await page.waitForLoadState('domcontentloaded', { timeout: 5000 }).catch(() => {});\n\n    // Check if password field appeared (OIE two-step flow)\n    try {\n      const passwordField = page.locator(passwordSelector!);\n      const isPasswordVisible = await passwordField.isVisible({ timeout: 2000 });\n\n      if (isPasswordVisible) {\n        const passwordValue = await passwordField.inputValue();\n        if (!passwordValue) {\n          logger.debug('OIE two-step flow detected, password page loaded');\n          // Note: Password should have been filled in fillCredentials\n          // This handles edge cases\n        }\n      }\n    } catch {\n      // Password field not visible, continue\n    }\n\n    logger.debug('Okta form submitted');\n  },\n\n  /**\n   * Handle Okta MFA challenge\n   */\n  async handleMFA(page: Page, mfaConfig: OIDCMfaConfig): Promise<void> {\n    if (mfaConfig.type !== 'totp') {\n      logger.warn('Non-TOTP MFA type for Okta', { type: mfaConfig.type });\n      // For push, we just wait\n      if (mfaConfig.type === 'push') {\n        await handleOktaPushMfa(page, mfaConfig);\n        return;\n      }\n      return;\n    }\n\n    const totpSelector = mfaConfig.totpInputSelector ?? DEFAULT_OKTA_SELECTORS.totpInput;\n    const submitSelector = mfaConfig.totpSubmitSelector ?? DEFAULT_OKTA_SELECTORS.totpSubmit;\n\n    logger.debug('Handling Okta TOTP MFA');\n\n    // Wait for OTP input\n    await page.waitForSelector(totpSelector!, { state: 'visible', timeout: 10000 });\n\n    // Generate and enter code\n    if (!mfaConfig.totpSecretEnv) {\n      throw new Error('TOTP secret environment variable not configured');\n    }\n\n    const code = generateTOTPCode(mfaConfig.totpSecretEnv);\n    await page.fill(totpSelector!, code);\n    await page.click(submitSelector!);\n\n    logger.debug('TOTP code submitted to Okta');\n  },\n\n  /**\n   * Get default Okta selectors\n   */\n  getDefaultSelectors(): OIDCIdpSelectors {\n    return { ...DEFAULT_OKTA_SELECTORS };\n  },\n};\n\n// =============================================================================\n// Helper Functions\n// =============================================================================\n\n/**\n * Handle Okta Push MFA\n */\nasync function handleOktaPushMfa(page: Page, mfaConfig: OIDCMfaConfig): Promise<void> {\n  const timeout = mfaConfig.pushTimeoutMs ?? 30000;\n\n  logger.info('Waiting for Okta Push approval', { timeoutMs: timeout });\n\n  // Wait for push to be approved (page navigates away from MFA)\n  try {\n    await page.waitForFunction(\n      () => {\n        const url = window.location.href;\n        return !url.includes('/signin/verify') && !url.includes('/mfa/');\n      },\n      { timeout }\n    );\n  } catch {\n    throw new Error(`Okta Push MFA approval timeout after ${timeout}ms`);\n  }\n}\n\n// =============================================================================\n// Utility Functions\n// =============================================================================\n\n/**\n * Check if current page is an Okta login page\n */\nexport function isOktaLoginPage(page: Page): boolean {\n  const url = page.url();\n  return (\n    url.includes('.okta.com') ||\n    url.includes('.oktapreview.com') ||\n    url.includes('/oauth2/') ||\n    url.includes('/login/login.htm')\n  );\n}\n\n/**\n * Check if Okta shows an error message\n */\nexport async function getOktaErrorMessage(page: Page): Promise<string | undefined> {\n  const errorSelectors = [\n    '.okta-form-infobox-error',\n    '.o-form-error-container',\n    '.error-box',\n    '[data-se=\"o-form-error-container\"]',\n  ];\n\n  for (const selector of errorSelectors) {\n    try {\n      const element = page.locator(selector);\n      if (await element.isVisible({ timeout: 500 })) {\n        return await element.textContent() ?? undefined;\n      }\n    } catch {\n      // Continue\n    }\n  }\n\n  return undefined;\n}\n\n/**\n * Check if Okta requires MFA factor selection\n */\nexport async function isOktaFactorSelectionRequired(page: Page): Promise<boolean> {\n  const factorSelectors = [\n    '.factor-list',\n    '[data-se=\"factor-list\"]',\n    '.authenticator-verify-list',\n  ];\n\n  for (const selector of factorSelectors) {\n    try {\n      const element = page.locator(selector);\n      if (await element.isVisible({ timeout: 500 })) {\n        return true;\n      }\n    } catch {\n      // Continue\n    }\n  }\n\n  return false;\n}\n","/**\n * Generic OIDC IdP handler\n *\n * Handles generic OIDC providers that don't have a specific handler.\n * Uses configurable selectors to interact with any OIDC login page.\n *\n * FR-006: Support OIDC with configurable Identity Provider handlers (Generic)\n *\n * @module auth/oidc/providers/generic\n */\n\nimport type { Page } from '@playwright/test';\nimport type {\n  Credentials,\n  IdpHandler,\n  OIDCIdpSelectors,\n  OIDCMfaConfig,\n} from '../../types.js';\nimport { generateTOTPCode } from '../flow.js';\nimport { createLogger } from '../../../utils/logger.js';\n\nconst logger = createLogger('auth', 'generic-idp');\n\n// =============================================================================\n// Default Selectors\n// =============================================================================\n\n/**\n * Default generic form selectors\n *\n * These are common patterns that work with many IdPs.\n * Override with specific selectors in config when needed.\n */\nconst DEFAULT_GENERIC_SELECTORS: OIDCIdpSelectors = {\n  // Common username/email input patterns\n  username: [\n    'input[type=\"email\"]',\n    'input[name=\"username\"]',\n    'input[name=\"email\"]',\n    'input[id*=\"username\"]',\n    'input[id*=\"email\"]',\n    'input[autocomplete=\"username\"]',\n  ].join(', '),\n\n  // Common password input patterns\n  password: [\n    'input[type=\"password\"]',\n    'input[name=\"password\"]',\n    'input[id*=\"password\"]',\n    'input[autocomplete=\"current-password\"]',\n  ].join(', '),\n\n  // Common submit button patterns\n  submit: [\n    'button[type=\"submit\"]',\n    'input[type=\"submit\"]',\n    'button:has-text(\"Sign in\")',\n    'button:has-text(\"Log in\")',\n    'button:has-text(\"Login\")',\n    'button:has-text(\"Submit\")',\n  ].join(', '),\n\n  // Common TOTP input patterns\n  totpInput: [\n    'input[name*=\"otp\"]',\n    'input[name*=\"totp\"]',\n    'input[name*=\"code\"]',\n    'input[name*=\"token\"]',\n    'input[type=\"tel\"][maxlength=\"6\"]',\n    'input[autocomplete=\"one-time-code\"]',\n  ].join(', '),\n\n  // Common TOTP submit patterns\n  totpSubmit: [\n    'button[type=\"submit\"]',\n    'input[type=\"submit\"]',\n    'button:has-text(\"Verify\")',\n    'button:has-text(\"Submit\")',\n  ].join(', '),\n};\n\n// =============================================================================\n// Generic Handler\n// =============================================================================\n\n/**\n * Generic OIDC Identity Provider handler\n *\n * Provides a flexible handler that works with most OIDC providers\n * using common selector patterns. Custom selectors can be provided\n * via configuration to handle specific IdP quirks.\n *\n * Handles:\n * - Single-page and two-step login flows\n * - TOTP-based MFA\n * - Common error detection\n */\nexport const genericHandler: IdpHandler = {\n  idpType: 'generic',\n\n  /**\n   * Fill credentials on generic IdP login page\n   */\n  async fillCredentials(\n    page: Page,\n    credentials: Credentials,\n    selectors?: OIDCIdpSelectors\n  ): Promise<void> {\n    const { username: usernameSelector, password: passwordSelector } = {\n      ...DEFAULT_GENERIC_SELECTORS,\n      ...selectors,\n    };\n\n    logger.debug('Filling credentials on generic IdP');\n\n    // Wait for username field\n    const usernameField = page.locator(usernameSelector!).first();\n    await usernameField.waitFor({ state: 'visible', timeout: 10000 });\n\n    // Check if password field is visible\n    const passwordField = page.locator(passwordSelector!).first();\n    const isPasswordVisible = await passwordField.isVisible().catch(() => false);\n\n    if (isPasswordVisible) {\n      // Single-page login - fill both fields\n      await usernameField.fill(credentials.username);\n      await passwordField.fill(credentials.password);\n      logger.debug('Filled both username and password (single-page flow)');\n    } else {\n      // Might be two-step - fill username only\n      await usernameField.fill(credentials.username);\n      logger.debug('Filled username (possible two-step flow)');\n    }\n  },\n\n  /**\n   * Submit the login form\n   */\n  async submitForm(page: Page, selectors?: OIDCIdpSelectors): Promise<void> {\n    const { submit: submitSelector, password: passwordSelector } = {\n      ...DEFAULT_GENERIC_SELECTORS,\n      ...selectors,\n    };\n\n    // Click submit button\n    const submitButton = page.locator(submitSelector!).first();\n    await submitButton.click();\n\n    // Wait for navigation\n    await page.waitForLoadState('domcontentloaded', { timeout: 5000 }).catch(() => {});\n\n    // Check for two-step flow (password appears after username submit)\n    try {\n      const passwordField = page.locator(passwordSelector!).first();\n      const isPasswordVisible = await passwordField.isVisible({ timeout: 2000 });\n\n      if (isPasswordVisible) {\n        const passwordValue = await passwordField.inputValue();\n        if (!passwordValue) {\n          logger.debug('Two-step flow detected, password field now visible');\n        }\n      }\n    } catch {\n      // Password field not visible or doesn't exist\n    }\n\n    logger.debug('Form submitted');\n  },\n\n  /**\n   * Handle MFA challenge\n   */\n  async handleMFA(page: Page, mfaConfig: OIDCMfaConfig): Promise<void> {\n    if (mfaConfig.type !== 'totp') {\n      logger.warn('Non-TOTP MFA type for generic handler', { type: mfaConfig.type });\n      return;\n    }\n\n    const totpSelector = mfaConfig.totpInputSelector ?? DEFAULT_GENERIC_SELECTORS.totpInput;\n    const submitSelector = mfaConfig.totpSubmitSelector ?? DEFAULT_GENERIC_SELECTORS.totpSubmit;\n\n    logger.debug('Handling generic TOTP MFA');\n\n    // Wait for OTP input\n    const totpField = page.locator(totpSelector!).first();\n    await totpField.waitFor({ state: 'visible', timeout: 10000 });\n\n    // Generate and enter code\n    if (!mfaConfig.totpSecretEnv) {\n      throw new Error('TOTP secret environment variable not configured');\n    }\n\n    const code = generateTOTPCode(mfaConfig.totpSecretEnv);\n    await totpField.fill(code);\n\n    // Submit\n    const submitButton = page.locator(submitSelector!).first();\n    await submitButton.click();\n\n    logger.debug('TOTP code submitted');\n  },\n\n  /**\n   * Handle post-login prompts (generic - does nothing by default)\n   */\n  async handlePostLoginPrompts(_page: Page, _selectors?: OIDCIdpSelectors): Promise<void> {\n    // Generic handler doesn't handle specific post-login prompts\n    // Specific IdP handlers should override this\n    logger.debug('No post-login prompt handling for generic IdP');\n  },\n\n  /**\n   * Get default generic selectors\n   */\n  getDefaultSelectors(): OIDCIdpSelectors {\n    return { ...DEFAULT_GENERIC_SELECTORS };\n  },\n};\n\n// =============================================================================\n// Factory Function\n// =============================================================================\n\n/**\n * Create a generic handler with custom selectors\n *\n * @param customSelectors - Custom selectors to merge with defaults\n * @returns Customized IdP handler\n *\n * @example\n * ```typescript\n * const myIdpHandler = createGenericHandler({\n *   username: '#my-username-field',\n *   password: '#my-password-field',\n *   submit: '#my-submit-button',\n * });\n * ```\n */\nexport function createGenericHandler(customSelectors: OIDCIdpSelectors): IdpHandler {\n  const mergedSelectors = {\n    ...DEFAULT_GENERIC_SELECTORS,\n    ...customSelectors,\n  };\n\n  return {\n    idpType: 'generic',\n\n    async fillCredentials(\n      page: Page,\n      credentials: Credentials,\n      selectors?: OIDCIdpSelectors\n    ): Promise<void> {\n      const finalSelectors = { ...mergedSelectors, ...selectors };\n      return genericHandler.fillCredentials(page, credentials, finalSelectors);\n    },\n\n    async submitForm(page: Page, selectors?: OIDCIdpSelectors): Promise<void> {\n      const finalSelectors = { ...mergedSelectors, ...selectors };\n      return genericHandler.submitForm(page, finalSelectors);\n    },\n\n    async handleMFA(page: Page, mfaConfig: OIDCMfaConfig): Promise<void> {\n      return genericHandler.handleMFA!(page, mfaConfig);\n    },\n\n    async handlePostLoginPrompts(page: Page, selectors?: OIDCIdpSelectors): Promise<void> {\n      const finalSelectors = { ...mergedSelectors, ...selectors };\n      return genericHandler.handlePostLoginPrompts!(page, finalSelectors);\n    },\n\n    getDefaultSelectors(): OIDCIdpSelectors {\n      return { ...mergedSelectors };\n    },\n  };\n}\n\n// =============================================================================\n// Utility Functions\n// =============================================================================\n\n/**\n * Try to detect which IdP type based on URL patterns\n *\n * @param page - Playwright Page\n * @returns Detected IdP type or 'generic'\n */\nexport function detectIdpType(page: Page): string {\n  const url = page.url().toLowerCase();\n\n  if (url.includes('keycloak') || url.includes('/auth/realms/')) {\n    return 'keycloak';\n  }\n\n  if (url.includes('login.microsoftonline.com') || url.includes('login.live.com')) {\n    return 'azure-ad';\n  }\n\n  if (url.includes('.okta.com') || url.includes('.oktapreview.com')) {\n    return 'okta';\n  }\n\n  if (url.includes('auth0.com')) {\n    return 'auth0';\n  }\n\n  return 'generic';\n}\n\n/**\n * Get generic error message from page\n */\nexport async function getGenericErrorMessage(page: Page): Promise<string | undefined> {\n  const errorSelectors = [\n    '.error',\n    '.error-message',\n    '.alert-danger',\n    '.alert-error',\n    '[role=\"alert\"]',\n    '.form-error',\n    '.login-error',\n  ];\n\n  for (const selector of errorSelectors) {\n    try {\n      const element = page.locator(selector).first();\n      if (await element.isVisible({ timeout: 500 })) {\n        return await element.textContent() ?? undefined;\n      }\n    } catch {\n      // Continue\n    }\n  }\n\n  return undefined;\n}\n","/**\n * Base AuthProvider abstract class\n *\n * Provides common functionality for all authentication providers including:\n * - Logging setup\n * - Retry configuration\n * - Session validation helpers\n *\n * @module auth/providers/base\n * @see data-model.md Section 2.1\n */\n\nimport type { Page } from '@playwright/test';\nimport type {\n  AuthProvider,\n  AuthRetryOptions,\n  Credentials,\n} from '../types.js';\nimport { createLogger, type Logger } from '../../utils/logger.js';\n\n// =============================================================================\n// Default Configuration\n// =============================================================================\n\n/**\n * Default retry options for authentication\n *\n * NFR-010: Retry authentication failures up to 2 times with exponential backoff\n */\nexport const DEFAULT_AUTH_RETRY_OPTIONS: Required<AuthRetryOptions> = {\n  maxRetries: 2,\n  initialDelayMs: 1000,\n  maxDelayMs: 10000,\n  backoffMultiplier: 2,\n  retryOnTimeout: true,\n  retryOnNetworkError: true,\n};\n\n// =============================================================================\n// Base Class\n// =============================================================================\n\n/**\n * Abstract base class for authentication providers\n *\n * Provides common functionality that all auth providers inherit:\n * - Logger instance\n * - Retry configuration\n * - Helper methods for common operations\n *\n * @example\n * ```typescript\n * class MyAuthProvider extends BaseAuthProvider {\n *   constructor() {\n *     super('my-auth');\n *   }\n *\n *   async login(page: Page, credentials: Credentials): Promise<void> {\n *     this.logger.info('Starting login');\n *     // Implementation...\n *   }\n * }\n * ```\n */\nexport abstract class BaseAuthProvider implements AuthProvider {\n  /**\n   * Logger instance for this provider\n   */\n  protected readonly logger: Logger;\n\n  /**\n   * Retry options for authentication operations\n   */\n  protected readonly retryOptions: Required<AuthRetryOptions>;\n\n  /**\n   * Provider name for logging\n   */\n  protected readonly providerName: string;\n\n  /**\n   * Create a new base auth provider\n   *\n   * @param providerName - Name for logging (e.g., 'oidc', 'form', 'token')\n   * @param retryOptions - Optional retry configuration override\n   */\n  constructor(\n    providerName: string,\n    retryOptions: AuthRetryOptions = {}\n  ) {\n    this.providerName = providerName;\n    this.logger = createLogger('auth', providerName);\n    this.retryOptions = {\n      ...DEFAULT_AUTH_RETRY_OPTIONS,\n      ...retryOptions,\n    };\n  }\n\n  /**\n   * Perform full login flow\n   *\n   * @param page - Playwright Page object\n   * @param credentials - Username and password\n   */\n  abstract login(page: Page, credentials: Credentials): Promise<void>;\n\n  /**\n   * Check if current session is still valid\n   *\n   * @param page - Playwright Page object\n   * @returns true if session is valid\n   */\n  abstract isSessionValid(page: Page): Promise<boolean>;\n\n  /**\n   * Perform logout\n   *\n   * @param page - Playwright Page object\n   */\n  abstract logout(page: Page): Promise<void>;\n\n  /**\n   * Attempt to refresh the session (optional)\n   *\n   * Default implementation returns false (refresh not supported).\n   * Override in subclasses that support session refresh.\n   *\n   * @param page - Playwright Page object\n   * @returns true if refresh succeeded, false if login required\n   */\n  refreshSession(_page: Page): Promise<boolean> {\n    this.logger.debug('Session refresh not supported by this provider');\n    return Promise.resolve(false);\n  }\n\n  // ===========================================================================\n  // Protected Helper Methods\n  // ===========================================================================\n\n  /**\n   * Wait for successful navigation after login\n   *\n   * Waits for either a URL pattern or element selector to indicate success.\n   *\n   * @param page - Playwright Page\n   * @param options - Success detection options\n   */\n  protected async waitForLoginSuccess(\n    page: Page,\n    options: {\n      url?: string;\n      selector?: string;\n      timeout?: number;\n    }\n  ): Promise<void> {\n    const timeout = options.timeout ?? 5000;\n\n    if (options.url && options.selector) {\n      // Wait for either URL or selector\n      await Promise.race([\n        page.waitForURL(options.url, { timeout }),\n        page.waitForSelector(options.selector, { timeout, state: 'visible' }),\n      ]);\n    } else if (options.url) {\n      await page.waitForURL(options.url, { timeout });\n    } else if (options.selector) {\n      await page.waitForSelector(options.selector, { timeout, state: 'visible' });\n    } else {\n      // No success criteria - just wait for load state\n      await page.waitForLoadState('networkidle', { timeout });\n    }\n  }\n\n  /**\n   * Fill a form field with retry on failure\n   *\n   * @param page - Playwright Page\n   * @param selector - Field selector\n   * @param value - Value to fill\n   * @param options - Fill options\n   */\n  protected async fillField(\n    page: Page,\n    selector: string,\n    value: string,\n    options: { timeout?: number; clearFirst?: boolean } = {}\n  ): Promise<void> {\n    const timeout = options.timeout ?? 5000;\n    const clearFirst = options.clearFirst ?? true;\n\n    const locator = page.locator(selector);\n    await locator.waitFor({ state: 'visible', timeout });\n\n    if (clearFirst) {\n      await locator.clear();\n    }\n\n    await locator.fill(value);\n  }\n\n  /**\n   * Click an element with retry on failure\n   *\n   * @param page - Playwright Page\n   * @param selector - Element selector\n   * @param options - Click options\n   */\n  protected async clickElement(\n    page: Page,\n    selector: string,\n    options: { timeout?: number; force?: boolean } = {}\n  ): Promise<void> {\n    const timeout = options.timeout ?? 5000;\n    const force = options.force ?? false;\n\n    const locator = page.locator(selector);\n    await locator.waitFor({ state: 'visible', timeout });\n    await locator.click({ force, timeout });\n  }\n\n  /**\n   * Check if an element is visible on page\n   *\n   * @param page - Playwright Page\n   * @param selector - Element selector\n   * @param timeout - How long to check for visibility\n   * @returns true if element is visible\n   */\n  protected async isElementVisible(\n    page: Page,\n    selector: string,\n    timeout: number = 1000\n  ): Promise<boolean> {\n    try {\n      await page.waitForSelector(selector, { state: 'visible', timeout });\n      return true;\n    } catch {\n      return false;\n    }\n  }\n\n  /**\n   * Get the current page URL\n   *\n   * @param page - Playwright Page\n   * @returns Current URL\n   */\n  protected getCurrentUrl(page: Page): string {\n    return page.url();\n  }\n\n  /**\n   * Check if current URL matches a pattern\n   *\n   * @param page - Playwright Page\n   * @param pattern - URL pattern (string or RegExp)\n   * @returns true if URL matches\n   */\n  protected urlMatches(page: Page, pattern: string | RegExp): boolean {\n    const url = this.getCurrentUrl(page);\n    if (typeof pattern === 'string') {\n      return url.includes(pattern);\n    }\n    return pattern.test(url);\n  }\n\n  /**\n   * Calculate delay for retry attempt using exponential backoff\n   *\n   * @param attempt - Current attempt number (0-indexed)\n   * @returns Delay in milliseconds\n   */\n  protected calculateRetryDelay(attempt: number): number {\n    const baseDelay = this.retryOptions.initialDelayMs;\n    const multiplier = this.retryOptions.backoffMultiplier;\n    const maxDelay = this.retryOptions.maxDelayMs;\n\n    const delay = baseDelay * Math.pow(multiplier, attempt);\n    return Math.min(delay, maxDelay);\n  }\n\n  /**\n   * Determine if an error should trigger a retry\n   *\n   * @param error - Error that occurred\n   * @returns true if should retry\n   */\n  protected shouldRetry(error: Error): boolean {\n    const message = error.message.toLowerCase();\n\n    // Retry on timeout\n    if (this.retryOptions.retryOnTimeout) {\n      if (message.includes('timeout') || message.includes('timed out')) {\n        return true;\n      }\n    }\n\n    // Retry on network errors\n    if (this.retryOptions.retryOnNetworkError) {\n      if (\n        message.includes('network') ||\n        message.includes('net::') ||\n        message.includes('econnrefused') ||\n        message.includes('enotfound')\n      ) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  /**\n   * Sleep for a specified duration\n   *\n   * @param ms - Duration in milliseconds\n   */\n  protected sleep(ms: number): Promise<void> {\n    return new Promise((resolve) => setTimeout(resolve, ms));\n  }\n}\n\n// =============================================================================\n// Utility Types\n// =============================================================================\n\n/**\n * Options for login operations\n */\nexport interface LoginOptions {\n  /** Timeout for the entire login flow in ms */\n  readonly timeout?: number;\n\n  /** Whether to skip session validation after login */\n  readonly skipValidation?: boolean;\n}\n\n/**\n * Options for logout operations\n */\nexport interface LogoutOptions {\n  /** Timeout for logout in ms */\n  readonly timeout?: number;\n\n  /** Whether to also logout from IdP (for OIDC) */\n  readonly idpLogout?: boolean;\n}\n","/**\n * OIDC Authentication Provider\n *\n * Implements the AuthProvider interface for OIDC authentication flows.\n * Supports multiple IdPs (Keycloak, Azure AD, Okta, generic) with retry logic.\n *\n * FR-006: Support OIDC with configurable Identity Provider handlers\n * NFR-010: Retry authentication failures up to 2 times with exponential backoff\n * NFR-011: After retry exhaustion, fail with actionable error message\n * NFR-012: Log each retry attempt at warn level\n *\n * @module auth/providers/oidc\n */\n\nimport type { Page } from '@playwright/test';\nimport type {\n  AuthRetryOptions,\n  Credentials,\n  IdpHandler,\n  OIDCAuthProviderConfig,\n} from '../types.js';\nimport { BaseAuthProvider } from './base.js';\nimport { ARTKAuthError } from '../../errors/auth-error.js';\nimport { executeOIDCFlow, isOIDCSessionValid } from '../oidc/flow.js';\nimport { keycloakHandler } from '../oidc/providers/keycloak.js';\nimport { azureAdHandler } from '../oidc/providers/azure-ad.js';\nimport { oktaHandler } from '../oidc/providers/okta.js';\nimport { genericHandler } from '../oidc/providers/generic.js';\n\n// =============================================================================\n// IdP Handler Registry\n// =============================================================================\n\n/**\n * Map of IdP types to their handlers\n */\nconst IDP_HANDLERS: Record<string, IdpHandler> = {\n  keycloak: keycloakHandler,\n  'azure-ad': azureAdHandler,\n  okta: oktaHandler,\n  auth0: genericHandler, // Auth0 uses generic handler with Auth0-specific selectors\n  generic: genericHandler,\n};\n\n/**\n * Get IdP handler for a given type\n *\n * @param idpType - Type of IdP\n * @returns IdP handler\n */\nexport function getIdpHandler(idpType: string): IdpHandler {\n  const handler = IDP_HANDLERS[idpType];\n  if (!handler) {\n    return genericHandler;\n  }\n  return handler;\n}\n\n// =============================================================================\n// OIDC Auth Provider\n// =============================================================================\n\n/**\n * OIDC Authentication Provider\n *\n * Handles OIDC login flows for various Identity Providers with:\n * - Automatic IdP handler selection based on type\n * - Retry logic with exponential backoff\n * - MFA handling (TOTP)\n * - Session validation\n *\n * @example\n * ```typescript\n * const provider = new OIDCAuthProvider({\n *   idpType: 'keycloak',\n *   loginUrl: 'https://app.example.com/login',\n *   success: { url: 'https://app.example.com/dashboard' },\n * });\n *\n * await provider.login(page, credentials);\n * ```\n */\nexport class OIDCAuthProvider extends BaseAuthProvider {\n  private readonly config: OIDCAuthProviderConfig;\n  private readonly idpHandler: IdpHandler;\n  private currentRole: string = 'unknown';\n\n  /**\n   * Create OIDC auth provider\n   *\n   * @param config - OIDC configuration\n   * @param retryOptions - Optional retry configuration\n   */\n  constructor(\n    config: OIDCAuthProviderConfig,\n    retryOptions: AuthRetryOptions = {}\n  ) {\n    super(`oidc-${config.idpType}`, retryOptions);\n    this.config = config;\n    this.idpHandler = getIdpHandler(config.idpType);\n  }\n\n  /**\n   * Set the role for error reporting\n   *\n   * @param role - Role name\n   */\n  setRole(role: string): void {\n    this.currentRole = role;\n  }\n\n  /**\n   * Perform OIDC login with retry\n   *\n   * NFR-010: Retry authentication failures up to 2 times with exponential backoff\n   * NFR-011: After retry exhaustion, fail with actionable error message\n   * NFR-012: Log each retry attempt at warn level\n   *\n   * @param page - Playwright Page\n   * @param credentials - User credentials\n   * @throws ARTKAuthError on login failure\n   */\n  async login(page: Page, credentials: Credentials): Promise<void> {\n    let lastError: ARTKAuthError | undefined;\n\n    for (let attempt = 0; attempt <= this.retryOptions.maxRetries; attempt++) {\n      try {\n        // Execute OIDC flow\n        const result = await executeOIDCFlow(page, this.config, credentials, {\n          idpHandler: this.idpHandler,\n          role: this.currentRole,\n        });\n\n        if (result.success) {\n          this.logger.info('OIDC login successful', {\n            role: this.currentRole,\n            idpType: this.config.idpType,\n            durationMs: result.durationMs,\n            attempts: attempt + 1,\n          });\n          return;\n        }\n\n        // Flow failed\n        lastError = result.error ?? new ARTKAuthError(\n          'OIDC login failed',\n          this.currentRole,\n          result.phase,\n          undefined,\n          'Check credentials and OIDC configuration'\n        );\n\n        // Check if should retry\n        if (attempt < this.retryOptions.maxRetries) {\n          const delay = this.calculateRetryDelay(attempt);\n\n          // NFR-012: Log each retry attempt at warn level\n          this.logger.warn(`OIDC login attempt ${attempt + 1} failed, retrying in ${delay}ms`, {\n            role: this.currentRole,\n            attempt: attempt + 1,\n            maxRetries: this.retryOptions.maxRetries,\n            delayMs: delay,\n            error: lastError.message,\n          });\n\n          await this.sleep(delay);\n        }\n      } catch (error) {\n        // Unexpected error\n        if (error instanceof ARTKAuthError) {\n          lastError = error;\n        } else {\n          lastError = new ARTKAuthError(\n            error instanceof Error ? error.message : String(error),\n            this.currentRole,\n            'credentials'\n          );\n        }\n\n        // Check if should retry\n        if (attempt < this.retryOptions.maxRetries && this.shouldRetry(lastError)) {\n          const delay = this.calculateRetryDelay(attempt);\n\n          this.logger.warn(`OIDC login error, retrying in ${delay}ms`, {\n            role: this.currentRole,\n            attempt: attempt + 1,\n            delayMs: delay,\n            error: lastError.message,\n          });\n\n          await this.sleep(delay);\n        }\n      }\n    }\n\n    // NFR-011: After retry exhaustion, fail with actionable error message\n    this.logger.error('OIDC login failed after all retries', {\n      role: this.currentRole,\n      maxRetries: this.retryOptions.maxRetries,\n      error: lastError?.message,\n    });\n\n    throw new ARTKAuthError(\n      `OIDC login failed after ${this.retryOptions.maxRetries + 1} attempts: ${lastError?.message ?? 'Unknown error'}`,\n      this.currentRole,\n      lastError?.phase ?? 'credentials',\n      lastError?.idpResponse,\n      `Verify credentials for role \"${this.currentRole}\" are correct. Check OIDC configuration and IdP status.`\n    );\n  }\n\n  /**\n   * Check if current session is valid\n   *\n   * @param page - Playwright Page\n   * @returns true if session is valid\n   */\n  async isSessionValid(page: Page): Promise<boolean> {\n    try {\n      // Navigate to a protected page or check for session indicators\n      const currentUrl = page.url();\n\n      // If we're on the login page, session is not valid\n      if (currentUrl.includes(this.config.loginUrl)) {\n        return false;\n      }\n\n      // Check for success indicators\n      return await isOIDCSessionValid(page, this.config);\n    } catch (error) {\n      this.logger.debug('Session validation failed', {\n        error: error instanceof Error ? error.message : String(error),\n      });\n      return false;\n    }\n  }\n\n  /**\n   * Attempt to refresh the session\n   *\n   * OIDC sessions are typically refreshed via silent renewal.\n   * This method attempts a simple page refresh to trigger token refresh.\n   *\n   * @param page - Playwright Page\n   * @returns true if session is still valid after refresh\n   */\n  async refreshSession(page: Page): Promise<boolean> {\n    try {\n      this.logger.debug('Attempting OIDC session refresh');\n\n      // Reload page to trigger any token refresh\n      await page.reload({ waitUntil: 'networkidle' });\n\n      // Check if we were redirected to login\n      if (page.url().includes(this.config.loginUrl)) {\n        this.logger.debug('Session refresh failed - redirected to login');\n        return false;\n      }\n\n      // Validate session\n      const isValid = await this.isSessionValid(page);\n\n      this.logger.debug('Session refresh result', { isValid });\n      return isValid;\n    } catch (error) {\n      this.logger.warn('Session refresh error', {\n        error: error instanceof Error ? error.message : String(error),\n      });\n      return false;\n    }\n  }\n\n  /**\n   * Perform logout\n   *\n   * @param page - Playwright Page\n   */\n  async logout(page: Page): Promise<void> {\n    this.logger.debug('Performing OIDC logout', { role: this.currentRole });\n\n    try {\n      const logoutConfig = this.config.logout;\n\n      if (logoutConfig?.url) {\n        // Navigate to logout URL\n        await page.goto(logoutConfig.url, { waitUntil: 'networkidle' });\n\n        // If IdP logout is configured, handle redirect\n        if (logoutConfig.idpLogout) {\n          // Wait for IdP logout to complete\n          await page.waitForLoadState('networkidle', { timeout: 10000 });\n        }\n      } else {\n        // Try common logout URLs\n        const baseUrl = new URL(this.config.loginUrl).origin;\n        const logoutUrls = [\n          `${baseUrl}/logout`,\n          `${baseUrl}/api/logout`,\n          `${baseUrl}/auth/logout`,\n        ];\n\n        for (const url of logoutUrls) {\n          try {\n            const response = await page.goto(url, { waitUntil: 'networkidle', timeout: 5000 });\n            if (response?.ok()) {\n              this.logger.debug('Logout successful', { url });\n              return;\n            }\n          } catch {\n            // Try next URL\n          }\n        }\n\n        // Clear cookies as fallback\n        await page.context().clearCookies();\n        this.logger.debug('Cleared cookies as logout fallback');\n      }\n    } catch (error) {\n      this.logger.warn('Logout error', {\n        error: error instanceof Error ? error.message : String(error),\n      });\n      // Clear cookies even if logout fails\n      await page.context().clearCookies();\n    }\n  }\n\n  /**\n   * Get the configured IdP handler\n   */\n  getIdpHandler(): IdpHandler {\n    return this.idpHandler;\n  }\n\n  /**\n   * Get the OIDC configuration\n   */\n  getConfig(): OIDCAuthProviderConfig {\n    return this.config;\n  }\n}\n\n// =============================================================================\n// Factory Function\n// =============================================================================\n\n/**\n * Create OIDC auth provider from config\n *\n * @param config - OIDC configuration\n * @param retryOptions - Optional retry configuration\n * @returns OIDC auth provider instance\n */\nexport function createOIDCAuthProvider(\n  config: OIDCAuthProviderConfig,\n  retryOptions?: AuthRetryOptions\n): OIDCAuthProvider {\n  return new OIDCAuthProvider(config, retryOptions);\n}\n","/**\n * Form-based Authentication Provider\n *\n * Implements the AuthProvider interface for direct form login (no OIDC redirect).\n * Useful for local development environments with basic auth.\n *\n * **MFA Support:** This provider does NOT support multi-factor authentication (MFA).\n * For applications requiring MFA (TOTP, push notifications, etc.), use the\n * OIDCAuthProvider instead, which supports MFA flows including TOTP generation\n * and push notification handling.\n *\n * **Use Cases:**\n * - Local development with basic username/password auth\n * - Simple authentication forms without OIDC\n * - Custom login pages in staging environments\n *\n * @module auth/providers/form\n */\n\nimport type { Page } from '@playwright/test';\nimport type { AuthRetryOptions, Credentials, FormAuthProviderConfig } from '../types.js';\nimport { BaseAuthProvider } from './base.js';\nimport { ARTKAuthError } from '../../errors/auth-error.js';\n\n// =============================================================================\n// Default Configuration\n// =============================================================================\n\n/**\n * Default timeouts for form auth\n */\nconst DEFAULT_TIMEOUTS = {\n  navigationMs: 30000,\n  submitMs: 10000,\n  successMs: 5000,\n};\n\n// =============================================================================\n// Form Auth Provider\n// =============================================================================\n\n/**\n * Form-based Authentication Provider\n *\n * Handles direct form login without OIDC redirect flows.\n * Suitable for:\n * - Local development environments\n * - Basic authentication forms\n * - Custom login pages\n *\n * @example\n * ```typescript\n * const provider = new FormAuthProvider({\n *   loginUrl: 'https://localhost:3000/login',\n *   selectors: {\n *     username: '#username',\n *     password: '#password',\n *     submit: 'button[type=\"submit\"]',\n *   },\n *   success: { url: '/dashboard' },\n * });\n *\n * await provider.login(page, credentials);\n * ```\n */\nexport class FormAuthProvider extends BaseAuthProvider {\n  private readonly config: FormAuthProviderConfig;\n  private currentRole: string = 'unknown';\n\n  /**\n   * Create form auth provider\n   *\n   * @param config - Form auth configuration\n   * @param retryOptions - Optional retry configuration\n   */\n  constructor(\n    config: FormAuthProviderConfig,\n    retryOptions: AuthRetryOptions = {}\n  ) {\n    super('form', retryOptions);\n    this.config = config;\n  }\n\n  /**\n   * Set the role for error reporting\n   */\n  setRole(role: string): void {\n    this.currentRole = role;\n  }\n\n  /**\n   * Perform form-based login\n   *\n   * @param page - Playwright Page\n   * @param credentials - User credentials\n   * @throws ARTKAuthError on login failure\n   */\n  async login(page: Page, credentials: Credentials): Promise<void> {\n    let lastError: ARTKAuthError | undefined;\n\n    for (let attempt = 0; attempt <= this.retryOptions.maxRetries; attempt++) {\n      try {\n        // Navigate to login page\n        await this.navigateToLogin(page);\n\n        // Fill credentials\n        await this.fillCredentials(page, credentials);\n\n        // Submit form\n        await this.submitForm(page);\n\n        // Wait for success\n        await this.waitForSuccess(page);\n\n        this.logger.info('Form login successful', {\n          role: this.currentRole,\n          attempts: attempt + 1,\n        });\n        return;\n      } catch (error) {\n        lastError = error instanceof ARTKAuthError\n          ? error\n          : new ARTKAuthError(\n              error instanceof Error ? error.message : String(error),\n              this.currentRole,\n              'credentials'\n            );\n\n        if (attempt < this.retryOptions.maxRetries && this.shouldRetry(lastError)) {\n          const delay = this.calculateRetryDelay(attempt);\n\n          this.logger.warn(`Form login attempt ${attempt + 1} failed, retrying in ${delay}ms`, {\n            role: this.currentRole,\n            attempt: attempt + 1,\n            delayMs: delay,\n            error: lastError.message,\n          });\n\n          await this.sleep(delay);\n        }\n      }\n    }\n\n    this.logger.error('Form login failed after all retries', {\n      role: this.currentRole,\n      maxRetries: this.retryOptions.maxRetries,\n      error: lastError?.message,\n    });\n\n    throw new ARTKAuthError(\n      `Form login failed after ${this.retryOptions.maxRetries + 1} attempts: ${lastError?.message ?? 'Unknown error'}`,\n      this.currentRole,\n      lastError?.phase ?? 'credentials',\n      undefined,\n      `Verify credentials for role \"${this.currentRole}\" are correct. Check login URL and form selectors.`\n    );\n  }\n\n  /**\n   * Navigate to the login page\n   */\n  private async navigateToLogin(page: Page): Promise<void> {\n    const timeout = this.config.timeouts?.navigationMs ?? DEFAULT_TIMEOUTS.navigationMs;\n\n    this.logger.debug('Navigating to login page', { url: this.config.loginUrl });\n\n    try {\n      await page.goto(this.config.loginUrl, {\n        waitUntil: 'domcontentloaded',\n        timeout,\n      });\n    } catch (error) {\n      const message = error instanceof Error ? error.message : String(error);\n      throw new ARTKAuthError(\n        `Failed to navigate to login page: ${message}`,\n        this.currentRole,\n        'navigation',\n        undefined,\n        `Verify the login URL is correct and accessible: ${this.config.loginUrl}`\n      );\n    }\n  }\n\n  /**\n   * Fill credentials in the login form\n   */\n  private async fillCredentials(page: Page, credentials: Credentials): Promise<void> {\n    const { selectors } = this.config;\n\n    this.logger.debug('Filling credentials');\n\n    try {\n      // Wait for and fill username\n      await this.fillField(page, selectors.username, credentials.username);\n\n      // Wait for and fill password\n      await this.fillField(page, selectors.password, credentials.password);\n    } catch (error) {\n      const message = error instanceof Error ? error.message : String(error);\n      throw new ARTKAuthError(\n        `Failed to fill credentials: ${message}`,\n        this.currentRole,\n        'credentials',\n        undefined,\n        'Check that username and password selectors are correct'\n      );\n    }\n  }\n\n  /**\n   * Submit the login form\n   */\n  private async submitForm(page: Page): Promise<void> {\n    const { selectors } = this.config;\n\n    this.logger.debug('Submitting login form');\n\n    try {\n      await this.clickElement(page, selectors.submit);\n    } catch (error) {\n      const message = error instanceof Error ? error.message : String(error);\n      throw new ARTKAuthError(\n        `Failed to submit login form: ${message}`,\n        this.currentRole,\n        'credentials',\n        undefined,\n        'Check that submit button selector is correct'\n      );\n    }\n  }\n\n  /**\n   * Wait for successful login\n   */\n  private async waitForSuccess(page: Page): Promise<void> {\n    const { success } = this.config;\n    const timeout = success.timeout ?? DEFAULT_TIMEOUTS.successMs;\n\n    this.logger.debug('Waiting for login success');\n\n    try {\n      await this.waitForLoginSuccess(page, {\n        url: success.url,\n        selector: success.selector,\n        timeout,\n      });\n    } catch (error) {\n      // Check for error messages on page\n      const errorText = await this.detectLoginError(page);\n\n      throw new ARTKAuthError(\n        'Login failed - success condition not met',\n        this.currentRole,\n        'callback',\n        errorText,\n        'Verify credentials are correct and success URL/selector configuration'\n      );\n    }\n  }\n\n  /**\n   * Detect login error messages on page\n   */\n  private async detectLoginError(page: Page): Promise<string | undefined> {\n    const errorSelectors = [\n      '.error-message',\n      '.alert-danger',\n      '.error',\n      '[role=\"alert\"]',\n      '.login-error',\n      '#error',\n    ];\n\n    for (const selector of errorSelectors) {\n      try {\n        const element = page.locator(selector).first();\n        if (await element.isVisible({ timeout: 500 })) {\n          return await element.textContent() ?? undefined;\n        }\n      } catch {\n        // Continue\n      }\n    }\n\n    return undefined;\n  }\n\n  /**\n   * Check if current session is valid\n   */\n  async isSessionValid(page: Page): Promise<boolean> {\n    const { success } = this.config;\n    const currentUrl = page.url();\n\n    // Check if on login page\n    if (currentUrl.includes(this.config.loginUrl)) {\n      return false;\n    }\n\n    // Check URL match\n    if (success.url && !currentUrl.includes(success.url)) {\n      return false;\n    }\n\n    // Check selector presence\n    if (success.selector) {\n      try {\n        await page.waitForSelector(success.selector, { state: 'visible', timeout: 1000 });\n      } catch {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  /**\n   * Perform logout\n   */\n  async logout(page: Page): Promise<void> {\n    this.logger.debug('Performing form auth logout');\n\n    // Try common logout URLs\n    const baseUrl = new URL(this.config.loginUrl).origin;\n    const logoutUrls = [\n      `${baseUrl}/logout`,\n      `${baseUrl}/api/logout`,\n      `${baseUrl}/signout`,\n    ];\n\n    for (const url of logoutUrls) {\n      try {\n        const response = await page.goto(url, { waitUntil: 'networkidle', timeout: 5000 });\n        if (response?.ok()) {\n          this.logger.debug('Logout successful', { url });\n          return;\n        }\n      } catch {\n        // Try next\n      }\n    }\n\n    // Clear cookies as fallback\n    await page.context().clearCookies();\n    this.logger.debug('Cleared cookies as logout fallback');\n  }\n\n  /**\n   * Get the form auth configuration\n   */\n  getConfig(): FormAuthProviderConfig {\n    return this.config;\n  }\n}\n\n// =============================================================================\n// Factory Function\n// =============================================================================\n\n/**\n * Create form auth provider from config\n *\n * @param config - Form auth configuration\n * @param retryOptions - Optional retry configuration\n * @returns Form auth provider instance\n */\nexport function createFormAuthProvider(\n  config: FormAuthProviderConfig,\n  retryOptions?: AuthRetryOptions\n): FormAuthProvider {\n  return new FormAuthProvider(config, retryOptions);\n}\n","/**\n * Token-based Authentication Provider\n *\n * Implements the AuthProvider interface for API-based token acquisition.\n * Stores token in browser local storage for reuse across test requests.\n *\n * @module auth/providers/token\n */\n\nimport type { Page } from '@playwright/test';\nimport type { AuthRetryOptions, Credentials, TokenAuthProviderConfig } from '../types.js';\nimport { BaseAuthProvider } from './base.js';\nimport { ARTKAuthError } from '../../errors/auth-error.js';\n\n// =============================================================================\n// Default Configuration\n// =============================================================================\n\n/**\n * Default token auth configuration\n */\nconst DEFAULT_TOKEN_CONFIG = {\n  headerName: 'Authorization',\n  headerPrefix: 'Bearer ',\n  tokenField: 'access_token',\n  timeoutMs: 10000,\n  usernameField: 'username',\n  passwordField: 'password',\n};\n\n/**\n * Local storage key for storing token\n */\nconst TOKEN_STORAGE_KEY = 'artk_auth_token';\n\n// =============================================================================\n// Token Auth Provider\n// =============================================================================\n\n/**\n * Token-based Authentication Provider\n *\n * Handles API-based token acquisition:\n * 1. POST credentials to token endpoint\n * 2. Extract access token from response\n * 3. Store token in browser local storage\n *\n * The stored token can be used by apiContext fixtures for authenticated requests.\n *\n * @example\n * ```typescript\n * const provider = new TokenAuthProvider({\n *   tokenEndpoint: 'https://api.example.com/auth/token',\n *   headerName: 'Authorization',\n *   headerPrefix: 'Bearer ',\n * });\n *\n * await provider.login(page, credentials);\n * // Token is now stored in local storage\n * ```\n */\nexport class TokenAuthProvider extends BaseAuthProvider {\n  private readonly config: TokenAuthProviderConfig;\n  private currentRole: string = 'unknown';\n  private cachedToken: string | undefined;\n\n  /**\n   * Create token auth provider\n   *\n   * @param config - Token auth configuration\n   * @param retryOptions - Optional retry configuration\n   */\n  constructor(\n    config: TokenAuthProviderConfig,\n    retryOptions: AuthRetryOptions = {}\n  ) {\n    super('token', retryOptions);\n    this.config = config;\n  }\n\n  /**\n   * Set the role for error reporting\n   */\n  setRole(role: string): void {\n    this.currentRole = role;\n  }\n\n  /**\n   * Perform token-based login\n   *\n   * Acquires an access token from the token endpoint and stores it\n   * in the browser's local storage for use by test fixtures.\n   *\n   * @param page - Playwright Page\n   * @param credentials - User credentials\n   * @throws ARTKAuthError on login failure\n   */\n  async login(page: Page, credentials: Credentials): Promise<void> {\n    let lastError: ARTKAuthError | undefined;\n\n    for (let attempt = 0; attempt <= this.retryOptions.maxRetries; attempt++) {\n      try {\n        // Acquire token\n        const token = await this.acquireToken(page, credentials);\n\n        // Store token in local storage\n        await this.storeToken(page, token);\n\n        // Cache token for isSessionValid\n        this.cachedToken = token;\n\n        this.logger.info('Token login successful', {\n          role: this.currentRole,\n          attempts: attempt + 1,\n        });\n        return;\n      } catch (error) {\n        lastError = error instanceof ARTKAuthError\n          ? error\n          : new ARTKAuthError(\n              error instanceof Error ? error.message : String(error),\n              this.currentRole,\n              'credentials'\n            );\n\n        if (attempt < this.retryOptions.maxRetries && this.shouldRetry(lastError)) {\n          const delay = this.calculateRetryDelay(attempt);\n\n          this.logger.warn(`Token login attempt ${attempt + 1} failed, retrying in ${delay}ms`, {\n            role: this.currentRole,\n            attempt: attempt + 1,\n            delayMs: delay,\n            error: lastError.message,\n          });\n\n          await this.sleep(delay);\n        }\n      }\n    }\n\n    this.logger.error('Token login failed after all retries', {\n      role: this.currentRole,\n      maxRetries: this.retryOptions.maxRetries,\n      error: lastError?.message,\n    });\n\n    throw new ARTKAuthError(\n      `Token login failed after ${this.retryOptions.maxRetries + 1} attempts: ${lastError?.message ?? 'Unknown error'}`,\n      this.currentRole,\n      lastError?.phase ?? 'credentials',\n      undefined,\n      `Verify credentials for role \"${this.currentRole}\" are correct. Check token endpoint configuration.`\n    );\n  }\n\n  /**\n   * Acquire token from endpoint\n   */\n  private async acquireToken(page: Page, credentials: Credentials): Promise<string> {\n    const {\n      tokenEndpoint,\n      tokenField = DEFAULT_TOKEN_CONFIG.tokenField,\n      timeoutMs = DEFAULT_TOKEN_CONFIG.timeoutMs,\n      requestBody,\n    } = this.config;\n\n    const usernameField = requestBody?.usernameField ?? DEFAULT_TOKEN_CONFIG.usernameField;\n    const passwordField = requestBody?.passwordField ?? DEFAULT_TOKEN_CONFIG.passwordField;\n\n    this.logger.debug('Acquiring token', { endpoint: tokenEndpoint });\n\n    try {\n      // Build request body\n      const body: Record<string, string> = {\n        [usernameField]: credentials.username,\n        [passwordField]: credentials.password,\n        ...requestBody?.additionalFields,\n      };\n\n      // Use page.evaluate to make the request (works around CORS)\n      // Or use Playwright's request context\n      const response = await page.evaluate(\n        async ({ endpoint, body, timeout }): Promise<{ data?: Record<string, unknown>; error?: string }> => {\n          const controller = new AbortController();\n          const timeoutId = setTimeout(() => controller.abort(), timeout);\n\n          try {\n            const res = await fetch(endpoint, {\n              method: 'POST',\n              headers: {\n                'Content-Type': 'application/json',\n              },\n              body: JSON.stringify(body),\n              signal: controller.signal,\n            });\n\n            clearTimeout(timeoutId);\n\n            if (!res.ok) {\n              const text = await res.text().catch(() => '');\n              return { error: `HTTP ${res.status}: ${text}` };\n            }\n\n            return { data: await res.json() as Record<string, unknown> };\n          } catch (e) {\n            clearTimeout(timeoutId);\n            return { error: e instanceof Error ? e.message : String(e) };\n          }\n        },\n        { endpoint: tokenEndpoint, body, timeout: timeoutMs }\n      );\n\n      if (response.error) {\n        throw new ARTKAuthError(\n          `Token request failed: ${response.error}`,\n          this.currentRole,\n          'credentials',\n          response.error,\n          'Check credentials and token endpoint configuration'\n        );\n      }\n\n      // Extract token from response\n      const token = response.data?.[tokenField] as string | undefined;\n\n      if (!token) {\n        throw new ARTKAuthError(\n          `Token not found in response (expected field: ${tokenField})`,\n          this.currentRole,\n          'callback',\n          JSON.stringify(response.data).slice(0, 200),\n          `Check that token endpoint returns token in \"${tokenField}\" field`\n        );\n      }\n\n      return token;\n    } catch (error) {\n      if (error instanceof ARTKAuthError) {\n        throw error;\n      }\n\n      const message = error instanceof Error ? error.message : String(error);\n      throw new ARTKAuthError(\n        `Token acquisition failed: ${message}`,\n        this.currentRole,\n        'credentials',\n        undefined,\n        'Check token endpoint URL and network connectivity'\n      );\n    }\n  }\n\n  /**\n   * Store token in browser local storage\n   */\n  private async storeToken(page: Page, token: string): Promise<void> {\n    const {\n      headerName = DEFAULT_TOKEN_CONFIG.headerName,\n      headerPrefix = DEFAULT_TOKEN_CONFIG.headerPrefix,\n    } = this.config;\n\n    // Store token and header config\n    await page.evaluate(\n      ({ key, token, headerName, headerPrefix }) => {\n        localStorage.setItem(key, JSON.stringify({\n          token,\n          headerName,\n          headerPrefix,\n          timestamp: Date.now(),\n        }));\n      },\n      { key: TOKEN_STORAGE_KEY, token, headerName, headerPrefix }\n    );\n\n    this.logger.debug('Token stored in local storage');\n  }\n\n  /**\n   * Check if current session is valid\n   */\n  async isSessionValid(page: Page): Promise<boolean> {\n    try {\n      const stored = await page.evaluate((key): { token?: string } | null => {\n        const data = localStorage.getItem(key);\n        if (!data) {return null;}\n        return JSON.parse(data) as { token?: string };\n      }, TOKEN_STORAGE_KEY);\n\n      if (!stored?.token) {\n        return false;\n      }\n\n      // Token exists - could add JWT expiry check here\n      return true;\n    } catch {\n      return false;\n    }\n  }\n\n  /**\n   * Perform logout - clear stored token\n   */\n  async logout(page: Page): Promise<void> {\n    this.logger.debug('Performing token auth logout');\n\n    await page.evaluate((key) => {\n      localStorage.removeItem(key);\n    }, TOKEN_STORAGE_KEY);\n\n    this.cachedToken = undefined;\n    this.logger.debug('Token cleared from local storage');\n  }\n\n  /**\n   * Get the current cached token\n   */\n  getToken(): string | undefined {\n    return this.cachedToken;\n  }\n\n  /**\n   * Get the token auth configuration\n   */\n  getConfig(): TokenAuthProviderConfig {\n    return this.config;\n  }\n\n  /**\n   * Get the authorization header value\n   */\n  getAuthHeader(): string | undefined {\n    if (!this.cachedToken) {\n      return undefined;\n    }\n\n    const prefix = this.config.headerPrefix ?? DEFAULT_TOKEN_CONFIG.headerPrefix;\n    return `${prefix}${this.cachedToken}`;\n  }\n\n  /**\n   * Get the header name for authorization\n   */\n  getHeaderName(): string {\n    return this.config.headerName ?? DEFAULT_TOKEN_CONFIG.headerName;\n  }\n}\n\n// =============================================================================\n// Factory Function\n// =============================================================================\n\n/**\n * Create token auth provider from config\n *\n * @param config - Token auth configuration\n * @param retryOptions - Optional retry configuration\n * @returns Token auth provider instance\n */\nexport function createTokenAuthProvider(\n  config: TokenAuthProviderConfig,\n  retryOptions?: AuthRetryOptions\n): TokenAuthProvider {\n  return new TokenAuthProvider(config, retryOptions);\n}\n\n// =============================================================================\n// Utility Functions\n// =============================================================================\n\n/**\n * Get stored token from page local storage\n *\n * @param page - Playwright Page\n * @returns Stored token data or undefined\n */\nexport async function getStoredToken(page: Page): Promise<{\n  token: string;\n  headerName: string;\n  headerPrefix: string;\n  timestamp: number;\n} | undefined> {\n  try {\n    const stored = await page.evaluate((key) => {\n      const data = localStorage.getItem(key);\n      if (!data) {return null;}\n      return JSON.parse(data);\n    }, TOKEN_STORAGE_KEY);\n\n    return stored ?? undefined;\n  } catch {\n    return undefined;\n  }\n}\n","/**\n * Custom Authentication Provider Abstract Base\n *\n * Provides an abstract base class for implementing project-specific\n * authentication flows. Extend this class when the built-in providers\n * (OIDC, Form, Token) don't meet your needs.\n *\n * @module auth/providers/custom\n */\n\nimport type { Page } from '@playwright/test';\nimport type { AuthRetryOptions, Credentials } from '../types.js';\nimport { BaseAuthProvider } from './base.js';\n\n// =============================================================================\n// Custom Auth Provider\n// =============================================================================\n\n/**\n * Abstract base class for custom authentication providers\n *\n * Extend this class to implement project-specific auth flows.\n * The base class provides:\n * - Retry configuration\n * - Logging\n * - Helper methods for common operations\n *\n * @example\n * ```typescript\n * class MyCustomAuthProvider extends CustomAuthProvider {\n *   constructor() {\n *     super('my-custom-auth', { maxRetries: 3 });\n *   }\n *\n *   async performLogin(page: Page, credentials: Credentials): Promise<void> {\n *     // 1. Navigate to custom login page\n *     await page.goto('https://example.com/special-login');\n *\n *     // 2. Perform custom authentication steps\n *     await page.fill('#custom-user', credentials.username);\n *     await page.fill('#custom-pass', credentials.password);\n *\n *     // 3. Handle custom challenge (e.g., captcha, security question)\n *     await this.handleSecurityQuestion(page);\n *\n *     // 4. Submit and verify\n *     await page.click('#login-button');\n *     await page.waitForURL('/dashboard');\n *   }\n *\n *   async checkSessionValidity(page: Page): Promise<boolean> {\n *     // Check for session indicator\n *     return await page.isVisible('.user-profile-icon');\n *   }\n *\n *   async performLogout(page: Page): Promise<void> {\n *     await page.click('#logout-button');\n *   }\n *\n *   private async handleSecurityQuestion(page: Page): Promise<void> {\n *     // Custom logic for security questions\n *   }\n * }\n * ```\n */\nexport abstract class CustomAuthProvider extends BaseAuthProvider {\n  private currentRole: string = 'unknown';\n\n  /**\n   * Create a custom auth provider\n   *\n   * @param providerName - Name for logging\n   * @param retryOptions - Retry configuration\n   */\n  constructor(\n    providerName: string = 'custom',\n    retryOptions: AuthRetryOptions = {}\n  ) {\n    super(providerName, retryOptions);\n  }\n\n  /**\n   * Set the role for error reporting\n   */\n  setRole(role: string): void {\n    this.currentRole = role;\n  }\n\n  /**\n   * Get the current role\n   */\n  protected getRole(): string {\n    return this.currentRole;\n  }\n\n  // ===========================================================================\n  // Abstract Methods - Must Implement\n  // ===========================================================================\n\n  /**\n   * Perform the actual login implementation\n   *\n   * Override this method with your custom authentication logic.\n   * This method is called by login() which handles retries.\n   *\n   * @param page - Playwright Page\n   * @param credentials - User credentials\n   * @throws Error on login failure\n   */\n  protected abstract performLogin(page: Page, credentials: Credentials): Promise<void>;\n\n  /**\n   * Check if the session is currently valid\n   *\n   * Override this method to implement custom session validation.\n   *\n   * @param page - Playwright Page\n   * @returns true if session is valid\n   */\n  protected abstract checkSessionValidity(page: Page): Promise<boolean>;\n\n  /**\n   * Perform the actual logout implementation\n   *\n   * Override this method with your custom logout logic.\n   *\n   * @param page - Playwright Page\n   */\n  protected abstract performLogout(page: Page): Promise<void>;\n\n  // ===========================================================================\n  // Interface Implementation (with retry)\n  // ===========================================================================\n\n  /**\n   * Login with retry support\n   *\n   * Calls performLogin() with automatic retry on failure.\n   */\n  async login(page: Page, credentials: Credentials): Promise<void> {\n    let lastError: Error | undefined;\n\n    for (let attempt = 0; attempt <= this.retryOptions.maxRetries; attempt++) {\n      try {\n        await this.performLogin(page, credentials);\n\n        this.logger.info('Custom login successful', {\n          role: this.currentRole,\n          attempts: attempt + 1,\n        });\n        return;\n      } catch (error) {\n        lastError = error instanceof Error ? error : new Error(String(error));\n\n        if (attempt < this.retryOptions.maxRetries && this.shouldRetry(lastError)) {\n          const delay = this.calculateRetryDelay(attempt);\n\n          this.logger.warn(`Custom login attempt ${attempt + 1} failed, retrying in ${delay}ms`, {\n            role: this.currentRole,\n            attempt: attempt + 1,\n            delayMs: delay,\n            error: lastError.message,\n          });\n\n          await this.sleep(delay);\n        }\n      }\n    }\n\n    this.logger.error('Custom login failed after all retries', {\n      role: this.currentRole,\n      maxRetries: this.retryOptions.maxRetries,\n      error: lastError?.message,\n    });\n\n    throw lastError;\n  }\n\n  /**\n   * Check session validity\n   */\n  async isSessionValid(page: Page): Promise<boolean> {\n    try {\n      return await this.checkSessionValidity(page);\n    } catch (error) {\n      this.logger.debug('Session validation error', {\n        error: error instanceof Error ? error.message : String(error),\n      });\n      return false;\n    }\n  }\n\n  /**\n   * Perform logout\n   */\n  async logout(page: Page): Promise<void> {\n    try {\n      await this.performLogout(page);\n      this.logger.debug('Custom logout completed');\n    } catch (error) {\n      this.logger.warn('Custom logout error', {\n        error: error instanceof Error ? error.message : String(error),\n      });\n      // Clear cookies as fallback\n      await page.context().clearCookies();\n    }\n  }\n}\n\n// =============================================================================\n// Example Implementation\n// =============================================================================\n\n/**\n * Example custom auth provider for reference\n *\n * This demonstrates how to extend CustomAuthProvider.\n * Copy and modify for your specific needs.\n */\nexport class ExampleCustomAuthProvider extends CustomAuthProvider {\n  private readonly loginUrl: string;\n  private readonly successUrl: string;\n\n  constructor(options: { loginUrl: string; successUrl: string }) {\n    super('example-custom');\n    this.loginUrl = options.loginUrl;\n    this.successUrl = options.successUrl;\n  }\n\n  protected async performLogin(page: Page, credentials: Credentials): Promise<void> {\n    // Navigate to login page\n    await page.goto(this.loginUrl);\n\n    // Fill credentials\n    await page.fill('input[name=\"username\"]', credentials.username);\n    await page.fill('input[name=\"password\"]', credentials.password);\n\n    // Submit\n    await page.click('button[type=\"submit\"]');\n\n    // Wait for success\n    await page.waitForURL(this.successUrl);\n  }\n\n  protected async checkSessionValidity(page: Page): Promise<boolean> {\n    // Using Promise.resolve to make the async meaningful\n    return Promise.resolve(!page.url().includes(this.loginUrl));\n  }\n\n  protected async performLogout(page: Page): Promise<void> {\n    await page.goto(`${new URL(this.loginUrl).origin}/logout`);\n  }\n}\n","/**\n * Auth Setup Factory\n *\n * Creates Playwright auth setup project configurations for each role.\n * These projects run before browser tests to establish authenticated sessions.\n *\n * FR-007: Persist authentication state to files and reuse valid state across test runs\n * FR-009: Support multiple named roles with separate credentials and storage states\n *\n * @module auth/setup-factory\n */\n\nimport * as path from 'node:path';\nimport type { AuthSetupOptions, AuthSetupProject } from './types.js';\nimport type { ARTKConfig, AuthConfig, RoleConfig } from '../config/types.js';\nimport { DEFAULT_STORAGE_STATE_CONFIG } from './storage-state.js';\nimport { createLogger } from '../utils/logger.js';\n\nconst logger = createLogger('auth', 'setup-factory');\n\n// =============================================================================\n// Default Configuration\n// =============================================================================\n\n/**\n * Default auth setup options\n */\nconst DEFAULT_AUTH_SETUP_OPTIONS: Required<AuthSetupOptions> = {\n  outputDir: DEFAULT_STORAGE_STATE_CONFIG.directory,\n  filePattern: DEFAULT_STORAGE_STATE_CONFIG.filePattern,\n  forceReauth: false,\n};\n\n// =============================================================================\n// Auth Setup Factory\n// =============================================================================\n\n/**\n * Create Playwright auth setup project configuration for a role\n *\n * Creates a project configuration that:\n * 1. Runs before browser tests\n * 2. Checks for valid existing storage state\n * 3. Authenticates and saves storage state if needed\n *\n * @param role - Role name (e.g., 'admin', 'standardUser')\n * @param authConfig - Authentication configuration\n * @param options - Optional setup configuration\n * @returns Playwright project configuration with name, testMatch, and setup paths\n */\nexport function createAuthSetup(\n  role: string,\n  authConfig: AuthConfig,\n  _options: AuthSetupOptions = {}\n): AuthSetupProject {\n  logger.debug('Creating auth setup for role', { role });\n\n  // Validate role exists\n  const roleConfig = authConfig.roles[role];\n  if (!roleConfig) {\n    throw new Error(`Role \"${role}\" not found in auth configuration`);\n  }\n\n  // Generate project name\n  const projectName = `auth-setup-${role}`;\n\n  return {\n    name: projectName,\n    testMatch: '**/auth.setup.ts',\n    setup: `auth/setup/${role}.setup.ts`,\n  };\n}\n\n/**\n * Create auth setup projects for all configured roles\n *\n * FR-009: Support multiple named roles with separate credentials and storage states\n *\n * @param authConfig - Authentication configuration\n * @param options - Optional setup configuration\n * @returns Array of Playwright project configurations for all roles\n */\nexport function createAllAuthSetups(\n  authConfig: AuthConfig,\n  options: AuthSetupOptions = {}\n): AuthSetupProject[] {\n  const roles = Object.keys(authConfig.roles);\n\n  logger.debug('Creating auth setups for all roles', { roles });\n\n  return roles.map((role) => createAuthSetup(role, authConfig, options));\n}\n\n/**\n * Create auth setup code for a role\n *\n * Generates the TypeScript code for an auth setup file that can be\n * imported into Playwright's globalSetup.\n *\n * @param role - Role name\n * @param authConfig - Authentication configuration\n * @returns TypeScript code as string\n */\nexport function generateAuthSetupCode(role: string, authConfig: AuthConfig): string {\n  const roleConfig = authConfig.roles[role];\n  if (!roleConfig) {\n    throw new Error(`Role \"${role}\" not found in auth configuration`);\n  }\n\n  return `/**\n * Auth Setup for role: ${role}\n *\n * This file is auto-generated by ARTK.\n * It runs before browser tests to establish an authenticated session.\n */\n\nimport { chromium } from '@playwright/test';\nimport {\n  getCredentials,\n  saveStorageState,\n  loadStorageState,\n  cleanupExpiredStorageStates,\n  createAuthProviderFromConfig,\n} from '@artk/core/auth';\nimport { loadConfig } from '@artk/core/config';\n\nasync function setup() {\n  // Load configuration\n  const config = await loadConfig();\n\n  // Cleanup expired storage states (NFR-007)\n  await cleanupExpiredStorageStates();\n\n  // Check for valid existing storage state\n  const existingState = await loadStorageState('${role}', {\n    directory: config.auth.storageState.directory,\n    maxAgeMinutes: config.auth.storageState.maxAgeMinutes,\n  });\n\n  if (existingState) {\n    console.log('Reusing existing storage state for role: ${role}');\n    return;\n  }\n\n  console.log('Authenticating for role: ${role}');\n\n  // Get credentials\n  const credentials = getCredentials('${role}', config.auth);\n\n  // Create auth provider\n  const provider = createAuthProviderFromConfig(config.auth, '${role}');\n\n  // Launch browser\n  const browser = await chromium.launch();\n  const context = await browser.newContext();\n  const page = await context.newPage();\n\n  try {\n    // Perform login\n    await provider.login(page, credentials);\n\n    // Save storage state\n    await saveStorageState(context, '${role}', {\n      directory: config.auth.storageState.directory,\n      filePattern: config.auth.storageState.filePattern,\n    });\n\n    console.log('Authentication successful for role: ${role}');\n  } finally {\n    await browser.close();\n  }\n}\n\nexport default setup;\n`;\n}\n\n// =============================================================================\n// Playwright Config Integration\n// =============================================================================\n\n/**\n * Generate Playwright project configurations for auth setup\n *\n * Creates the full project configuration array needed for playwright.config.ts\n * including dependencies between auth setups and browser tests.\n *\n * Use these projects in playwright.config.ts by spreading them into the projects\n * array and setting browser test projects to depend on them.\n *\n * @param config - Full ARTK configuration\n * @returns Array of Playwright project configurations with name, testMatch, and metadata\n */\nexport function generateAuthProjects(config: ARTKConfig): PlaywrightAuthProject[] {\n  const authConfig = config.auth;\n  const roles = Object.keys(authConfig.roles);\n\n  return roles.map((role) => ({\n    name: `auth-setup-${role}`,\n    testMatch: /auth\\.setup\\.ts$/,\n    metadata: {\n      role,\n      storageStatePath: getStorageStatePath(role, {\n        outputDir: authConfig.storageState.directory,\n        filePattern: authConfig.storageState.filePattern,\n      }),\n    },\n  }));\n}\n\n/**\n * Get storage state file path for a role\n */\nfunction getStorageStatePath(role: string, options: AuthSetupOptions): string {\n  const directory = options.outputDir ?? DEFAULT_AUTH_SETUP_OPTIONS.outputDir;\n  const pattern = options.filePattern ?? DEFAULT_AUTH_SETUP_OPTIONS.filePattern;\n\n  const filename = pattern.replace('{role}', role).replace('{env}', 'default');\n  return path.join(directory, filename.endsWith('.json') ? filename : `${filename}.json`);\n}\n\n/**\n * Playwright project configuration for auth\n */\nexport interface PlaywrightAuthProject {\n  name: string;\n  testMatch: RegExp;\n  metadata: {\n    role: string;\n    storageStatePath: string;\n  };\n}\n\n// =============================================================================\n// Auth Provider Factory\n// =============================================================================\n\n/**\n * Create an auth provider from configuration\n *\n * Factory function that creates the appropriate AuthProvider based on\n * the configuration's provider type.\n *\n * @param authConfig - Authentication configuration\n * @param role - Role name for provider setup\n * @returns AuthProvider instance\n */\nexport function createAuthProviderFromConfig(\n  authConfig: AuthConfig,\n  role: string\n): AuthProviderLike {\n  const roleConfig = authConfig.roles[role];\n  if (!roleConfig) {\n    throw new Error(`Role \"${role}\" not found in auth configuration`);\n  }\n\n  const providerType = authConfig.provider;\n\n  // Lazy import to avoid circular dependencies\n  switch (providerType) {\n    case 'oidc': {\n      // Dynamic import would be ideal, but for now we return a factory pattern\n      return {\n        type: 'oidc',\n        role,\n        config: authConfig.oidc!,\n        roleOverrides: roleConfig.oidcOverrides,\n      } as AuthProviderLike;\n    }\n\n    case 'form': {\n      return {\n        type: 'form',\n        role,\n        config: authConfig.form!,\n      } as AuthProviderLike;\n    }\n\n    case 'token': {\n      return {\n        type: 'token',\n        role,\n        // Token config would be in a similar structure\n      } as AuthProviderLike;\n    }\n\n    case 'custom': {\n      return {\n        type: 'custom',\n        role,\n      } as AuthProviderLike;\n    }\n\n    default:\n      throw new Error(`Unknown auth provider type: ${providerType}`);\n  }\n}\n\n/**\n * Auth provider-like object for lazy instantiation\n */\nexport interface AuthProviderLike {\n  type: 'oidc' | 'form' | 'token' | 'custom';\n  role: string;\n  config?: unknown;\n  roleOverrides?: unknown;\n}\n\n// =============================================================================\n// Helper Functions\n// =============================================================================\n\n/**\n * Get all configured role names\n */\nexport function getRoleNames(authConfig: AuthConfig): string[] {\n  return Object.keys(authConfig.roles);\n}\n\n/**\n * Get storage state directory path\n */\nexport function getStorageStateDirectory(authConfig: AuthConfig, projectRoot: string = process.cwd()): string {\n  return path.join(projectRoot, authConfig.storageState.directory);\n}\n\n/**\n * Check if a role is configured\n */\nexport function hasRole(role: string, authConfig: AuthConfig): boolean {\n  return role in authConfig.roles;\n}\n\n/**\n * Get role configuration\n */\nexport function getRoleConfig(role: string, authConfig: AuthConfig): RoleConfig | undefined {\n  return authConfig.roles[role];\n}\n"]}