{"version":3,"sources":["../../utils/logger.ts","../../detection/signals.ts","../../detection/package-scanner.ts","../../detection/entry-detector.ts","../../detection/directory-heuristics.ts","../../detection/frontend-detector.ts","../../detection/submodule-checker.ts","../../detection/env/node-version.ts","../../detection/env/module-system.ts","../../detection/env/typescript-config.ts","../../detection/env/confidence.ts","../../detection/env/index.ts"],"names":["logger","path","existsSync","readFile","statSync","readdir","DEFAULT_OPTIONS","execSync","commitMatch","path6","fs","stripJsonComments","path7","fs2","ESM_TS_MODULES","path8","fs3"],"mappings":"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","file":"index.cjs","sourcesContent":["/**\n * Structured logger utility\n *\n * Provides structured JSON logging with verbosity levels (debug, info, warn, error)\n * as required by NFR-001, NFR-002, and NFR-003.\n *\n * All logs include module, operation, and timestamp for filtering and aggregation.\n *\n * @example\n * ```typescript\n * import { createLogger } from './logger.js';\n *\n * const logger = createLogger('config', 'loadConfig');\n * logger.info('Loading configuration', { path: 'artk.config.yml' });\n * logger.error('Validation failed', { errors: [...] });\n * ```\n */\n\n/**\n * Log levels in order of severity\n */\nexport type LogLevel = 'debug' | 'info' | 'warn' | 'error';\n\n/**\n * Log output format\n */\nexport type LogFormat = 'json' | 'pretty';\n\n/**\n * Structured log entry\n */\nexport interface LogEntry {\n  level: LogLevel;\n  module: string;\n  operation: string;\n  timestamp: string;\n  message: string;\n  context?: Record<string, unknown>;\n}\n\n/**\n * Logger configuration\n */\nexport interface LoggerConfig {\n  minLevel: LogLevel;\n  format: LogFormat;\n  output: (entry: LogEntry) => void;\n}\n\n/**\n * Log level numeric values for comparison\n */\nconst LOG_LEVELS: Record<LogLevel, number> = {\n  debug: 0,\n  info: 1,\n  warn: 2,\n  error: 3,\n};\n\n/**\n * Format log entry as pretty text\n *\n * @param entry - Log entry to format\n * @returns Formatted string\n */\nfunction formatPretty(entry: LogEntry): string {\n  // Extract time from ISO timestamp (HH:MM:SS)\n  const time = entry.timestamp.split('T')[1]?.split('.')[0] || '00:00:00';\n\n  // Format level (uppercase, padded to 5 chars for alignment)\n  const level = entry.level.toUpperCase().padEnd(5);\n\n  // Format context if present\n  const context = entry.context ? ` ${JSON.stringify(entry.context)}` : '';\n\n  return `[${time}] ${level} [${entry.module}] ${entry.message}${context}`;\n}\n\n/**\n * Global logger configuration\n */\nlet globalConfig: LoggerConfig = {\n  minLevel: 'info',\n  format: 'json',\n  output: (entry: LogEntry): void => {\n    // eslint-disable-next-line no-console\n    const target = entry.level === 'error' ? console.error : console.log;\n\n    if (globalConfig.format === 'pretty') {\n      target(formatPretty(entry));\n    } else {\n      target(JSON.stringify(entry));\n    }\n  },\n};\n\n/**\n * Configure global logger settings\n *\n * @param config - Logger configuration\n *\n * @example\n * ```typescript\n * // JSON format (default, for production)\n * configureLogger({\n *   minLevel: 'debug',\n *   format: 'json'\n * });\n *\n * // Pretty format (for local development)\n * configureLogger({\n *   minLevel: 'debug',\n *   format: 'pretty'\n * });\n *\n * // Custom output\n * configureLogger({\n *   output: (entry) => fs.appendFileSync('artk.log', JSON.stringify(entry) + '\\n')\n * });\n * ```\n */\nexport function configureLogger(config: Partial<LoggerConfig>): void {\n  globalConfig = { ...globalConfig, ...config };\n}\n\n/**\n * Get current logger configuration\n */\nexport function getLoggerConfig(): Readonly<LoggerConfig> {\n  return { ...globalConfig };\n}\n\n/**\n * Logger interface\n */\nexport interface Logger {\n  debug(message: string, context?: Record<string, unknown>): void;\n  info(message: string, context?: Record<string, unknown>): void;\n  warn(message: string, context?: Record<string, unknown>): void;\n  error(message: string, context?: Record<string, unknown>): void;\n}\n\n/**\n * Create a logger for a specific module and operation\n *\n * @param module - Module name (e.g., 'config', 'auth', 'fixtures')\n * @param operation - Operation name (e.g., 'loadConfig', 'saveStorageState')\n * @returns Logger instance\n *\n * @example\n * ```typescript\n * const logger = createLogger('auth', 'oidcLogin');\n * logger.info('Starting OIDC login flow', { role: 'admin' });\n * ```\n */\nexport function createLogger(module: string, operation: string): Logger {\n  const log = (level: LogLevel, message: string, context?: Record<string, unknown>): void => {\n    // Check if this log level should be output\n    if (LOG_LEVELS[level] < LOG_LEVELS[globalConfig.minLevel]) {\n      return;\n    }\n\n    const entry: LogEntry = {\n      level,\n      module,\n      operation,\n      timestamp: new Date().toISOString(),\n      message,\n      context,\n    };\n\n    globalConfig.output(entry);\n  };\n\n  return {\n    debug: (message: string, context?: Record<string, unknown>): void => log('debug', message, context),\n    info: (message: string, context?: Record<string, unknown>): void => log('info', message, context),\n    warn: (message: string, context?: Record<string, unknown>): void => log('warn', message, context),\n    error: (message: string, context?: Record<string, unknown>): void => log('error', message, context),\n  };\n}\n\n/**\n * Parse log level from string (case-insensitive)\n *\n * @param level - Log level string\n * @returns Parsed log level or undefined if invalid\n *\n * @example\n * ```typescript\n * const level = parseLogLevel(process.env.LOG_LEVEL);\n * if (level) {\n *   configureLogger({ minLevel: level });\n * }\n * ```\n */\nexport function parseLogLevel(level: string | undefined): LogLevel | undefined {\n  if (!level) {\n    return undefined;\n  }\n\n  const normalized = level.toLowerCase() as LogLevel;\n  if (normalized in LOG_LEVELS) {\n    return normalized;\n  }\n\n  return undefined;\n}\n","/**\n * @module detection/signals\n * @description Signal scoring constants and utilities for frontend detection.\n *\n * Implements the multi-signal detection approach with confidence scoring\n * as defined in the architecture specification.\n *\n * @example\n * ```typescript\n * import { SIGNAL_WEIGHTS, calculateScore, getConfidenceFromScore } from '@artk/core/detection';\n *\n * const score = calculateScore(['package-dependency:react', 'entry-file:src/App.tsx']);\n * const confidence = getConfidenceFromScore(score); // 'high'\n * ```\n */\n\nimport type { ArtkConfidenceLevel, ArtkDetectionSignalCategory } from '../types/detection.js';\nimport { createLogger } from '../utils/logger.js';\n\nconst logger = createLogger('detection', 'signals');\n\n/**\n * Track unknown signals to avoid spamming warnings.\n * Only warn once per unique signal per process lifecycle.\n * Limited to MAX_WARNED_SIGNALS to prevent memory leaks in long-running processes.\n */\nconst MAX_WARNED_SIGNALS = 1000;\nconst warnedSignals = new Set<string>();\n\n/**\n * Signal weight definitions for frontend detection.\n *\n * Weights are based on the research.md specification:\n * - Package dependencies (30-35): Most reliable indicator\n * - Entry files (15-20): Strong secondary indicator\n * - Directory names (15): Medium confidence\n * - index.html presence (10): Low confidence\n */\nexport const SIGNAL_WEIGHTS = {\n  // Package.json framework dependencies (highest weight)\n  'package-dependency:react': 30,\n  'package-dependency:vue': 30,\n  'package-dependency:@angular/core': 30,\n  'package-dependency:svelte': 30,\n\n  // Package.json meta-framework dependencies (highest weight)\n  'package-dependency:next': 35,\n  'package-dependency:nuxt': 35,\n  'package-dependency:gatsby': 35,\n  'package-dependency:remix': 35,\n  'package-dependency:astro': 35,\n\n  // Package.json build tool dependencies (medium weight)\n  'package-dependency:vite': 20,\n  'package-dependency:webpack': 20,\n  'package-dependency:parcel': 20,\n  'package-dependency:rollup': 15,\n  'package-dependency:esbuild': 15,\n\n  // Entry files - React/TypeScript (medium-high weight)\n  'entry-file:src/App.tsx': 20,\n  'entry-file:src/App.jsx': 20,\n  'entry-file:src/app.tsx': 20,\n  'entry-file:src/app.jsx': 20,\n  'entry-file:src/main.tsx': 15,\n  'entry-file:src/main.jsx': 15,\n  'entry-file:src/index.tsx': 15,\n  'entry-file:src/index.jsx': 15,\n\n  // Entry files - Vue (vue.config.js or vite.config.ts for disambiguation)\n  'entry-file:src/App.vue': 20,\n  'entry-file:vue.config.js': 20,\n  // Shared entry files (Vue/Angular both use these - disambiguation via config files)\n  'entry-file:src/main.ts': 15,\n  'entry-file:src/main.js': 15,\n\n  // Entry files - Next.js\n  'entry-file:app/page.tsx': 20,\n  'entry-file:app/page.jsx': 20,\n  'entry-file:app/layout.tsx': 15,\n  'entry-file:pages/index.tsx': 15,\n  'entry-file:pages/index.jsx': 15,\n  'entry-file:pages/_app.tsx': 15,\n  'entry-file:pages/_app.jsx': 15,\n\n  // Entry files - Nuxt\n  'entry-file:pages/index.vue': 15,\n  'entry-file:app.vue': 15,\n  'entry-file:nuxt.config.ts': 20,\n  'entry-file:nuxt.config.js': 20,\n\n  // Entry files - Angular (angular.json is the definitive indicator)\n  'entry-file:src/app/app.component.ts': 20,\n  'entry-file:angular.json': 25,\n  'entry-file:src/app/app.module.ts': 15,\n\n  // Directory names (medium weight)\n  'directory-name:frontend': 15,\n  'directory-name:client': 15,\n  'directory-name:web': 10,\n  'directory-name:app': 10,\n  'directory-name:ui': 10,\n  'directory-name:webapp': 15,\n  'directory-name:web-app': 15,\n  'directory-name:web-client': 15,\n\n  // index.html presence (low weight)\n  'index-html:public/index.html': 10,\n  'index-html:index.html': 10,\n  'index-html:src/index.html': 10,\n\n  // Config files (various weights)\n  'config-file:vite.config.ts': 20,\n  'config-file:vite.config.js': 20,\n  'config-file:webpack.config.js': 15,\n  'config-file:next.config.js': 25,\n  'config-file:next.config.mjs': 25,\n  'config-file:nuxt.config.ts': 25,\n  'config-file:angular.json': 25,\n  'config-file:svelte.config.js': 20,\n  'config-file:astro.config.mjs': 20,\n\n  // AG Grid dependencies (indicates data-heavy frontend)\n  'package-dependency:ag-grid-community': 25,\n  'package-dependency:ag-grid-enterprise': 30,\n  'package-dependency:ag-grid-react': 25,\n  'package-dependency:ag-grid-vue': 25,\n  'package-dependency:ag-grid-vue3': 25,\n  'package-dependency:ag-grid-angular': 25,\n  'package-dependency:@ag-grid-community/core': 25,\n  'package-dependency:@ag-grid-enterprise/core': 30,\n} as const;\n\n/**\n * Type for valid signal keys.\n */\nexport type SignalKey = keyof typeof SIGNAL_WEIGHTS;\n\n/**\n * Confidence level thresholds.\n * Score 40 = high, 20-39 = medium, <20 = low\n */\nexport const CONFIDENCE_THRESHOLDS = {\n  HIGH: 40,\n  MEDIUM: 20,\n} as const;\n\n/**\n * Framework detection mappings.\n * Maps primary package dependencies to their target types.\n */\nexport const FRAMEWORK_DETECTION_MAP: Record<string, import('../types/target.js').ArtkTargetType> = {\n  'react': 'react-spa',\n  'react-dom': 'react-spa',\n  'vue': 'vue-spa',\n  '@angular/core': 'angular',\n  '@angular/platform-browser': 'angular',\n  'next': 'next',\n  'nuxt': 'nuxt',\n  'nuxt3': 'nuxt',\n  'gatsby': 'react-spa', // Gatsby uses React\n  'svelte': 'other',\n  'astro': 'other',\n  'remix': 'react-spa', // Remix uses React\n};\n\n/**\n * Directory patterns that suggest frontend applications.\n */\nexport const FRONTEND_DIRECTORY_PATTERNS = [\n  'frontend',\n  'client',\n  'web',\n  'webapp',\n  'web-app',\n  'web-client',\n  'app',\n  'ui',\n] as const;\n\n/**\n * Package.json dependencies that indicate a frontend project.\n */\nexport const FRONTEND_PACKAGE_INDICATORS = [\n  // Frameworks\n  'react',\n  'react-dom',\n  'vue',\n  '@angular/core',\n  'svelte',\n  'solid-js',\n\n  // Meta-frameworks\n  'next',\n  'nuxt',\n  'gatsby',\n  'astro',\n  'remix',\n  '@remix-run/react',\n\n  // Build tools (secondary indicators)\n  'vite',\n  'webpack',\n  'parcel',\n  '@vitejs/plugin-react',\n  '@vitejs/plugin-vue',\n\n  // Data grid libraries (indicates data-heavy frontend)\n  'ag-grid-community',\n  'ag-grid-enterprise',\n  'ag-grid-react',\n  'ag-grid-vue',\n  'ag-grid-vue3',\n  'ag-grid-angular',\n  '@ag-grid-community/core',\n  '@ag-grid-enterprise/core',\n] as const;\n\n/**\n * Calculates the total score from a list of signal identifiers.\n *\n * @param signals - Array of signal identifiers (e.g., 'package.json:react')\n * @returns Combined score from all matched signals\n *\n * @example\n * ```typescript\n * const score = calculateScore(['package-dependency:react', 'entry-file:src/App.tsx']);\n * console.log(score); // 50\n * ```\n */\nexport function calculateScore(signals: string[]): number {\n  return signals.reduce((score, signal) => {\n    // Use getSignalWeight for consistent behavior (logging unknown signals)\n    return score + getSignalWeight(signal);\n  }, 0);\n}\n\n/**\n * Determines the confidence level from a score.\n *\n * @param score - The total detection score\n * @returns Confidence level: 'high', 'medium', or 'low'\n *\n * @example\n * ```typescript\n * getConfidenceFromScore(55); // 'high'\n * getConfidenceFromScore(25); // 'medium'\n * getConfidenceFromScore(10); // 'low'\n * ```\n */\nexport function getConfidenceFromScore(score: number): ArtkConfidenceLevel {\n  if (score >= CONFIDENCE_THRESHOLDS.HIGH) return 'high';\n  if (score >= CONFIDENCE_THRESHOLDS.MEDIUM) return 'medium';\n  return 'low';\n}\n\n/**\n * Gets the signal category from a signal identifier.\n *\n * @param signal - Signal identifier (e.g., 'package-dependency:react')\n * @returns Signal category or undefined if invalid format\n *\n * @example\n * ```typescript\n * getSignalCategory('package-dependency:react'); // 'package-dependency'\n * getSignalCategory('entry-file:src/App.tsx'); // 'entry-file'\n * ```\n */\nexport function getSignalCategory(\n  signal: string\n): ArtkDetectionSignalCategory | undefined {\n  const [category] = signal.split(':');\n  const validCategories: ArtkDetectionSignalCategory[] = [\n    'package-dependency',\n    'entry-file',\n    'directory-name',\n    'index-html',\n    'config-file',\n  ];\n\n  return validCategories.includes(category as ArtkDetectionSignalCategory)\n    ? (category as ArtkDetectionSignalCategory)\n    : undefined;\n}\n\n/**\n * Creates a signal identifier from category and source.\n *\n * @param category - Signal category\n * @param source - Signal source (e.g., 'react', 'src/App.tsx')\n * @returns Formatted signal identifier\n *\n * @example\n * ```typescript\n * createSignal('package-dependency', 'react'); // 'package-dependency:react'\n * createSignal('entry-file', 'src/App.tsx'); // 'entry-file:src/App.tsx'\n * ```\n */\nexport function createSignal(\n  category: ArtkDetectionSignalCategory,\n  source: string\n): string {\n  return `${category}:${source}`;\n}\n\n/**\n * Gets the weight for a specific signal.\n *\n * @param signal - Signal identifier\n * @returns Weight value or 0 if signal not recognized\n */\nexport function getSignalWeight(signal: string): number {\n  const weight = SIGNAL_WEIGHTS[signal as SignalKey];\n  if (weight === undefined) {\n    // Rate limit warnings - only warn once per unique signal\n    if (!warnedSignals.has(signal)) {\n      // Prevent memory leak by clearing when threshold reached\n      if (warnedSignals.size >= MAX_WARNED_SIGNALS) {\n        warnedSignals.clear();\n      }\n      warnedSignals.add(signal);\n      logger.warn('Unknown detection signal (returning weight 0)', {\n        signal,\n        hint: 'Check for typos or add the signal to SIGNAL_WEIGHTS',\n      });\n    }\n    return 0;\n  }\n  return weight;\n}\n\n/**\n * Clears the cache of warned signals.\n * Useful for testing or when you want to re-enable warnings.\n */\nexport function clearWarnedSignalsCache(): void {\n  warnedSignals.clear();\n}\n\n/**\n * Checks if a package name indicates a frontend project.\n *\n * @param packageName - Name of the package dependency\n * @returns True if the package suggests a frontend project\n */\nexport function isFrontendPackage(packageName: string): boolean {\n  return FRONTEND_PACKAGE_INDICATORS.includes(\n    packageName as (typeof FRONTEND_PACKAGE_INDICATORS)[number]\n  );\n}\n\n/**\n * Checks if a directory name matches known frontend directory patterns.\n * Simple string matching - for full directory analysis use DirectoryAnalyzer.\n *\n * @param dirName - Name of the directory\n * @returns True if the directory name suggests a frontend project\n */\nexport function matchesFrontendDirectoryPattern(dirName: string): boolean {\n  const normalized = dirName.toLowerCase();\n  return FRONTEND_DIRECTORY_PATTERNS.some((pattern) =>\n    normalized.includes(pattern)\n  );\n}\n\n/**\n * AG Grid package indicators for detection.\n * Used by the grid module to determine if AG Grid helpers should be available.\n */\nexport const AG_GRID_PACKAGE_INDICATORS = [\n  'ag-grid-community',\n  'ag-grid-enterprise',\n  'ag-grid-react',\n  'ag-grid-vue',\n  'ag-grid-vue3',\n  'ag-grid-angular',\n  '@ag-grid-community/core',\n  '@ag-grid-enterprise/core',\n] as const;\n\n/**\n * Checks if a package name indicates AG Grid usage.\n *\n * @param packageName - Name of the package dependency\n * @returns True if the package indicates AG Grid is used\n *\n * @example\n * ```typescript\n * isAgGridPackage('ag-grid-react'); // true\n * isAgGridPackage('react'); // false\n * ```\n */\nexport function isAgGridPackage(packageName: string): boolean {\n  return AG_GRID_PACKAGE_INDICATORS.includes(\n    packageName as (typeof AG_GRID_PACKAGE_INDICATORS)[number]\n  );\n}\n\n/**\n * Checks if a package name indicates AG Grid Enterprise usage.\n *\n * @param packageName - Name of the package dependency\n * @returns True if the package indicates AG Grid Enterprise is used\n */\nexport function isAgGridEnterprisePackage(packageName: string): boolean {\n  return (\n    packageName === 'ag-grid-enterprise' ||\n    packageName === '@ag-grid-enterprise/core'\n  );\n}\n","/**\n * @module detection/package-scanner\n * @description Package.json dependency scanner for frontend detection.\n *\n * Scans package.json files for framework and build tool dependencies\n * to detect frontend applications.\n *\n * @example\n * ```typescript\n * import { scanPackageJson, PackageScanner } from '@artk/core/detection';\n *\n * const result = await scanPackageJson('/path/to/project');\n * console.log(result.signals); // ['package-dependency:react', 'package-dependency:vite']\n * console.log(result.detectedType); // 'react-spa'\n * ```\n */\n\nimport { readFile } from 'node:fs/promises';\nimport { existsSync } from 'node:fs';\nimport path from 'node:path';\nimport type { ArtkTargetType } from '../types/target.js';\nimport type { DetectionSignal } from '../types/detection.js';\nimport {\n  createSignal,\n  FRAMEWORK_DETECTION_MAP,\n  FRONTEND_PACKAGE_INDICATORS,\n  getSignalWeight,\n} from './signals.js';\nimport { createLogger } from '../utils/logger.js';\n\nconst logger = createLogger('detection', 'package-scanner');\n\n/**\n * Result of scanning a package.json file.\n */\nexport interface PackageScanResult {\n  /** Whether a package.json was found */\n  found: boolean;\n\n  /** Absolute path to the package.json file */\n  packageJsonPath: string | null;\n\n  /** Package name from package.json */\n  packageName: string | null;\n\n  /** Detection signals from package dependencies */\n  signals: string[];\n\n  /** Detailed signal information */\n  detailedSignals: DetectionSignal[];\n\n  /** Combined score from all signals */\n  score: number;\n\n  /** Detected frontend type based on dependencies */\n  detectedType: ArtkTargetType | null;\n\n  /** All dependencies found (for debugging) */\n  allDependencies: string[];\n}\n\n/**\n * Package.json structure (partial).\n */\ninterface PackageJson {\n  name?: string;\n  dependencies?: Record<string, string>;\n  devDependencies?: Record<string, string>;\n  peerDependencies?: Record<string, string>;\n}\n\n/**\n * Scanner for package.json files.\n */\nexport class PackageScanner {\n  /**\n   * Scans a package.json file for frontend dependencies.\n   *\n   * @param dirPath - Directory containing package.json\n   * @returns Scan result with signals and detected type\n   */\n  async scan(dirPath: string): Promise<PackageScanResult> {\n    const packageJsonPath = path.join(dirPath, 'package.json');\n\n    const emptyResult: PackageScanResult = {\n      found: false,\n      packageJsonPath: null,\n      packageName: null,\n      signals: [],\n      detailedSignals: [],\n      score: 0,\n      detectedType: null,\n      allDependencies: [],\n    };\n\n    if (!existsSync(packageJsonPath)) {\n      return emptyResult;\n    }\n\n    try {\n      const content = await readFile(packageJsonPath, 'utf-8');\n      const pkg: PackageJson = JSON.parse(content);\n\n      return this.analyzePackage(pkg, packageJsonPath);\n    } catch (error) {\n      // Log error for debugging but continue gracefully\n      logger.warn('Failed to parse package.json (treating as empty)', {\n        path: packageJsonPath,\n        error: error instanceof Error ? error.message : String(error),\n      });\n      return {\n        ...emptyResult,\n        packageJsonPath,\n      };\n    }\n  }\n\n  /**\n   * Analyzes a parsed package.json for frontend indicators.\n   */\n  private analyzePackage(\n    pkg: PackageJson,\n    packageJsonPath: string\n  ): PackageScanResult {\n    const allDeps = this.getAllDependencies(pkg);\n    const signals: string[] = [];\n    const detailedSignals: DetectionSignal[] = [];\n\n    // Check for frontend framework/tool dependencies\n    for (const dep of allDeps) {\n      if (this.isFrontendDependency(dep)) {\n        const signal = createSignal('package-dependency', dep);\n        const weight = getSignalWeight(signal);\n\n        if (weight > 0) {\n          signals.push(signal);\n          detailedSignals.push({\n            type: 'package-dependency',\n            source: signal,\n            weight,\n            description: `Found ${dep} in package.json dependencies`,\n          });\n        }\n      }\n    }\n\n    // Calculate total score\n    const score = detailedSignals.reduce((sum, s) => sum + s.weight, 0);\n\n    // Detect primary framework type\n    const detectedType = this.detectFrameworkType(allDeps);\n\n    return {\n      found: true,\n      packageJsonPath,\n      packageName: pkg.name ?? null,\n      signals,\n      detailedSignals,\n      score,\n      detectedType,\n      allDependencies: allDeps,\n    };\n  }\n\n  /**\n   * Gets all dependencies from package.json (deps + devDeps + peerDeps).\n   */\n  private getAllDependencies(pkg: PackageJson): string[] {\n    const deps = new Set<string>();\n\n    if (pkg.dependencies) {\n      Object.keys(pkg.dependencies).forEach((d) => deps.add(d));\n    }\n    if (pkg.devDependencies) {\n      Object.keys(pkg.devDependencies).forEach((d) => deps.add(d));\n    }\n    if (pkg.peerDependencies) {\n      Object.keys(pkg.peerDependencies).forEach((d) => deps.add(d));\n    }\n\n    return Array.from(deps);\n  }\n\n  /**\n   * Checks if a dependency indicates a frontend project.\n   */\n  private isFrontendDependency(dep: string): boolean {\n    // Direct match\n    if (\n      FRONTEND_PACKAGE_INDICATORS.includes(\n        dep as (typeof FRONTEND_PACKAGE_INDICATORS)[number]\n      )\n    ) {\n      return true;\n    }\n\n    // Check framework detection map\n    if (dep in FRAMEWORK_DETECTION_MAP) {\n      return true;\n    }\n\n    // Check for scoped packages that indicate frontend\n    const scopedPatterns = [\n      /^@angular\\//,\n      /^@vue\\//,\n      /^@vitejs\\//,\n      /^@remix-run\\//,\n      /^@sveltejs\\//,\n      /^@astrojs\\//,\n      /^@nuxt\\//,\n      /^@next\\//,\n    ];\n\n    return scopedPatterns.some((pattern) => pattern.test(dep));\n  }\n\n  /**\n   * Detects the primary framework type from dependencies.\n   * Priority: meta-frameworks > frameworks > build tools\n   */\n  private detectFrameworkType(deps: string[]): ArtkTargetType | null {\n    // Priority 1: Meta-frameworks (Next, Nuxt, etc.)\n    if (deps.includes('next')) return 'next';\n    if (deps.includes('nuxt') || deps.includes('nuxt3')) return 'nuxt';\n\n    // Priority 2: Core frameworks\n    if (deps.includes('react') || deps.includes('react-dom')) return 'react-spa';\n    if (deps.includes('vue')) return 'vue-spa';\n    if (\n      deps.includes('@angular/core') ||\n      deps.includes('@angular/platform-browser')\n    ) {\n      return 'angular';\n    }\n\n    // Priority 3: Other frameworks\n    if (deps.includes('svelte')) return 'other';\n    if (deps.includes('astro')) return 'other';\n    if (deps.includes('solid-js')) return 'other';\n\n    // Priority 4: Check for framework plugins in build tools\n    const hasReactVitePlugin = deps.includes('@vitejs/plugin-react');\n    const hasVueVitePlugin = deps.includes('@vitejs/plugin-vue');\n    const hasReactWebpackPlugin =\n      deps.includes('babel-preset-react-app') ||\n      deps.includes('@babel/preset-react');\n\n    if (hasReactVitePlugin || hasReactWebpackPlugin) return 'react-spa';\n    if (hasVueVitePlugin) return 'vue-spa';\n\n    // No clear framework detected\n    return null;\n  }\n}\n\n/**\n * Convenience function to scan a package.json file.\n *\n * @param dirPath - Directory containing package.json\n * @returns Scan result\n */\nexport async function scanPackageJson(\n  dirPath: string\n): Promise<PackageScanResult> {\n  const scanner = new PackageScanner();\n  return scanner.scan(dirPath);\n}\n\n/**\n * Checks if a directory has a package.json file.\n *\n * @param dirPath - Directory to check\n * @returns True if package.json exists\n */\nexport function hasPackageJson(dirPath: string): boolean {\n  return existsSync(path.join(dirPath, 'package.json'));\n}\n","/**\n * @module detection/entry-detector\n * @description Entry file detector for frontend applications.\n *\n * Scans directories for common frontend entry files like App.tsx,\n * main.ts, pages/index.tsx, etc.\n *\n * @example\n * ```typescript\n * import { detectEntryFiles, EntryFileDetector } from '@artk/core/detection';\n *\n * const result = await detectEntryFiles('/path/to/project');\n * console.log(result.signals); // ['entry-file:src/App.tsx', 'entry-file:src/main.tsx']\n * console.log(result.detectedType); // 'react-spa'\n * ```\n */\n\nimport { existsSync, statSync } from 'node:fs';\nimport path from 'node:path';\nimport type { ArtkTargetType } from '../types/target.js';\nimport type { DetectionSignal } from '../types/detection.js';\nimport { createSignal, getSignalWeight } from './signals.js';\n\n/**\n * Entry file patterns to check, organized by framework.\n */\nexport const ENTRY_FILE_PATTERNS = {\n  // React/Generic SPA\n  react: [\n    'src/App.tsx',\n    'src/App.jsx',\n    'src/app.tsx',\n    'src/app.jsx',\n    'src/main.tsx',\n    'src/main.jsx',\n    'src/index.tsx',\n    'src/index.jsx',\n  ],\n\n  // Vue (src/App.vue is definitive, vue.config.js for Vue 2 CLI projects)\n  // Note: src/main.ts and src/main.js are shared with Angular and other frameworks\n  // so we exclude them from Vue type detection to avoid false positives\n  vue: ['src/App.vue', 'vue.config.js'],\n\n  // Next.js (App Router)\n  'next-app': ['app/page.tsx', 'app/page.jsx', 'app/layout.tsx', 'app/layout.jsx'],\n\n  // Next.js (Pages Router)\n  'next-pages': [\n    'pages/index.tsx',\n    'pages/index.jsx',\n    'pages/_app.tsx',\n    'pages/_app.jsx',\n    'pages/_document.tsx',\n    'pages/_document.jsx',\n  ],\n\n  // Nuxt\n  nuxt: [\n    'pages/index.vue',\n    'app.vue',\n    'nuxt.config.ts',\n    'nuxt.config.js',\n  ],\n\n  // Angular (angular.json is definitive, app.module.ts is legacy but still common)\n  angular: [\n    'src/app/app.component.ts',\n    'src/app/app.module.ts',\n    'src/main.ts',\n    'angular.json',\n  ],\n\n  // Config files (secondary indicators)\n  config: [\n    'vite.config.ts',\n    'vite.config.js',\n    'webpack.config.js',\n    'webpack.config.ts',\n    'next.config.js',\n    'next.config.mjs',\n    'next.config.ts',\n    'svelte.config.js',\n    'astro.config.mjs',\n  ],\n} as const;\n\n/**\n * Result of entry file detection.\n */\nexport interface EntryFileResult {\n  /** All entry files found */\n  foundFiles: string[];\n\n  /** Detection signals from found files */\n  signals: string[];\n\n  /** Detailed signal information */\n  detailedSignals: DetectionSignal[];\n\n  /** Combined score from all signals */\n  score: number;\n\n  /** Detected framework type based on entry files */\n  detectedType: ArtkTargetType | null;\n}\n\n/**\n * Entry file detector for frontend applications.\n */\nexport class EntryFileDetector {\n  /**\n   * Detects entry files in a directory.\n   *\n   * @param dirPath - Directory to scan for entry files\n   * @returns Detection result with signals and type\n   */\n  async detect(dirPath: string): Promise<EntryFileResult> {\n    const foundFiles: string[] = [];\n    const signals: string[] = [];\n    const detailedSignals: DetectionSignal[] = [];\n\n    // Check all entry file patterns\n    for (const [category, patterns] of Object.entries(ENTRY_FILE_PATTERNS)) {\n      for (const pattern of patterns) {\n        const fullPath = path.join(dirPath, pattern);\n\n        if (existsSync(fullPath) && this.isFile(fullPath)) {\n          foundFiles.push(pattern);\n\n          // Determine signal category\n          const signalCategory = pattern.includes('config')\n            ? 'config-file'\n            : 'entry-file';\n          const signal = createSignal(signalCategory, pattern);\n          const weight = getSignalWeight(signal);\n\n          if (weight > 0) {\n            signals.push(signal);\n            detailedSignals.push({\n              type: signalCategory,\n              source: signal,\n              weight,\n              description: `Found ${category} entry file: ${pattern}`,\n            });\n          }\n        }\n      }\n    }\n\n    // Calculate total score\n    const score = detailedSignals.reduce((sum, s) => sum + s.weight, 0);\n\n    // Detect framework type from entry files\n    const detectedType = this.detectTypeFromFiles(foundFiles);\n\n    return {\n      foundFiles,\n      signals,\n      detailedSignals,\n      score,\n      detectedType,\n    };\n  }\n\n  /**\n   * Checks if a path is a file (not a directory).\n   */\n  private isFile(filePath: string): boolean {\n    try {\n      return statSync(filePath).isFile();\n    } catch {\n      return false;\n    }\n  }\n\n  /**\n   * Detects the framework type from found entry files.\n   */\n  private detectTypeFromFiles(files: string[]): ArtkTargetType | null {\n    // Priority 1: Next.js (either router)\n    const hasNextApp = files.some((f) =>\n      ENTRY_FILE_PATTERNS['next-app'].includes(f as any)\n    );\n    const hasNextPages = files.some((f) =>\n      ENTRY_FILE_PATTERNS['next-pages'].includes(f as any)\n    );\n    const hasNextConfig = files.some(\n      (f) => f.startsWith('next.config')\n    );\n\n    if (hasNextApp || hasNextPages || hasNextConfig) {\n      return 'next';\n    }\n\n    // Priority 2: Nuxt\n    const hasNuxt = files.some(\n      (f) =>\n        ENTRY_FILE_PATTERNS.nuxt.includes(f as any) ||\n        f.startsWith('nuxt.config')\n    );\n    if (hasNuxt) {\n      return 'nuxt';\n    }\n\n    // Priority 3: Angular (requires angular.json as definitive indicator)\n    // Note: src/main.ts alone is ambiguous (used by Vue/Angular/React+Vite)\n    // We require angular.json to disambiguate from other frameworks\n    const hasAngularJson = files.includes('angular.json');\n    const hasAngularComponent = files.includes('src/app/app.component.ts');\n    const hasAngularModule = files.includes('src/app/app.module.ts');\n    if (hasAngularJson || (hasAngularComponent && hasAngularModule)) {\n      return 'angular';\n    }\n\n    // Priority 4: Vue\n    const hasVue = files.some((f) =>\n      ENTRY_FILE_PATTERNS.vue.includes(f as any)\n    );\n    if (hasVue) {\n      return 'vue-spa';\n    }\n\n    // Priority 5: React (most generic)\n    const hasReact = files.some((f) =>\n      ENTRY_FILE_PATTERNS.react.includes(f as any)\n    );\n    if (hasReact) {\n      return 'react-spa';\n    }\n\n    // No clear type detected\n    return null;\n  }\n}\n\n/**\n * Convenience function to detect entry files.\n *\n * @param dirPath - Directory to scan\n * @returns Detection result\n */\nexport async function detectEntryFiles(\n  dirPath: string\n): Promise<EntryFileResult> {\n  const detector = new EntryFileDetector();\n  return detector.detect(dirPath);\n}\n\n/**\n * Checks if a directory has any common frontend entry files.\n *\n * @param dirPath - Directory to check\n * @returns True if any entry files are found\n */\nexport async function hasEntryFiles(dirPath: string): Promise<boolean> {\n  const result = await detectEntryFiles(dirPath);\n  return result.foundFiles.length > 0;\n}\n\n/**\n * Gets the list of all entry file patterns to check.\n *\n * @returns Flat list of all entry file patterns\n */\nexport function getAllEntryPatterns(): string[] {\n  return Object.values(ENTRY_FILE_PATTERNS).flat();\n}\n","/**\n * @module detection/directory-heuristics\n * @description Directory name heuristics for frontend detection.\n *\n * Analyzes directory names to identify likely frontend projects\n * based on common naming conventions.\n *\n * @example\n * ```typescript\n * import { analyzeDirectoryName, DirectoryAnalyzer } from '@artk/core/detection';\n *\n * const result = analyzeDirectoryName('frontend');\n * console.log(result.isFrontend); // true\n * console.log(result.score); // 15\n * ```\n */\n\nimport { readdir } from 'node:fs/promises';\nimport path from 'node:path';\nimport type { DetectionSignal } from '../types/detection.js';\nimport { createSignal, getSignalWeight } from './signals.js';\n\n/**\n * Patterns that indicate a frontend directory.\n * Weighted by specificity.\n */\nexport const DIRECTORY_PATTERNS = {\n  // High confidence patterns\n  high: ['frontend', 'client', 'webapp', 'web-app', 'web-client'],\n\n  // Medium confidence patterns\n  medium: ['web', 'app', 'ui'],\n\n  // Low confidence (too generic, needs other signals)\n  low: ['src', 'public', 'assets'],\n} as const;\n\n/**\n * Patterns that suggest a directory is NOT a frontend project.\n */\nexport const NON_FRONTEND_PATTERNS = [\n  'backend',\n  'server',\n  'api',\n  'service',\n  'services',\n  'lib',\n  'libs',\n  'packages',\n  'tools',\n  'scripts',\n  'docs',\n  'documentation',\n  'test',\n  'tests',\n  '__tests__',\n  'e2e',\n  'spec',\n  'specs',\n  'node_modules',\n  '.git',\n  '.github',\n  'dist',\n  'build',\n  'out',\n  'coverage',\n] as const;\n\n/**\n * Result of directory name analysis.\n */\nexport interface DirectoryAnalysisResult {\n  /** The analyzed directory name */\n  dirName: string;\n\n  /** Whether the directory name suggests a frontend project */\n  isFrontend: boolean;\n\n  /** Whether the directory name suggests it's NOT a frontend project */\n  isNonFrontend: boolean;\n\n  /** Confidence level of the analysis */\n  confidence: 'high' | 'medium' | 'low' | 'none';\n\n  /** Detection signals from directory name */\n  signals: string[];\n\n  /** Detailed signal information */\n  detailedSignals: DetectionSignal[];\n\n  /** Combined score from all signals */\n  score: number;\n}\n\n/**\n * Analyzer for directory names and structure.\n */\nexport class DirectoryAnalyzer {\n  /**\n   * Analyzes a directory name for frontend indicators.\n   *\n   * @param dirPath - Path to the directory (uses basename for analysis)\n   * @returns Analysis result\n   */\n  analyze(dirPath: string): DirectoryAnalysisResult {\n    const dirName = path.basename(dirPath).toLowerCase();\n    const signals: string[] = [];\n    const detailedSignals: DetectionSignal[] = [];\n\n    // Check if it matches non-frontend patterns\n    const isNonFrontend = NON_FRONTEND_PATTERNS.some(\n      (pattern) => dirName === pattern || dirName.startsWith(`${pattern}-`)\n    );\n\n    if (isNonFrontend) {\n      return {\n        dirName,\n        isFrontend: false,\n        isNonFrontend: true,\n        confidence: 'none',\n        signals: [],\n        detailedSignals: [],\n        score: 0,\n      };\n    }\n\n    // Check high confidence patterns\n    for (const pattern of DIRECTORY_PATTERNS.high) {\n      if (this.matchesPattern(dirName, pattern)) {\n        const signal = createSignal('directory-name', pattern);\n        const weight = getSignalWeight(signal);\n\n        signals.push(signal);\n        detailedSignals.push({\n          type: 'directory-name',\n          source: signal,\n          weight,\n          description: `Directory name matches frontend pattern: ${pattern}`,\n        });\n      }\n    }\n\n    // Check medium confidence patterns\n    for (const pattern of DIRECTORY_PATTERNS.medium) {\n      if (this.matchesPattern(dirName, pattern)) {\n        const signal = createSignal('directory-name', pattern);\n        const weight = getSignalWeight(signal);\n\n        if (weight > 0) {\n          signals.push(signal);\n          detailedSignals.push({\n            type: 'directory-name',\n            source: signal,\n            weight,\n            description: `Directory name matches frontend pattern: ${pattern}`,\n          });\n        }\n      }\n    }\n\n    // Calculate total score\n    const score = detailedSignals.reduce((sum, s) => sum + s.weight, 0);\n\n    // Determine confidence level\n    let confidence: DirectoryAnalysisResult['confidence'] = 'none';\n    if (DIRECTORY_PATTERNS.high.some((p) => this.matchesPattern(dirName, p))) {\n      confidence = 'high';\n    } else if (\n      DIRECTORY_PATTERNS.medium.some((p) => this.matchesPattern(dirName, p))\n    ) {\n      confidence = 'medium';\n    } else if (signals.length > 0) {\n      confidence = 'low';\n    }\n\n    return {\n      dirName,\n      isFrontend: signals.length > 0,\n      isNonFrontend: false,\n      confidence,\n      signals,\n      detailedSignals,\n      score,\n    };\n  }\n\n  /**\n   * Scans a directory for subdirectories that might be frontends.\n   *\n   * @param rootPath - Root directory to scan\n   * @param maxDepth - Maximum depth to scan (default: 2)\n   * @returns List of potential frontend directories with analysis\n   */\n  async scanForFrontends(\n    rootPath: string,\n    maxDepth = 2\n  ): Promise<DirectoryAnalysisResult[]> {\n    const results: DirectoryAnalysisResult[] = [];\n    await this.scanRecursive(rootPath, rootPath, 0, maxDepth, results);\n    return results.filter((r) => r.isFrontend);\n  }\n\n  /**\n   * Recursive directory scanning.\n   */\n  private async scanRecursive(\n    currentPath: string,\n    rootPath: string,\n    depth: number,\n    maxDepth: number,\n    results: DirectoryAnalysisResult[]\n  ): Promise<void> {\n    if (depth > maxDepth) return;\n\n    try {\n      const entries = await readdir(currentPath, { withFileTypes: true });\n\n      for (const entry of entries) {\n        if (!entry.isDirectory()) continue;\n\n        const entryPath = path.join(currentPath, entry.name);\n        const analysis = this.analyze(entryPath);\n\n        // Skip non-frontend directories completely\n        if (analysis.isNonFrontend) continue;\n\n        // Add to results if it looks like a frontend\n        if (analysis.isFrontend) {\n          results.push(analysis);\n        }\n\n        // Continue scanning subdirectories\n        await this.scanRecursive(\n          entryPath,\n          rootPath,\n          depth + 1,\n          maxDepth,\n          results\n        );\n      }\n    } catch {\n      // Directory not readable, skip\n    }\n  }\n\n  /**\n   * Checks if a directory name matches a pattern.\n   * Supports exact match and prefix/suffix matching.\n   */\n  private matchesPattern(dirName: string, pattern: string): boolean {\n    // Exact match\n    if (dirName === pattern) return true;\n\n    // Suffix match (e.g., 'iss-frontend' matches 'frontend')\n    if (dirName.endsWith(`-${pattern}`)) return true;\n\n    // Prefix match (e.g., 'frontend-app' matches 'frontend')\n    if (dirName.startsWith(`${pattern}-`)) return true;\n\n    return false;\n  }\n}\n\n/**\n * Convenience function to analyze a directory name.\n *\n * @param dirPath - Path to the directory\n * @returns Analysis result\n */\nexport function analyzeDirectoryName(\n  dirPath: string\n): DirectoryAnalysisResult {\n  const analyzer = new DirectoryAnalyzer();\n  return analyzer.analyze(dirPath);\n}\n\n/**\n * Checks if a directory name suggests a frontend project.\n *\n * @param dirPath - Path to the directory\n * @returns True if the directory name suggests a frontend project\n */\nexport function isFrontendDirectory(dirPath: string): boolean {\n  const result = analyzeDirectoryName(dirPath);\n  return result.isFrontend;\n}\n\n/**\n * Checks if a directory name suggests it's NOT a frontend project.\n *\n * @param dirPath - Path to the directory\n * @returns True if the directory is clearly not a frontend\n */\nexport function isNonFrontendDirectory(dirPath: string): boolean {\n  const result = analyzeDirectoryName(dirPath);\n  return result.isNonFrontend;\n}\n\n/**\n * Scans for potential frontend directories in a root path.\n *\n * @param rootPath - Root directory to scan\n * @param maxDepth - Maximum depth to scan\n * @returns List of potential frontend directories\n */\nexport async function scanForFrontendDirectories(\n  rootPath: string,\n  maxDepth = 2\n): Promise<DirectoryAnalysisResult[]> {\n  const analyzer = new DirectoryAnalyzer();\n  return analyzer.scanForFrontends(rootPath, maxDepth);\n}\n","/**\n * @module detection/frontend-detector\n * @description Main frontend detector that combines all detection signals.\n *\n * Orchestrates package scanning, entry file detection, and directory\n * heuristics to identify frontend applications in a project.\n *\n * @example\n * ```typescript\n * import { FrontendDetector, detectFrontends } from '@artk/core/detection';\n *\n * const detector = new FrontendDetector();\n * const results = await detector.detectAll('/path/to/monorepo');\n *\n * for (const result of results) {\n *   console.log(`Found ${result.type} at ${result.path} (${result.confidence})`);\n * }\n * ```\n */\n\nimport { existsSync } from 'node:fs';\nimport { readdir } from 'node:fs/promises';\nimport path from 'node:path';\nimport type { ArtkTargetType } from '../types/target.js';\nimport type {\n  DetectionResult,\n  DetectionSignal,\n  ArtkConfidenceLevel,\n} from '../types/detection.js';\nimport {\n  calculateScore,\n  getConfidenceFromScore,\n  getSignalWeight,\n  CONFIDENCE_THRESHOLDS,\n} from './signals.js';\nimport { PackageScanner, type PackageScanResult } from './package-scanner.js';\nimport { EntryFileDetector, type EntryFileResult } from './entry-detector.js';\nimport {\n  DirectoryAnalyzer,\n  type DirectoryAnalysisResult,\n  NON_FRONTEND_PATTERNS,\n} from './directory-heuristics.js';\n\n/**\n * Options for frontend detection.\n */\nexport interface FrontendDetectorOptions {\n  /** Maximum depth to scan for frontends (default: 3) */\n  maxDepth?: number;\n\n  /** Minimum score required to consider a detection valid (default: 10) */\n  minScore?: number;\n\n  /** Maximum number of results to return (default: 5) */\n  maxResults?: number;\n\n  /** Whether to include low confidence results (default: true) */\n  includeLowConfidence?: boolean;\n\n  /** Base path for calculating relative paths (default: process.cwd()) */\n  relativeTo?: string;\n}\n\n/**\n * Default detection options.\n */\nconst DEFAULT_OPTIONS: Required<FrontendDetectorOptions> = {\n  maxDepth: 3,\n  minScore: 10,\n  maxResults: 5,\n  includeLowConfidence: true,\n  relativeTo: process.cwd(),\n};\n\n/**\n * Main frontend detector class.\n */\nexport class FrontendDetector {\n  private packageScanner: PackageScanner;\n  private entryDetector: EntryFileDetector;\n  private directoryAnalyzer: DirectoryAnalyzer;\n\n  constructor() {\n    this.packageScanner = new PackageScanner();\n    this.entryDetector = new EntryFileDetector();\n    this.directoryAnalyzer = new DirectoryAnalyzer();\n  }\n\n  /**\n   * Detects all potential frontend applications in a directory tree.\n   *\n   * @param rootPath - Root directory to start scanning from\n   * @param options - Detection options\n   * @returns Array of detection results, sorted by score (highest first)\n   */\n  async detectAll(\n    rootPath: string,\n    options?: FrontendDetectorOptions\n  ): Promise<DetectionResult[]> {\n    const opts: Required<FrontendDetectorOptions> = {\n      ...DEFAULT_OPTIONS,\n      ...options,\n    };\n\n    const results: DetectionResult[] = [];\n    const visited = new Set<string>();\n\n    await this.scanDirectory(rootPath, 0, opts, results, visited);\n\n    // Sort by score (highest first)\n    results.sort((a, b) => b.score - a.score);\n\n    // Filter by confidence if needed\n    let filtered = results;\n    if (!opts.includeLowConfidence) {\n      filtered = results.filter((r) => r.confidence !== 'low');\n    }\n\n    // Limit results\n    return filtered.slice(0, opts.maxResults);\n  }\n\n  /**\n   * Detects a single frontend at a specific path.\n   *\n   * @param dirPath - Directory to analyze\n   * @param relativeTo - Base path for relative path calculation\n   * @returns Detection result or null if not a frontend\n   */\n  async detectSingle(\n    dirPath: string,\n    relativeTo?: string\n  ): Promise<DetectionResult | null> {\n    const result = await this.analyzeDirectory(\n      dirPath,\n      relativeTo ?? process.cwd()\n    );\n\n    // Return null if score is too low\n    if (result.score < DEFAULT_OPTIONS.minScore) {\n      return null;\n    }\n\n    return result;\n  }\n\n  /**\n   * Recursively scans directories for frontends.\n   */\n  private async scanDirectory(\n    currentPath: string,\n    depth: number,\n    options: Required<FrontendDetectorOptions>,\n    results: DetectionResult[],\n    visited: Set<string>\n  ): Promise<void> {\n    if (depth > options.maxDepth) return;\n\n    // Normalize and check if already visited\n    const normalizedPath = path.resolve(currentPath);\n    if (visited.has(normalizedPath)) return;\n    visited.add(normalizedPath);\n\n    // Skip non-existent directories\n    if (!existsSync(currentPath)) return;\n\n    // Analyze current directory\n    const result = await this.analyzeDirectory(currentPath, options.relativeTo);\n\n    // Add to results if score meets threshold\n    if (result.score >= options.minScore) {\n      results.push(result);\n    }\n\n    // Scan subdirectories (but skip if current dir is a high-confidence frontend)\n    // This prevents detecting nested node_modules, etc.\n    if (result.confidence !== 'high' || result.score < CONFIDENCE_THRESHOLDS.HIGH) {\n      await this.scanSubdirectories(\n        currentPath,\n        depth,\n        options,\n        results,\n        visited\n      );\n    }\n  }\n\n  /**\n   * Scans subdirectories of a path.\n   */\n  private async scanSubdirectories(\n    currentPath: string,\n    depth: number,\n    options: Required<FrontendDetectorOptions>,\n    results: DetectionResult[],\n    visited: Set<string>\n  ): Promise<void> {\n    try {\n      const entries = await readdir(currentPath, { withFileTypes: true });\n\n      for (const entry of entries) {\n        if (!entry.isDirectory()) continue;\n\n        // Skip common non-frontend directories\n        const lowerName = entry.name.toLowerCase();\n        if (this.shouldSkipDirectory(lowerName)) continue;\n\n        const subPath = path.join(currentPath, entry.name);\n        await this.scanDirectory(subPath, depth + 1, options, results, visited);\n      }\n    } catch {\n      // Directory not readable, skip\n    }\n  }\n\n  /**\n   * Checks if a directory should be skipped during scanning.\n   */\n  private shouldSkipDirectory(dirName: string): boolean {\n    // Skip hidden directories\n    if (dirName.startsWith('.')) return true;\n\n    // Skip known non-frontend directories\n    return NON_FRONTEND_PATTERNS.some((pattern) => dirName === pattern);\n  }\n\n  /**\n   * Analyzes a single directory for frontend signals.\n   */\n  private async analyzeDirectory(\n    dirPath: string,\n    relativeTo: string\n  ): Promise<DetectionResult> {\n    // Collect all signals\n    const allSignals: string[] = [];\n    const allDetailedSignals: DetectionSignal[] = [];\n\n    // 1. Package.json analysis\n    const packageResult = await this.packageScanner.scan(dirPath);\n    if (packageResult.found) {\n      allSignals.push(...packageResult.signals);\n      allDetailedSignals.push(...packageResult.detailedSignals);\n    }\n\n    // 2. Entry file analysis\n    const entryResult = await this.entryDetector.detect(dirPath);\n    allSignals.push(...entryResult.signals);\n    allDetailedSignals.push(...entryResult.detailedSignals);\n\n    // 3. Directory name analysis\n    const dirResult = this.directoryAnalyzer.analyze(dirPath);\n    allSignals.push(...dirResult.signals);\n    allDetailedSignals.push(...dirResult.detailedSignals);\n\n    // 4. Check for index.html\n    const indexHtmlSignals = await this.checkIndexHtml(dirPath);\n    allSignals.push(...indexHtmlSignals.signals);\n    allDetailedSignals.push(...indexHtmlSignals.detailedSignals);\n\n    // Calculate combined score\n    const score = calculateScore(allSignals);\n    const confidence = getConfidenceFromScore(score);\n\n    // Determine type (priority: package > entry > directory)\n    const detectedType = this.determineType(packageResult, entryResult, dirResult);\n\n    // Calculate relative path\n    const relativePath = path.relative(relativeTo, dirPath);\n\n    return {\n      path: path.resolve(dirPath),\n      relativePath: relativePath || '.',\n      confidence,\n      type: detectedType,\n      signals: allSignals,\n      score,\n      detailedSignals: allDetailedSignals,\n    };\n  }\n\n  /**\n   * Checks for index.html files.\n   */\n  private async checkIndexHtml(\n    dirPath: string\n  ): Promise<{ signals: string[]; detailedSignals: DetectionSignal[] }> {\n    const signals: string[] = [];\n    const detailedSignals: DetectionSignal[] = [];\n\n    const locations = [\n      'public/index.html',\n      'index.html',\n      'src/index.html',\n    ];\n\n    for (const location of locations) {\n      const fullPath = path.join(dirPath, location);\n      if (existsSync(fullPath)) {\n        const signal = `index-html:${location}`;\n        const weight = getSignalWeight(signal);\n        signals.push(signal);\n        detailedSignals.push({\n          type: 'index-html',\n          source: signal,\n          weight,\n          description: `Found index.html at ${location}`,\n        });\n      }\n    }\n\n    return { signals, detailedSignals };\n  }\n\n  /**\n   * Determines the frontend type from all detection results.\n   */\n  private determineType(\n    packageResult: PackageScanResult,\n    entryResult: EntryFileResult,\n    _dirResult: DirectoryAnalysisResult\n  ): ArtkTargetType {\n    // Priority 1: Package.json type detection (most reliable)\n    if (packageResult.detectedType) {\n      return packageResult.detectedType;\n    }\n\n    // Priority 2: Entry file type detection\n    if (entryResult.detectedType) {\n      return entryResult.detectedType;\n    }\n\n    // Note: _dirResult is available for future directory-based type detection\n    // Default to 'other' if we have any signals but no specific type\n    return 'other';\n  }\n}\n\n/**\n * Convenience function to detect all frontends in a directory.\n *\n * @param rootPath - Root directory to scan\n * @param options - Detection options\n * @returns Array of detection results\n */\nexport async function detectFrontends(\n  rootPath: string,\n  options?: FrontendDetectorOptions\n): Promise<DetectionResult[]> {\n  const detector = new FrontendDetector();\n  return detector.detectAll(rootPath, options);\n}\n\n/**\n * Convenience function to detect a single frontend.\n *\n * @param dirPath - Directory to analyze\n * @param relativeTo - Base path for relative path calculation\n * @returns Detection result or null\n */\nexport async function detectSingleFrontend(\n  dirPath: string,\n  relativeTo?: string\n): Promise<DetectionResult | null> {\n  const detector = new FrontendDetector();\n  return detector.detectSingle(dirPath, relativeTo);\n}\n\n/**\n * Filters detection results by minimum confidence level.\n *\n * @param results - Detection results to filter\n * @param minConfidence - Minimum confidence level ('low', 'medium', or 'high')\n * @returns Filtered results\n */\nexport function filterByConfidence(\n  results: DetectionResult[],\n  minConfidence: ArtkConfidenceLevel\n): DetectionResult[] {\n  const confidenceOrder: ArtkConfidenceLevel[] = ['low', 'medium', 'high'];\n  const minIndex = confidenceOrder.indexOf(minConfidence);\n\n  return results.filter((r) => {\n    const resultIndex = confidenceOrder.indexOf(r.confidence);\n    return resultIndex >= minIndex;\n  });\n}\n\n/**\n * Converts detection results to ArtkTarget format.\n *\n * @param results - Detection results\n * @returns Array of ArtkTarget objects\n */\nexport function detectionResultsToTargets(\n  results: DetectionResult[]\n): import('../types/target.js').ArtkTarget[] {\n  return results.map((result, index) => ({\n    name: generateTargetName(result, index),\n    path: result.relativePath,\n    type: result.type,\n    detected_by: result.signals,\n    description: `Detected ${result.type} frontend (${result.confidence} confidence, score: ${result.score})`,\n  }));\n}\n\n/**\n * Generates a kebab-case target name from a detection result.\n */\nfunction generateTargetName(result: DetectionResult, index: number): string {\n  // Try to use directory name\n  const dirName = path.basename(result.path).toLowerCase();\n\n  // Clean up to kebab-case\n  const cleaned = dirName\n    .replace(/[^a-z0-9]+/g, '-')\n    .replace(/^-|-$/g, '');\n\n  // If cleaned name is valid, use it\n  if (cleaned && /^[a-z][a-z0-9-]*$/.test(cleaned)) {\n    return cleaned;\n  }\n\n  // Fall back to generic name\n  return index === 0 ? 'frontend' : `frontend-${index + 1}`;\n}\n","/**\n * @module detection/submodule-checker\n * @description Git submodule detection and status checker.\n *\n * Parses .gitmodules files and checks submodule initialization status\n * to identify submodule boundaries during frontend detection.\n *\n * @example\n * ```typescript\n * import { SubmoduleChecker, checkSubmodules } from '@artk/core/detection';\n *\n * const checker = new SubmoduleChecker();\n * const status = await checker.checkAll('/path/to/repo');\n *\n * for (const sub of status) {\n *   console.log(`${sub.path}: ${sub.initialized ? 'initialized' : 'not initialized'}`);\n * }\n * ```\n */\n\nimport { existsSync } from 'node:fs';\nimport { readFile } from 'node:fs/promises';\nimport { execSync } from 'node:child_process';\nimport path from 'node:path';\nimport type { SubmoduleStatus, SubmoduleScanResult } from '../types/submodule.js';\n\n/**\n * Options for submodule checking.\n */\nexport interface SubmoduleCheckerOptions {\n  /** Whether to check initialization status via git command (default: true) */\n  checkInitStatus?: boolean;\n\n  /** Whether to include remote URL information (default: false) */\n  includeUrls?: boolean;\n}\n\n/**\n * Default checker options.\n */\nconst DEFAULT_OPTIONS: Required<SubmoduleCheckerOptions> = {\n  checkInitStatus: true,\n  includeUrls: false,\n};\n\n/**\n * Parsed entry from .gitmodules file.\n */\ninterface GitmodulesEntry {\n  name: string;\n  path: string;\n  url?: string;\n  branch?: string;\n}\n\n/**\n * Checker for git submodule status.\n */\nexport class SubmoduleChecker {\n  /**\n   * Checks all submodules in a repository.\n   *\n   * @param repoRoot - Root directory of the git repository\n   * @param options - Checker options\n   * @returns Array of submodule statuses\n   */\n  async checkAll(\n    repoRoot: string,\n    options?: SubmoduleCheckerOptions\n  ): Promise<SubmoduleStatus[]> {\n    const opts: Required<SubmoduleCheckerOptions> = {\n      ...DEFAULT_OPTIONS,\n      ...options,\n    };\n\n    const gitmodulesPath = path.join(repoRoot, '.gitmodules');\n\n    // No .gitmodules = no submodules\n    if (!existsSync(gitmodulesPath)) {\n      return [];\n    }\n\n    // Parse .gitmodules\n    const entries = await this.parseGitmodules(gitmodulesPath);\n\n    if (entries.length === 0) {\n      return [];\n    }\n\n    // Build status for each submodule\n    const statuses: SubmoduleStatus[] = [];\n\n    for (const entry of entries) {\n      const fullPath = path.join(repoRoot, entry.path);\n      const status: SubmoduleStatus = {\n        path: entry.path,\n        initialized: false,\n      };\n\n      // Check if submodule directory exists\n      if (!existsSync(fullPath)) {\n        status.warning = 'Submodule directory does not exist';\n        statuses.push(status);\n        continue;\n      }\n\n      // Check initialization status\n      if (opts.checkInitStatus) {\n        const initStatus = this.checkInitialization(repoRoot, entry.path);\n        status.initialized = initStatus.initialized;\n        status.commit = initStatus.commit;\n        if (initStatus.warning) {\n          status.warning = initStatus.warning;\n        }\n      } else {\n        // If not checking git status, assume initialized if .git exists\n        status.initialized = existsSync(path.join(fullPath, '.git'));\n      }\n\n      // Include URL if requested\n      if (opts.includeUrls && entry.url) {\n        status.url = entry.url;\n      }\n\n      statuses.push(status);\n    }\n\n    return statuses;\n  }\n\n  /**\n   * Scans a directory to determine if it's a submodule.\n   *\n   * @param dirPath - Directory to check\n   * @param repoRoot - Root of the parent repository\n   * @returns Scan result with submodule information\n   */\n  async scan(dirPath: string, repoRoot: string): Promise<SubmoduleScanResult> {\n    const gitmodulesPath = path.join(repoRoot, '.gitmodules');\n\n    // No .gitmodules = not a submodule\n    if (!existsSync(gitmodulesPath)) {\n      return {\n        isSubmodule: false,\n        path: dirPath,\n      };\n    }\n\n    // Get relative path from repo root\n    const relativePath = path.relative(repoRoot, dirPath);\n\n    // Parse .gitmodules and check if this path matches\n    const entries = await this.parseGitmodules(gitmodulesPath);\n    const matchingEntry = entries.find(\n      (e) => e.path === relativePath || e.path === relativePath.replace(/\\\\/g, '/')\n    );\n\n    if (!matchingEntry) {\n      return {\n        isSubmodule: false,\n        path: dirPath,\n      };\n    }\n\n    // It's a submodule - get its status\n    const initStatus = this.checkInitialization(repoRoot, matchingEntry.path);\n\n    return {\n      isSubmodule: true,\n      path: dirPath,\n      relativePath: matchingEntry.path,\n      status: {\n        path: matchingEntry.path,\n        initialized: initStatus.initialized,\n        commit: initStatus.commit,\n        url: matchingEntry.url,\n        warning: initStatus.warning,\n      },\n    };\n  }\n\n  /**\n   * Checks if a path is within a submodule.\n   *\n   * @param checkPath - Path to check\n   * @param repoRoot - Root of the parent repository\n   * @returns True if path is inside a submodule\n   */\n  async isInSubmodule(checkPath: string, repoRoot: string): Promise<boolean> {\n    const gitmodulesPath = path.join(repoRoot, '.gitmodules');\n\n    if (!existsSync(gitmodulesPath)) {\n      return false;\n    }\n\n    const relativePath = path.relative(repoRoot, checkPath);\n    const normalizedPath = relativePath.replace(/\\\\/g, '/');\n\n    const entries = await this.parseGitmodules(gitmodulesPath);\n\n    // Check if the path starts with any submodule path\n    return entries.some((entry) => {\n      const submodulePath = entry.path.replace(/\\\\/g, '/');\n      return (\n        normalizedPath === submodulePath ||\n        normalizedPath.startsWith(submodulePath + '/')\n      );\n    });\n  }\n\n  /**\n   * Parses a .gitmodules file.\n   *\n   * @param gitmodulesPath - Path to .gitmodules file\n   * @returns Array of parsed submodule entries\n   */\n  private async parseGitmodules(\n    gitmodulesPath: string\n  ): Promise<GitmodulesEntry[]> {\n    try {\n      const content = await readFile(gitmodulesPath, 'utf-8');\n      return this.parseGitmodulesContent(content);\n    } catch {\n      return [];\n    }\n  }\n\n  /**\n   * Parses the content of a .gitmodules file.\n   *\n   * .gitmodules format:\n   * [submodule \"name\"]\n   *     path = some/path\n   *     url = https://github.com/...\n   *     branch = main\n   */\n  private parseGitmodulesContent(content: string): GitmodulesEntry[] {\n    const entries: GitmodulesEntry[] = [];\n    const lines = content.split('\\n');\n\n    let currentEntry: Partial<GitmodulesEntry> | null = null;\n\n    for (const line of lines) {\n      const trimmed = line.trim();\n\n      // Skip empty lines and comments\n      if (!trimmed || trimmed.startsWith('#')) {\n        continue;\n      }\n\n      // Check for section header: [submodule \"name\"]\n      const sectionMatch = trimmed.match(/^\\[submodule\\s+\"([^\"]+)\"\\]$/);\n      if (sectionMatch) {\n        // Save previous entry if valid\n        if (currentEntry?.name && currentEntry?.path) {\n          entries.push(currentEntry as GitmodulesEntry);\n        }\n\n        // Start new entry\n        currentEntry = {\n          name: sectionMatch[1],\n        };\n        continue;\n      }\n\n      // Parse key = value pairs\n      if (currentEntry) {\n        const keyValueMatch = trimmed.match(/^(\\w+)\\s*=\\s*(.+)$/);\n        if (keyValueMatch && keyValueMatch[1] && keyValueMatch[2]) {\n          const key = keyValueMatch[1];\n          const value = keyValueMatch[2];\n          switch (key.toLowerCase()) {\n            case 'path':\n              currentEntry.path = value.trim();\n              break;\n            case 'url':\n              currentEntry.url = value.trim();\n              break;\n            case 'branch':\n              currentEntry.branch = value.trim();\n              break;\n          }\n        }\n      }\n    }\n\n    // Don't forget the last entry\n    if (currentEntry?.name && currentEntry?.path) {\n      entries.push(currentEntry as GitmodulesEntry);\n    }\n\n    return entries;\n  }\n\n  /**\n   * Checks initialization status of a submodule via git command.\n   */\n  private checkInitialization(\n    repoRoot: string,\n    submodulePath: string\n  ): { initialized: boolean; commit?: string; warning?: string } {\n    try {\n      // Use git submodule status to check initialization\n      const output = execSync(`git submodule status \"${submodulePath}\"`, {\n        cwd: repoRoot,\n        encoding: 'utf-8',\n        stdio: ['pipe', 'pipe', 'pipe'],\n      });\n\n      // Parse output: \" abc123 path\" (initialized) or \"-abc123 path\" (not initialized)\n      const trimmed = output.trim();\n\n      if (trimmed.startsWith('-')) {\n        // Not initialized (prefix is -)\n        return { initialized: false };\n      }\n\n      if (trimmed.startsWith('+')) {\n        // Initialized but has local changes (prefix is +)\n        const commitMatch = trimmed.match(/^\\+([a-f0-9]+)/);\n        return {\n          initialized: true,\n          commit: commitMatch?.[1],\n          warning: 'Submodule has uncommitted changes',\n        };\n      }\n\n      // Normal initialized state (prefix is space)\n      const commitMatch = trimmed.match(/^\\s*([a-f0-9]+)/);\n      return {\n        initialized: true,\n        commit: commitMatch?.[1],\n      };\n    } catch {\n      // Git command failed - might not be a git repo or git not available\n      return {\n        initialized: false,\n        warning: 'Could not determine git status',\n      };\n    }\n  }\n}\n\n/**\n * Convenience function to check all submodules in a repository.\n *\n * @param repoRoot - Root directory of the git repository\n * @param options - Checker options\n * @returns Array of submodule statuses\n */\nexport async function checkSubmodules(\n  repoRoot: string,\n  options?: SubmoduleCheckerOptions\n): Promise<SubmoduleStatus[]> {\n  const checker = new SubmoduleChecker();\n  return checker.checkAll(repoRoot, options);\n}\n\n/**\n * Checks if a directory is a git submodule.\n *\n * @param dirPath - Directory to check\n * @param repoRoot - Root of the parent repository\n * @returns Scan result with submodule information\n */\nexport async function scanSubmodule(\n  dirPath: string,\n  repoRoot: string\n): Promise<SubmoduleScanResult> {\n  const checker = new SubmoduleChecker();\n  return checker.scan(dirPath, repoRoot);\n}\n\n/**\n * Checks if a path is within a git submodule.\n *\n * @param checkPath - Path to check\n * @param repoRoot - Root of the parent repository\n * @returns True if path is inside a submodule\n */\nexport async function isPathInSubmodule(\n  checkPath: string,\n  repoRoot: string\n): Promise<boolean> {\n  const checker = new SubmoduleChecker();\n  return checker.isInSubmodule(checkPath, repoRoot);\n}\n\n/**\n * Parses a .gitmodules file directly.\n *\n * @param gitmodulesPath - Path to .gitmodules file\n * @returns Array of submodule paths\n */\nexport async function parseGitmodulesFile(\n  gitmodulesPath: string\n): Promise<string[]> {\n  if (!existsSync(gitmodulesPath)) {\n    return [];\n  }\n\n  try {\n    const content = await readFile(gitmodulesPath, 'utf-8');\n    const paths: string[] = [];\n    const lines = content.split('\\n');\n\n    for (const line of lines) {\n      const match = line.trim().match(/^path\\s*=\\s*(.+)$/);\n      if (match && match[1]) {\n        paths.push(match[1].trim());\n      }\n    }\n\n    return paths;\n  } catch {\n    return [];\n  }\n}\n","/**\n * Node.js Version Detection\n *\n * Detects and validates Node.js version for ESM compatibility determination.\n *\n * @module @artk/core/detection/env/node-version\n */\n\nimport type { NodeVersionParsed } from '../../types/environment-context.js';\n\n/**\n * Parsed Node version with raw string\n */\nexport interface ParsedNodeVersion extends NodeVersionParsed {\n  /**\n   * Raw version string (e.g., \"18.12.1\")\n   */\n  raw: string;\n}\n\n/**\n * ESM compatibility flags\n */\nexport interface ESMCompatibility {\n  /**\n   * Basic ESM support (Node 18+)\n   */\n  supportsESM: boolean;\n\n  /**\n   * Full ESM support including all features (Node 20+)\n   */\n  supportsFullESM: boolean;\n\n  /**\n   * Supports import.meta.url (Node 18+ in ESM mode)\n   */\n  supportsImportMeta: boolean;\n\n  /**\n   * Supports import.meta.dirname (Node 20.11.0+)\n   */\n  supportsBuiltinDirname: boolean;\n}\n\n/**\n * Minimum supported Node.js version\n */\nconst MIN_NODE_VERSION = 18;\n\n/**\n * Node version for full ESM support\n */\nconst FULL_ESM_VERSION = 20;\n\n/**\n * Node version for import.meta.dirname support\n */\nconst BUILTIN_DIRNAME_VERSION = { major: 20, minor: 11, patch: 0 };\n\n/**\n * Parses a Node.js version string into components\n *\n * @param version - Version string (e.g., \"v18.12.1\" or \"18.12.1\")\n * @returns Parsed version components\n * @throws Error if version format is invalid\n *\n * @example\n * ```typescript\n * parseNodeVersion('v18.12.1');\n * // { major: 18, minor: 12, patch: 1 }\n * ```\n */\nexport function parseNodeVersion(version: string): ParsedNodeVersion {\n  if (!version) {\n    throw new Error('Node version string is required');\n  }\n\n  // Remove 'v' prefix if present\n  const cleanVersion = version.replace(/^v/, '');\n\n  // Match semver pattern (allow pre-release suffix)\n  const match = cleanVersion.match(/^(\\d+)\\.(\\d+)\\.(\\d+)/);\n\n  if (!match) {\n    throw new Error(`Invalid Node.js version format: \"${version}\". Expected semver format (e.g., \"18.12.1\")`);\n  }\n\n  // Match groups are guaranteed to exist if the regex matched\n  const majorStr = match[1] as string;\n  const minorStr = match[2] as string;\n  const patchStr = match[3] as string;\n  const rawVersion = cleanVersion.split('-')[0] as string;\n\n  return {\n    major: parseInt(majorStr, 10),\n    minor: parseInt(minorStr, 10),\n    patch: parseInt(patchStr, 10),\n    raw: rawVersion, // Remove pre-release suffix for raw\n  };\n}\n\n/**\n * Gets the current Node.js version\n *\n * @returns Parsed version of the running Node.js process\n *\n * @example\n * ```typescript\n * const version = getNodeVersion();\n * console.log(`Running Node ${version.major}.${version.minor}.${version.patch}`);\n * ```\n */\nexport function getNodeVersion(): ParsedNodeVersion {\n  return parseNodeVersion(process.version);\n}\n\n/**\n * Validates that Node.js version meets minimum requirements (FR-009)\n *\n * @param version - Parsed Node version\n * @throws Error if Node version is below minimum supported\n *\n * @example\n * ```typescript\n * validateNodeVersion({ major: 18, minor: 0, patch: 0, raw: '18.0.0' });\n * // No error\n *\n * validateNodeVersion({ major: 16, minor: 20, patch: 0, raw: '16.20.0' });\n * // Throws: Node.js version must be >= 18.0.0\n * ```\n */\nexport function validateNodeVersion(version: ParsedNodeVersion): void {\n  if (version.major < MIN_NODE_VERSION) {\n    throw new Error(\n      `Node.js version must be >= ${MIN_NODE_VERSION}.0.0. ` +\n      `Current version: ${version.raw}. ` +\n      `Please upgrade Node.js to use ARTK.`\n    );\n  }\n}\n\n/**\n * Determines ESM compatibility based on Node version (FR-004)\n *\n * @param version - Parsed Node version\n * @returns ESM compatibility flags\n *\n * @example\n * ```typescript\n * determineESMCompatibility({ major: 18, minor: 12, patch: 1, raw: '18.12.1' });\n * // { supportsESM: true, supportsFullESM: false, supportsImportMeta: true, supportsBuiltinDirname: false }\n *\n * determineESMCompatibility({ major: 20, minor: 11, patch: 0, raw: '20.11.0' });\n * // { supportsESM: true, supportsFullESM: true, supportsImportMeta: true, supportsBuiltinDirname: true }\n * ```\n */\nexport function determineESMCompatibility(version: ParsedNodeVersion): ESMCompatibility {\n  const supportsESM = version.major >= MIN_NODE_VERSION;\n  const supportsFullESM = version.major >= FULL_ESM_VERSION;\n\n  // import.meta.dirname requires Node 20.11.0+\n  const supportsBuiltinDirname =\n    version.major > BUILTIN_DIRNAME_VERSION.major ||\n    (version.major === BUILTIN_DIRNAME_VERSION.major &&\n      version.minor >= BUILTIN_DIRNAME_VERSION.minor);\n\n  return {\n    supportsESM,\n    supportsFullESM,\n    supportsImportMeta: supportsESM, // Available in Node 18+ for ESM\n    supportsBuiltinDirname,\n  };\n}\n\n/**\n * Checks if version A is greater than or equal to version B\n *\n * @internal\n */\nexport function isVersionGte(\n  a: { major: number; minor: number; patch: number },\n  b: { major: number; minor: number; patch: number }\n): boolean {\n  if (a.major !== b.major) return a.major > b.major;\n  if (a.minor !== b.minor) return a.minor > b.minor;\n  return a.patch >= b.patch;\n}\n","/**\n * Module System Detection\n *\n * Detects whether a project uses CommonJS or ESM based on package.json.\n *\n * @module @artk/core/detection/env/module-system\n */\n\nimport * as fs from 'fs';\nimport * as path from 'path';\nimport type { ModuleSystem, DetectionMethod, DetectionConfidence } from '../../types/environment-context.js';\n\n/**\n * Minimal package.json type for detection\n */\nexport interface PackageJsonMinimal {\n  name?: string;\n  version?: string;\n  type?: string;\n  [key: string]: unknown;\n}\n\n/**\n * Result of module system detection from package.json\n */\nexport interface ModuleSystemDetectionResult {\n  /**\n   * Detected module system\n   */\n  moduleSystem: ModuleSystem;\n\n  /**\n   * How detection was performed\n   */\n  detectionMethod: DetectionMethod;\n\n  /**\n   * Confidence in the detection\n   */\n  confidence: DetectionConfidence;\n\n  /**\n   * Warnings encountered during detection\n   */\n  warnings: string[];\n\n  /**\n   * Raw type field value from package.json\n   */\n  rawType?: string;\n}\n\n/**\n * Gets module system from package.json \"type\" field (FR-002)\n *\n * Per Node.js specification:\n * - \"module\" = ESM\n * - \"commonjs\" or absent = CommonJS\n *\n * @param typeField - Value of \"type\" field from package.json\n * @returns Module system ('commonjs' or 'esm')\n *\n * @example\n * ```typescript\n * getModuleSystemFromType('module');   // 'esm'\n * getModuleSystemFromType('commonjs'); // 'commonjs'\n * getModuleSystemFromType(undefined);  // 'commonjs'\n * ```\n */\nexport function getModuleSystemFromType(typeField: string | undefined): ModuleSystem {\n  if (typeField === 'module') {\n    return 'esm';\n  }\n  // \"commonjs\" or any other value (including undefined) = CommonJS\n  return 'commonjs';\n}\n\n/**\n * Parses package.json content string\n *\n * @param content - Raw package.json content\n * @returns Parsed package.json object\n * @throws Error if content is invalid JSON\n *\n * @example\n * ```typescript\n * const pkg = parsePackageJson('{\"name\": \"test\", \"type\": \"module\"}');\n * // { name: 'test', type: 'module' }\n * ```\n */\nexport function parsePackageJson(content: string): PackageJsonMinimal {\n  try {\n    return JSON.parse(content);\n  } catch (error) {\n    throw new Error(\n      `Failed to parse package.json: ${error instanceof Error ? error.message : 'Invalid JSON'}`\n    );\n  }\n}\n\n/**\n * Detects module system from package.json in the project root (FR-002)\n *\n * @param projectRoot - Path to project root directory\n * @returns Detection result with module system, method, and warnings\n *\n * @example\n * ```typescript\n * const result = detectModuleSystem('/path/to/project');\n * if (result.moduleSystem === 'esm') {\n *   console.log('Project uses ES Modules');\n * }\n * ```\n */\nexport function detectModuleSystem(projectRoot: string): ModuleSystemDetectionResult {\n  const warnings: string[] = [];\n  const packageJsonPath = path.join(projectRoot, 'package.json');\n\n  // Check if package.json exists\n  if (!fs.existsSync(packageJsonPath)) {\n    warnings.push('package.json not found in project root. Using CommonJS fallback.');\n    return {\n      moduleSystem: 'commonjs',\n      detectionMethod: 'fallback',\n      confidence: 'low',\n      warnings,\n    };\n  }\n\n  // Read and parse package.json\n  let pkg: PackageJsonMinimal;\n  try {\n    const content = fs.readFileSync(packageJsonPath, 'utf8');\n    pkg = parsePackageJson(content);\n  } catch (error) {\n    warnings.push(\n      `Failed to parse package.json: ${error instanceof Error ? error.message : 'Unknown error'}. Using CommonJS fallback.`\n    );\n    return {\n      moduleSystem: 'commonjs',\n      detectionMethod: 'fallback',\n      confidence: 'low',\n      warnings,\n    };\n  }\n\n  // Determine module system from type field\n  const moduleSystem = getModuleSystemFromType(pkg.type);\n\n  return {\n    moduleSystem,\n    detectionMethod: 'package.json',\n    confidence: 'high',\n    warnings,\n    rawType: pkg.type,\n  };\n}\n","/**\n * TypeScript Configuration Detection\n *\n * Detects TypeScript module settings from tsconfig.json.\n * Uses strip-json-comments to handle JSON with comments.\n *\n * @module @artk/core/detection/env/typescript-config\n */\n\nimport * as fs from 'fs';\nimport * as path from 'path';\nimport stripJsonComments from 'strip-json-comments';\nimport type { ModuleSystem } from '../../types/environment-context.js';\n\n/**\n * Minimal tsconfig.json structure for detection\n */\nexport interface TsConfigMinimal {\n  compilerOptions?: {\n    module?: string;\n    target?: string;\n    moduleResolution?: string;\n    [key: string]: unknown;\n  };\n  extends?: string;\n  [key: string]: unknown;\n}\n\n/**\n * Result of TypeScript config detection\n */\nexport interface TypeScriptDetectionResult {\n  /**\n   * TypeScript module setting (e.g., \"commonjs\", \"esnext\", \"nodenext\")\n   */\n  tsModule: string | null;\n\n  /**\n   * Inferred module system based on tsconfig module setting\n   */\n  inferredModuleSystem: ModuleSystem | null;\n\n  /**\n   * Warnings encountered during detection\n   */\n  warnings: string[];\n\n  /**\n   * Whether tsconfig.json was found\n   */\n  found: boolean;\n}\n\n/**\n * TypeScript module values that map to ESM\n */\nconst ESM_TS_MODULES = [\n  'es6',\n  'es2015',\n  'es2020',\n  'es2022',\n  'esnext',\n  'nodenext',\n  'node16',\n  'node18',\n];\n\n/**\n * TypeScript module values that map to CommonJS\n */\nconst CJS_TS_MODULES = ['commonjs', 'umd', 'amd', 'system'];\n\n/**\n * Parses tsconfig.json content, handling JSON with comments\n *\n * Uses strip-json-comments to remove single-line and block style comments.\n *\n * @param content - Raw tsconfig.json content (may contain comments)\n * @returns Parsed config object, or null if parsing fails\n *\n * @example\n * ```typescript\n * const config = parseTsConfig(`{\n *   // TypeScript configuration\n *   \"compilerOptions\": {\n *     \"module\": \"esnext\"\n *   }\n * }`);\n * // { compilerOptions: { module: 'esnext' } }\n * ```\n */\nexport function parseTsConfig(content: string): TsConfigMinimal | null {\n  try {\n    // Strip comments first\n    const cleanContent = stripJsonComments(content);\n    return JSON.parse(cleanContent);\n  } catch {\n    // Return null for any parse error (including invalid JSON after comment stripping)\n    return null;\n  }\n}\n\n/**\n * Extracts module setting from tsconfig\n *\n * @param config - Parsed tsconfig object\n * @returns Module setting or null if not found\n *\n * @example\n * ```typescript\n * getTsModuleFromConfig({ compilerOptions: { module: 'esnext' } });\n * // 'esnext'\n *\n * getTsModuleFromConfig({});\n * // null\n * ```\n */\nexport function getTsModuleFromConfig(config: TsConfigMinimal | null): string | null {\n  if (!config || !config.compilerOptions) {\n    return null;\n  }\n  return config.compilerOptions.module ?? null;\n}\n\n/**\n * Infers module system from TypeScript module setting\n *\n * @param tsModule - TypeScript module setting\n * @returns Inferred module system or null if cannot determine\n *\n * @example\n * ```typescript\n * inferModuleSystemFromTsModule('esnext');   // 'esm'\n * inferModuleSystemFromTsModule('commonjs'); // 'commonjs'\n * inferModuleSystemFromTsModule('unknown');  // null\n * ```\n */\nexport function inferModuleSystemFromTsModule(tsModule: string | null): ModuleSystem | null {\n  if (!tsModule) {\n    return null;\n  }\n\n  const normalized = tsModule.toLowerCase();\n\n  if (ESM_TS_MODULES.includes(normalized)) {\n    return 'esm';\n  }\n\n  if (CJS_TS_MODULES.includes(normalized)) {\n    return 'commonjs';\n  }\n\n  // Unknown module type\n  return null;\n}\n\n/**\n * Detects TypeScript module setting from tsconfig.json (FR-003)\n *\n * @param projectRoot - Path to project root directory\n * @returns Detection result with module setting and inferred system\n *\n * @example\n * ```typescript\n * const result = detectTypeScriptModule('/path/to/project');\n * if (result.tsModule === 'esnext') {\n *   console.log('TypeScript configured for ESM');\n * }\n * ```\n */\nexport function detectTypeScriptModule(projectRoot: string): TypeScriptDetectionResult {\n  const warnings: string[] = [];\n  const tsconfigPath = path.join(projectRoot, 'tsconfig.json');\n\n  // Check if tsconfig.json exists\n  if (!fs.existsSync(tsconfigPath)) {\n    return {\n      tsModule: null,\n      inferredModuleSystem: null,\n      warnings,\n      found: false,\n    };\n  }\n\n  // Read and parse tsconfig.json\n  let config: TsConfigMinimal | null;\n  try {\n    const content = fs.readFileSync(tsconfigPath, 'utf8');\n    config = parseTsConfig(content);\n  } catch (error) {\n    warnings.push(\n      `Failed to read tsconfig.json: ${error instanceof Error ? error.message : 'Unknown error'}`\n    );\n    return {\n      tsModule: null,\n      inferredModuleSystem: null,\n      warnings,\n      found: true,\n    };\n  }\n\n  if (!config) {\n    warnings.push('Failed to parse tsconfig.json (invalid JSON after comment stripping)');\n    return {\n      tsModule: null,\n      inferredModuleSystem: null,\n      warnings,\n      found: true,\n    };\n  }\n\n  const tsModule = getTsModuleFromConfig(config);\n  const inferredModuleSystem = inferModuleSystemFromTsModule(tsModule);\n\n  return {\n    tsModule,\n    inferredModuleSystem,\n    warnings,\n    found: true,\n  };\n}\n","/**\n * Detection Confidence Scoring\n *\n * Calculates confidence level based on consistency of detection signals.\n *\n * @module @artk/core/detection/env/confidence\n */\n\nimport type { ModuleSystem, DetectionConfidence } from '../../types/environment-context.js';\n\n/**\n * Signals used for confidence calculation\n */\nexport interface DetectionSignals {\n  /**\n   * Value of package.json \"type\" field\n   * undefined = no type field (CommonJS default)\n   */\n  packageJsonType: string | undefined;\n\n  /**\n   * Value of tsconfig.json compilerOptions.module\n   * null = no tsconfig or no module field\n   */\n  tsconfigModule: string | null;\n\n  /**\n   * Whether fallback was used (no package.json found)\n   */\n  usedFallback?: boolean;\n\n  /**\n   * Whether detection timed out\n   */\n  timedOut?: boolean;\n}\n\n/**\n * Result of confidence calculation\n */\nexport interface ConfidenceResult {\n  /**\n   * Confidence level\n   */\n  confidence: DetectionConfidence;\n\n  /**\n   * Recommended module system (prioritizing TypeScript for .ts files)\n   */\n  recommendedModuleSystem: ModuleSystem;\n\n  /**\n   * Warnings about detection\n   */\n  warnings: string[];\n}\n\n/**\n * TypeScript module values that indicate ESM\n */\nconst ESM_TS_MODULES = new Set([\n  'es6',\n  'es2015',\n  'es2020',\n  'es2022',\n  'esnext',\n  'nodenext',\n  'node16',\n  'node18',\n]);\n\n/**\n * Determines if a tsconfig module setting indicates ESM\n */\nfunction isTsModuleESM(tsModule: string | null): boolean | null {\n  if (!tsModule) return null;\n  return ESM_TS_MODULES.has(tsModule.toLowerCase());\n}\n\n/**\n * Determines if package.json type indicates ESM\n */\nfunction isPackageTypeESM(packageType: string | undefined): boolean {\n  return packageType === 'module';\n}\n\n/**\n * Calculates detection confidence based on signal consistency (FR-008)\n *\n * Confidence levels:\n * - 'high': package.json and tsconfig agree, or only one present\n * - 'medium': package.json and tsconfig conflict but clear precedence\n * - 'low': fallback used or timeout occurred\n *\n * When there's a conflict, TypeScript config is prioritized for .ts files.\n *\n * @param signals - Detection signals to evaluate\n * @returns Confidence result with recommended module system\n *\n * @example\n * ```typescript\n * // High confidence - both agree\n * calculateConfidence({ packageJsonType: 'module', tsconfigModule: 'esnext' });\n * // { confidence: 'high', recommendedModuleSystem: 'esm', warnings: [] }\n *\n * // Medium confidence - conflict\n * calculateConfidence({ packageJsonType: 'module', tsconfigModule: 'commonjs' });\n * // { confidence: 'medium', recommendedModuleSystem: 'commonjs', warnings: [...] }\n * ```\n */\nexport function calculateConfidence(signals: DetectionSignals): ConfidenceResult {\n  const warnings: string[] = [];\n\n  // Low confidence: fallback or timeout\n  if (signals.usedFallback || signals.timedOut) {\n    const reason = signals.timedOut ? 'detection timed out' : 'fallback was used';\n    warnings.push(`Low confidence: ${reason}`);\n\n    return {\n      confidence: 'low',\n      recommendedModuleSystem: 'commonjs', // Safe default\n      warnings,\n    };\n  }\n\n  const packageIsESM = isPackageTypeESM(signals.packageJsonType);\n  const tsIsESM = isTsModuleESM(signals.tsconfigModule);\n\n  // Case 1: Only package.json signal available\n  if (tsIsESM === null) {\n    return {\n      confidence: 'high',\n      recommendedModuleSystem: packageIsESM ? 'esm' : 'commonjs',\n      warnings,\n    };\n  }\n\n  // Case 2: Only tsconfig signal available (package.json has no type field)\n  if (signals.packageJsonType === undefined) {\n    // No explicit package type, tsconfig determines\n    return {\n      confidence: 'high',\n      recommendedModuleSystem: tsIsESM ? 'esm' : 'commonjs',\n      warnings,\n    };\n  }\n\n  // Case 3: Both signals available - check for agreement\n  const packageModuleSystem: ModuleSystem = packageIsESM ? 'esm' : 'commonjs';\n  const tsModuleSystem: ModuleSystem = tsIsESM ? 'esm' : 'commonjs';\n\n  if (packageModuleSystem === tsModuleSystem) {\n    // Agreement\n    return {\n      confidence: 'high',\n      recommendedModuleSystem: packageModuleSystem,\n      warnings,\n    };\n  }\n\n  // Case 4: Conflict - package.json and tsconfig disagree\n  warnings.push(\n    `Conflicting module system settings: package.json indicates \"${packageModuleSystem}\", ` +\n    `tsconfig.json indicates \"${tsModuleSystem}\".`\n  );\n  warnings.push(\n    'TypeScript configuration is prioritized for .ts files (recommended for foundation modules).'\n  );\n\n  return {\n    confidence: 'medium',\n    recommendedModuleSystem: tsModuleSystem, // Prioritize TypeScript config\n    warnings,\n  };\n}\n","/**\n * Environment Detection Module\n *\n * Automatically detects project environment (CommonJS/ESM, Node version, TypeScript config)\n * for foundation module generation.\n *\n * @module @artk/core/detection/env\n *\n * @example\n * ```typescript\n * import { detectEnvironment } from '@artk/core/detection';\n *\n * const result = detectEnvironment({ projectRoot: '/path/to/project' });\n * console.log(`Module system: ${result.context.moduleSystem}`);\n * console.log(`Template variant: ${result.context.templateVariant}`);\n * ```\n */\n\nimport * as fs from 'fs';\nimport * as path from 'path';\nimport type {\n  EnvironmentContext,\n  DetectionOptions as BaseDetectionOptions,\n  DetectionResult,\n} from '../../types/environment-context.js';\nimport { getNodeVersion, validateNodeVersion, determineESMCompatibility, type ParsedNodeVersion } from './node-version.js';\nimport { detectModuleSystem, type ModuleSystemDetectionResult } from './module-system.js';\nimport { detectTypeScriptModule, type TypeScriptDetectionResult } from './typescript-config.js';\nimport { calculateConfidence, type DetectionSignals } from './confidence.js';\n\n// Re-export sub-modules\nexport * from './node-version.js';\nexport * from './module-system.js';\nexport * from './typescript-config.js';\nexport * from './confidence.js';\n\n/**\n * Extended detection options\n */\nexport interface DetectionOptions extends BaseDetectionOptions {\n  /**\n   * Project root directory to detect environment for\n   */\n  projectRoot: string;\n\n  /**\n   * Force re-detection even if cached results exist\n   * @default false\n   */\n  forceDetect?: boolean;\n\n  /**\n   * Timeout in milliseconds for detection\n   * @default 5000\n   */\n  timeout?: number;\n}\n\n/**\n * Context file path\n */\nconst CONTEXT_DIR = '.artk';\nconst CONTEXT_FILE = 'context.json';\n\n/**\n * Default detection timeout (5 seconds per spec)\n */\nconst DEFAULT_TIMEOUT = 5000;\n\n/**\n * Reads cached context from .artk/context.json\n */\nfunction readCachedContext(projectRoot: string): EnvironmentContext | null {\n  const contextPath = path.join(projectRoot, CONTEXT_DIR, CONTEXT_FILE);\n\n  if (!fs.existsSync(contextPath)) {\n    return null;\n  }\n\n  try {\n    const content = fs.readFileSync(contextPath, 'utf8');\n    return JSON.parse(content);\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Writes context to .artk/context.json\n */\nfunction writeCachedContext(projectRoot: string, context: EnvironmentContext): void {\n  const contextDir = path.join(projectRoot, CONTEXT_DIR);\n  const contextPath = path.join(contextDir, CONTEXT_FILE);\n\n  // Create .artk directory if it doesn't exist\n  if (!fs.existsSync(contextDir)) {\n    fs.mkdirSync(contextDir, { recursive: true });\n  }\n\n  fs.writeFileSync(contextPath, JSON.stringify(context, null, 2));\n}\n\n/**\n * Creates an EnvironmentContext from detection results\n */\nfunction createEnvironmentContext(\n  nodeVersion: ParsedNodeVersion,\n  moduleSystemResult: ModuleSystemDetectionResult,\n  tsResult: TypeScriptDetectionResult,\n  confidenceResult: ReturnType<typeof calculateConfidence>\n): EnvironmentContext {\n  const esmCompat = determineESMCompatibility(nodeVersion);\n\n  // Determine final module system\n  const moduleSystem = confidenceResult.recommendedModuleSystem;\n\n  // Collect all warnings\n  const warnings = [\n    ...moduleSystemResult.warnings,\n    ...tsResult.warnings,\n    ...confidenceResult.warnings,\n  ];\n\n  return {\n    moduleSystem,\n    nodeVersion: nodeVersion.raw,\n    nodeVersionParsed: {\n      major: nodeVersion.major,\n      minor: nodeVersion.minor,\n      patch: nodeVersion.patch,\n    },\n    tsModule: tsResult.tsModule,\n    supportsImportMeta: moduleSystem === 'esm' && esmCompat.supportsImportMeta,\n    supportsBuiltinDirname: esmCompat.supportsBuiltinDirname,\n    templateVariant: moduleSystem,\n    templateSource: 'bundled',\n    detectionTimestamp: new Date().toISOString(),\n    detectionConfidence: confidenceResult.confidence,\n    detectionMethod: moduleSystemResult.detectionMethod,\n    warnings,\n  };\n}\n\n/**\n * Detects project environment (FR-001 through FR-010)\n *\n * Performs automatic detection of:\n * - Node.js version (FR-001)\n * - Module system from package.json (FR-002)\n * - TypeScript module setting (FR-003)\n * - ESM compatibility (FR-004)\n *\n * Results are cached to .artk/context.json (FR-005, FR-006).\n *\n * @param options - Detection options\n * @returns Detection result with environment context\n * @throws Error if projectRoot doesn't exist or Node version is unsupported\n *\n * @example\n * ```typescript\n * // Basic detection\n * const result = detectEnvironment({ projectRoot: '/path/to/project' });\n *\n * // Force re-detection (bypass cache)\n * const fresh = detectEnvironment({\n *   projectRoot: '/path/to/project',\n *   forceDetect: true\n * });\n * ```\n */\nexport function detectEnvironment(options: DetectionOptions): DetectionResult {\n  const { projectRoot, forceDetect = false, timeout = DEFAULT_TIMEOUT } = options;\n  const startTime = Date.now();\n\n  // Validate project root exists\n  if (!fs.existsSync(projectRoot)) {\n    throw new Error(`Project directory does not exist: ${projectRoot}`);\n  }\n\n  // Check for cached results (unless force-detect)\n  if (!forceDetect) {\n    const cached = readCachedContext(projectRoot);\n    if (cached) {\n      return {\n        context: cached,\n        fromCache: true,\n        detectionTime: Date.now() - startTime,\n      };\n    }\n  }\n\n  // Perform detection with timeout protection\n  let context: EnvironmentContext;\n  let timedOut = false;\n\n  try {\n    // Set up timeout check\n    const checkTimeout = () => {\n      if (Date.now() - startTime > timeout) {\n        timedOut = true;\n        throw new Error('Detection timeout');\n      }\n    };\n\n    // 1. Get Node version (FR-001)\n    const nodeVersion = getNodeVersion();\n    validateNodeVersion(nodeVersion);\n    checkTimeout();\n\n    // 2. Detect module system from package.json (FR-002)\n    const moduleSystemResult = detectModuleSystem(projectRoot);\n    checkTimeout();\n\n    // 3. Detect TypeScript module (FR-003)\n    const tsResult = detectTypeScriptModule(projectRoot);\n    checkTimeout();\n\n    // 4. Calculate confidence (FR-008)\n    const signals: DetectionSignals = {\n      packageJsonType: moduleSystemResult.rawType,\n      tsconfigModule: tsResult.tsModule,\n      usedFallback: moduleSystemResult.detectionMethod === 'fallback',\n      timedOut: false,\n    };\n    const confidenceResult = calculateConfidence(signals);\n\n    // 5. Create context\n    context = createEnvironmentContext(nodeVersion, moduleSystemResult, tsResult, confidenceResult);\n  } catch (error) {\n    if (timedOut || (error instanceof Error && error.message === 'Detection timeout')) {\n      // Fallback on timeout\n      const nodeVersion = getNodeVersion();\n      const esmCompat = determineESMCompatibility(nodeVersion);\n\n      context = {\n        moduleSystem: 'commonjs',\n        nodeVersion: nodeVersion.raw,\n        nodeVersionParsed: {\n          major: nodeVersion.major,\n          minor: nodeVersion.minor,\n          patch: nodeVersion.patch,\n        },\n        tsModule: null,\n        supportsImportMeta: false,\n        supportsBuiltinDirname: esmCompat.supportsBuiltinDirname,\n        templateVariant: 'commonjs',\n        templateSource: 'bundled',\n        detectionTimestamp: new Date().toISOString(),\n        detectionConfidence: 'low',\n        detectionMethod: 'fallback',\n        warnings: ['Detection timed out. Using CommonJS fallback.'],\n      };\n    } else {\n      throw error;\n    }\n  }\n\n  // Cache results (FR-005)\n  writeCachedContext(projectRoot, context);\n\n  return {\n    context,\n    fromCache: false,\n    detectionTime: Date.now() - startTime,\n  };\n}\n"]}