{"version":3,"sources":["../../src/config/schema.ts","../../src/config/loader.ts"],"names":["z","join","existsSync","resolve","readFileSync","parseYaml"],"mappings":"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","file":"index.cjs","sourcesContent":["/**\n * Zod schema for autogen.config.yml\n * @see research/2026-01-02_autogen-refined-plan.md Section 7\n */\nimport { z } from 'zod';\n\n/**\n * Selector strategy types following Playwright priority\n */\nexport const SelectorStrategySchema = z.enum([\n  'role',\n  'label',\n  'placeholder',\n  'text',\n  'testid',\n  'css',\n]);\n\n/**\n * Path configuration for generated artifacts\n */\nexport const PathsSchema = z.object({\n  journeys: z.string().default('journeys'),\n  modules: z.string().default('e2e/modules'),\n  tests: z.string().default('e2e/tests'),\n  templates: z.string().default('artk/templates'),\n  catalog: z.string().default('artk/selectors'),\n});\n\n/**\n * ESLint rule severity\n */\nexport const EslintSeveritySchema = z.enum(['error', 'warn', 'off']);\n\n/**\n * ESLint rules configuration\n */\nexport const EslintRulesSchema = z.record(z.string(), EslintSeveritySchema).default({\n  'no-wait-for-timeout': 'error',\n  'no-force-option': 'error',\n  'prefer-web-first-assertions': 'error',\n});\n\n/**\n * Selector policy configuration\n */\nexport const SelectorPolicySchema = z.object({\n  priority: z.array(SelectorStrategySchema).default([\n    'role',\n    'label',\n    'placeholder',\n    'text',\n    'testid',\n    'css',\n  ]),\n  forbiddenPatterns: z.array(z.string()).default([]),\n});\n\n/**\n * Validation configuration\n */\nexport const ValidationSchema = z.object({\n  eslintRules: EslintRulesSchema.default({\n    'no-wait-for-timeout': 'error',\n    'no-force-option': 'error',\n    'prefer-web-first-assertions': 'error',\n  }),\n  customRules: z.array(z.string()).default([]),\n});\n\n/**\n * Healing configuration\n */\nexport const HealSchema = z.object({\n  enabled: z.boolean().default(true),\n  maxSuggestions: z.number().min(1).max(10).default(5),\n  skipPatterns: z.array(z.string()).default([]),\n});\n\n/**\n * Code regeneration strategy\n */\nexport const RegenerationStrategySchema = z.enum(['ast', 'blocks']).default('ast');\n\n/**\n * Complete AutoGen configuration schema\n */\nexport const AutogenConfigSchema = z.object({\n  version: z.literal(1).default(1),\n  paths: PathsSchema.default({}),\n  selectorPolicy: SelectorPolicySchema.default({}),\n  validation: ValidationSchema.default({}),\n  heal: HealSchema.default({}),\n  regenerationStrategy: RegenerationStrategySchema,\n});\n\n/**\n * TypeScript types derived from schemas\n */\nexport type SelectorStrategy = z.infer<typeof SelectorStrategySchema>;\nexport type Paths = z.infer<typeof PathsSchema>;\nexport type EslintSeverity = z.infer<typeof EslintSeveritySchema>;\nexport type SelectorPolicy = z.infer<typeof SelectorPolicySchema>;\nexport type Validation = z.infer<typeof ValidationSchema>;\nexport type Heal = z.infer<typeof HealSchema>;\nexport type RegenerationStrategy = z.infer<typeof RegenerationStrategySchema>;\nexport type AutogenConfig = z.infer<typeof AutogenConfigSchema>;\n","/**\n * Config loader for artk/autogen.config.yml\n * @see research/2026-01-02_autogen-refined-plan.md Section 7\n */\nimport { readFileSync, existsSync } from 'node:fs';\nimport { join, resolve } from 'node:path';\nimport { parse as parseYaml } from 'yaml';\nimport { AutogenConfigSchema, type AutogenConfig } from './schema.js';\n\n/**\n * Default config file locations to search\n */\nconst CONFIG_PATHS = [\n  'artk/autogen.config.yml',\n  'artk/autogen.config.yaml',\n  '.artk/autogen.config.yml',\n  '.artk/autogen.config.yaml',\n];\n\n/**\n * Error thrown when config loading fails\n */\nexport class ConfigLoadError extends Error {\n  constructor(\n    message: string,\n    public readonly cause?: unknown\n  ) {\n    super(message);\n    this.name = 'ConfigLoadError';\n  }\n}\n\n/**\n * Find the config file in the project\n */\nexport function findConfigFile(rootDir: string): string | null {\n  for (const configPath of CONFIG_PATHS) {\n    const fullPath = join(rootDir, configPath);\n    if (existsSync(fullPath)) {\n      return fullPath;\n    }\n  }\n  return null;\n}\n\n/**\n * Load and parse the autogen config file\n * @param configPath - Path to config file, or project root to auto-detect\n * @returns Parsed and validated config\n * @throws ConfigLoadError if config cannot be loaded or is invalid\n */\nexport function loadConfig(configPath?: string): AutogenConfig {\n  const rootDir = process.cwd();\n  let resolvedPath: string;\n\n  if (configPath) {\n    resolvedPath = resolve(rootDir, configPath);\n  } else {\n    const found = findConfigFile(rootDir);\n    if (!found) {\n      // Return default config if no file found\n      console.warn(\n        'No autogen config file found, using defaults. Create artk/autogen.config.yml to customize.'\n      );\n      return AutogenConfigSchema.parse({});\n    }\n    resolvedPath = found;\n  }\n\n  if (!existsSync(resolvedPath)) {\n    throw new ConfigLoadError(`Config file not found: ${resolvedPath}`);\n  }\n\n  let rawContent: string;\n  try {\n    rawContent = readFileSync(resolvedPath, 'utf-8');\n  } catch (err) {\n    throw new ConfigLoadError(`Failed to read config file: ${resolvedPath}`, err);\n  }\n\n  let parsed: unknown;\n  try {\n    parsed = parseYaml(rawContent);\n  } catch (err) {\n    throw new ConfigLoadError(`Invalid YAML in config file: ${resolvedPath}`, err);\n  }\n\n  // Validate with Zod schema\n  const result = AutogenConfigSchema.safeParse(parsed);\n  if (!result.success) {\n    const issues = result.error.issues\n      .map((i) => `  - ${i.path.join('.')}: ${i.message}`)\n      .join('\\n');\n    throw new ConfigLoadError(\n      `Invalid config in ${resolvedPath}:\\n${issues}`,\n      result.error\n    );\n  }\n\n  return result.data;\n}\n\n/**\n * Get the default config without loading from file\n */\nexport function getDefaultConfig(): AutogenConfig {\n  return AutogenConfigSchema.parse({});\n}\n\n/**\n * Resolve a path from config relative to project root\n */\nexport function resolveConfigPath(\n  config: AutogenConfig,\n  pathKey: keyof AutogenConfig['paths'],\n  rootDir?: string\n): string {\n  const base = rootDir || process.cwd();\n  return resolve(base, config.paths[pathKey]);\n}\n"]}